2025-11-30 00:03:54.461 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T22:48:54.4564932Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:04:49.986 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:04:49.987 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:04:49.988 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:04:49.991 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:04:49.991 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:04:49.992 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:04:49.993 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:04:49.994 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:04:49.995 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:04:49.996 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:04:49.999 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:04:50.003 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:04:50.004 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:04:50.005 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:04:50.007 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:04:50.008 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.8423ms
2025-11-30 00:04:50.010 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:04:50.011 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:04:50.011 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:04:50.012 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 20.9036ms
2025-11-30 00:04:50.013 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 14.6728ms
2025-11-30 00:04:50.014 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 27.9848ms
2025-11-30 00:04:50.015 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:04:50.019 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.4301ms
2025-11-30 00:04:50.020 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:04:50.021 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.225ms
2025-11-30 00:04:50.023 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:04:50.026 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 6.1474ms
2025-11-30 00:04:50.028 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:04:50.032 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:04:50.032 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:04:50.034 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:04:50.035 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:04:50.037 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:04:50.038 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:04:50.039 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.578ms
2025-11-30 00:04:50.040 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:04:50.042 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 9.1715ms
2025-11-30 00:04:50.043 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 15.6418ms
2025-11-30 00:04:50.065 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:04:50.065 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:04:50.067 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:04:50.070 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:04:50.071 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:04:50.071 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:04:50.073 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:04:50.074 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:04:50.075 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:04:50.075 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:04:50.079 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:04:50.080 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:04:50.082 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:04:50.083 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:04:50.086 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:04:50.088 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:04:50.090 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:04:50.090 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:04:50.092 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.9728ms
2025-11-30 00:04:50.094 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:04:50.095 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:04:50.097 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:04:50.097 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.2776ms
2025-11-30 00:04:50.100 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:04:50.101 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.7962ms
2025-11-30 00:04:50.106 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:04:50.109 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:04:50.110 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:04:52.133 +01:00 [INF] Received HTTP response headers after 2021.4171ms - 422
2025-11-30 00:04:52.134 +01:00 [INF] End processing HTTP request after 2024.5937ms - 422
2025-11-30 00:04:52.135 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:04:52.137 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2060.2609ms
2025-11-30 00:04:52.138 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:04:52.139 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2068.6586ms
2025-11-30 00:04:52.141 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2075.8625ms
2025-11-30 00:08:29.674 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:08:29.675 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:08:29.676 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:29.679 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:29.679 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:08:29.680 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:08:29.681 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:08:29.683 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:08:29.684 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:08:29.684 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:08:29.696 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:08:29.697 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:08:29.700 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:08:29.702 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:08:29.703 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:08:29.705 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:08:29.707 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 20.9019ms
2025-11-30 00:08:29.707 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:29.708 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:08:29.709 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 22.3084ms
2025-11-30 00:08:29.710 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 30.8468ms
2025-11-30 00:08:29.711 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:08:29.713 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 39.0747ms
2025-11-30 00:08:29.714 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 34.1979ms
2025-11-30 00:08:29.718 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 43.5313ms
2025-11-30 00:08:29.735 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:08:29.737 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:29.738 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.9678ms
2025-11-30 00:08:29.739 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:08:29.743 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:29.743 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:08:29.745 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:08:29.745 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:08:29.748 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:08:29.748 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:29.750 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6729ms
2025-11-30 00:08:29.751 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:08:29.752 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.5548ms
2025-11-30 00:08:29.754 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.1523ms
2025-11-30 00:08:29.757 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:08:29.759 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:08:29.759 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:29.761 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:29.762 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:08:29.762 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:08:29.763 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:08:29.765 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:08:29.766 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:08:29.766 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:08:29.769 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:08:29.770 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:08:29.772 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:08:29.774 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:08:29.775 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:08:29.777 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:08:29.779 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:29.779 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:29.781 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:08:29.782 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.9897ms
2025-11-30 00:08:29.785 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:29.785 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:08:29.787 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:29.788 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.3275ms
2025-11-30 00:08:29.790 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:29.791 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.26ms
2025-11-30 00:08:29.793 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:08:29.797 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:08:31.827 +01:00 [INF] Received HTTP response headers after 2029.7015ms - 422
2025-11-30 00:08:31.829 +01:00 [INF] End processing HTTP request after 2035.7035ms - 422
2025-11-30 00:08:31.830 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:08:31.831 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2063.5807ms
2025-11-30 00:08:31.832 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:08:31.833 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2071.4631ms
2025-11-30 00:08:31.835 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2077.7758ms
2025-11-30 00:08:54.422 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 00:08:54.423 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:08:54.424 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.426 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.427 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.732ms
2025-11-30 00:08:54.428 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.6462ms
2025-11-30 00:08:54.431 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 00:08:54.432 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:08:54.434 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.436 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.437 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:54'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:08:54.437 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:54'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:08:54.439 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:54'.
2025-11-30 00:08:54.440 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:54'.
2025-11-30 00:08:54.440 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 00:08:54.441 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 00:08:54.442 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:08:54.443 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:08:54.444 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 00:08:54.445 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:08:54.448 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 00:08:54.449 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:08:54.451 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 00:08:54.452 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 00:08:54.454 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.2131ms
2025-11-30 00:08:54.454 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-29T23:08:54.4535265Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-29T23:08:54.4534553Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-29T23:08:54.4534558Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T22:36:46.020051","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T22:36:46.020052"}' (Size = 4000), @p8='0HNHFH06JI8T4:00000004' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-29T23:08:54.4534553Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-29T23:08:54.4534558Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 00:08:54.455 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:08:54.458 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 16.6853ms
2025-11-30 00:08:54.459 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:54.460 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 28.058ms
2025-11-30 00:08:54.461 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.2696ms
2025-11-30 00:08:54.464 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:08:54.465 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 24.6084ms
2025-11-30 00:08:54.467 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 35.325ms
2025-11-30 00:08:54.473 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T22:53:54.4726002Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:08:54.485 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:08:54.487 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.488 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:08:54.489 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:08:54.490 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:08:54.493 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:08:54.495 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:08:54.497 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:08:54.498 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.1711ms
2025-11-30 00:08:54.499 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:08:54.500 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 12.0529ms
2025-11-30 00:08:54.501 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 16.2624ms
2025-11-30 00:08:54.505 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:08:54.507 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.507 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.2667ms
2025-11-30 00:08:54.513 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:08:54.515 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.516 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:08:54.517 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:08:54.518 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:08:54.520 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:08:54.520 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:54.521 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.1159ms
2025-11-30 00:08:54.522 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:08:54.523 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.4375ms
2025-11-30 00:08:54.525 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.4055ms
2025-11-30 00:08:54.540 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:08:54.540 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:08:54.542 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.544 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:54.544 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:08:54.545 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:08:54.546 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:08:54.547 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:08:54.548 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:08:54.549 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:08:54.552 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:08:54.552 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:08:54.554 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:08:54.556 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:08:54.558 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:08:54.559 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:08:54.561 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:54.561 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:54.564 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:08:54.564 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.0175ms
2025-11-30 00:08:54.567 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:54.568 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:08:54.570 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:54.570 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.2211ms
2025-11-30 00:08:54.573 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:08:54.574 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.2476ms
2025-11-30 00:08:54.576 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:08:54.580 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:08:56.625 +01:00 [INF] Received HTTP response headers after 2043.9499ms - 422
2025-11-30 00:08:56.626 +01:00 [INF] End processing HTTP request after 2050.5889ms - 422
2025-11-30 00:08:56.627 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:08:56.629 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2079.0159ms
2025-11-30 00:08:56.630 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:08:56.631 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2086.7205ms
2025-11-30 00:08:56.632 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2092.2896ms
2025-11-30 00:08:56.840 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 00:08:56.843 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:56.843 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.1174ms
2025-11-30 00:08:56.845 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:08:56.849 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:56.850 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:56'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:08:56.852 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:56'.
2025-11-30 00:08:56.853 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:08:56.854 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:08:56.855 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:08:56.858 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU3NzM0LCJleHAiOjE3OTU5OTM3MzQsImlhdCI6MTc2NDQ1NzczNCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.XhCZyvd8IJFb5on66RHHYBueuqdSVphdz7nkwIkmXg8' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:08:56.861 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:08:56.864 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:08:56.868 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:08:56.8669009Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:08:56.8669003Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:08:56.8671042Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482597' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482597,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:08:56.8669009Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:08:56.8669003Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8T4:00000007' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:08:56.873 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:08:56.874 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 17.6732ms
2025-11-30 00:08:56.875 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:08:56.876 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 23.779ms
2025-11-30 00:08:56.878 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 33.1125ms
2025-11-30 00:08:56.896 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:08:56.898 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:56.899 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.8264ms
2025-11-30 00:08:56.901 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:08:56.904 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:56.905 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:08:56.906 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:08:56.907 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:08:56.908 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0055ms
2025-11-30 00:08:56.909 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.5826ms
2025-11-30 00:08:56.911 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=xtwmAFzyW7mWuD81SCr7Kw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:08:56.914 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:56.915 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:08:56.916 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:08:56.919 +01:00 [INF] SignalR connected: 5X1vOFjWlTpDhCCJzBQK7w user:null
2025-11-30 00:08:56.922 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:08:56.925 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:08:56.9245906Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:08:56.9246527Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:08:56.9245906Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8T6:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:08:57.396 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/120 - null null
2025-11-30 00:08:57.398 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:57.398 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/120 - 204 null null 2.5086ms
2025-11-30 00:08:57.401 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/120 - null null
2025-11-30 00:08:57.402 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:08:57.403 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:57'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:08:57.405 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:08:57'.
2025-11-30 00:08:57.405 +01:00 [INF] HTTP GET /api/Conversations/history/120 started - IP: 127.0.0.1
2025-11-30 00:08:57.406 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:08:57.407 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:08:57.410 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:08:57.413 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:08:57.416 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:08:57.418 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:08:57.419 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.2873ms
2025-11-30 00:08:57.420 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:08:57.421 +01:00 [INF] HTTP GET /api/Conversations/history/120 completed - Status: 200 - Duration: 15.4321ms
2025-11-30 00:08:57.422 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/120 - 200 null application/json; charset=utf-8 21.4361ms
2025-11-30 00:08:58.563 +01:00 [INF] 💾 [SaveWelcomeMessage] Guardando mensaje de bienvenida - ConvId: 120, BotId: 1
2025-11-30 00:08:58.564 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:08:58.568 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='1' (Nullable = true), @p1='120', @p2='2025-11-29T23:08:58.5668898Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='¡Hola veci! ¿Cómo estás? ¿En qué te puedo ayudar?' (Size = 4000), @p5='4' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='bot' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13='5' (Nullable = true), @p14='CREATE' (Size = 100), @p15='2025-11-29T23:08:58.5670512Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482645' (Nullable = true), @p18='Message' (Size = 100), @p19='127.0.0.1' (Size = 45), @p20='{"Id":-2147482645,"BotId":1,"ConversationId":120,"CreatedAt":"2025-11-29T23:08:58.5668898Z","FileId":null,"MessageText":"¡Hola veci! ¿Cómo estás? ¿En qué te puedo ayudar?","PublicUserId":4,"Read":false,"ReplyToMessageId":null,"Sender":"bot","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":5}' (Size = 4000), @p21='' (Size = 4000), @p22='0HNHFH06JI8T6:00000001' (Size = 50), @p23='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:08:58.572 +01:00 [INF] ✅ [SaveWelcomeMessage] Mensaje de bienvenida guardado - MessageId: 46
2025-11-30 00:09:26.905 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:09:26.908 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:09:26.9071977Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:09:26.9072675Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:09:26.9071977Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:08:56.92459"}' (Size = 4000), @p10='0HNHFH06JI8T6:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:09:42.714 +01:00 [INF] SignalR disconnected: 5X1vOFjWlTpDhCCJzBQK7w user:null ex:null
2025-11-30 00:09:42.714 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:09:42.715 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:09:42.716 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:09:42.718 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.720 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.721 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:09:42.721 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 45806.2907ms
2025-11-30 00:09:42.722 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:09:42.722 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:09:42.724 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.726 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 45806.2907ms
2025-11-30 00:09:42.727 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:09:42.728 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:09:42.729 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 7.7916ms
2025-11-30 00:09:42.730 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=xtwmAFzyW7mWuD81SCr7Kw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 45819.106ms
2025-11-30 00:09:42.731 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:09:42.731 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:09:42.732 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:09:42.738 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.742 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:09:42.742 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:09:42.742 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:09:42.745 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:09:42.745 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:09:42.748 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:09:42.749 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:09:42.750 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:09:42.752 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:09:42.753 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 13.6306ms
2025-11-30 00:09:42.754 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 12.1538ms
2025-11-30 00:09:42.755 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:09:42.756 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:09:42.758 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 27.2174ms
2025-11-30 00:09:42.759 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 17.4575ms
2025-11-30 00:09:42.760 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 37.8454ms
2025-11-30 00:09:42.764 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:09:42.765 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 51.1626ms
2025-11-30 00:09:42.766 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 43.8125ms
2025-11-30 00:09:42.770 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 55.6276ms
2025-11-30 00:09:42.780 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=soY8vhWedhz6TClGqlvcOQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:09:42.782 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:09:42.782 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.784 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.785 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:09:42.786 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.9203ms
2025-11-30 00:09:42.787 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:09:42.788 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:09:42.792 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.793 +01:00 [INF] SignalR connected: IQCgw0sZFRe8HJ7NHb6dNQ user:null
2025-11-30 00:09:42.793 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:09:42.796 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:09:42.797 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:09:42.799 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:09:42.799 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:09:42.801 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.5103ms
2025-11-30 00:09:42.801 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:09:42.802 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:09:42.804 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 11.18ms
2025-11-30 00:09:42.805 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:09:42.8041224Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:09:42.8042017Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:09:42.8041224Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:09:26.907197"}' (Size = 4000), @p10='0HNHFH06JI8T8:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:09:42.806 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 17.4959ms
2025-11-30 00:09:42.809 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:09:42.813 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.813 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:09:42.814 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:09:42.816 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:42.818 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:09:42.818 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:09:42.819 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:09:42.820 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:09:42.823 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:09:42.823 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:09:42.825 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:09:42.828 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:09:42.830 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:09:42.832 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:09:42.833 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:09:42.835 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:42.835 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:09:42.838 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:09:42.838 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 14.1633ms
2025-11-30 00:09:42.841 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:42.841 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:09:42.843 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.3123ms
2025-11-30 00:09:42.843 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:42.845 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.8178ms
2025-11-30 00:09:42.848 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:42.852 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:09:42.853 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:09:44.879 +01:00 [INF] Received HTTP response headers after 2025.4779ms - 422
2025-11-30 00:09:44.880 +01:00 [INF] End processing HTTP request after 2028.4952ms - 422
2025-11-30 00:09:44.881 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:09:44.883 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2061.2287ms
2025-11-30 00:09:44.884 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:09:44.885 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2070.577ms
2025-11-30 00:09:44.886 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2077.0124ms
2025-11-30 00:09:50.302 +01:00 [INF] SignalR disconnected: IQCgw0sZFRe8HJ7NHb6dNQ user:null ex:null
2025-11-30 00:09:50.303 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:09:50.304 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 7518.4819ms
2025-11-30 00:09:50.305 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 7518.4819ms
2025-11-30 00:09:50.306 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=soY8vhWedhz6TClGqlvcOQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 7525.9519ms
2025-11-30 00:09:50.334 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/120/disconnect - null 0
2025-11-30 00:09:50.336 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:50.337 +01:00 [INF] HTTP POST /api/conversations/120/disconnect started - IP: 127.0.0.1
2025-11-30 00:09:50.337 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:09:50.338 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api)'
2025-11-30 00:09:50.340 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:50.341 +01:00 [INF] Route matched with {action = "UserDisconnected", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UserDisconnected(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:09:50.342 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 4.1178ms
2025-11-30 00:09:50.345 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:09:50.349 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:09:50.3480273Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:09:50.3481118Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:09:50.3480273Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:09:42.804122"}' (Size = 4000), @p10='0HNHFH06JI8T4:0000000C' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:09:50.353 +01:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-11-30 00:09:50.354 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api) in 10.9883ms
2025-11-30 00:09:50.355 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api)'
2025-11-30 00:09:50.356 +01:00 [INF] HTTP POST /api/conversations/120/disconnect completed - Status: 200 - Duration: 18.6589ms
2025-11-30 00:09:50.357 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/120/disconnect - 200 0 null 22.895ms
2025-11-30 00:09:50.381 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:09:50.383 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:50.384 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:09:50.385 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:09:50.386 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:09:50.387 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0928ms
2025-11-30 00:09:50.389 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.0332ms
2025-11-30 00:09:52.052 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 00:09:52.052 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:09:52.054 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.056 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.057 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 5.0685ms
2025-11-30 00:09:52.058 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.4513ms
2025-11-30 00:09:52.063 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 00:09:52.063 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:09:52.065 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.068 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.069 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:09:52'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:09:52.070 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:09:52'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:09:52.071 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:09:52'.
2025-11-30 00:09:52.073 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:09:52'.
2025-11-30 00:09:52.074 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 00:09:52.075 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 00:09:52.076 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:09:52.077 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:09:52.078 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 00:09:52.079 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:09:52.082 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 00:09:52.083 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:09:52.085 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 00:09:52.086 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 00:09:52.089 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-29T23:09:52.0885103Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-29T23:09:52.0883959Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-29T23:09:52.0883965Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T23:08:54.453455","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T23:08:54.453455"}' (Size = 4000), @p8='0HNHFH06JI8T7:00000002' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-29T23:09:52.0883959Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-29T23:09:52.0883965Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 00:09:52.089 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 7.1511ms
2025-11-30 00:09:52.093 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:09:52.094 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 19.1412ms
2025-11-30 00:09:52.094 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:09:52.096 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 32.3365ms
2025-11-30 00:09:52.097 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 16.1735ms
2025-11-30 00:09:52.100 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:09:52.101 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 27.585ms
2025-11-30 00:09:52.103 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 39.7439ms
2025-11-30 00:09:52.148 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:09:52.150 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.151 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:09:52.152 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:09:52.153 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:09:52.156 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:09:52.159 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:09:52.161 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:09:52.163 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.5421ms
2025-11-30 00:09:52.164 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:09:52.165 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.65ms
2025-11-30 00:09:52.167 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 19.0353ms
2025-11-30 00:09:52.217 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:09:52.219 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.220 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.111ms
2025-11-30 00:09:52.221 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:09:52.224 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.225 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:09:52.226 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:09:52.227 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:09:52.230 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:09:52.230 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:09:52.232 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6204ms
2025-11-30 00:09:52.233 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:09:52.234 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 9.091ms
2025-11-30 00:09:52.236 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.698ms
2025-11-30 00:09:52.253 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:09:52.253 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:09:52.255 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.258 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:52.258 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:09:52.259 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:09:52.260 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:09:52.261 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:09:52.262 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:09:52.263 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:09:52.266 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:09:52.267 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:09:52.269 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:09:52.271 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:09:52.272 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:09:52.273 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:09:52.275 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:09:52.275 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:52.276 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 10.6577ms
2025-11-30 00:09:52.279 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:09:52.280 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:09:52.282 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.2021ms
2025-11-30 00:09:52.282 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:52.284 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 30.5124ms
2025-11-30 00:09:52.286 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:52.290 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:09:52.292 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:09:52.293 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:09:53.598 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:09:53.601 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:53.601 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9879ms
2025-11-30 00:09:53.602 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:09:53.606 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:53.606 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:09:53.608 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:09:53.608 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:09:53.609 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0016ms
2025-11-30 00:09:53.611 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.9292ms
2025-11-30 00:09:53.612 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=fiG2Ge_O8gApFg8smPnYcw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:09:53.616 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:53.617 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:09:53.618 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:09:53.622 +01:00 [INF] SignalR connected: AhnGxH6nLXLvj8ec14CU6g user:null
2025-11-30 00:09:53.625 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:09:53.628 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:09:53.6271256Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:09:53.6272048Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:09:53.6271256Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:09:50.348027"}' (Size = 4000), @p10='0HNHFH06JI8T9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:09:54.125 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/120 - null null
2025-11-30 00:09:54.127 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:54.128 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/120 - 204 null null 3.3377ms
2025-11-30 00:09:54.130 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/120 - null null
2025-11-30 00:09:54.132 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:09:54.133 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:09:54'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:09:54.134 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:09:54'.
2025-11-30 00:09:54.135 +01:00 [INF] HTTP GET /api/Conversations/history/120 started - IP: 127.0.0.1
2025-11-30 00:09:54.136 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:09:54.137 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:09:54.140 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:09:54.142 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:09:54.145 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:09:54.147 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:09:54.149 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.5446ms
2025-11-30 00:09:54.150 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:09:54.151 +01:00 [INF] HTTP GET /api/Conversations/history/120 completed - Status: 200 - Duration: 15.7844ms
2025-11-30 00:09:54.152 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/120 - 200 null application/json; charset=utf-8 21.7832ms
2025-11-30 00:09:54.327 +01:00 [INF] Received HTTP response headers after 2033.1647ms - 422
2025-11-30 00:09:54.329 +01:00 [INF] End processing HTTP request after 2036.5601ms - 422
2025-11-30 00:09:54.330 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:09:54.331 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2067.1758ms
2025-11-30 00:09:54.332 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:09:54.333 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2075.0501ms
2025-11-30 00:09:54.335 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2082.103ms
2025-11-30 00:10:23.609 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:10:23.612 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:10:23.6118896Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:10:23.6119584Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:10:23.6118896Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:09:53.627125"}' (Size = 4000), @p10='0HNHFH06JI8T9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:10:53.637 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:10:53.640 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:10:53.6394494Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:10:53.6395181Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:10:53.6394494Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:10:23.611889"}' (Size = 4000), @p10='0HNHFH06JI8T9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:11:23.641 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:11:23.644 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:11:23.6434293Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:11:23.6435080Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:11:23.6434293Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:10:53.639449"}' (Size = 4000), @p10='0HNHFH06JI8T9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:11:30.616 +01:00 [INF] SignalR disconnected: AhnGxH6nLXLvj8ec14CU6g user:null ex:null
2025-11-30 00:11:30.618 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:11:30.618 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 97001.2776ms
2025-11-30 00:11:30.620 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 97001.2776ms
2025-11-30 00:11:30.621 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=fiG2Ge_O8gApFg8smPnYcw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 97008.5536ms
2025-11-30 00:11:32.027 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 00:11:32.030 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.030 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.9556ms
2025-11-30 00:11:32.032 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:11:32.035 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.036 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:11:32.037 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:32'.
2025-11-30 00:11:32.038 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:11:32.039 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:11:32.040 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:11:32.043 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU3NzkyLCJleHAiOjE3OTU5OTM3OTIsImlhdCI6MTc2NDQ1Nzc5MiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.HFa-0Nez9F-e28EfgJl9jbthIYuRqklYs9G0CB9W5gs' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:11:32.046 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:11:32.048 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:11:32.051 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:11:32.0500095Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:11:32.0500090Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:11:32.0501610Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482596' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482596,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:11:32.0500095Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:11:32.050009Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8T7:00000006' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:11:32.055 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:11:32.056 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.4795ms
2025-11-30 00:11:32.057 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:11:32.058 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.7449ms
2025-11-30 00:11:32.059 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.4881ms
2025-11-30 00:11:32.067 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=121&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:11:32.069 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.070 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=121&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.6787ms
2025-11-30 00:11:32.090 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=121&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:11:32.092 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.093 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:11:32.094 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:11:32.095 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:11:32.096 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.8934ms
2025-11-30 00:11:32.097 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=121&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.837ms
2025-11-30 00:11:32.099 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=121&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=LduBfvKi4kHBFMWz_56OhA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:11:32.102 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.102 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:11:32.104 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:11:32.107 +01:00 [INF] SignalR connected: m-QY7hlIO6PlzRZR0ah_XA user:null
2025-11-30 00:11:32.110 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='121'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:11:32.113 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='121', @p0='2025-11-29T23:11:32.1123132Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:11:32.1123840Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='121' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:11:32.1123132Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TA:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:11:32.587 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/121 - null null
2025-11-30 00:11:32.588 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.589 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/121 - 204 null null 2.3903ms
2025-11-30 00:11:32.591 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/121 - null null
2025-11-30 00:11:32.593 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:32.594 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:11:32.595 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:32'.
2025-11-30 00:11:32.596 +01:00 [INF] HTTP GET /api/Conversations/history/121 started - IP: 127.0.0.1
2025-11-30 00:11:32.597 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:11:32.597 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:11:32.600 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='121'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:11:32.602 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='121'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:11:32.604 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='121'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:11:32.606 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:11:32.607 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.8268ms
2025-11-30 00:11:32.608 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:11:32.609 +01:00 [INF] HTTP GET /api/Conversations/history/121 completed - Status: 200 - Duration: 13.7036ms
2025-11-30 00:11:32.611 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/121 - 200 null application/json; charset=utf-8 19.2565ms
2025-11-30 00:11:33.710 +01:00 [INF] SignalR disconnected: m-QY7hlIO6PlzRZR0ah_XA user:null ex:null
2025-11-30 00:11:33.711 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:11:33.712 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1609.3868ms
2025-11-30 00:11:33.713 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=121&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=LduBfvKi4kHBFMWz_56OhA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1613.9489ms
2025-11-30 00:11:35.056 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:11:35.058 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:35.058 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:35'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:11:35.060 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:35'.
2025-11-30 00:11:35.061 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:11:35.062 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:11:35.063 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:11:35.066 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU3NzkyLCJleHAiOjE3OTU5OTM3OTIsImlhdCI6MTc2NDQ1Nzc5MiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.HFa-0Nez9F-e28EfgJl9jbthIYuRqklYs9G0CB9W5gs' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:11:35.068 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:11:35.070 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:11:35.073 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:11:35.0723774Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:11:35.0723764Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:11:35.0724967Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482595' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482595,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:11:35.0723774Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:11:35.0723764Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8T7:00000008' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:11:35.078 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:11:35.079 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.2111ms
2025-11-30 00:11:35.080 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:11:35.081 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.3197ms
2025-11-30 00:11:35.083 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.321ms
2025-11-30 00:11:35.090 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=122&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:11:35.092 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:35.093 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=122&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9243ms
2025-11-30 00:11:35.095 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=122&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:11:35.097 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:35.098 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:11:35.099 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:11:35.100 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:11:35.101 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.8912ms
2025-11-30 00:11:35.102 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=122&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.3724ms
2025-11-30 00:11:35.121 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=122&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=mXEv04jd73-P0o3lNHqp-A&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:11:35.124 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:35.125 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:11:35.126 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:11:35.129 +01:00 [INF] SignalR connected: t5qYrXX8j7hkocrCS2XRCQ user:null
2025-11-30 00:11:35.132 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='122'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:11:35.135 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='122', @p0='2025-11-29T23:11:35.1346410Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:11:35.1346965Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='122' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:11:35.134641Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TB:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:11:35.596 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/122 - null null
2025-11-30 00:11:35.598 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:35.599 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/122 - 204 null null 2.461ms
2025-11-30 00:11:35.601 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/122 - null null
2025-11-30 00:11:35.603 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:11:35.603 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:35'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:11:35.605 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:11:35'.
2025-11-30 00:11:35.605 +01:00 [INF] HTTP GET /api/Conversations/history/122 started - IP: 127.0.0.1
2025-11-30 00:11:35.606 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:11:35.607 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:11:35.610 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='122'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:11:35.613 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='122'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:11:35.615 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='122'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:11:35.617 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:11:35.618 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.6923ms
2025-11-30 00:11:35.619 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:11:35.620 +01:00 [INF] HTTP GET /api/Conversations/history/122 completed - Status: 200 - Duration: 14.745ms
2025-11-30 00:11:35.621 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/122 - 200 null application/json; charset=utf-8 20.3105ms
2025-11-30 00:11:36.685 +01:00 [INF] SignalR disconnected: t5qYrXX8j7hkocrCS2XRCQ user:null ex:null
2025-11-30 00:11:36.687 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:11:36.688 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1563.4421ms
2025-11-30 00:11:36.689 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=122&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=mXEv04jd73-P0o3lNHqp-A&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1568.281ms
2025-11-30 00:13:54.485 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T22:58:54.4841676Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:15:24.018 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:15:24.018 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:15:24.020 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:24.022 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:24.023 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:15:24.023 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:15:24.024 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:15:24.026 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:15:24.026 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:15:24.027 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:15:24.030 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:15:24.033 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:15:24.035 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:24.037 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.1639ms
2025-11-30 00:15:24.038 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:15:24.039 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 15.6633ms
2025-11-30 00:15:24.040 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 22.2906ms
2025-11-30 00:15:24.043 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:15:24.045 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:15:24.046 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:15:24.047 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:24.049 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:15:24.049 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.2334ms
2025-11-30 00:15:24.050 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:24.053 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 23.5418ms
2025-11-30 00:15:24.055 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:15:24.056 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 32.2045ms
2025-11-30 00:15:24.057 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 38.8842ms
2025-11-30 00:15:24.080 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:15:24.082 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:24.083 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:15:24.084 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:15:24.085 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:24.088 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:15:24.088 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:24.089 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.4013ms
2025-11-30 00:15:24.090 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:15:24.091 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.0221ms
2025-11-30 00:15:24.092 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.2804ms
2025-11-30 00:15:24.096 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:15:24.097 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:15:24.098 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:24.100 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:24.100 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:15:24.101 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:15:24.102 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:15:24.104 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:15:24.104 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:15:24.105 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:15:24.108 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:15:24.109 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:15:24.111 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:15:24.113 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:15:24.115 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:15:24.116 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:15:24.118 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:24.118 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:24.121 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:15:24.122 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.5972ms
2025-11-30 00:15:24.124 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:24.124 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:15:24.127 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:24.127 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.1753ms
2025-11-30 00:15:24.129 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:24.131 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.2106ms
2025-11-30 00:15:24.132 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:15:24.135 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:15:26.171 +01:00 [INF] Received HTTP response headers after 2034.9004ms - 422
2025-11-30 00:15:26.172 +01:00 [INF] End processing HTTP request after 2040.0549ms - 422
2025-11-30 00:15:26.173 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:26.175 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2068.5416ms
2025-11-30 00:15:26.176 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:15:26.177 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2076.6978ms
2025-11-30 00:15:26.179 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2082.6414ms
2025-11-30 00:15:33.672 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 00:15:33.673 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:15:33.675 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.676 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.677 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.8393ms
2025-11-30 00:15:33.678 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.8394ms
2025-11-30 00:15:33.679 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 00:15:33.680 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:15:33.684 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.686 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.687 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:33'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:33.687 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:33'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:33.689 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:33'.
2025-11-30 00:15:33.690 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:33'.
2025-11-30 00:15:33.691 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 00:15:33.691 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 00:15:33.692 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:15:33.693 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:15:33.694 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 00:15:33.695 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:15:33.698 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 00:15:33.699 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:15:33.701 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 00:15:33.702 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 00:15:33.705 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.9496ms
2025-11-30 00:15:33.705 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-29T23:15:33.7044975Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-29T23:15:33.7044253Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-29T23:15:33.7044258Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T23:09:52.088395","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T23:09:52.088396"}' (Size = 4000), @p8='0HNHFH06JI8TD:00000004' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-29T23:15:33.7044253Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-29T23:15:33.7044258Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 00:15:33.707 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:15:33.709 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 18.0681ms
2025-11-30 00:15:33.711 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:33.711 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 31.0013ms
2025-11-30 00:15:33.712 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 15.5235ms
2025-11-30 00:15:33.716 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:15:33.717 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 26.0462ms
2025-11-30 00:15:33.718 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 39.6545ms
2025-11-30 00:15:33.771 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:15:33.773 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.774 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:15:33.775 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:15:33.776 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:15:33.779 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:15:33.782 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:15:33.784 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:33.786 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.6972ms
2025-11-30 00:15:33.787 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:15:33.788 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.3544ms
2025-11-30 00:15:33.789 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 17.9009ms
2025-11-30 00:15:33.804 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:15:33.806 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.807 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.8018ms
2025-11-30 00:15:33.808 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:15:33.812 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.812 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:15:33.813 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:15:33.814 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:33.817 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:15:33.817 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:33.819 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6733ms
2025-11-30 00:15:33.820 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:15:33.820 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.1693ms
2025-11-30 00:15:33.822 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.1628ms
2025-11-30 00:15:33.855 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:15:33.856 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:15:33.857 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.859 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:33.860 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:15:33.861 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:15:33.862 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:15:33.863 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:15:33.864 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:15:33.865 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:15:33.868 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:15:33.869 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:15:33.872 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:15:33.873 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:15:33.876 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:15:33.877 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:15:33.880 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:33.880 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:33.882 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:15:33.883 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 15.3133ms
2025-11-30 00:15:33.885 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:33.886 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:15:33.889 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:33.889 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 28.2513ms
2025-11-30 00:15:33.891 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:15:33.892 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.927ms
2025-11-30 00:15:33.894 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:15:33.897 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:15:34.572 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:15:34.574 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:34.574 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.6721ms
2025-11-30 00:15:34.576 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:15:34.579 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:34.580 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:15:34.581 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:15:34.581 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:15:34.582 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6456ms
2025-11-30 00:15:34.584 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.964ms
2025-11-30 00:15:34.586 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=xCqfSVryBRH11wYp33OV7w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:15:34.588 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:34.589 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:15:34.590 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:15:34.593 +01:00 [INF] SignalR connected: JG5ZCZ_6s0JiAKNDTZl2cA user:null
2025-11-30 00:15:34.596 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:15:34.599 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='120', @p0='2025-11-29T23:15:34.5981170Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:15:34.5981882Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='120' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:15:34.598117Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:11:23.643429"}' (Size = 4000), @p10='0HNHFH06JI8TG:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:15:35.096 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/120 - null null
2025-11-30 00:15:35.099 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:35.099 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/120 - 204 null null 2.758ms
2025-11-30 00:15:35.102 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/120 - null null
2025-11-30 00:15:35.104 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:35.104 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:35'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:35.106 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:35'.
2025-11-30 00:15:35.107 +01:00 [INF] HTTP GET /api/Conversations/history/120 started - IP: 127.0.0.1
2025-11-30 00:15:35.108 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:15:35.109 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:35.112 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:15:35.115 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:15:35.117 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='120'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:15:35.119 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:35.120 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.7375ms
2025-11-30 00:15:35.121 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:15:35.122 +01:00 [INF] HTTP GET /api/Conversations/history/120 completed - Status: 200 - Duration: 15.2037ms
2025-11-30 00:15:35.124 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/120 - 200 null application/json; charset=utf-8 22.154ms
2025-11-30 00:15:35.922 +01:00 [INF] Received HTTP response headers after 2023.4432ms - 422
2025-11-30 00:15:35.923 +01:00 [INF] End processing HTTP request after 2028.7422ms - 422
2025-11-30 00:15:35.924 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:35.925 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2058.9017ms
2025-11-30 00:15:35.926 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:15:35.927 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2066.7055ms
2025-11-30 00:15:35.928 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2073.273ms
2025-11-30 00:15:37.115 +01:00 [INF] SignalR disconnected: JG5ZCZ_6s0JiAKNDTZl2cA user:null ex:null
2025-11-30 00:15:37.117 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:15:37.118 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 2529.3792ms
2025-11-30 00:15:37.120 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=120&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=xCqfSVryBRH11wYp33OV7w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 2533.9185ms
2025-11-30 00:15:38.319 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 00:15:38.321 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.322 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.1198ms
2025-11-30 00:15:38.323 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:15:38.326 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.328 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:38'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:38.329 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:38'.
2025-11-30 00:15:38.330 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:15:38.331 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:15:38.332 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:38.335 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:15:38.338 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:15:38.340 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:15:38.343 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:15:38.3425431Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:15:38.3425426Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:15:38.3427019Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482594' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482594,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:15:38.3425431Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:15:38.3425426Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8TD:00000008' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:15:38.348 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:38.349 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.2275ms
2025-11-30 00:15:38.350 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:15:38.350 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.4056ms
2025-11-30 00:15:38.352 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.3836ms
2025-11-30 00:15:38.382 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=123&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:15:38.384 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.385 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=123&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.0792ms
2025-11-30 00:15:38.391 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=123&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:15:38.393 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.394 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:15:38.395 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:15:38.396 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:15:38.397 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.095ms
2025-11-30 00:15:38.398 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=123&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.6803ms
2025-11-30 00:15:38.400 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=123&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=QF0qAgZr9PUvDIjdDU9j0g&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:15:38.403 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.404 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:15:38.405 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:15:38.408 +01:00 [INF] SignalR connected: CaClD242ZP7FaqESLRltvw user:null
2025-11-30 00:15:38.411 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='123'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:15:38.414 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='123', @p0='2025-11-29T23:15:38.4136818Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:15:38.4137510Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='123' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:15:38.4136818Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:15:38.877 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/123 - null null
2025-11-30 00:15:38.879 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.880 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/123 - 204 null null 2.6998ms
2025-11-30 00:15:38.882 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/123 - null null
2025-11-30 00:15:38.884 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:38.885 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:38'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:38.887 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:38'.
2025-11-30 00:15:38.887 +01:00 [INF] HTTP GET /api/Conversations/history/123 started - IP: 127.0.0.1
2025-11-30 00:15:38.889 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:15:38.890 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:38.892 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='123'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:15:38.895 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='123'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:15:38.897 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='123'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:15:38.899 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:38.900 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.0413ms
2025-11-30 00:15:38.901 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:15:38.902 +01:00 [INF] HTTP GET /api/Conversations/history/123 completed - Status: 200 - Duration: 14.6505ms
2025-11-30 00:15:38.904 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/123 - 200 null application/json; charset=utf-8 21.5587ms
2025-11-30 00:15:39.915 +01:00 [INF] SignalR disconnected: CaClD242ZP7FaqESLRltvw user:null ex:null
2025-11-30 00:15:39.916 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:15:39.917 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1513.4244ms
2025-11-30 00:15:39.919 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=123&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=QF0qAgZr9PUvDIjdDU9j0g&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1518.5376ms
2025-11-30 00:15:41.589 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:15:41.591 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:41.592 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:41'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:41.594 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:41'.
2025-11-30 00:15:41.595 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:15:41.596 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:15:41.596 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:41.599 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:15:41.601 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:15:41.604 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:15:41.607 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:15:41.6061399Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:15:41.6061392Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:15:41.6063902Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482593' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482593,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:15:41.6061399Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:15:41.6061392Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8TD:0000000A' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:15:41.611 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:15:41.613 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9506ms
2025-11-30 00:15:41.614 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:15:41.614 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.8003ms
2025-11-30 00:15:41.616 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 26.6118ms
2025-11-30 00:15:41.620 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=124&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:15:41.622 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:41.623 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=124&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.6669ms
2025-11-30 00:15:41.624 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=124&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:15:41.627 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:41.628 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:15:41.629 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:15:41.630 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:15:41.630 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.627ms
2025-11-30 00:15:41.632 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=124&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.8116ms
2025-11-30 00:15:41.634 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=124&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=wMUzBP6T4sxYAH5Cl_w8cA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:15:41.637 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:41.638 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:15:41.639 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:15:41.649 +01:00 [INF] SignalR connected: u25xk-KTUHc7iptKKr-9og user:null
2025-11-30 00:15:41.652 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='124'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:15:41.655 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='124', @p0='2025-11-29T23:15:41.6546636Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:15:41.6547442Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='124' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:15:41.6546636Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TI:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:15:42.128 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/124 - null null
2025-11-30 00:15:42.130 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:42.130 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/124 - 204 null null 2.6766ms
2025-11-30 00:15:42.133 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/124 - null null
2025-11-30 00:15:42.135 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:15:42.136 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:42'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:15:42.137 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:15:42'.
2025-11-30 00:15:42.138 +01:00 [INF] HTTP GET /api/Conversations/history/124 started - IP: 127.0.0.1
2025-11-30 00:15:42.139 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:15:42.140 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:15:42.143 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='124'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:15:42.145 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='124'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:15:42.147 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='124'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:15:42.149 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:15:42.150 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.2335ms
2025-11-30 00:15:42.151 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:15:42.152 +01:00 [INF] HTTP GET /api/Conversations/history/124 completed - Status: 200 - Duration: 13.2778ms
2025-11-30 00:15:42.153 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/124 - 200 null application/json; charset=utf-8 19.8688ms
2025-11-30 00:15:42.787 +01:00 [INF] SignalR disconnected: u25xk-KTUHc7iptKKr-9og user:null ex:null
2025-11-30 00:15:42.789 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:15:42.790 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1152.4287ms
2025-11-30 00:15:42.791 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=124&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=wMUzBP6T4sxYAH5Cl_w8cA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1157.8071ms
2025-11-30 00:17:47.619 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 00:17:47.621 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:47.621 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.3605ms
2025-11-30 00:17:47.623 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:17:47.625 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:47.626 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:17:47'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:17:47.627 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:17:47'.
2025-11-30 00:17:47.627 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:17:47.629 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:17:47.629 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:17:47.632 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:17:47.635 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:17:47.637 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:17:47.640 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:17:47.6394879Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:17:47.6394873Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:17:47.6396232Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482592' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482592,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:17:47.6394879Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:17:47.6394873Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8TJ:00000001' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:17:47.644 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:17:47.645 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.5706ms
2025-11-30 00:17:47.646 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:17:47.647 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.682ms
2025-11-30 00:17:47.649 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 25.6868ms
2025-11-30 00:17:47.700 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=125&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:17:47.702 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:47.703 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=125&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.4911ms
2025-11-30 00:17:47.717 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=125&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:17:47.719 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:47.720 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:17:47.721 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:17:47.722 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:17:47.722 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5124ms
2025-11-30 00:17:47.724 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=125&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 6.5545ms
2025-11-30 00:17:47.727 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=125&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=UyLQmsg3BEsid5fOZ0l6VQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:17:47.728 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:47.729 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:17:47.730 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:17:47.734 +01:00 [INF] SignalR connected: fiO31ZAYnJvOTAUS5g2mkg user:null
2025-11-30 00:17:47.738 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='125'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:17:47.741 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='125', @p0='2025-11-29T23:17:47.7405139Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:17:47.7405923Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='125' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:17:47.7405139Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TL:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:17:48.189 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/125 - null null
2025-11-30 00:17:48.191 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:48.192 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/125 - 204 null null 2.4712ms
2025-11-30 00:17:48.194 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/125 - null null
2025-11-30 00:17:48.196 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:17:48.196 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:17:48'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:17:48.199 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:17:48'.
2025-11-30 00:17:48.200 +01:00 [INF] HTTP GET /api/Conversations/history/125 started - IP: 127.0.0.1
2025-11-30 00:17:48.201 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:17:48.202 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:17:48.205 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='125'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:17:48.209 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='125'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:17:48.211 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='125'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:17:48.214 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:17:48.217 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 13.3658ms
2025-11-30 00:17:48.223 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:17:48.224 +01:00 [INF] HTTP GET /api/Conversations/history/125 completed - Status: 200 - Duration: 23.3925ms
2025-11-30 00:17:48.226 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/125 - 200 null application/json; charset=utf-8 31.6779ms
2025-11-30 00:17:49.033 +01:00 [INF] SignalR disconnected: fiO31ZAYnJvOTAUS5g2mkg user:null ex:null
2025-11-30 00:17:49.035 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:17:49.036 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1306.5703ms
2025-11-30 00:17:49.037 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=125&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=UyLQmsg3BEsid5fOZ0l6VQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1310.3135ms
2025-11-30 00:18:54.497 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:03:54.4964335Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:23:54.516 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:08:54.5120667Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:26:25.212 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:26:25.212 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:26:25.214 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:25.216 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:25.217 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:26:25.217 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:26:25.219 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:26:25.220 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:26:25.221 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:26:25.221 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:26:25.225 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:26:25.228 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:26:25.230 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:26:25.230 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:26:25.233 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:26:25.234 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.9083ms
2025-11-30 00:26:25.236 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:26:25.237 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:26:25.237 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:26:25.238 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 21.3657ms
2025-11-30 00:26:25.239 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 14.9835ms
2025-11-30 00:26:25.241 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 28.9232ms
2025-11-30 00:26:25.242 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:26:25.245 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:26:25.246 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 28.6032ms
2025-11-30 00:26:25.248 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:25.249 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 36.8549ms
2025-11-30 00:26:25.250 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.5566ms
2025-11-30 00:26:25.253 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:26:25.258 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:25.258 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:26:25.260 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:26:25.261 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:26:25.263 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:26:25.264 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:26:25.265 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.773ms
2025-11-30 00:26:25.266 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:26:25.267 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.2861ms
2025-11-30 00:26:25.268 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 15.1118ms
2025-11-30 00:26:25.285 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:26:25.287 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:26:25.288 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:25.290 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:25.290 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:26:25.291 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:26:25.292 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:26:25.293 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:26:25.294 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:26:25.295 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:26:25.299 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:26:25.299 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:26:25.302 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:26:25.304 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:26:25.305 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:26:25.306 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:26:25.309 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:26:25.309 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:26:25.310 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.1845ms
2025-11-30 00:26:25.313 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:26:25.313 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:26:25.314 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.1016ms
2025-11-30 00:26:25.317 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:26:25.318 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.0076ms
2025-11-30 00:26:25.321 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:26:25.325 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:26:25.327 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:26:25.328 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:26:27.080 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 00:26:27.082 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.082 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.6034ms
2025-11-30 00:26:27.084 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:26:27.087 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.088 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:26:27'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:26:27.089 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:26:27'.
2025-11-30 00:26:27.090 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:26:27.092 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:26:27.092 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:26:27.095 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:26:27.098 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:26:27.100 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:26:27.104 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:26:27.1026065Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:26:27.1026059Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:26:27.1027998Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482591' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482591,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:26:27.1026065Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:26:27.1026059Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8TN:00000004' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:26:27.108 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:26:27.109 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.3397ms
2025-11-30 00:26:27.110 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:26:27.111 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.4443ms
2025-11-30 00:26:27.112 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.5455ms
2025-11-30 00:26:27.133 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=126&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:26:27.135 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.136 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=126&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.3747ms
2025-11-30 00:26:27.138 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=126&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:26:27.141 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.142 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:26:27.143 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:26:27.144 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:26:27.145 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.1308ms
2025-11-30 00:26:27.147 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=126&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.8834ms
2025-11-30 00:26:27.149 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=126&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=E_H4ED3GOm6R4HAzW0GEAg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:26:27.154 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.156 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:26:27.158 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:26:27.163 +01:00 [INF] SignalR connected: taDXCRuV-pW2Lve45VbMOQ user:null
2025-11-30 00:26:27.176 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='126'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:26:27.180 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='126', @p0='2025-11-29T23:26:27.1791955Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:26:27.1793423Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='126' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:26:27.1791955Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TQ:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:26:27.344 +01:00 [INF] Received HTTP response headers after 2014.9145ms - 422
2025-11-30 00:26:27.345 +01:00 [INF] End processing HTTP request after 2018.1615ms - 422
2025-11-30 00:26:27.346 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:26:27.348 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2051.1177ms
2025-11-30 00:26:27.349 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:26:27.350 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2059.3936ms
2025-11-30 00:26:27.351 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2066.2266ms
2025-11-30 00:26:27.643 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/126 - null null
2025-11-30 00:26:27.645 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.646 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/126 - 204 null null 2.4124ms
2025-11-30 00:26:27.648 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/126 - null null
2025-11-30 00:26:27.649 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:27.650 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:26:27'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:26:27.652 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:26:27'.
2025-11-30 00:26:27.653 +01:00 [INF] HTTP GET /api/Conversations/history/126 started - IP: 127.0.0.1
2025-11-30 00:26:27.654 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:26:27.655 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:26:27.658 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='126'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:26:27.661 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='126'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:26:27.663 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='126'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:26:27.665 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:26:27.667 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.1025ms
2025-11-30 00:26:27.668 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:26:27.669 +01:00 [INF] HTTP GET /api/Conversations/history/126 completed - Status: 200 - Duration: 16.2572ms
2025-11-30 00:26:27.671 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/126 - 200 null application/json; charset=utf-8 22.8689ms
2025-11-30 00:26:28.341 +01:00 [INF] SignalR disconnected: taDXCRuV-pW2Lve45VbMOQ user:null ex:null
2025-11-30 00:26:28.343 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:26:28.345 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1188.879ms
2025-11-30 00:26:28.348 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=126&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=E_H4ED3GOm6R4HAzW0GEAg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1198.0463ms
2025-11-30 00:26:28.907 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:26:28.909 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:28.910 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:26:28'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:26:28.911 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:26:28'.
2025-11-30 00:26:28.912 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:26:28.913 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:26:28.914 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:26:28.917 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:26:28.920 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:26:28.923 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:26:28.926 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:26:28.9250834Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:26:28.9250830Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:26:28.9252345Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482590' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482590,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:26:28.9250834Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:26:28.925083Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8TN:00000006' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:26:28.930 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:26:28.931 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.6501ms
2025-11-30 00:26:28.932 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:26:28.933 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.1406ms
2025-11-30 00:26:28.935 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.8935ms
2025-11-30 00:26:28.940 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=127&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:26:28.942 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:28.942 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=127&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.8213ms
2025-11-30 00:26:28.944 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=127&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:26:28.948 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:28.948 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:26:28.949 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:26:28.950 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:26:28.951 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6973ms
2025-11-30 00:26:28.953 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=127&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.6651ms
2025-11-30 00:26:28.976 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=127&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=-U0cbzfhipayPt5mZ7FJLQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:26:28.978 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:26:28.979 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:26:28.980 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:26:28.985 +01:00 [INF] SignalR connected: QpvPRQqcBT_MWLenBQDZGw user:null
2025-11-30 00:26:28.992 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='127'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:26:28.996 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='127', @p0='2025-11-29T23:26:28.9950255Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:26:28.9951176Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='127' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:26:28.9950255Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8TR:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:26:29.437 +01:00 [INF] SignalR disconnected: QpvPRQqcBT_MWLenBQDZGw user:null ex:null
2025-11-30 00:26:29.439 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:26:29.440 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 460.5863ms
2025-11-30 00:26:29.441 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=127&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=-U0cbzfhipayPt5mZ7FJLQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 464.8636ms
2025-11-30 00:28:05.441 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:28:05.442 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:28:05.443 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:28:05.445 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:28:05.446 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:28:05.446 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:28:05.447 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:28:05.448 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:28:05.449 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:28:05.450 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:28:05.453 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:28:05.454 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:28:05.456 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:28:05.457 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:28:05.459 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:28:05.460 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:28:05.461 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 9.8596ms
2025-11-30 00:28:05.462 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:28:05.463 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:28:05.464 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.2161ms
2025-11-30 00:28:05.465 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 19.1605ms
2025-11-30 00:28:05.466 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:28:05.468 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 26.5064ms
2025-11-30 00:28:05.469 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.5773ms
2025-11-30 00:28:05.473 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:28:05.473 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.072ms
2025-11-30 00:28:05.475 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:28:05.477 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.7085ms
2025-11-30 00:28:05.479 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:28:05.482 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:28:05.482 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:28:05.484 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:28:05.484 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:28:05.486 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:28:05.487 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:28:05.488 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2297ms
2025-11-30 00:28:05.489 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:28:05.490 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.2179ms
2025-11-30 00:28:05.491 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.2601ms
2025-11-30 00:28:05.513 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:28:05.514 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:28:05.516 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:28:05.518 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:28:05.519 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:28:05.519 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:28:05.520 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:28:05.522 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:28:05.522 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:28:05.523 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:28:05.526 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:28:05.527 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:28:05.529 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:28:05.530 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:28:05.532 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:28:05.533 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:28:05.536 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:28:05.536 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:28:05.538 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:28:05.538 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.4161ms
2025-11-30 00:28:05.540 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:28:05.541 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:28:05.543 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:28:05.543 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.8495ms
2025-11-30 00:28:05.545 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:28:05.546 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.4891ms
2025-11-30 00:28:05.548 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:28:05.551 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:28:07.593 +01:00 [INF] Received HTTP response headers after 2041.2049ms - 422
2025-11-30 00:28:07.595 +01:00 [INF] End processing HTTP request after 2046.6361ms - 422
2025-11-30 00:28:07.596 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:28:07.597 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2073.018ms
2025-11-30 00:28:07.599 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:28:07.600 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2081.3378ms
2025-11-30 00:28:07.602 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2088.6787ms
2025-11-30 00:28:54.530 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:13:54.5295502Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:30:56.693 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:30:56.694 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:30:56.695 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:30:56.697 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:30:56.698 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:30:56.698 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:30:56.699 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:30:56.701 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:30:56.701 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:30:56.702 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:30:56.706 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:30:56.706 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:30:56.709 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:30:56.710 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:30:56.712 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:30:56.714 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:30:56.715 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 11.2305ms
2025-11-30 00:30:56.716 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:30:56.717 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:30:56.719 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.3328ms
2025-11-30 00:30:56.719 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 21.8099ms
2025-11-30 00:30:56.720 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:30:56.722 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 29.0372ms
2025-11-30 00:30:56.723 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.8559ms
2025-11-30 00:30:56.728 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.8482ms
2025-11-30 00:30:56.741 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:30:56.743 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:30:56.744 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.8914ms
2025-11-30 00:30:56.745 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:30:56.749 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:30:56.750 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:30:56.751 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:30:56.751 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:30:56.753 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:30:56.754 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:30:56.755 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2802ms
2025-11-30 00:30:56.756 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:30:56.757 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.3959ms
2025-11-30 00:30:56.758 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.8792ms
2025-11-30 00:30:56.768 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:30:56.770 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:30:56.770 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:30:56.772 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:30:56.773 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:30:56.773 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:30:56.774 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:30:56.776 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:30:56.776 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:30:56.777 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:30:56.781 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:30:56.782 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:30:56.783 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:30:56.785 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:30:56.786 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:30:56.788 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:30:56.790 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:30:56.790 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:30:56.792 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:30:56.792 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.5509ms
2025-11-30 00:30:56.794 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:30:56.795 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:30:56.798 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:30:56.798 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.3486ms
2025-11-30 00:30:56.800 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:30:56.801 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.1491ms
2025-11-30 00:30:56.803 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:30:56.805 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:30:58.823 +01:00 [INF] Received HTTP response headers after 2017.2137ms - 422
2025-11-30 00:30:58.825 +01:00 [INF] End processing HTTP request after 2022.0939ms - 422
2025-11-30 00:30:58.826 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:30:58.827 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2048.4191ms
2025-11-30 00:30:58.829 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:30:58.830 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2056.8473ms
2025-11-30 00:30:58.831 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2063.4661ms
2025-11-30 00:33:28.928 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:33:28.929 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:33:28.930 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:33:28.932 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:33:28.933 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:33:28.934 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:33:28.935 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:33:28.936 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:33:28.937 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:33:28.938 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:33:28.941 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:33:28.942 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:33:28.945 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:33:28.946 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:33:28.947 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:33:28.949 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:33:28.951 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 11.6413ms
2025-11-30 00:33:28.951 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:33:28.952 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:33:28.954 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.1762ms
2025-11-30 00:33:28.955 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 21.9226ms
2025-11-30 00:33:28.957 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:33:28.960 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 31.4425ms
2025-11-30 00:33:28.961 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.846ms
2025-11-30 00:33:28.965 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.9565ms
2025-11-30 00:33:28.985 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:33:28.987 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:33:28.988 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.8637ms
2025-11-30 00:33:28.989 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:33:28.992 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:33:28.993 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:33:28.995 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:33:28.996 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:33:28.998 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:33:28.999 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:33:29.000 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.481ms
2025-11-30 00:33:29.001 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:33:29.002 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.5507ms
2025-11-30 00:33:29.004 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.476ms
2025-11-30 00:33:29.013 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:33:29.014 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:33:29.016 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:33:29.019 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:33:29.020 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:33:29.021 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:33:29.022 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:33:29.023 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:33:29.023 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:33:29.024 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:33:29.027 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:33:29.028 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:33:29.030 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:33:29.031 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:33:29.033 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:33:29.034 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:33:29.037 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:33:29.037 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:33:29.038 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 10.8019ms
2025-11-30 00:33:29.040 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:33:29.040 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:33:29.043 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.6012ms
2025-11-30 00:33:29.043 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:33:29.045 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.0039ms
2025-11-30 00:33:29.047 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:33:29.052 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:33:29.054 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:33:29.055 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:33:31.089 +01:00 [INF] Received HTTP response headers after 2032.0865ms - 422
2025-11-30 00:33:31.090 +01:00 [INF] End processing HTTP request after 2036.1936ms - 422
2025-11-30 00:33:31.091 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:33:31.093 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2067.3502ms
2025-11-30 00:33:31.094 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:33:31.095 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2074.8258ms
2025-11-30 00:33:31.096 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2083.5803ms
2025-11-30 00:33:54.540 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:18:54.5395631Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:38:52.665 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:38:52.665 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:38:52.667 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:38:52.669 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:38:52.669 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:38:52.670 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:38:52.671 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:38:52.672 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:38:52.673 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:38:52.673 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:38:52.686 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:38:52.689 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:38:52.691 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:38:52.692 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:38:52.693 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 17.3723ms
2025-11-30 00:38:52.695 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:38:52.695 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.6553ms
2025-11-30 00:38:52.697 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.8088ms
2025-11-30 00:38:52.710 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:38:52.713 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:38:52.714 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:38:52.716 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 41.2436ms
2025-11-30 00:38:52.717 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:38:52.718 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 49.0425ms
2025-11-30 00:38:52.720 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 55.3977ms
2025-11-30 00:38:52.725 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:38:52.727 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:38:52.727 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.6072ms
2025-11-30 00:38:52.730 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:38:52.732 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:38:52.733 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:38:52.734 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:38:52.735 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:38:52.737 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:38:52.738 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:38:52.739 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.479ms
2025-11-30 00:38:52.740 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:38:52.741 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.2997ms
2025-11-30 00:38:52.742 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.7513ms
2025-11-30 00:38:52.746 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:38:52.747 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:38:52.748 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:38:52.750 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:38:52.751 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:38:52.751 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:38:52.752 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:38:52.753 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:38:52.754 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:38:52.755 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:38:52.758 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:38:52.762 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:38:52.763 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:38:52.765 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:38:52.767 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:38:52.768 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:38:52.769 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:38:52.772 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:38:52.772 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:38:52.773 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 15.4547ms
2025-11-30 00:38:52.776 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:38:52.776 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:38:52.778 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:38:52.779 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.2372ms
2025-11-30 00:38:52.781 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:38:52.782 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.4849ms
2025-11-30 00:38:52.784 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:38:52.787 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:38:54.557 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:23:54.5559455Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:38:54.807 +01:00 [INF] Received HTTP response headers after 2019.1923ms - 422
2025-11-30 00:38:54.808 +01:00 [INF] End processing HTTP request after 2024.1432ms - 422
2025-11-30 00:38:54.809 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:38:54.811 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2054.1841ms
2025-11-30 00:38:54.812 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:38:54.813 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2061.8604ms
2025-11-30 00:38:54.814 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2068.4137ms
2025-11-30 00:43:04.084 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:43:04.085 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:43:04.087 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:43:04.089 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:43:04.089 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:43:04.090 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:43:04.091 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:43:04.093 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:43:04.094 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:43:04.095 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:43:04.107 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:43:04.107 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:43:04.110 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:43:04.112 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:43:04.113 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:43:04.115 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:43:04.116 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:43:04.118 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 21.5466ms
2025-11-30 00:43:04.119 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 20.9853ms
2025-11-30 00:43:04.120 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:43:04.121 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:43:04.122 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 32.9251ms
2025-11-30 00:43:04.123 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 33.3212ms
2025-11-30 00:43:04.125 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 40.6719ms
2025-11-30 00:43:04.127 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 41.7939ms
2025-11-30 00:43:04.173 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:43:04.175 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:43:04.175 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.8839ms
2025-11-30 00:43:04.177 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:43:04.180 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:43:04.181 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:43:04.182 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:43:04.183 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:43:04.185 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:43:04.186 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:43:04.187 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.5419ms
2025-11-30 00:43:04.189 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:43:04.190 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.3251ms
2025-11-30 00:43:04.191 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.6535ms
2025-11-30 00:43:04.195 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:43:04.196 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:43:04.198 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:43:04.200 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:43:04.201 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:43:04.201 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:43:04.202 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:43:04.204 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:43:04.205 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:43:04.205 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:43:04.209 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:43:04.210 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:43:04.212 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:43:04.214 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:43:04.215 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:43:04.217 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:43:04.219 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:43:04.219 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:43:04.221 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:43:04.222 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.4101ms
2025-11-30 00:43:04.224 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:43:04.225 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:43:04.228 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.4012ms
2025-11-30 00:43:04.228 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:43:04.229 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.1283ms
2025-11-30 00:43:04.231 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:43:04.235 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:43:04.236 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:43:06.274 +01:00 [INF] Received HTTP response headers after 2037.4851ms - 422
2025-11-30 00:43:06.275 +01:00 [INF] End processing HTTP request after 2040.4958ms - 422
2025-11-30 00:43:06.276 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:43:06.278 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2070.9021ms
2025-11-30 00:43:06.279 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:43:06.280 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2079.0634ms
2025-11-30 00:43:06.281 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2085.7987ms
2025-11-30 00:43:54.561 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:28:54.5602694Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:44:26.436 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 00:44:26.438 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:26.439 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.6151ms
2025-11-30 00:44:26.442 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:44:26.444 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:26.444 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:26'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:44:26.446 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:26'.
2025-11-30 00:44:26.447 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:44:26.448 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:44:26.448 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:44:26.451 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:44:26.454 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:44:26.456 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:44:26.460 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:44:26.4583002Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:44:26.4582995Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:44:26.4586229Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482589' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482589,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:44:26.4583002Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:44:26.4582995Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8U4:00000004' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:44:26.464 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:44:26.465 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.8359ms
2025-11-30 00:44:26.466 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:44:26.467 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.1368ms
2025-11-30 00:44:26.468 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 26.3674ms
2025-11-30 00:44:26.496 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:44:26.498 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:26.498 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5535ms
2025-11-30 00:44:26.500 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:44:26.502 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:26.503 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:44:26.504 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:44:26.505 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:44:26.505 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.4717ms
2025-11-30 00:44:26.507 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 6.6611ms
2025-11-30 00:44:26.512 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=376ySgVhJ6Ff4vdm89Zq9w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:44:26.514 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:26.515 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:44:26.516 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:44:26.519 +01:00 [INF] SignalR connected: 0D4Ly0NBxB74juOio7fbFQ user:null
2025-11-30 00:44:26.527 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:44:26.530 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='128', @p0='2025-11-29T23:44:26.5297246Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:44:26.5298019Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='128' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:44:26.5297246Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8U5:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:44:27.017 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/128 - null null
2025-11-30 00:44:27.019 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:27.020 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/128 - 204 null null 2.7442ms
2025-11-30 00:44:27.022 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/128 - null null
2025-11-30 00:44:27.025 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:27.026 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:27'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:44:27.027 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:27'.
2025-11-30 00:44:27.028 +01:00 [INF] HTTP GET /api/Conversations/history/128 started - IP: 127.0.0.1
2025-11-30 00:44:27.030 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:44:27.030 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:44:27.033 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:44:27.035 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:44:27.038 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:44:27.040 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:44:27.042 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.9244ms
2025-11-30 00:44:27.043 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:44:27.044 +01:00 [INF] HTTP GET /api/Conversations/history/128 completed - Status: 200 - Duration: 15.5341ms
2025-11-30 00:44:27.045 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/128 - 200 null application/json; charset=utf-8 22.988ms
2025-11-30 00:44:28.080 +01:00 [INF] SignalR disconnected: 0D4Ly0NBxB74juOio7fbFQ user:null ex:null
2025-11-30 00:44:28.081 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:44:28.082 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1567.1041ms
2025-11-30 00:44:28.084 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=376ySgVhJ6Ff4vdm89Zq9w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1571.2653ms
2025-11-30 00:44:29.021 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:44:29.023 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:29.024 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:29'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:44:29.026 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:29'.
2025-11-30 00:44:29.026 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:44:29.028 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:44:29.029 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:44:29.032 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:44:29.034 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:44:29.036 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:44:29.039 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:44:29.0384598Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:44:29.0384593Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:44:29.0385849Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482588' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482588,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:44:29.0384598Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:44:29.0384593Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8U4:00000006' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:44:29.043 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:44:29.044 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.2258ms
2025-11-30 00:44:29.045 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:44:29.046 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.8008ms
2025-11-30 00:44:29.047 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 26.411ms
2025-11-30 00:44:29.052 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=129&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:44:29.054 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:29.054 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=129&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.505ms
2025-11-30 00:44:29.056 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=129&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:44:29.059 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:29.060 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:44:29.061 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:44:29.062 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:44:29.062 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6252ms
2025-11-30 00:44:29.064 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=129&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.2988ms
2025-11-30 00:44:29.090 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=129&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=BWTFcndbox8S7lcgHoIzcg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:44:29.093 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:29.094 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:44:29.095 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:44:29.098 +01:00 [INF] SignalR connected: ZSJi6nV9TLASU8LaQXDZRw user:null
2025-11-30 00:44:29.103 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='129'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:44:29.106 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='129', @p0='2025-11-29T23:44:29.1053929Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:44:29.1054625Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='129' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:44:29.1053929Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8U6:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:44:29.585 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/129 - null null
2025-11-30 00:44:29.587 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:29.588 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/129 - 204 null null 2.6399ms
2025-11-30 00:44:29.590 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/129 - null null
2025-11-30 00:44:29.592 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:29.593 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:29'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:44:29.595 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:29'.
2025-11-30 00:44:29.596 +01:00 [INF] HTTP GET /api/Conversations/history/129 started - IP: 127.0.0.1
2025-11-30 00:44:29.597 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:44:29.598 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:44:29.600 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='129'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:44:29.602 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='129'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:44:29.605 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='129'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:44:29.606 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:44:29.608 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.2064ms
2025-11-30 00:44:29.609 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:44:29.610 +01:00 [INF] HTTP GET /api/Conversations/history/129 completed - Status: 200 - Duration: 14.2728ms
2025-11-30 00:44:29.611 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/129 - 200 null application/json; charset=utf-8 21.2003ms
2025-11-30 00:44:30.256 +01:00 [INF] SignalR disconnected: ZSJi6nV9TLASU8LaQXDZRw user:null ex:null
2025-11-30 00:44:30.257 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:44:30.258 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1164.762ms
2025-11-30 00:44:30.260 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=129&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=BWTFcndbox8S7lcgHoIzcg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1169.2902ms
2025-11-30 00:44:30.964 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 00:44:30.966 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:30.967 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:30'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:44:30.969 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:30'.
2025-11-30 00:44:30.970 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 00:44:30.971 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:44:30.972 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:44:30.975 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDU4MTMzLCJleHAiOjE3OTU5OTQxMzMsImlhdCI6MTc2NDQ1ODEzMywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.qzVIw4M20UMF935S1X_F_rNGusJYIGzaZMIp8KgOIaM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:44:30.977 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 00:44:30.980 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 00:44:30.983 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-29T23:44:30.9820946Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-29T23:44:30.9820941Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-29T23:44:30.9822365Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482587' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482587,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-29T23:44:30.9820946Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-29T23:44:30.9820941Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8U4:00000008' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:44:30.987 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:44:30.988 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.4381ms
2025-11-30 00:44:30.990 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 00:44:30.991 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.9019ms
2025-11-30 00:44:30.992 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.932ms
2025-11-30 00:44:30.996 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=130&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 00:44:30.998 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:30.999 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=130&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.4579ms
2025-11-30 00:44:31.000 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=130&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 00:44:31.003 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:31.004 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 00:44:31.005 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 00:44:31.005 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 00:44:31.006 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5902ms
2025-11-30 00:44:31.008 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=130&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.5975ms
2025-11-30 00:44:31.028 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=130&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=cSkgK5sChGT7DAOp_c0rlw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:44:31.030 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:31.030 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 00:44:31.031 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 00:44:31.034 +01:00 [INF] SignalR connected: tpq2Y4HfPzQu7FrpelXypw user:null
2025-11-30 00:44:31.040 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='130'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 00:44:31.043 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='130', @p0='2025-11-29T23:44:31.0422159Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-29T23:44:31.0422809Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='130' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-29T23:44:31.0422159Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8U7:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 00:44:31.531 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/130 - null null
2025-11-30 00:44:31.533 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:31.534 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/130 - 204 null null 2.7202ms
2025-11-30 00:44:31.536 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/130 - null null
2025-11-30 00:44:31.538 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:44:31.539 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:31'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:44:31.540 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:44:31'.
2025-11-30 00:44:31.541 +01:00 [INF] HTTP GET /api/Conversations/history/130 started - IP: 127.0.0.1
2025-11-30 00:44:31.542 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:44:31.543 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:44:31.546 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='130'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 00:44:31.548 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='130'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 00:44:31.551 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='130'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 00:44:31.553 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:44:31.554 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.5441ms
2025-11-30 00:44:31.555 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 00:44:31.556 +01:00 [INF] HTTP GET /api/Conversations/history/130 completed - Status: 200 - Duration: 14.415ms
2025-11-30 00:44:31.557 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/130 - 200 null application/json; charset=utf-8 21.0949ms
2025-11-30 00:44:31.984 +01:00 [INF] SignalR disconnected: tpq2Y4HfPzQu7FrpelXypw user:null ex:null
2025-11-30 00:44:31.985 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 00:44:31.986 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 955.5438ms
2025-11-30 00:44:31.987 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=130&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=cSkgK5sChGT7DAOp_c0rlw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 959.5978ms
2025-11-30 00:47:43.378 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 00:47:43.379 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:47:43.380 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:47:43.382 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:47:43.383 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.5374ms
2025-11-30 00:47:43.383 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.0517ms
2025-11-30 00:47:43.387 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 00:47:43.387 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:47:43.391 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:47:43.393 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:47:43.394 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:47:43'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:47:43.394 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:47:43'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:47:43.395 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:47:43'.
2025-11-30 00:47:43.397 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:47:43'.
2025-11-30 00:47:43.397 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 00:47:43.398 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 00:47:43.399 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:47:43.400 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:47:43.401 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 00:47:43.402 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:47:43.405 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 00:47:43.408 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 00:47:43.410 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-29T23:47:43.4098988Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-29T23:47:43.4098385Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-29T23:47:43.409839Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T23:15:33.704425","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T23:15:33.704425"}' (Size = 4000), @p8='0HNHFH06JI8U8:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-29T23:47:43.4098385Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-29T23:47:43.4098390Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 00:47:43.412 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:47:43.414 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 00:47:43.415 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:47:43.415 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 10.3009ms
2025-11-30 00:47:43.416 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 12.6264ms
2025-11-30 00:47:43.417 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:47:43.418 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:47:43.419 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 20.9762ms
2025-11-30 00:47:43.420 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 22.5177ms
2025-11-30 00:47:43.421 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 34.291ms
2025-11-30 00:47:43.423 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 36.0107ms
2025-11-30 00:48:54.571 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:33:54.5701743Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:49:19.655 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 00:49:19.655 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:49:19.658 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:49:19.660 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:49:19.660 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 5.1761ms
2025-11-30 00:49:19.661 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.4772ms
2025-11-30 00:49:19.686 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 00:49:19.686 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:49:19.688 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:49:19.691 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:49:19.692 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:49:19'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:49:19.692 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:49:19'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:49:19.694 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:49:19'.
2025-11-30 00:49:19.695 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:49:19'.
2025-11-30 00:49:19.696 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 00:49:19.697 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 00:49:19.698 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:49:19.700 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:49:19.701 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 00:49:19.702 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:49:19.705 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 00:49:19.706 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:49:19.708 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 00:49:19.709 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 00:49:19.712 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-29T23:49:19.7113340Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-29T23:49:19.7112676Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-29T23:49:19.7112681Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T23:47:43.409838","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T23:47:43.409839"}' (Size = 4000), @p8='0HNHFH06JI8U8:00000002' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-29T23:49:19.7112676Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-29T23:49:19.7112681Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 00:49:19.712 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.9126ms
2025-11-30 00:49:19.715 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:49:19.716 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:49:19.716 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 19.2171ms
2025-11-30 00:49:19.717 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 13.8773ms
2025-11-30 00:49:19.719 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 32.1417ms
2025-11-30 00:49:19.720 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:49:19.723 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 27.1908ms
2025-11-30 00:49:19.724 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 38.2965ms
2025-11-30 00:51:18.420 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 00:51:18.421 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:51:18.422 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.424 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.424 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.3388ms
2025-11-30 00:51:18.425 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.3517ms
2025-11-30 00:51:18.427 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 00:51:18.428 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 00:51:18.433 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.435 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.436 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:51:18'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:51:18.436 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:51:18'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 00:51:18.438 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:51:18'.
2025-11-30 00:51:18.439 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '29/11/2025 23:51:18'.
2025-11-30 00:51:18.440 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 00:51:18.441 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 00:51:18.442 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:51:18.443 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:51:18.444 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 00:51:18.445 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:51:18.449 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 00:51:18.450 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:51:18.451 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 00:51:18.453 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 00:51:18.456 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-29T23:51:18.4551001Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-29T23:51:18.4550365Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-29T23:51:18.4550371Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T23:49:19.711267","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T23:49:19.711268"}' (Size = 4000), @p8='0HNHFH06JI8UB:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-29T23:51:18.4550365Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-29T23:51:18.4550371Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 00:51:18.456 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 7.2116ms
2025-11-30 00:51:18.459 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 00:51:18.460 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 19.2027ms
2025-11-30 00:51:18.462 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 33.8901ms
2025-11-30 00:51:18.472 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 00:51:18.474 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.474 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 00:51:18.476 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:51:18.477 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:51:18.480 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 00:51:18.482 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:51:18.483 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 00:51:18.484 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 36.6094ms
2025-11-30 00:51:18.486 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:51:18.487 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 00:51:18.488 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 9.7123ms
2025-11-30 00:51:18.489 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 48.8459ms
2025-11-30 00:51:18.490 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 00:51:18.491 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 64.7508ms
2025-11-30 00:51:18.492 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 17.9108ms
2025-11-30 00:51:18.497 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 25.1522ms
2025-11-30 00:51:18.534 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:51:18.536 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.537 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.1458ms
2025-11-30 00:51:18.541 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 00:51:18.544 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.544 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 00:51:18.546 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:51:18.547 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 00:51:18.549 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 00:51:18.550 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:51:18.551 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.8615ms
2025-11-30 00:51:18.553 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 00:51:18.554 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 9.2247ms
2025-11-30 00:51:18.555 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.0708ms
2025-11-30 00:51:18.560 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 00:51:18.561 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 00:51:18.562 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.565 +01:00 [INF] CORS policy execution successful.
2025-11-30 00:51:18.565 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 00:51:18.566 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 00:51:18.567 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:51:18.568 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:51:18.569 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 00:51:18.570 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 00:51:18.573 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 00:51:18.574 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 00:51:18.576 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 00:51:18.578 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 00:51:18.580 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 00:51:18.582 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 00:51:18.584 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 00:51:18.584 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 00:51:18.585 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.29ms
2025-11-30 00:51:18.588 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 00:51:18.588 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 00:51:18.590 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:51:18.591 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.826ms
2025-11-30 00:51:18.593 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 00:51:18.594 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.8075ms
2025-11-30 00:51:18.597 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 00:51:18.601 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:51:18.601 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 00:51:20.631 +01:00 [INF] Received HTTP response headers after 2028.507ms - 422
2025-11-30 00:51:20.632 +01:00 [INF] End processing HTTP request after 2031.4735ms - 422
2025-11-30 00:51:20.633 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 00:51:20.635 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2063.257ms
2025-11-30 00:51:20.636 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 00:51:20.637 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2071.336ms
2025-11-30 00:51:20.638 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2078.5454ms
2025-11-30 00:53:54.577 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:38:54.5762596Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 00:58:54.603 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:43:54.5987835Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:03:54.617 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:48:54.6131673Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:08:54.633 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:53:54.6300785Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:13:54.651 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-29T23:58:54.6471309Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:18:54.666 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:03:54.6625083Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:23:54.679 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:08:54.6757456Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:28:54.694 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:13:54.6907872Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:33:54.711 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:18:54.7079030Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:38:53.441 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:23:53.4375931Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:39:57.483 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:39:57.484 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:39:57.485 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:39:57.487 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:39:57.488 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.8261ms
2025-11-30 01:39:57.489 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.8351ms
2025-11-30 01:39:57.490 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:39:57.491 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:39:57.496 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:39:57.498 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:39:57.499 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:39:57'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:39:57.500 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:39:57'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:39:57.501 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:39:57'.
2025-11-30 01:39:57.502 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:39:57'.
2025-11-30 01:39:57.503 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:39:57.504 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:39:57.505 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:39:57.506 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:39:57.507 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:39:57.508 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:39:57.511 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:39:57.514 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:39:57.518 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:39:57.5167703Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:39:57.5166886Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:39:57.5166893Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-29T23:51:18.455036","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-29T23:51:18.455037"}' (Size = 4000), @p8='0HNHFH06JI8UE:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:39:57.5166886Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:39:57.5166893Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:39:57.518 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:39:57.522 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:39:57.522 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:39:57.523 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 13.5375ms
2025-11-30 01:39:57.524 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 13.1381ms
2025-11-30 01:39:57.525 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:39:57.526 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:39:57.527 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 23.5984ms
2025-11-30 01:39:57.527 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 23.4824ms
2025-11-30 01:39:57.529 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 39.0198ms
2025-11-30 01:39:57.530 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 38.9429ms
2025-11-30 01:42:04.430 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:42:04.431 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:42:04.432 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:42:04.434 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:42:04.435 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.3622ms
2025-11-30 01:42:04.435 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.0293ms
2025-11-30 01:42:04.436 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:42:04.438 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:42:04.442 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:42:04.444 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:42:04.445 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:42:04'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:42:04.445 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:42:04'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:42:04.447 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:42:04'.
2025-11-30 01:42:04.448 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:42:04'.
2025-11-30 01:42:04.449 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:42:04.450 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:42:04.451 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:42:04.453 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:42:04.453 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:42:04.454 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:42:04.457 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:42:04.459 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:42:04.460 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:42:04.462 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:42:04.465 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 7.111ms
2025-11-30 01:42:04.465 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:42:04.4640863Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:42:04.464012Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:42:04.4640125Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:39:57.516688","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:39:57.516689"}' (Size = 4000), @p8='0HNHFH06JI8UH:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:42:04.4640120Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:42:04.4640125Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:42:04.466 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:42:04.469 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 18.7257ms
2025-11-30 01:42:04.470 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:42:04.470 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 32.6024ms
2025-11-30 01:42:04.471 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 15.6508ms
2025-11-30 01:42:04.475 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:42:04.476 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 27.1541ms
2025-11-30 01:42:04.478 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 41.8162ms
2025-11-30 01:43:53.445 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:28:53.4448791Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:44:52.797 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:44:52.798 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:44:52.799 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:52.803 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:52.803 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 6.1627ms
2025-11-30 01:44:52.804 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 6.1154ms
2025-11-30 01:44:52.825 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:44:52.825 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:44:52.827 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:52.829 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:52.830 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:52'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:44:52.830 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:52'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:44:52.831 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:52'.
2025-11-30 01:44:52.832 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:52'.
2025-11-30 01:44:52.833 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:44:52.834 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:44:52.835 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:44:52.836 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:44:52.836 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:44:52.837 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:44:52.840 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:44:52.842 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:44:52.843 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:44:52.844 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:44:52.847 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.6735ms
2025-11-30 01:44:52.847 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:44:52.8460731Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:44:52.8459995Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:44:52.846Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:42:04.464012","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:42:04.464012"}' (Size = 4000), @p8='0HNHFH06JI8UK:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:44:52.8459995Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:44:52.8460000Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:44:52.848 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:44:52.850 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 16.8209ms
2025-11-30 01:44:52.852 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:44:52.852 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 26.6901ms
2025-11-30 01:44:52.853 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.5271ms
2025-11-30 01:44:52.856 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:44:52.857 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 24.4332ms
2025-11-30 01:44:52.859 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 34.1455ms
2025-11-30 01:44:58.068 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:44:58.068 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:44:58.071 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.073 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.073 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 5.1028ms
2025-11-30 01:44:58.074 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.8022ms
2025-11-30 01:44:58.076 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:44:58.077 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:44:58.081 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.083 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.084 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:58'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:44:58.084 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:58'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:44:58.086 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:58'.
2025-11-30 01:44:58.087 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:44:58'.
2025-11-30 01:44:58.088 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:44:58.089 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:44:58.090 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:44:58.092 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:44:58.092 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:44:58.093 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:44:58.097 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:44:58.098 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:44:58.099 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:44:58.101 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:44:58.103 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:44:58.1026236Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:44:58.1025609Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:44:58.1025613Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:44:52.845999","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:44:52.846"}' (Size = 4000), @p8='0HNHFH06JI8UK:00000002' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:44:58.1025609Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:44:58.1025613Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:44:58.103 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.8237ms
2025-11-30 01:44:58.107 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:44:58.108 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:44:58.108 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 19.3217ms
2025-11-30 01:44:58.109 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.3626ms
2025-11-30 01:44:58.111 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 34.129ms
2025-11-30 01:44:58.112 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:44:58.116 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 27.9736ms
2025-11-30 01:44:58.117 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 41.5335ms
2025-11-30 01:44:58.126 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:44:58.128 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.129 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:44:58.131 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:44:58.132 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:44:58.135 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:44:58.138 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:44:58.140 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:44:58.142 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 9.0709ms
2025-11-30 01:44:58.144 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:44:58.145 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 15.46ms
2025-11-30 01:44:58.146 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 20.3191ms
2025-11-30 01:44:58.174 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:44:58.177 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.177 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.0435ms
2025-11-30 01:44:58.179 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:44:58.182 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.182 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:44:58.183 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:44:58.184 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:44:58.186 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:44:58.187 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:44:58.188 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.5231ms
2025-11-30 01:44:58.189 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:44:58.190 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.8853ms
2025-11-30 01:44:58.192 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.8883ms
2025-11-30 01:44:58.196 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:44:58.196 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:44:58.198 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.200 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:44:58.201 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:44:58.201 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:44:58.202 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:44:58.203 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:44:58.204 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:44:58.205 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:44:58.208 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:44:58.209 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:44:58.212 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:44:58.213 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:44:58.215 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:44:58.217 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:44:58.219 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:44:58.219 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:44:58.220 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.9282ms
2025-11-30 01:44:58.223 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:44:58.223 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:44:58.226 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:44:58.226 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.0797ms
2025-11-30 01:44:58.229 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:44:58.229 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.1544ms
2025-11-30 01:44:58.232 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:44:58.235 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:44:58.236 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:45:00.262 +01:00 [INF] Received HTTP response headers after 2024.6239ms - 422
2025-11-30 01:45:00.263 +01:00 [INF] End processing HTTP request after 2027.7104ms - 422
2025-11-30 01:45:00.264 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:45:00.266 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2059.3053ms
2025-11-30 01:45:00.267 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:45:00.268 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2067.1512ms
2025-11-30 01:45:00.269 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2073.457ms
2025-11-30 01:48:47.005 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:48:47.005 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:48:47.007 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:48:47.009 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:48:47.010 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.5398ms
2025-11-30 01:48:47.010 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.7249ms
2025-11-30 01:48:47.011 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:48:47.012 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:48:47.016 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:48:47.018 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:48:47.019 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:48:47'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:48:47.020 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:48:47'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:48:47.021 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:48:47'.
2025-11-30 01:48:47.022 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:48:47'.
2025-11-30 01:48:47.023 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:48:47.024 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:48:47.025 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:48:47.025 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:48:47.026 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:48:47.027 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:48:47.040 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:48:47.040 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:48:47.042 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:48:47.043 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:48:47.046 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 16.4255ms
2025-11-30 01:48:47.046 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:48:47.0453345Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:48:47.0452591Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:48:47.0452597Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:44:58.10256","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:44:58.102561"}' (Size = 4000), @p8='0HNHFH06JI8UN:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:48:47.0452591Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:48:47.0452597Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:48:47.047 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:48:47.050 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 26.1071ms
2025-11-30 01:48:47.051 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:48:47.051 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 39.0677ms
2025-11-30 01:48:47.052 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 24.4095ms
2025-11-30 01:48:47.056 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:48:47.057 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 34.0586ms
2025-11-30 01:48:47.059 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 47.5872ms
2025-11-30 01:48:53.458 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:33:53.4577658Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:50:32.273 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:50:32.274 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:50:32.276 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.278 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.278 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 5.2171ms
2025-11-30 01:50:32.279 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.4904ms
2025-11-30 01:50:32.287 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:50:32.288 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:50:32.289 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.291 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.292 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:50:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:50:32.293 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:50:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:50:32.294 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:50:32'.
2025-11-30 01:50:32.295 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:50:32'.
2025-11-30 01:50:32.296 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:50:32.297 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:50:32.298 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:50:32.299 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:50:32.300 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:50:32.301 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:50:32.304 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:50:32.306 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:50:32.307 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:50:32.308 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:50:32.311 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:50:32.3103938Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:50:32.3103276Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:50:32.310328Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:48:47.045259","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:48:47.045259"}' (Size = 4000), @p8='0HNHFH06JI8UN:00000002' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:50:32.3103276Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:50:32.3103280Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:50:32.311 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.4641ms
2025-11-30 01:50:32.314 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:50:32.315 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 18.2716ms
2025-11-30 01:50:32.317 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 29.1986ms
2025-11-30 01:50:32.317 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:50:32.320 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 17.7032ms
2025-11-30 01:50:32.322 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:50:32.323 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 26.8505ms
2025-11-30 01:50:32.324 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 37.3069ms
2025-11-30 01:50:32.327 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:50:32.329 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.330 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:50:32.331 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:50:32.332 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:50:32.335 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:50:32.338 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:50:32.340 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:50:32.341 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.5491ms
2025-11-30 01:50:32.342 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:50:32.344 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.7292ms
2025-11-30 01:50:32.345 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 17.967ms
2025-11-30 01:50:32.364 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:50:32.366 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.367 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.3102ms
2025-11-30 01:50:32.369 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:50:32.372 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.372 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:50:32.373 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:50:32.374 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:50:32.376 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:50:32.377 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:50:32.378 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.4827ms
2025-11-30 01:50:32.379 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:50:32.380 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.8952ms
2025-11-30 01:50:32.382 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.3177ms
2025-11-30 01:50:32.410 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:50:32.410 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:50:32.412 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.414 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:50:32.414 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:50:32.415 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:50:32.416 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:50:32.417 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:50:32.418 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:50:32.419 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:50:32.421 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:50:32.422 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:50:32.424 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:50:32.426 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:50:32.427 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:50:32.428 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:50:32.430 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:50:32.431 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:50:32.433 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:50:32.434 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.3944ms
2025-11-30 01:50:32.436 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:50:32.437 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:50:32.439 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:50:32.439 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.9092ms
2025-11-30 01:50:32.441 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:50:32.442 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.5228ms
2025-11-30 01:50:32.443 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:50:32.446 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:50:34.490 +01:00 [INF] Received HTTP response headers after 2042.3617ms - 422
2025-11-30 01:50:34.491 +01:00 [INF] End processing HTTP request after 2047.4662ms - 422
2025-11-30 01:50:34.492 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:50:34.493 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2073.5048ms
2025-11-30 01:50:34.494 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:50:34.495 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2080.9536ms
2025-11-30 01:50:34.497 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2087.0527ms
2025-11-30 01:51:56.641 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:51:56.642 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:51:56.644 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.645 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.646 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.6332ms
2025-11-30 01:51:56.647 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.2201ms
2025-11-30 01:51:56.649 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:51:56.650 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:51:56.654 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.656 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.657 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:51:56'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:51:56.657 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:51:56'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:51:56.658 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:51:56'.
2025-11-30 01:51:56.660 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:51:56'.
2025-11-30 01:51:56.661 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:51:56.661 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:51:56.663 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:51:56.664 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:51:56.665 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:51:56.666 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:51:56.669 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:51:56.670 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:51:56.671 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:51:56.672 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:51:56.675 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.6392ms
2025-11-30 01:51:56.675 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:51:56.6746157Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:51:56.6745297Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:51:56.6745304Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:50:32.310327","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:50:32.310328"}' (Size = 4000), @p8='0HNHFH06JI8UN:00000005' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:51:56.6745297Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:51:56.6745304Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:51:56.676 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:51:56.679 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 17.7188ms
2025-11-30 01:51:56.683 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 33.5894ms
2025-11-30 01:51:56.692 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:51:56.693 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 26.151ms
2025-11-30 01:51:56.694 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:51:56.695 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 34.3921ms
2025-11-30 01:51:56.697 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 47.4809ms
2025-11-30 01:51:56.749 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:51:56.751 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.752 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:51:56.753 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:51:56.754 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:51:56.758 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:51:56.760 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:51:56.762 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:51:56.764 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.1437ms
2025-11-30 01:51:56.765 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:51:56.766 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.0981ms
2025-11-30 01:51:56.768 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.7621ms
2025-11-30 01:51:56.785 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:51:56.787 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.788 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.6765ms
2025-11-30 01:51:56.814 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:51:56.816 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.817 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:51:56.818 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:51:56.819 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:51:56.821 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:51:56.822 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:51:56.823 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 3.06ms
2025-11-30 01:51:56.824 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:51:56.825 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.0598ms
2025-11-30 01:51:56.826 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.2897ms
2025-11-30 01:51:56.831 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:51:56.831 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:51:56.833 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.836 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:56.837 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:51:56.837 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:51:56.838 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:51:56.839 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:51:56.840 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:51:56.841 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:51:56.844 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:51:56.845 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:51:56.848 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:51:56.851 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:51:56.853 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:51:56.854 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:51:56.856 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:51:56.856 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:51:56.858 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:51:56.859 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 15.2379ms
2025-11-30 01:51:56.861 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:51:56.861 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:51:56.864 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:51:56.864 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.1188ms
2025-11-30 01:51:56.866 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:51:56.868 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 36.505ms
2025-11-30 01:51:56.870 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:51:56.873 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:51:57.876 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:51:57.878 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:57.878 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9153ms
2025-11-30 01:51:57.880 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:51:57.884 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:57.884 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:51:57.885 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:51:57.886 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:51:57.887 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5997ms
2025-11-30 01:51:57.889 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.4022ms
2025-11-30 01:51:57.890 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=KpBWs5iVVoj18C573vhVrw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:51:57.893 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:57.893 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:51:57.895 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:51:57.898 +01:00 [INF] SignalR connected: f1UDKlLGohcxFLSU92-pAQ user:null
2025-11-30 01:51:57.902 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:51:57.904 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='128', @p0='2025-11-30T00:51:57.9035961Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:51:57.9036693Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='128' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:51:57.9035961Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-29T23:44:26.529724"}' (Size = 4000), @p10='0HNHFH06JI8UQ:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:51:58.399 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/128 - null null
2025-11-30 01:51:58.401 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:58.402 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/128 - 204 null null 3.1074ms
2025-11-30 01:51:58.404 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/128 - null null
2025-11-30 01:51:58.406 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:51:58.407 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:51:58'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:51:58.409 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:51:58'.
2025-11-30 01:51:58.410 +01:00 [INF] HTTP GET /api/Conversations/history/128 started - IP: 127.0.0.1
2025-11-30 01:51:58.411 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:51:58.411 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:51:58.415 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:51:58.418 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:51:58.421 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='128'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:51:58.423 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:51:58.424 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.9142ms
2025-11-30 01:51:58.425 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:51:58.426 +01:00 [INF] HTTP GET /api/Conversations/history/128 completed - Status: 200 - Duration: 16.4221ms
2025-11-30 01:51:58.427 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/128 - 200 null application/json; charset=utf-8 22.9377ms
2025-11-30 01:51:58.911 +01:00 [INF] Received HTTP response headers after 2037.2537ms - 422
2025-11-30 01:51:58.912 +01:00 [INF] End processing HTTP request after 2042.9204ms - 422
2025-11-30 01:51:58.914 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:51:58.916 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2073.7882ms
2025-11-30 01:51:58.917 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:51:58.918 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2081.0696ms
2025-11-30 01:51:58.919 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2088.2549ms
2025-11-30 01:52:00.995 +01:00 [INF] SignalR disconnected: f1UDKlLGohcxFLSU92-pAQ user:null ex:null
2025-11-30 01:52:00.997 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:52:00.998 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 3104.6643ms
2025-11-30 01:52:01.000 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=128&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=KpBWs5iVVoj18C573vhVrw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 3109.0907ms
2025-11-30 01:52:01.974 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 01:52:01.976 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:01.977 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.9957ms
2025-11-30 01:52:01.980 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 01:52:01.982 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:01.983 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:52:01'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:52:01.985 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:52:01'.
2025-11-30 01:52:01.986 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 01:52:01.987 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:52:01.987 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:52:01.991 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDYzOTE2LCJleHAiOjE3OTU5OTk5MTYsImlhdCI6MTc2NDQ2MzkxNiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.M5Tbez1ErhXbShMAtirIanT-ylBPw6Y65Ily37JYjfM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:52:01.993 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:52:01.995 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 01:52:01.999 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T00:52:01.9982208Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T00:52:01.9982201Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T00:52:01.9983918Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482586' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482586,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T00:52:01.9982208Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T00:52:01.9982201Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8UN:00000009' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:52:02.003 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:52:02.004 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.0975ms
2025-11-30 01:52:02.005 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:52:02.006 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.3041ms
2025-11-30 01:52:02.007 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.3154ms
2025-11-30 01:52:02.013 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=131&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:52:02.015 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:02.016 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=131&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.4833ms
2025-11-30 01:52:02.029 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=131&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:52:02.031 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:02.032 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:52:02.033 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:52:02.034 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:52:02.035 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.7318ms
2025-11-30 01:52:02.036 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=131&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.0914ms
2025-11-30 01:52:02.038 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=131&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=u4PhSdkGyYnx-E4qQ8knGw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:52:02.040 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:02.041 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:52:02.042 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:52:02.045 +01:00 [INF] SignalR connected: Lf3vxD5I_wAdu_U9iYLT8w user:null
2025-11-30 01:52:02.048 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='131'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:52:02.051 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='131', @p0='2025-11-30T00:52:02.0506679Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:52:02.0507503Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='131' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:52:02.0506679Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8UR:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:52:02.540 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/131 - null null
2025-11-30 01:52:02.542 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:02.543 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/131 - 204 null null 2.6152ms
2025-11-30 01:52:02.545 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/131 - null null
2025-11-30 01:52:02.547 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:52:02.548 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:52:02'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:52:02.550 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:52:02'.
2025-11-30 01:52:02.551 +01:00 [INF] HTTP GET /api/Conversations/history/131 started - IP: 127.0.0.1
2025-11-30 01:52:02.552 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:52:02.553 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:52:02.555 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='131'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:52:02.558 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='131'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:52:02.560 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='131'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:52:02.562 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:52:02.564 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.6985ms
2025-11-30 01:52:02.565 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:52:02.566 +01:00 [INF] HTTP GET /api/Conversations/history/131 completed - Status: 200 - Duration: 14.9249ms
2025-11-30 01:52:02.567 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/131 - 200 null application/json; charset=utf-8 21.7099ms
2025-11-30 01:52:03.657 +01:00 [INF] SignalR disconnected: Lf3vxD5I_wAdu_U9iYLT8w user:null ex:null
2025-11-30 01:52:03.658 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:52:03.659 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1617.8915ms
2025-11-30 01:52:03.660 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=131&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=u4PhSdkGyYnx-E4qQ8knGw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1622.048ms
2025-11-30 01:53:53.461 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:38:53.4607572Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:54:19.671 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:54:19.672 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:54:19.673 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:19.675 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:19.676 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:54:19.677 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:54:19.678 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:54:19.679 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:54:19.680 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:54:19.681 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:54:19.684 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:54:19.684 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:54:19.686 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:54:19.688 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:54:19.689 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:19.690 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:54:19.692 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.1059ms
2025-11-30 01:54:19.692 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:19.694 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:54:19.695 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.4614ms
2025-11-30 01:54:19.696 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 19.7217ms
2025-11-30 01:54:19.697 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:54:19.698 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 26.8232ms
2025-11-30 01:54:19.699 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.3567ms
2025-11-30 01:54:19.703 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 30.8354ms
2025-11-30 01:54:19.722 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:54:19.724 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:19.725 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.6214ms
2025-11-30 01:54:19.727 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:54:19.729 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:19.730 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:54:19.731 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:54:19.732 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:19.734 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:54:19.734 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:19.735 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2018ms
2025-11-30 01:54:19.736 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:54:19.737 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.0738ms
2025-11-30 01:54:19.738 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.3557ms
2025-11-30 01:54:19.745 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:54:19.747 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:54:19.747 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:19.749 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:19.750 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:54:19.750 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:54:19.751 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:54:19.752 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:54:19.753 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:54:19.754 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:54:19.757 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:54:19.758 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:54:19.760 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:54:19.762 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:54:19.764 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:54:19.765 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:54:19.767 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:54:19.768 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:19.770 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:54:19.770 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.5178ms
2025-11-30 01:54:19.773 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:54:19.773 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:54:19.775 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:54:19.775 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.1729ms
2025-11-30 01:54:19.778 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:54:19.779 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.1337ms
2025-11-30 01:54:19.781 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:54:19.784 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:54:21.807 +01:00 [INF] Received HTTP response headers after 2021.8575ms - 422
2025-11-30 01:54:21.808 +01:00 [INF] End processing HTTP request after 2027.4716ms - 422
2025-11-30 01:54:21.809 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:21.811 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2055.9001ms
2025-11-30 01:54:21.812 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:54:21.813 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2063.4117ms
2025-11-30 01:54:21.815 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2070.0556ms
2025-11-30 01:54:32.895 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 01:54:32.898 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:32.898 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.4439ms
2025-11-30 01:54:32.900 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 01:54:32.903 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:32.904 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:32.905 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:32'.
2025-11-30 01:54:32.906 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 01:54:32.907 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:32.909 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:32.913 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDYzOTE2LCJleHAiOjE3OTU5OTk5MTYsImlhdCI6MTc2NDQ2MzkxNiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.M5Tbez1ErhXbShMAtirIanT-ylBPw6Y65Ily37JYjfM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:32.916 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:32.918 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 01:54:32.921 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T00:54:32.9202792Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T00:54:32.9202786Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T00:54:32.9204118Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482585' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482585,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T00:54:32.9202792Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T00:54:32.9202786Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8UT:00000004' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:32.925 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:32.926 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9893ms
2025-11-30 01:54:32.927 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:32.928 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 22.215ms
2025-11-30 01:54:32.930 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 29.7249ms
2025-11-30 01:54:32.954 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=132&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:54:32.956 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:32.957 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=132&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.8829ms
2025-11-30 01:54:32.961 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=132&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:54:32.963 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:32.963 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:54:32.964 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:54:32.965 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:54:32.966 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6639ms
2025-11-30 01:54:32.968 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=132&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.4228ms
2025-11-30 01:54:32.972 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=132&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=x4C7wLe1UCu8zkhw7GXFKg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:54:32.974 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:32.975 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:54:32.977 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:54:32.982 +01:00 [INF] SignalR connected: ITJohG1K8S1HY17XAkSZwA user:null
2025-11-30 01:54:32.985 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='132'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:54:32.988 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='132', @p0='2025-11-30T00:54:32.9872345Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:54:32.9873050Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='132' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:54:32.9872345Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8UU:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:33.463 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/132 - null null
2025-11-30 01:54:33.464 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:33.465 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/132 - 204 null null 2.5536ms
2025-11-30 01:54:33.468 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/132 - null null
2025-11-30 01:54:33.470 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:33.470 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:33'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:33.472 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:33'.
2025-11-30 01:54:33.472 +01:00 [INF] HTTP GET /api/Conversations/history/132 started - IP: 127.0.0.1
2025-11-30 01:54:33.474 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:33.475 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:33.478 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='132'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:54:33.480 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='132'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:54:33.483 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='132'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:54:33.484 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:33.486 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.5803ms
2025-11-30 01:54:33.487 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:33.488 +01:00 [INF] HTTP GET /api/Conversations/history/132 completed - Status: 200 - Duration: 15.8197ms
2025-11-30 01:54:33.490 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/132 - 200 null application/json; charset=utf-8 22.371ms
2025-11-30 01:54:36.015 +01:00 [INF] SignalR disconnected: ITJohG1K8S1HY17XAkSZwA user:null ex:null
2025-11-30 01:54:36.017 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:54:36.018 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 3043.0612ms
2025-11-30 01:54:36.019 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=132&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=x4C7wLe1UCu8zkhw7GXFKg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 3047.4876ms
2025-11-30 01:54:38.002 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 01:54:38.004 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.004 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.8385ms
2025-11-30 01:54:38.005 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 01:54:38.009 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.010 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:38'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:38.011 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:38'.
2025-11-30 01:54:38.012 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 01:54:38.014 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:38.014 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:38.017 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDYzOTE2LCJleHAiOjE3OTU5OTk5MTYsImlhdCI6MTc2NDQ2MzkxNiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.M5Tbez1ErhXbShMAtirIanT-ylBPw6Y65Ily37JYjfM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:38.020 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:38.022 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 01:54:38.025 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T00:54:38.0243763Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T00:54:38.0243759Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T00:54:38.0245059Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482584' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482584,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T00:54:38.0243763Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T00:54:38.0243759Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8UT:00000006' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:38.030 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:38.031 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9298ms
2025-11-30 01:54:38.032 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:38.033 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.3275ms
2025-11-30 01:54:38.034 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.6732ms
2025-11-30 01:54:38.038 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:54:38.040 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.041 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5001ms
2025-11-30 01:54:38.043 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:54:38.046 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.046 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:54:38.048 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:54:38.048 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:54:38.049 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9419ms
2025-11-30 01:54:38.051 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.5285ms
2025-11-30 01:54:38.063 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=b1ue83Hq_JggmIeo_KpIWQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:54:38.065 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.065 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:54:38.067 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:54:38.069 +01:00 [INF] SignalR connected: KRxbm0GTexBv1CvqwKFOXA user:null
2025-11-30 01:54:38.072 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:54:38.075 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-30T00:54:38.0740693Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:54:38.0741310Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:54:38.0740693Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8UV:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:38.545 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/133 - null null
2025-11-30 01:54:38.547 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.547 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/133 - 204 null null 2.4444ms
2025-11-30 01:54:38.550 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - null null
2025-11-30 01:54:38.551 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:38.552 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:38'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:38.553 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:38'.
2025-11-30 01:54:38.554 +01:00 [INF] HTTP GET /api/Conversations/history/133 started - IP: 127.0.0.1
2025-11-30 01:54:38.555 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:38.556 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:38.558 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:54:38.561 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:54:38.564 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:54:38.565 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:38.567 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.6871ms
2025-11-30 01:54:38.568 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:38.568 +01:00 [INF] HTTP GET /api/Conversations/history/133 completed - Status: 200 - Duration: 14.4507ms
2025-11-30 01:54:38.570 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - 200 null application/json; charset=utf-8 20.3116ms
2025-11-30 01:54:40.848 +01:00 [INF] SignalR disconnected: KRxbm0GTexBv1CvqwKFOXA user:null ex:null
2025-11-30 01:54:40.850 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:54:40.851 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 2785.4902ms
2025-11-30 01:54:40.853 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=b1ue83Hq_JggmIeo_KpIWQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 2790.2728ms
2025-11-30 01:54:42.304 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 01:54:42.306 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:42.307 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:42'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:42.309 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:42'.
2025-11-30 01:54:42.310 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 01:54:42.311 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:42.313 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:42.316 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDYzOTE2LCJleHAiOjE3OTU5OTk5MTYsImlhdCI6MTc2NDQ2MzkxNiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.M5Tbez1ErhXbShMAtirIanT-ylBPw6Y65Ily37JYjfM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:42.318 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:42.321 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 01:54:42.324 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T00:54:42.3230706Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T00:54:42.3230701Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T00:54:42.3232307Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482583' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482583,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T00:54:42.3230706Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T00:54:42.3230701Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8UT:00000008' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:42.329 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:42.330 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.9133ms
2025-11-30 01:54:42.331 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:42.332 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 22.2326ms
2025-11-30 01:54:42.334 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 30.047ms
2025-11-30 01:54:42.339 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:54:42.341 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:42.341 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.591ms
2025-11-30 01:54:42.343 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:54:42.347 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:42.348 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:54:42.349 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:54:42.350 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:54:42.351 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9292ms
2025-11-30 01:54:42.352 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.9706ms
2025-11-30 01:54:42.380 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=HkWvc1Ija0RBZAbugQm0yQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:54:42.382 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:42.383 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:54:42.384 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:54:42.387 +01:00 [INF] SignalR connected: FUoltYhCzYXHzO1JYshhqQ user:null
2025-11-30 01:54:42.390 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:54:42.393 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='134', @p0='2025-11-30T00:54:42.3925096Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:54:42.3926041Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='134' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:54:42.3925096Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8V0:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:42.852 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/134 - null null
2025-11-30 01:54:42.854 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:42.855 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/134 - 204 null null 2.4762ms
2025-11-30 01:54:42.857 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/134 - null null
2025-11-30 01:54:42.859 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:42.860 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:42'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:42.861 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:42'.
2025-11-30 01:54:42.862 +01:00 [INF] HTTP GET /api/Conversations/history/134 started - IP: 127.0.0.1
2025-11-30 01:54:42.863 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:42.864 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:42.867 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:54:42.869 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:54:42.871 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:54:42.873 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:42.874 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.2552ms
2025-11-30 01:54:42.876 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:42.877 +01:00 [INF] HTTP GET /api/Conversations/history/134 completed - Status: 200 - Duration: 14.8088ms
2025-11-30 01:54:42.878 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/134 - 200 null application/json; charset=utf-8 21.0806ms
2025-11-30 01:54:44.471 +01:00 [INF] SignalR disconnected: FUoltYhCzYXHzO1JYshhqQ user:null ex:null
2025-11-30 01:54:44.472 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:54:44.473 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 2090.6553ms
2025-11-30 01:54:44.475 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=HkWvc1Ija0RBZAbugQm0yQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 2095.0567ms
2025-11-30 01:54:46.242 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 01:54:46.244 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.245 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.668ms
2025-11-30 01:54:46.247 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 01:54:46.250 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.250 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:46'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:46.252 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:46'.
2025-11-30 01:54:46.253 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 01:54:46.254 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:46.255 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:46.257 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDYzOTE2LCJleHAiOjE3OTU5OTk5MTYsImlhdCI6MTc2NDQ2MzkxNiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.M5Tbez1ErhXbShMAtirIanT-ylBPw6Y65Ily37JYjfM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:46.260 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:46.263 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 01:54:46.266 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T00:54:46.2651326Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T00:54:46.2651320Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T00:54:46.2652594Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482582' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482582,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T00:54:46.2651326Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T00:54:46.265132Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8UT:0000000A' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:46.270 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:46.271 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.2562ms
2025-11-30 01:54:46.272 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:46.273 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.4702ms
2025-11-30 01:54:46.275 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.3747ms
2025-11-30 01:54:46.318 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:54:46.320 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.321 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5729ms
2025-11-30 01:54:46.323 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:54:46.325 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.326 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:54:46.327 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:54:46.328 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:54:46.329 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.7017ms
2025-11-30 01:54:46.330 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.8606ms
2025-11-30 01:54:46.332 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=dtloT3Jv0XyTBgrlX044ow&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:54:46.335 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.336 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:54:46.338 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:54:46.341 +01:00 [INF] SignalR connected: WTWSOo8f5plcz2nkR6ODFg user:null
2025-11-30 01:54:46.344 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:54:46.347 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='135', @p0='2025-11-30T00:54:46.3465985Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:54:46.3466621Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='135' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:54:46.3465985Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8V1:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:46.790 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/135 - null null
2025-11-30 01:54:46.792 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.793 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/135 - 204 null null 3.0349ms
2025-11-30 01:54:46.795 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/135 - null null
2025-11-30 01:54:46.797 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:46.798 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:46'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:46.799 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:46'.
2025-11-30 01:54:46.800 +01:00 [INF] HTTP GET /api/Conversations/history/135 started - IP: 127.0.0.1
2025-11-30 01:54:46.801 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:46.802 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:46.804 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:54:46.807 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:54:46.810 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:54:46.812 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:46.813 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.8381ms
2025-11-30 01:54:46.814 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:46.815 +01:00 [INF] HTTP GET /api/Conversations/history/135 completed - Status: 200 - Duration: 14.8552ms
2025-11-30 01:54:46.816 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/135 - 200 null application/json; charset=utf-8 21.128ms
2025-11-30 01:54:50.024 +01:00 [INF] SignalR disconnected: WTWSOo8f5plcz2nkR6ODFg user:null ex:null
2025-11-30 01:54:50.025 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:54:50.026 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 3690.1183ms
2025-11-30 01:54:50.028 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=dtloT3Jv0XyTBgrlX044ow&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 3695.502ms
2025-11-30 01:54:51.191 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 01:54:51.194 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:51.195 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:51'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:51.196 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:51'.
2025-11-30 01:54:51.197 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 01:54:51.198 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:51.199 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:51.202 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDYzOTE2LCJleHAiOjE3OTU5OTk5MTYsImlhdCI6MTc2NDQ2MzkxNiwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.M5Tbez1ErhXbShMAtirIanT-ylBPw6Y65Ily37JYjfM' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:51.205 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 01:54:51.207 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 01:54:51.211 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T00:54:51.2101920Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T00:54:51.2101914Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T00:54:51.2103530Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482581' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482581,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T00:54:51.210192Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T00:54:51.2101914Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8UT:0000000C' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:51.216 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:54:51.217 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 16.36ms
2025-11-30 01:54:51.218 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 01:54:51.219 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.7702ms
2025-11-30 01:54:51.221 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 29.2198ms
2025-11-30 01:54:51.224 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:54:51.227 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:51.227 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9572ms
2025-11-30 01:54:51.229 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:54:51.232 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:51.233 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:54:51.234 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:54:51.235 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:54:51.236 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.1342ms
2025-11-30 01:54:51.238 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.8311ms
2025-11-30 01:54:51.238 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=5z2iny6rdBr5nAvCo1cqWg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:54:51.242 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:51.243 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:54:51.244 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:54:51.247 +01:00 [INF] SignalR connected: d2ifA-mbHQWRfSFtnzdzdw user:null
2025-11-30 01:54:51.250 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:54:51.253 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:54:51.2523016Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:54:51.2523764Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:54:51.2523016Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8V2:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:54:51.744 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/136 - null null
2025-11-30 01:54:51.747 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:51.747 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/136 - 204 null null 2.9786ms
2025-11-30 01:54:51.750 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/136 - null null
2025-11-30 01:54:51.752 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:54:51.753 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:51'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:54:51.754 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:54:51'.
2025-11-30 01:54:51.755 +01:00 [INF] HTTP GET /api/Conversations/history/136 started - IP: 127.0.0.1
2025-11-30 01:54:51.756 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:51.757 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:54:51.760 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:54:51.762 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:54:51.765 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:54:51.767 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:54:51.768 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.7073ms
2025-11-30 01:54:51.769 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:54:51.770 +01:00 [INF] HTTP GET /api/Conversations/history/136 completed - Status: 200 - Duration: 14.9345ms
2025-11-30 01:54:51.772 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/136 - 200 null application/json; charset=utf-8 21.3379ms
2025-11-30 01:55:21.238 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:55:21.242 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='136', @p0='2025-11-30T00:55:21.2407474Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:55:21.2408143Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:55:21.2407474Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:54:51.252301"}' (Size = 4000), @p10='0HNHFH06JI8V2:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:55:51.252 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:55:51.255 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:55:51.2547832Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:55:51.2548604Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:55:51.2547832Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:55:21.240747"}' (Size = 4000), @p10='0HNHFH06JI8V2:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:56:21.258 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:56:21.261 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:56:21.2599979Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:56:21.2600644Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:56:21.2599979Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:55:51.254783"}' (Size = 4000), @p10='0HNHFH06JI8V2:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:56:51.274 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:56:51.277 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:56:51.2760098Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:56:51.2760884Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:56:51.2760098Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:56:21.259997"}' (Size = 4000), @p10='0HNHFH06JI8V2:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:57:21.285 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:57:21.288 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:57:21.2874594Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:57:21.2875372Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:57:21.2874594Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:56:51.276009"}' (Size = 4000), @p10='0HNHFH06JI8V2:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:57:36.620 +01:00 [INF] SignalR disconnected: d2ifA-mbHQWRfSFtnzdzdw user:null ex:null
2025-11-30 01:57:36.621 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:57:36.621 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:57:36.622 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:57:36.623 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.624 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 165381.2418ms
2025-11-30 01:57:36.627 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:57:36.626 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.629 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 165381.2418ms
2025-11-30 01:57:36.630 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:57:36.630 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:57:36.631 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:57:36.632 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=5z2iny6rdBr5nAvCo1cqWg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 165393.4644ms
2025-11-30 01:57:36.633 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.634 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:57:36.635 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:57:36.639 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 8.7062ms
2025-11-30 01:57:36.642 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:57:36.643 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:57:36.647 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:57:36.648 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:57:36.650 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:57:36.651 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:57:36.653 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:57:36.655 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 14.2034ms
2025-11-30 01:57:36.655 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:57:36.657 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:57:36.658 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.8706ms
2025-11-30 01:57:36.659 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 31.9621ms
2025-11-30 01:57:36.660 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:57:36.662 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 40.645ms
2025-11-30 01:57:36.662 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 31.7275ms
2025-11-30 01:57:36.666 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:57:36.667 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 45.0509ms
2025-11-30 01:57:36.669 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.674 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:57:36.675 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:57:36.675 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:57:36.676 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:57:36.679 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.680 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 6.0223ms
2025-11-30 01:57:36.680 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=tWfLRfwIxi_r7Ywpjj2yaA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:57:36.680 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.9838ms
2025-11-30 01:57:36.682 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 15.4903ms
2025-11-30 01:57:36.684 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.691 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:57:36.691 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:57:36.692 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:57:36.694 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.696 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:57:36.697 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:57:36.697 +01:00 [INF] SignalR connected: Vht9A9Whet_a6-Q_hXchhw user:null
2025-11-30 01:57:36.698 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:57:36.701 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:57:36.701 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:57:36.701 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:57:36.705 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 4.3729ms
2025-11-30 01:57:36.705 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='136', @p0='2025-11-30T00:57:36.7038662Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:57:36.7039340Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:57:36.7038662Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:57:21.287459"}' (Size = 4000), @p10='0HNHFH06JI8V7:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:57:36.706 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:57:36.709 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 13.5994ms
2025-11-30 01:57:36.711 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 19.4794ms
2025-11-30 01:57:36.714 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:57:36.716 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:57:36.716 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.718 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:36.719 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:57:36.719 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:57:36.720 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:57:36.722 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:57:36.723 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:57:36.724 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:57:36.727 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:57:36.728 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:57:36.730 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:57:36.733 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:57:36.734 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:57:36.736 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:57:36.739 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:57:36.739 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:36.740 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.4473ms
2025-11-30 01:57:36.743 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:57:36.743 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:57:36.746 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:36.746 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.1391ms
2025-11-30 01:57:36.749 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:36.750 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.5707ms
2025-11-30 01:57:36.753 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:36.757 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:57:36.758 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:57:38.786 +01:00 [INF] Received HTTP response headers after 2027.0397ms - 422
2025-11-30 01:57:38.787 +01:00 [INF] End processing HTTP request after 2030.2354ms - 422
2025-11-30 01:57:38.788 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:57:38.790 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2064.843ms
2025-11-30 01:57:38.791 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:57:38.792 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2073.3761ms
2025-11-30 01:57:38.794 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2079.852ms
2025-11-30 01:57:45.084 +01:00 [INF] SignalR disconnected: Vht9A9Whet_a6-Q_hXchhw user:null ex:null
2025-11-30 01:57:45.091 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:57:45.092 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 8401.6015ms
2025-11-30 01:57:45.094 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 8401.6015ms
2025-11-30 01:57:45.095 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=tWfLRfwIxi_r7Ywpjj2yaA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 8414.9007ms
2025-11-30 01:57:45.126 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/136/disconnect - null 0
2025-11-30 01:57:45.128 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:45.129 +01:00 [INF] HTTP POST /api/conversations/136/disconnect started - IP: 127.0.0.1
2025-11-30 01:57:45.129 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:57:45.130 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api)'
2025-11-30 01:57:45.132 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:45.133 +01:00 [INF] Route matched with {action = "UserDisconnected", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UserDisconnected(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:57:45.133 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 4.2723ms
2025-11-30 01:57:45.136 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:57:45.141 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='136', @p0='2025-11-30T00:57:45.1400498Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:57:45.1401402Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:57:45.1400498Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:57:36.703866"}' (Size = 4000), @p10='0HNHFH06JI8V5:00000004' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:57:45.146 +01:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-11-30 01:57:45.148 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api) in 12.9977ms
2025-11-30 01:57:45.149 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api)'
2025-11-30 01:57:45.150 +01:00 [INF] HTTP POST /api/conversations/136/disconnect completed - Status: 200 - Duration: 20.8885ms
2025-11-30 01:57:45.151 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/136/disconnect - 200 0 null 25.2722ms
2025-11-30 01:57:46.796 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:57:46.796 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:57:46.798 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.800 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.801 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.802ms
2025-11-30 01:57:46.801 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.2716ms
2025-11-30 01:57:46.822 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:57:46.822 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:57:46.824 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.826 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.826 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:57:46'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:57:46.827 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:57:46'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:57:46.828 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:57:46'.
2025-11-30 01:57:46.830 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:57:46'.
2025-11-30 01:57:46.830 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:57:46.832 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:57:46.833 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:57:46.834 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:57:46.835 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:57:46.836 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:57:46.839 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:57:46.840 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:57:46.842 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:57:46.843 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:57:46.846 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.8027ms
2025-11-30 01:57:46.847 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:57:46.848 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 16.3066ms
2025-11-30 01:57:46.849 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 27.3899ms
2025-11-30 01:57:46.851 +01:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:57:46.8452554Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:57:46.8451825Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:57:46.8451831Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:51:56.674529","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:51:56.67453"}' (Size = 4000), @p8='0HNHFH06JI8V5:00000005' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:57:46.8451825Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:57:46.8451831Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:57:46.856 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:57:46.857 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 19.8611ms
2025-11-30 01:57:46.858 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:57:46.859 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 28.9241ms
2025-11-30 01:57:46.861 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 39.3294ms
2025-11-30 01:57:46.872 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:57:46.874 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.874 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:57:46.875 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:57:46.876 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:57:46.880 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:57:46.883 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:57:46.884 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:57:46.886 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.0341ms
2025-11-30 01:57:46.888 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:57:46.889 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.5165ms
2025-11-30 01:57:46.891 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.8587ms
2025-11-30 01:57:46.922 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:57:46.924 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.925 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.1212ms
2025-11-30 01:57:46.927 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:57:46.930 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.930 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:57:46.931 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:57:46.932 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:57:46.934 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:57:46.935 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:57:46.936 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.4254ms
2025-11-30 01:57:46.937 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:57:46.938 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.946ms
2025-11-30 01:57:46.940 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.4161ms
2025-11-30 01:57:46.944 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:57:46.945 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:57:46.946 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.947 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:46.948 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:57:46.949 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:57:46.950 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:57:46.951 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:57:46.951 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:57:46.952 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:57:46.956 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:57:46.956 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:57:46.960 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:57:46.961 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:57:46.963 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:57:46.964 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:57:46.966 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:46.966 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:57:46.968 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:57:46.968 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.4881ms
2025-11-30 01:57:46.971 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:46.971 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:57:46.974 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:46.974 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.3533ms
2025-11-30 01:57:46.976 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:57:46.977 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.1417ms
2025-11-30 01:57:46.979 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:57:46.982 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:57:48.424 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:57:48.426 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:48.427 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5613ms
2025-11-30 01:57:48.428 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:57:48.431 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:48.432 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:57:48.433 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:57:48.433 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:57:48.434 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6581ms
2025-11-30 01:57:48.436 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.6065ms
2025-11-30 01:57:48.437 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=i-g75Izf5LUu6ndJUrHQ0Q&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:57:48.440 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:48.441 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:57:48.442 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:57:48.445 +01:00 [INF] SignalR connected: jC5odl0jTRXTTu1mrJLi7A user:null
2025-11-30 01:57:48.448 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:57:48.451 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:57:48.4501777Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:57:48.4502431Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:57:48.4501777Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:57:45.140049"}' (Size = 4000), @p10='0HNHFH06JI8V8:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:57:48.946 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/136 - null null
2025-11-30 01:57:48.948 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:48.949 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/136 - 204 null null 2.7098ms
2025-11-30 01:57:48.951 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/136 - null null
2025-11-30 01:57:48.953 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:57:48.954 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:57:48'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:57:48.956 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:57:48'.
2025-11-30 01:57:48.957 +01:00 [INF] HTTP GET /api/Conversations/history/136 started - IP: 127.0.0.1
2025-11-30 01:57:48.958 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:57:48.959 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:57:48.962 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 01:57:48.964 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 01:57:48.967 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 01:57:48.969 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:57:48.971 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.3722ms
2025-11-30 01:57:48.972 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 01:57:48.973 +01:00 [INF] HTTP GET /api/Conversations/history/136 completed - Status: 200 - Duration: 16.4528ms
2025-11-30 01:57:48.975 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/136 - 200 null application/json; charset=utf-8 23.6983ms
2025-11-30 01:57:49.021 +01:00 [INF] Received HTTP response headers after 2038.0865ms - 422
2025-11-30 01:57:49.022 +01:00 [INF] End processing HTTP request after 2043.3027ms - 422
2025-11-30 01:57:49.023 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:57:49.024 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2071.0053ms
2025-11-30 01:57:49.025 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:57:49.026 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2078.3566ms
2025-11-30 01:57:49.028 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2084.1273ms
2025-11-30 01:58:18.427 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:58:18.430 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:58:18.4294768Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:58:18.4295468Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:58:18.4294768Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:57:48.450177"}' (Size = 4000), @p10='0HNHFH06JI8V8:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:58:48.415 +01:00 [INF] SignalR disconnected: jC5odl0jTRXTTu1mrJLi7A user:null ex:null
2025-11-30 01:58:48.416 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:58:48.417 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 59976.4045ms
2025-11-30 01:58:48.418 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 59976.4045ms
2025-11-30 01:58:48.420 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=i-g75Izf5LUu6ndJUrHQ0Q&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 59982.8687ms
2025-11-30 01:58:48.433 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:58:48.433 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:58:48.435 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.436 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 01:58:48.437 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.438 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:58:48.440 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.440 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:58:48.441 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:58:48.442 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 5.4334ms
2025-11-30 01:58:48.443 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:58:48.444 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 01:58:48.444 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:58:48.447 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:58:48.449 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.452 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:58:48.453 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 01:58:48.453 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:58:48.455 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:58:48.456 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 01:58:48.459 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:58:48.460 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:58:48.461 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 01:58:48.462 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:58:48.464 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 13.3098ms
2025-11-30 01:58:48.465 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 11.6828ms
2025-11-30 01:58:48.465 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:58:48.467 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:58:48.468 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 24.3651ms
2025-11-30 01:58:48.470 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 17.6943ms
2025-11-30 01:58:48.470 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=1hSVjKj01H3Z04abwQtYGA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:58:48.471 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 32.7161ms
2025-11-30 01:58:48.474 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:58:48.476 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.478 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 44.9154ms
2025-11-30 01:58:48.478 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 38.1366ms
2025-11-30 01:58:48.479 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 01:58:48.482 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:58:48.483 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 49.9282ms
2025-11-30 01:58:48.484 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 01:58:48.486 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.490 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 8.2175ms
2025-11-30 01:58:48.493 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:58:48.493 +01:00 [INF] SignalR connected: KUKxYR1JR2cosJ_6MlfO6Q user:null
2025-11-30 01:58:48.495 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.496 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:58:48.498 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:58:48.498 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:58:48.499 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:58:48.502 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:58:48.5010497Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:58:48.5011246Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:58:48.5010497Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:58:18.429476"}' (Size = 4000), @p10='0HNHFH06JI8V9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:58:48.503 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:58:48.505 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:58:48.507 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 4.2887ms
2025-11-30 01:58:48.508 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:58:48.509 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 12.1199ms
2025-11-30 01:58:48.510 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 17.6192ms
2025-11-30 01:58:48.523 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:58:48.525 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.526 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:58:48.527 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:58:48.527 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:58:48.529 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:58:48.530 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:58:48.531 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:58:48.533 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:58:48.534 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:58:48.534 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:58:48.538 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:58:48.539 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:58:48.540 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:58:48.542 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:58:48.544 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:58:48.545 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:58:48.548 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:58:48.548 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:58:48.549 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 10.8162ms
2025-11-30 01:58:48.552 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:58:48.552 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:58:48.555 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:58:48.555 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.4888ms
2025-11-30 01:58:48.558 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:58:48.559 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.1066ms
2025-11-30 01:58:48.561 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:58:48.564 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:58:50.598 +01:00 [INF] Received HTTP response headers after 2032.3964ms - 422
2025-11-30 01:58:50.599 +01:00 [INF] End processing HTTP request after 2038.2078ms - 422
2025-11-30 01:58:50.600 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:58:50.602 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2069.7743ms
2025-11-30 01:58:50.603 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:58:50.604 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2078.0636ms
2025-11-30 01:58:50.606 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2082.6002ms
2025-11-30 01:58:53.468 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:43:53.4676215Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 01:59:18.448 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:59:18.452 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='136', @p0='2025-11-30T00:59:18.4507592Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:59:18.4508358Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:59:18.4507592Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:58:48.501049"}' (Size = 4000), @p10='0HNHFH06JI8V9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:59:48.452 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 01:59:48.455 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='136', @p0='2025-11-30T00:59:48.4546180Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T00:59:48.4546858Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T00:59:48.454618Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:59:18.450759"}' (Size = 4000), @p10='0HNHFH06JI8V9:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 01:59:55.043 +01:00 [INF] SignalR disconnected: KUKxYR1JR2cosJ_6MlfO6Q user:null ex:null
2025-11-30 01:59:55.045 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 01:59:55.045 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:59:55.046 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 66566.342ms
2025-11-30 01:59:55.048 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:55.049 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 66566.342ms
2025-11-30 01:59:55.051 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:59:55.052 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=1hSVjKj01H3Z04abwQtYGA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 66581.845ms
2025-11-30 01:59:55.053 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:59:55.057 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:59:55.061 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:59:55.064 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:59:55.066 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:59:55.068 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.6077ms
2025-11-30 01:59:55.069 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:59:55.071 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 20.0821ms
2025-11-30 01:59:55.072 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 27.7651ms
2025-11-30 01:59:55.121 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:59:55.123 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:55.124 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.6806ms
2025-11-30 01:59:55.126 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:59:55.129 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:55.129 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:59:55.130 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:59:55.131 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:59:55.133 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:59:55.134 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:59:55.135 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.7637ms
2025-11-30 01:59:55.136 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:59:55.137 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.7054ms
2025-11-30 01:59:55.138 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.7109ms
2025-11-30 01:59:55.180 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:59:55.180 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:59:55.182 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:55.184 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:55.185 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:59:55.186 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:59:55.187 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:59:55.188 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:59:55.189 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:59:55.190 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:59:55.193 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:59:55.194 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:59:55.196 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:59:55.198 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:59:55.200 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:59:55.201 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:59:55.204 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:59:55.204 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:55.205 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.9287ms
2025-11-30 01:59:55.208 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:59:55.208 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:59:55.210 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:55.211 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.0144ms
2025-11-30 01:59:55.213 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:55.214 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.9888ms
2025-11-30 01:59:55.217 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:55.220 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:59:55.221 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:59:57.267 +01:00 [INF] Received HTTP response headers after 2044.9666ms - 422
2025-11-30 01:59:57.268 +01:00 [INF] End processing HTTP request after 2047.8357ms - 422
2025-11-30 01:59:57.269 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:59:57.270 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2078.9187ms
2025-11-30 01:59:57.272 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:59:57.272 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2087.3228ms
2025-11-30 01:59:57.274 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2094.4385ms
2025-11-30 01:59:59.302 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 01:59:59.302 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:59:59.304 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.306 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.306 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.3338ms
2025-11-30 01:59:59.307 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.6346ms
2025-11-30 01:59:59.308 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 01:59:59.309 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 01:59:59.313 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.314 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.315 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:59:59'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:59:59.316 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:59:59'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 01:59:59.317 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:59:59'.
2025-11-30 01:59:59.319 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 0:59:59'.
2025-11-30 01:59:59.319 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 01:59:59.320 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 01:59:59.321 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:59:59.322 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:59:59.323 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 01:59:59.324 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:59:59.326 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 01:59:59.328 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:59:59.329 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 01:59:59.330 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 01:59:59.333 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.5697ms
2025-11-30 01:59:59.333 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T00:59:59.3324664Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T00:59:59.3323962Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T00:59:59.3323966Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:57:46.845182","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:57:46.845183"}' (Size = 4000), @p8='0HNHFH06JI8V5:0000000E' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T00:59:59.3323962Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T00:59:59.3323966Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 01:59:59.334 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 01:59:59.337 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 17.3192ms
2025-11-30 01:59:59.339 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:59:59.339 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 30.0648ms
2025-11-30 01:59:59.340 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 15.3365ms
2025-11-30 01:59:59.344 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 01:59:59.345 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 25.2631ms
2025-11-30 01:59:59.346 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 38.0095ms
2025-11-30 01:59:59.357 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 01:59:59.359 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.359 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 01:59:59.360 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:59:59.361 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:59:59.364 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 01:59:59.366 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 01:59:59.368 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:59:59.369 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 6.8689ms
2025-11-30 01:59:59.370 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 01:59:59.371 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 11.5968ms
2025-11-30 01:59:59.372 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 15.5401ms
2025-11-30 01:59:59.378 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 01:59:59.380 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.381 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 01:59:59.382 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:59:59.383 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 01:59:59.385 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 01:59:59.386 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:59:59.387 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.3919ms
2025-11-30 01:59:59.388 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 01:59:59.389 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.6908ms
2025-11-30 01:59:59.390 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.9817ms
2025-11-30 01:59:59.397 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 01:59:59.397 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 01:59:59.398 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.400 +01:00 [INF] CORS policy execution successful.
2025-11-30 01:59:59.401 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 01:59:59.402 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 01:59:59.403 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:59:59.404 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:59:59.404 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 01:59:59.405 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 01:59:59.408 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 01:59:59.409 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 01:59:59.410 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 01:59:59.412 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 01:59:59.414 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 01:59:59.415 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 01:59:59.417 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 01:59:59.417 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:59.418 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 10.8709ms
2025-11-30 01:59:59.421 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 01:59:59.421 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 01:59:59.422 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 20.6378ms
2025-11-30 01:59:59.424 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:59.425 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 28.3378ms
2025-11-30 01:59:59.428 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:59.432 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 01:59:59.435 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:59:59.436 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 01:59:59.438 +01:00 [INF] Received HTTP response headers after 1.5813ms - 422
2025-11-30 01:59:59.439 +01:00 [INF] End processing HTTP request after 4.6218ms - 422
2025-11-30 01:59:59.440 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 01:59:59.442 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 35.7258ms
2025-11-30 01:59:59.443 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 01:59:59.444 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 43.1153ms
2025-11-30 01:59:59.446 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 49.0181ms
2025-11-30 02:00:00.168 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:00:00.170 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:00.171 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.0581ms
2025-11-30 02:00:00.173 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:00:00.176 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:00.177 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:00:00.178 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:00:00.179 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:00:00.180 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9689ms
2025-11-30 02:00:00.182 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.1772ms
2025-11-30 02:00:00.183 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=LeviGeuNdEa96aarp6ngrA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:00:00.187 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:00.187 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:00:00.189 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:00:00.192 +01:00 [INF] SignalR connected: 6dSSVYUpo2Fw_aTez-96jw user:null
2025-11-30 02:00:00.198 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:00.201 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='136', @p0='2025-11-30T01:00:00.2003196Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:00.2003865Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='136' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:00.2003196Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T00:59:48.454618"}' (Size = 4000), @p10='0HNHFH06JI8VA:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:00.684 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/136 - null null
2025-11-30 02:00:00.687 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:00.687 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/136 - 204 null null 2.9692ms
2025-11-30 02:00:00.690 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/136 - null null
2025-11-30 02:00:00.692 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:00.693 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:00'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:00.694 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:00'.
2025-11-30 02:00:00.695 +01:00 [INF] HTTP GET /api/Conversations/history/136 started - IP: 127.0.0.1
2025-11-30 02:00:00.696 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:00.697 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:00.699 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:00:00.702 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:00:00.705 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='136'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:00:00.707 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:00:00.708 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.8126ms
2025-11-30 02:00:00.709 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:00.710 +01:00 [INF] HTTP GET /api/Conversations/history/136 completed - Status: 200 - Duration: 14.5689ms
2025-11-30 02:00:00.711 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/136 - 200 null application/json; charset=utf-8 20.9928ms
2025-11-30 02:00:01.363 +01:00 [INF] SignalR disconnected: 6dSSVYUpo2Fw_aTez-96jw user:null ex:null
2025-11-30 02:00:01.364 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:00:01.365 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1177.785ms
2025-11-30 02:00:01.367 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=136&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=LeviGeuNdEa96aarp6ngrA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1183.2304ms
2025-11-30 02:00:02.194 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:00:02.196 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.196 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.735ms
2025-11-30 02:00:02.198 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:00:02.201 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.202 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:02'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:02.204 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:02'.
2025-11-30 02:00:02.205 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:00:02.206 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:02.207 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:02.210 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY0Mzk5LCJleHAiOjE3OTYwMDAzOTksImlhdCI6MTc2NDQ2NDM5OSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.saFgp7tH4WYAcblKZjQlfTqhaGo7UrKBz05TTxiFVlI' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:02.212 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:02.215 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:00:02.218 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:00:02.2173261Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:00:02.2173254Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:00:02.2175009Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482580' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482580,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:00:02.2173261Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:00:02.2173254Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8V5:00000012' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:02.223 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:00:02.224 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.9361ms
2025-11-30 02:00:02.225 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:02.226 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.3248ms
2025-11-30 02:00:02.228 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 29.9787ms
2025-11-30 02:00:02.263 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=137&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:00:02.266 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.266 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=137&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.7272ms
2025-11-30 02:00:02.268 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=137&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:00:02.271 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.272 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:00:02.273 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:00:02.273 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:00:02.274 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5743ms
2025-11-30 02:00:02.276 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=137&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.5332ms
2025-11-30 02:00:02.277 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=137&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=4UoXlxGF0_xN_Ut6glCWrg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:00:02.279 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.280 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:00:02.281 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:00:02.284 +01:00 [INF] SignalR connected: 6DACCtUy-lLP4W8_03NxoA user:null
2025-11-30 02:00:02.287 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='137'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:02.289 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='137', @p0='2025-11-30T01:00:02.2887693Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:02.2888262Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='137' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:02.2887693Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VB:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:02.757 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/137 - null null
2025-11-30 02:00:02.759 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.759 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/137 - 204 null null 2.442ms
2025-11-30 02:00:02.762 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/137 - null null
2025-11-30 02:00:02.763 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:02.764 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:02'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:02.765 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:02'.
2025-11-30 02:00:02.766 +01:00 [INF] HTTP GET /api/Conversations/history/137 started - IP: 127.0.0.1
2025-11-30 02:00:02.767 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:02.768 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:02.771 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='137'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:00:02.773 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='137'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:00:02.775 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='137'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:00:02.777 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:00:02.778 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.4801ms
2025-11-30 02:00:02.779 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:02.780 +01:00 [INF] HTTP GET /api/Conversations/history/137 completed - Status: 200 - Duration: 13.4356ms
2025-11-30 02:00:02.781 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/137 - 200 null application/json; charset=utf-8 19.0637ms
2025-11-30 02:00:03.288 +01:00 [INF] SignalR disconnected: 6DACCtUy-lLP4W8_03NxoA user:null ex:null
2025-11-30 02:00:03.289 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:00:03.290 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1010.0089ms
2025-11-30 02:00:03.291 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=137&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=4UoXlxGF0_xN_Ut6glCWrg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1014.3389ms
2025-11-30 02:00:04.169 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:00:04.171 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:04.172 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:04'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:04.173 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:04'.
2025-11-30 02:00:04.174 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:00:04.175 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:04.176 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:04.179 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY0Mzk5LCJleHAiOjE3OTYwMDAzOTksImlhdCI6MTc2NDQ2NDM5OSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.saFgp7tH4WYAcblKZjQlfTqhaGo7UrKBz05TTxiFVlI' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:04.181 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:04.183 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:00:04.187 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:00:04.1857543Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:00:04.1857537Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:00:04.1859127Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482579' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482579,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:00:04.1857543Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:00:04.1857537Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8V5:00000014' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:04.191 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:00:04.192 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9323ms
2025-11-30 02:00:04.193 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:04.194 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.0419ms
2025-11-30 02:00:04.196 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 26.5646ms
2025-11-30 02:00:04.202 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=138&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:00:04.204 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:04.204 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=138&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.3287ms
2025-11-30 02:00:04.206 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=138&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:00:04.209 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:04.209 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:00:04.210 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:00:04.211 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:00:04.212 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5427ms
2025-11-30 02:00:04.213 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=138&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.2009ms
2025-11-30 02:00:04.237 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=138&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=iO91i-qYVVlJfRHTKdiXNw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:00:04.239 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:04.240 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:00:04.241 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:00:04.244 +01:00 [INF] SignalR connected: b393gGE62QXxqkf324Xq7A user:null
2025-11-30 02:00:04.249 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='138'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:04.253 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='138', @p0='2025-11-30T01:00:04.2519138Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:04.2519821Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='138' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:04.2519138Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VC:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:04.713 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/138 - null null
2025-11-30 02:00:04.715 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:04.716 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/138 - 204 null null 2.696ms
2025-11-30 02:00:04.719 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/138 - null null
2025-11-30 02:00:04.720 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:04.721 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:04'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:04.722 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:04'.
2025-11-30 02:00:04.723 +01:00 [INF] HTTP GET /api/Conversations/history/138 started - IP: 127.0.0.1
2025-11-30 02:00:04.724 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:04.725 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:04.728 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='138'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:00:04.730 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='138'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:00:04.732 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='138'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:00:04.735 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:00:04.736 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.554ms
2025-11-30 02:00:04.737 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:04.738 +01:00 [INF] HTTP GET /api/Conversations/history/138 completed - Status: 200 - Duration: 14.3492ms
2025-11-30 02:00:04.739 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/138 - 200 null application/json; charset=utf-8 20.3277ms
2025-11-30 02:00:05.067 +01:00 [INF] SignalR disconnected: b393gGE62QXxqkf324Xq7A user:null ex:null
2025-11-30 02:00:05.068 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:00:05.069 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 829.1606ms
2025-11-30 02:00:05.071 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=138&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=iO91i-qYVVlJfRHTKdiXNw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 833.3751ms
2025-11-30 02:00:05.960 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:00:05.962 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:05.963 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:05'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:05.964 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:05'.
2025-11-30 02:00:05.965 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:00:05.966 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:05.967 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:05.970 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY0Mzk5LCJleHAiOjE3OTYwMDAzOTksImlhdCI6MTc2NDQ2NDM5OSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.saFgp7tH4WYAcblKZjQlfTqhaGo7UrKBz05TTxiFVlI' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:05.973 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:05.976 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:00:05.979 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:00:05.9779780Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:00:05.9779775Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:00:05.9780965Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482578' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482578,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:00:05.977978Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:00:05.9779775Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8V5:00000016' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:05.983 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:00:05.984 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.4633ms
2025-11-30 02:00:05.985 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:05.986 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.4059ms
2025-11-30 02:00:05.988 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.4249ms
2025-11-30 02:00:05.992 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=139&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:00:05.994 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:05.995 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=139&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.1352ms
2025-11-30 02:00:05.996 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=139&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:00:06.000 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:06.001 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:00:06.002 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:00:06.003 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:00:06.004 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.1751ms
2025-11-30 02:00:06.005 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=139&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 9.2231ms
2025-11-30 02:00:06.018 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=139&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=YWCCaS12XopfAvouQr6EYQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:00:06.020 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:06.021 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:00:06.022 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:00:06.025 +01:00 [INF] SignalR connected: iMR2O2Qjfw8uqKNk0pKdgw user:null
2025-11-30 02:00:06.030 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='139'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:06.032 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='139', @p0='2025-11-30T01:00:06.0319194Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:06.0319766Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='139' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:06.0319194Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VD:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:06.507 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/139 - null null
2025-11-30 02:00:06.509 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:06.509 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/139 - 204 null null 2.7427ms
2025-11-30 02:00:06.512 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/139 - null null
2025-11-30 02:00:06.514 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:06.514 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:06'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:06.516 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:06'.
2025-11-30 02:00:06.517 +01:00 [INF] HTTP GET /api/Conversations/history/139 started - IP: 127.0.0.1
2025-11-30 02:00:06.518 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:06.519 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:06.522 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='139'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:00:06.525 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='139'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:00:06.527 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='139'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:00:06.529 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:00:06.531 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.8168ms
2025-11-30 02:00:06.532 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:06.533 +01:00 [INF] HTTP GET /api/Conversations/history/139 completed - Status: 200 - Duration: 15.702ms
2025-11-30 02:00:06.534 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/139 - 200 null application/json; charset=utf-8 22.3796ms
2025-11-30 02:00:06.689 +01:00 [INF] SignalR disconnected: iMR2O2Qjfw8uqKNk0pKdgw user:null ex:null
2025-11-30 02:00:06.691 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:00:06.691 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 670.5548ms
2025-11-30 02:00:06.693 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=139&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=YWCCaS12XopfAvouQr6EYQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 674.9004ms
2025-11-30 02:00:07.532 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:00:07.534 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:07.535 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.4511ms
2025-11-30 02:00:07.537 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:00:07.540 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:07.541 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:07'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:07.542 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:07'.
2025-11-30 02:00:07.543 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:00:07.544 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:07.545 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:07.548 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY0Mzk5LCJleHAiOjE3OTYwMDAzOTksImlhdCI6MTc2NDQ2NDM5OSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.saFgp7tH4WYAcblKZjQlfTqhaGo7UrKBz05TTxiFVlI' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:07.551 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:07.553 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:00:07.556 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:00:07.5555512Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:00:07.5555506Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:00:07.5557049Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482577' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482577,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:00:07.5555512Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:00:07.5555506Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8V5:00000018' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:07.560 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:00:07.561 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.7641ms
2025-11-30 02:00:07.563 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:07.563 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.2551ms
2025-11-30 02:00:07.565 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.9464ms
2025-11-30 02:00:07.594 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=140&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:00:07.596 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:07.597 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=140&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.7339ms
2025-11-30 02:00:07.598 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=140&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:00:07.601 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:07.602 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:00:07.603 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:00:07.604 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:00:07.605 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9679ms
2025-11-30 02:00:07.607 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=140&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.9889ms
2025-11-30 02:00:07.608 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=140&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=VWpPP2q1wTGv3XfghLSk0Q&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:00:07.612 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:07.613 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:00:07.614 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:00:07.616 +01:00 [INF] SignalR connected: w4nuRkskfLvIrg0p_vc8Vw user:null
2025-11-30 02:00:07.622 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='140'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:07.625 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='140', @p0='2025-11-30T01:00:07.6240087Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:07.6240857Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='140' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:07.6240087Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VE:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:08.086 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/140 - null null
2025-11-30 02:00:08.088 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:08.089 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/140 - 204 null null 2.4451ms
2025-11-30 02:00:08.091 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/140 - null null
2025-11-30 02:00:08.093 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:08.094 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:08'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:08.095 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:08'.
2025-11-30 02:00:08.096 +01:00 [INF] HTTP GET /api/Conversations/history/140 started - IP: 127.0.0.1
2025-11-30 02:00:08.098 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:08.099 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:08.102 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='140'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:00:08.104 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='140'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:00:08.106 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='140'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:00:08.108 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:00:08.110 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.4275ms
2025-11-30 02:00:08.111 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:08.112 +01:00 [INF] HTTP GET /api/Conversations/history/140 completed - Status: 200 - Duration: 15.208ms
2025-11-30 02:00:08.113 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/140 - 200 null application/json; charset=utf-8 21.9233ms
2025-11-30 02:00:08.403 +01:00 [INF] SignalR disconnected: w4nuRkskfLvIrg0p_vc8Vw user:null ex:null
2025-11-30 02:00:08.404 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:00:08.405 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 792.1069ms
2025-11-30 02:00:08.406 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=140&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=VWpPP2q1wTGv3XfghLSk0Q&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 797.941ms
2025-11-30 02:00:09.207 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:00:09.209 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:09.210 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:09'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:09.211 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:09'.
2025-11-30 02:00:09.212 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:00:09.214 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:09.214 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:09.217 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY0Mzk5LCJleHAiOjE3OTYwMDAzOTksImlhdCI6MTc2NDQ2NDM5OSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.saFgp7tH4WYAcblKZjQlfTqhaGo7UrKBz05TTxiFVlI' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:09.220 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:00:09.223 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:00:09.226 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:00:09.2255346Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:00:09.2255338Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:00:09.2256643Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482576' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482576,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:00:09.2255346Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:00:09.2255338Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8V5:0000001A' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:09.230 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:00:09.231 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.5738ms
2025-11-30 02:00:09.233 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:00:09.233 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.1903ms
2025-11-30 02:00:09.235 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.8612ms
2025-11-30 02:00:09.240 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:00:09.242 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:09.243 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.4022ms
2025-11-30 02:00:09.244 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:00:09.247 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:09.247 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:00:09.248 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:00:09.249 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:00:09.250 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0431ms
2025-11-30 02:00:09.252 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.2365ms
2025-11-30 02:00:09.265 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=cZx3tSX-TfrL47SQGr3RYw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:00:09.267 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:09.268 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:00:09.269 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:00:09.272 +01:00 [INF] SignalR connected: rIe9rI23hjlsDGVx8c7Z6Q user:null
2025-11-30 02:00:09.277 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:09.280 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:00:09.2793489Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:09.2794135Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:09.2793489Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VF:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:00:09.750 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/141 - null null
2025-11-30 02:00:09.752 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:09.753 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/141 - 204 null null 3.5255ms
2025-11-30 02:00:09.756 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/141 - null null
2025-11-30 02:00:09.758 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:00:09.759 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:09'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:00:09.760 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:00:09'.
2025-11-30 02:00:09.761 +01:00 [INF] HTTP GET /api/Conversations/history/141 started - IP: 127.0.0.1
2025-11-30 02:00:09.762 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:09.763 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:00:09.765 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:00:09.768 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:00:09.771 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:00:09.773 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:00:09.775 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.3305ms
2025-11-30 02:00:09.776 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:00:09.777 +01:00 [INF] HTTP GET /api/Conversations/history/141 completed - Status: 200 - Duration: 15.3461ms
2025-11-30 02:00:09.778 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/141 - 200 null application/json; charset=utf-8 22.246ms
2025-11-30 02:00:39.252 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:00:39.255 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:00:39.2547005Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:00:39.2547727Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:00:39.2547005Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:00:09.279348"}' (Size = 4000), @p10='0HNHFH06JI8VF:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:01:09.263 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:01:09.266 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:01:09.2657173Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:01:09.2657953Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:01:09.2657173Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:00:39.2547"}' (Size = 4000), @p10='0HNHFH06JI8VF:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:01:09.629 +01:00 [INF] SignalR disconnected: rIe9rI23hjlsDGVx8c7Z6Q user:null ex:null
2025-11-30 02:01:09.630 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:01:09.631 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:01:09.633 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.634 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 60365.669ms
2025-11-30 02:01:09.634 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:01:09.635 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:01:09.636 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 60365.669ms
2025-11-30 02:01:09.637 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:01:09.638 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:01:09.639 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.640 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=cZx3tSX-TfrL47SQGr3RYw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 60375.5039ms
2025-11-30 02:01:09.641 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:01:09.643 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.643 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:01:09.647 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 9.8316ms
2025-11-30 02:01:09.649 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:01:09.649 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:01:09.649 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:01:09.654 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:01:09.654 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:01:09.656 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.658 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:01:09.659 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:01:09.659 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:01:09.661 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:01:09.662 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 15.4312ms
2025-11-30 02:01:09.663 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:01:09.665 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:01:09.666 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:01:09.667 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:01:09.668 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:01:09.669 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 34.2028ms
2025-11-30 02:01:09.670 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 10.3081ms
2025-11-30 02:01:09.671 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.9008ms
2025-11-30 02:01:09.672 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 42.5112ms
2025-11-30 02:01:09.673 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=dDnM5de5oPJJYyWaH6q65w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:01:09.674 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 24.6957ms
2025-11-30 02:01:09.675 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:01:09.679 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.683 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 40.0235ms
2025-11-30 02:01:09.684 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:01:09.686 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 50.4112ms
2025-11-30 02:01:09.687 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:01:09.704 +01:00 [INF] SignalR connected: iJ3GRYRnCWEjK68XnDr6Ug user:null
2025-11-30 02:01:09.710 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:01:09.712 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:01:09.7119581Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:01:09.7120222Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:01:09.7119581Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:01:09.265717"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:01:09.718 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:01:09.720 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.721 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.7071ms
2025-11-30 02:01:09.737 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:01:09.739 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.740 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:01:09.741 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:01:09.742 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:01:09.743 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:01:09.744 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:01:09.745 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2502ms
2025-11-30 02:01:09.746 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:01:09.748 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.0288ms
2025-11-30 02:01:09.749 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.4558ms
2025-11-30 02:01:09.754 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:01:09.756 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.757 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:01:09.757 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:01:09.759 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:01:09.760 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:01:09.761 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:01:09.762 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:01:09.763 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:01:09.766 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:01:09.767 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:01:09.769 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:01:09.771 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:01:09.773 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:01:09.775 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:01:09.776 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:01:09.778 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:01:09.778 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:01:09.781 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:01:09.781 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.5269ms
2025-11-30 02:01:09.784 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:01:09.785 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:01:09.785 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.5662ms
2025-11-30 02:01:09.788 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:01:09.788 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.7126ms
2025-11-30 02:01:09.791 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:01:09.795 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:01:09.796 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:01:11.828 +01:00 [INF] Received HTTP response headers after 2031.0459ms - 422
2025-11-30 02:01:11.829 +01:00 [INF] End processing HTTP request after 2034.486ms - 422
2025-11-30 02:01:11.830 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:01:11.832 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2067.1234ms
2025-11-30 02:01:11.833 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:01:11.834 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2077.2504ms
2025-11-30 02:01:11.836 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2082.511ms
2025-11-30 02:01:39.631 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:01:39.635 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:01:39.6338340Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:01:39.6339006Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:01:39.633834Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:01:09.711958"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:02:09.633 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:02:09.636 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:02:09.6353777Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:02:09.6354450Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:02:09.6353777Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:01:39.633834"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:02:39.635 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:02:39.638 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:02:39.6377107Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:02:39.6377752Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:02:39.6377107Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:02:09.635377"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:03:09.647 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:03:09.650 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:03:09.6498739Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:03:09.6499416Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:03:09.6498739Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:02:39.63771"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:03:39.652 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:03:39.656 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:03:39.6550208Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:03:39.6550981Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:03:39.6550208Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:03:09.649873"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:03:53.478 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:48:53.4772285Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:04:09.662 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:04:09.665 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='141', @p0='2025-11-30T01:04:09.6646853Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:04:09.6647560Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='141' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:04:09.6646853Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:03:39.65502"}' (Size = 4000), @p10='0HNHFH06JI8VH:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:04:39.657 +01:00 [INF] SignalR disconnected: iJ3GRYRnCWEjK68XnDr6Ug user:null ex:null
2025-11-30 02:04:39.658 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:04:39.659 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 209974.8563ms
2025-11-30 02:04:39.661 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 209974.8563ms
2025-11-30 02:04:39.661 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/141/leave-mobile - null null
2025-11-30 02:04:39.662 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=141&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=dDnM5de5oPJJYyWaH6q65w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 209989.6484ms
2025-11-30 02:04:39.664 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:04:39.668 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/141/leave-mobile - 204 null null 6.4643ms
2025-11-30 02:04:39.670 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/141/leave-mobile - application/json 0
2025-11-30 02:04:39.672 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:04:39.673 +01:00 [INF] HTTP POST /api/conversations/141/leave-mobile started - IP: 127.0.0.1
2025-11-30 02:04:39.674 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.LeaveMobileSession (Voia.Api)'
2025-11-30 02:04:39.675 +01:00 [INF] Route matched with {action = "LeaveMobileSession", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LeaveMobileSession(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:04:39.678 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='141'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:04:39.682 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p3='141', @p0='2025-11-30T01:04:39.6810496Z' (Nullable = true) (DbType = DateTime), @p1='2025-11-30T01:04:39.6810496Z' (Nullable = true) (DbType = DateTime), @p2='closed' (Nullable = false) (Size = 255), @p4='UPDATE' (Size = 100), @p5='2025-11-30T01:04:39.6811269Z' (DbType = DateTime), @p6='Updated Conversation' (Size = 4000), @p7='141' (Nullable = true), @p8='Conversation' (Size = 100), @p9='127.0.0.1' (Size = 45), @p10='{"ClosedAt":"2025-11-30T01:04:39.6810496Z","ExpiresAt":"2025-11-30T01:04:39.6810496Z","Status":"closed"}' (Size = 4000), @p11='{"ClosedAt":null,"ExpiresAt":null,"Status":"active"}' (Size = 4000), @p12='0HNHFH06JI8VI:00000002' (Size = 50), @p13='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p14=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `closed_at` = @p0, `expires_at` = @p1, `status` = @p2
WHERE `Id` = @p3;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:04:39.686 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType99`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:04:39.687 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.LeaveMobileSession (Voia.Api) in 11.1186ms
2025-11-30 02:04:39.689 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.LeaveMobileSession (Voia.Api)'
2025-11-30 02:04:39.690 +01:00 [INF] HTTP POST /api/conversations/141/leave-mobile completed - Status: 200 - Duration: 16.6842ms
2025-11-30 02:04:39.691 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/141/leave-mobile - 200 null application/json; charset=utf-8 20.6896ms
2025-11-30 02:05:08.241 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:05:08.243 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:05:08.244 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:05:08.245 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:05:08.246 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:05:08.249 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:05:08.252 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:05:08.253 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:05:08.255 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.7342ms
2025-11-30 02:05:08.256 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:05:08.257 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.3718ms
2025-11-30 02:05:08.258 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 17.8098ms
2025-11-30 02:05:08.263 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:05:08.265 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:05:08.266 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.8258ms
2025-11-30 02:05:08.296 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:05:08.298 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:05:08.299 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:05:08.301 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:05:08.302 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:05:08.304 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:05:08.305 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:05:08.306 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.5528ms
2025-11-30 02:05:08.307 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:05:08.308 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.5866ms
2025-11-30 02:05:08.310 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.8534ms
2025-11-30 02:05:08.314 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:05:08.317 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:05:08.317 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:05:08.318 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:05:08.320 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:05:08.321 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:05:08.322 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:05:08.323 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:05:08.324 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:05:08.327 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:05:08.327 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:05:08.332 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:05:08.334 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:05:08.336 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:05:08.338 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:05:08.339 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:05:08.341 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:05:08.343 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:05:08.345 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:05:08.347 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:05:08.347 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:05:08.349 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 19.7877ms
2025-11-30 02:05:08.351 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:05:08.352 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:05:08.354 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:05:08.355 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 32.9693ms
2025-11-30 02:05:08.356 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:05:08.357 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 40.0278ms
2025-11-30 02:05:10.375 +01:00 [INF] Received HTTP response headers after 2016.6498ms - 422
2025-11-30 02:05:10.376 +01:00 [INF] End processing HTTP request after 2022.0407ms - 422
2025-11-30 02:05:10.377 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:05:10.379 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2053.3864ms
2025-11-30 02:05:10.380 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:05:10.381 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2063.0985ms
2025-11-30 02:05:10.382 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2067.8894ms
2025-11-30 02:07:05.162 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:07:05.163 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:07:05.165 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:07:05.166 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:07:05.167 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:07:05.168 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:07:05.169 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:07:05.170 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:07:05.171 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:07:05.172 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:07:05.175 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:07:05.176 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:07:05.178 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:07:05.180 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:07:05.181 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:07:05.183 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:07:05.184 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.3302ms
2025-11-30 02:07:05.184 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:07:05.185 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:07:05.186 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.156ms
2025-11-30 02:07:05.187 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 19.8617ms
2025-11-30 02:07:05.188 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:07:05.189 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 27.2902ms
2025-11-30 02:07:05.190 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.6709ms
2025-11-30 02:07:05.194 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.2291ms
2025-11-30 02:07:05.255 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:07:05.258 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:07:05.258 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.4536ms
2025-11-30 02:07:05.270 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:07:05.273 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:07:05.273 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:07:05.275 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:07:05.276 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:07:05.278 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:07:05.279 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:07:05.280 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.5207ms
2025-11-30 02:07:05.281 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:07:05.282 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.1983ms
2025-11-30 02:07:05.283 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.8962ms
2025-11-30 02:07:05.331 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:07:05.332 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:07:05.334 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:07:05.336 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:07:05.336 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:07:05.337 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:07:05.338 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:07:05.339 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:07:05.341 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:07:05.341 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:07:05.344 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:07:05.345 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:07:05.347 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:07:05.349 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:07:05.350 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:07:05.352 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:07:05.354 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:07:05.354 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:07:05.357 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:07:05.357 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.3278ms
2025-11-30 02:07:05.360 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:07:05.360 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:07:05.362 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:07:05.363 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.6143ms
2025-11-30 02:07:05.365 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:07:05.366 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.9871ms
2025-11-30 02:07:05.368 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:07:05.370 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:07:07.409 +01:00 [INF] Received HTTP response headers after 2037.6976ms - 422
2025-11-30 02:07:07.410 +01:00 [INF] End processing HTTP request after 2042.4188ms - 422
2025-11-30 02:07:07.411 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:07:07.413 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2069.9383ms
2025-11-30 02:07:07.414 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:07:07.415 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2078.4663ms
2025-11-30 02:07:07.416 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2084.7273ms
2025-11-30 02:08:53.489 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:53:53.4885538Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:12:12.544 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:12:12.544 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:12:12.546 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:12:12.549 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:12:12.549 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:12:12.550 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:12:12.551 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:12:12.553 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:12:12.554 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:12:12.554 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:12:12.570 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:12:12.570 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:12:12.573 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:12:12.575 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:12:12.576 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:12:12.578 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:12:12.578 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:12:12.580 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 23.8759ms
2025-11-30 02:12:12.581 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 23.6559ms
2025-11-30 02:12:12.582 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:12:12.583 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:12:12.584 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 34.9411ms
2025-11-30 02:12:12.585 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 35.0591ms
2025-11-30 02:12:12.586 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 42.6282ms
2025-11-30 02:12:12.588 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 43.8255ms
2025-11-30 02:12:12.635 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:12:12.637 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:12:12.638 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.2577ms
2025-11-30 02:12:12.642 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:12:12.644 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:12:12.645 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:12:12.646 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:12:12.648 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:12:12.650 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:12:12.651 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:12:12.652 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6875ms
2025-11-30 02:12:12.653 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:12:12.654 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 9.4222ms
2025-11-30 02:12:12.656 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.3875ms
2025-11-30 02:12:12.660 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:12:12.662 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:12:12.663 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:12:12.664 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:12:12.665 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:12:12.667 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:12:12.668 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:12:12.669 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:12:12.671 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:12:12.671 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:12:12.672 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:12:12.674 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:12:12.676 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:12:12.677 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:12:12.680 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:12:12.681 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:12:12.683 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:12:12.685 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:12:12.685 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:12:12.686 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 10.9571ms
2025-11-30 02:12:12.689 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:12:12.689 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:12:12.691 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:12:12.691 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.6936ms
2025-11-30 02:12:12.694 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:12:12.695 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 30.5033ms
2025-11-30 02:12:12.697 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:12:12.700 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:12:14.744 +01:00 [INF] Received HTTP response headers after 2042.7832ms - 422
2025-11-30 02:12:14.745 +01:00 [INF] End processing HTTP request after 2047.9525ms - 422
2025-11-30 02:12:14.746 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:12:14.747 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2077.307ms
2025-11-30 02:12:14.749 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:12:14.750 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2086.2328ms
2025-11-30 02:12:14.751 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2090.5714ms
2025-11-30 02:13:53.506 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T00:58:53.5055365Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:14:35.039 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:14:35.042 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:35.042 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:14:35.044 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:14:35.045 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:14:35.049 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:14:35.051 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:14:35.053 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:35.055 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.0242ms
2025-11-30 02:14:35.056 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:14:35.057 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.3589ms
2025-11-30 02:14:35.058 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.5733ms
2025-11-30 02:14:35.083 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:14:35.085 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:35.086 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.7633ms
2025-11-30 02:14:35.087 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:14:35.090 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:35.090 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:14:35.091 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:14:35.092 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:35.094 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:14:35.095 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:35.096 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.4684ms
2025-11-30 02:14:35.097 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:14:35.098 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.8951ms
2025-11-30 02:14:35.100 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.6498ms
2025-11-30 02:14:35.112 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:14:35.114 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:14:35.115 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:35.117 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:35.117 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:14:35.118 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:14:35.119 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:14:35.120 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:14:35.121 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:14:35.122 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:14:35.125 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:14:35.126 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:14:35.128 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:14:35.130 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:14:35.132 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:14:35.133 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:14:35.136 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:35.136 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:35.138 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:14:35.138 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.4074ms
2025-11-30 02:14:35.141 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:35.141 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:14:35.143 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:35.144 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.5573ms
2025-11-30 02:14:35.146 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:35.147 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.8764ms
2025-11-30 02:14:35.149 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:14:35.152 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:14:37.210 +01:00 [INF] Received HTTP response headers after 2057.5877ms - 422
2025-11-30 02:14:37.211 +01:00 [INF] End processing HTTP request after 2062.7448ms - 422
2025-11-30 02:14:37.212 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:37.214 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2090.5507ms
2025-11-30 02:14:37.215 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:14:37.216 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2098.6244ms
2025-11-30 02:14:37.218 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2105.4805ms
2025-11-30 02:14:45.317 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:14:45.318 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:45.319 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.321 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.322 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.1314ms
2025-11-30 02:14:45.322 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.1425ms
2025-11-30 02:14:45.323 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:14:45.328 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:45.329 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.330 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.331 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:45'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:45.331 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:45'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:45.333 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:45'.
2025-11-30 02:14:45.334 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:45'.
2025-11-30 02:14:45.335 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:14:45.335 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:14:45.336 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:14:45.337 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:14:45.338 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:14:45.339 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:14:45.341 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:14:45.342 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:14:45.344 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:14:45.346 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:14:45.348 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.6678ms
2025-11-30 02:14:45.348 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:14:45.3473844Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:14:45.3473115Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:14:45.3473125Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T00:59:59.332396","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T00:59:59.332396"}' (Size = 4000), @p8='0HNHFH06JI8VO:00000003' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:14:45.3473115Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:14:45.3473125Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:14:45.349 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:14:45.352 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 16.3999ms
2025-11-30 02:14:45.353 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 24.6165ms
2025-11-30 02:14:45.353 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:45.356 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 16.648ms
2025-11-30 02:14:45.357 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:14:45.358 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 23.7148ms
2025-11-30 02:14:45.360 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 36.7502ms
2025-11-30 02:14:45.397 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:14:45.399 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.400 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:14:45.401 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:14:45.402 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:14:45.404 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:14:45.407 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:14:45.408 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:45.409 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 6.47ms
2025-11-30 02:14:45.410 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:14:45.412 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 12.055ms
2025-11-30 02:14:45.413 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 16.6232ms
2025-11-30 02:14:45.433 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:14:45.435 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.436 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.6165ms
2025-11-30 02:14:45.451 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:14:45.453 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.454 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:14:45.455 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:14:45.456 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:45.458 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:14:45.458 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:45.459 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2207ms
2025-11-30 02:14:45.460 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:14:45.461 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.5145ms
2025-11-30 02:14:45.463 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.8082ms
2025-11-30 02:14:45.481 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:14:45.481 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:14:45.483 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.485 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:45.485 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:14:45.486 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:14:45.487 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:14:45.489 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:14:45.490 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:14:45.491 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:14:45.494 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:14:45.495 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:14:45.498 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:14:45.499 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:14:45.501 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:14:45.502 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:14:45.505 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:45.505 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:45.507 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:14:45.507 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.5042ms
2025-11-30 02:14:45.509 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:45.510 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:14:45.512 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:45.513 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.758ms
2025-11-30 02:14:45.515 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:14:45.516 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.3311ms
2025-11-30 02:14:45.517 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:14:45.521 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:14:46.388 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:14:46.390 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.390 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.8233ms
2025-11-30 02:14:46.391 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:46.396 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.396 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:46'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:46.398 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:46'.
2025-11-30 02:14:46.399 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:46.400 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:46.401 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:46.404 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:46.406 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:46.409 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:46.413 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:46.4119753Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:46.4119746Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:46.4121342Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482575' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482575,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:46.4119753Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:46.4119746Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000006' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:46.417 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:46.418 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.8232ms
2025-11-30 02:14:46.419 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:46.420 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.998ms
2025-11-30 02:14:46.421 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 29.7928ms
2025-11-30 02:14:46.439 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=142&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:46.441 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.442 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=142&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.0446ms
2025-11-30 02:14:46.443 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=142&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:46.447 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.448 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:46.449 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:46.450 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:46.451 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9274ms
2025-11-30 02:14:46.452 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=142&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 9.1508ms
2025-11-30 02:14:46.454 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=142&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=Jjo6vKbJv7fGyiUuPh5Aiw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:46.457 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.458 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:46.459 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:46.462 +01:00 [INF] SignalR connected: 5SkZWd7pALGD1MjfZ0WdiA user:null
2025-11-30 02:14:46.469 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='142'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:46.473 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='142', @p0='2025-11-30T01:14:46.4719369Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:46.4720012Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='142' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:46.4719369Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VQ:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:46.946 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/142 - null null
2025-11-30 02:14:46.948 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.949 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/142 - 204 null null 2.5273ms
2025-11-30 02:14:46.951 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/142 - null null
2025-11-30 02:14:46.952 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:46.953 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:46'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:46.954 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:46'.
2025-11-30 02:14:46.955 +01:00 [INF] HTTP GET /api/Conversations/history/142 started - IP: 127.0.0.1
2025-11-30 02:14:46.956 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:46.956 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:46.959 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='142'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:46.962 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='142'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:46.965 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='142'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:46.966 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:46.967 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.8139ms
2025-11-30 02:14:46.968 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:46.969 +01:00 [INF] HTTP GET /api/Conversations/history/142 completed - Status: 200 - Duration: 14.4174ms
2025-11-30 02:14:46.970 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/142 - 200 null application/json; charset=utf-8 19.8116ms
2025-11-30 02:14:47.568 +01:00 [INF] Received HTTP response headers after 2046.2363ms - 422
2025-11-30 02:14:47.569 +01:00 [INF] End processing HTTP request after 2052.0259ms - 422
2025-11-30 02:14:47.570 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:47.572 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2079.6143ms
2025-11-30 02:14:47.573 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:14:47.574 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2088.2938ms
2025-11-30 02:14:47.575 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2094.0738ms
2025-11-30 02:14:47.713 +01:00 [INF] SignalR disconnected: 5SkZWd7pALGD1MjfZ0WdiA user:null ex:null
2025-11-30 02:14:47.714 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:47.715 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1257.5216ms
2025-11-30 02:14:47.717 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=142&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=Jjo6vKbJv7fGyiUuPh5Aiw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1262.5913ms
2025-11-30 02:14:48.479 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:48.481 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:48.481 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:48'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:48.483 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:48'.
2025-11-30 02:14:48.484 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:48.485 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:48.486 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:48.489 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:48.491 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:48.494 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:48.498 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:48.4966058Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:48.4966047Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:48.4967806Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482574' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482574,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:48.4966058Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:48.4966047Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000008' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:48.501 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:48.502 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.0344ms
2025-11-30 02:14:48.504 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:48.504 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.5129ms
2025-11-30 02:14:48.506 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.4664ms
2025-11-30 02:14:48.510 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=143&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:48.513 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:48.513 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=143&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9492ms
2025-11-30 02:14:48.515 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=143&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:48.518 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:48.519 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:48.520 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:48.521 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:48.522 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0721ms
2025-11-30 02:14:48.523 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=143&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.5747ms
2025-11-30 02:14:48.549 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=143&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=c-HQE8p4ICkEdayPnR3wzQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:48.551 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:48.552 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:48.553 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:48.556 +01:00 [INF] SignalR connected: 11-eqxsx0k9FWsUAnYsPkQ user:null
2025-11-30 02:14:48.560 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='143'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:48.564 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='143', @p0='2025-11-30T01:14:48.5630405Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:48.5631210Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='143' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:48.5630405Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VR:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:49.025 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/143 - null null
2025-11-30 02:14:49.027 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:49.028 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/143 - 204 null null 2.896ms
2025-11-30 02:14:49.030 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/143 - null null
2025-11-30 02:14:49.032 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:49.033 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:49'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:49.034 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:49'.
2025-11-30 02:14:49.035 +01:00 [INF] HTTP GET /api/Conversations/history/143 started - IP: 127.0.0.1
2025-11-30 02:14:49.036 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:49.036 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:49.039 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='143'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:49.042 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='143'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:49.045 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='143'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:49.047 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:49.048 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.3114ms
2025-11-30 02:14:49.049 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:49.050 +01:00 [INF] HTTP GET /api/Conversations/history/143 completed - Status: 200 - Duration: 15.461ms
2025-11-30 02:14:49.052 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/143 - 200 null application/json; charset=utf-8 21.3384ms
2025-11-30 02:14:49.145 +01:00 [INF] SignalR disconnected: 11-eqxsx0k9FWsUAnYsPkQ user:null ex:null
2025-11-30 02:14:49.147 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:49.148 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 595.7809ms
2025-11-30 02:14:49.149 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=143&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=c-HQE8p4ICkEdayPnR3wzQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 599.9573ms
2025-11-30 02:14:49.877 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:49.880 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:49.880 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:49'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:49.882 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:49'.
2025-11-30 02:14:49.883 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:49.884 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:49.884 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:49.887 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:49.889 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:49.891 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:49.894 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:49.8934587Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:49.8934582Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:49.8935948Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482573' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482573,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:49.8934587Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:49.8934582Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:0000000A' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:49.900 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:49.901 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9728ms
2025-11-30 02:14:49.902 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:49.903 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.8779ms
2025-11-30 02:14:49.904 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 26.6596ms
2025-11-30 02:14:49.939 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=144&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:49.941 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:49.942 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=144&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.6924ms
2025-11-30 02:14:49.943 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=144&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:49.946 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:49.947 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:49.948 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:49.949 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:49.950 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.4961ms
2025-11-30 02:14:49.951 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=144&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.7798ms
2025-11-30 02:14:49.953 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=144&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=MMOT46I2e2tVompGWlKcXA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:49.955 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:49.955 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:49.956 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:49.959 +01:00 [INF] SignalR connected: RV_Nx6ul5ey1LH3ZiKjJug user:null
2025-11-30 02:14:49.965 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='144'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:49.968 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='144', @p0='2025-11-30T01:14:49.9672731Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:49.9673484Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='144' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:49.9672731Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VS:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:50.415 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/144 - null null
2025-11-30 02:14:50.417 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:50.418 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/144 - 204 null null 2.7745ms
2025-11-30 02:14:50.421 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/144 - null null
2025-11-30 02:14:50.423 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:50.424 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:50'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:50.425 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:50'.
2025-11-30 02:14:50.426 +01:00 [INF] HTTP GET /api/Conversations/history/144 started - IP: 127.0.0.1
2025-11-30 02:14:50.427 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:50.428 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:50.431 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='144'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:50.434 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='144'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:50.437 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='144'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:50.438 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:50.440 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.1291ms
2025-11-30 02:14:50.441 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:50.442 +01:00 [INF] HTTP GET /api/Conversations/history/144 completed - Status: 200 - Duration: 15.7492ms
2025-11-30 02:14:50.444 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/144 - 200 null application/json; charset=utf-8 22.6888ms
2025-11-30 02:14:50.451 +01:00 [INF] SignalR disconnected: RV_Nx6ul5ey1LH3ZiKjJug user:null ex:null
2025-11-30 02:14:50.453 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:50.454 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 498.1823ms
2025-11-30 02:14:50.455 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=144&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=MMOT46I2e2tVompGWlKcXA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 502.5546ms
2025-11-30 02:14:51.169 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:51.173 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:51.174 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:51'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:51.180 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:51'.
2025-11-30 02:14:51.181 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:51.183 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:51.184 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:51.187 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:51.189 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:51.192 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:51.197 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:51.1954402Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:51.1954393Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:51.1956888Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482572' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482572,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:51.1954402Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:51.1954393Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:0000000C' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:51.202 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:51.213 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 28.2981ms
2025-11-30 02:14:51.215 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:51.216 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 35.0069ms
2025-11-30 02:14:51.219 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 50.1911ms
2025-11-30 02:14:51.243 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=145&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:51.245 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:51.246 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=145&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.1404ms
2025-11-30 02:14:51.248 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=145&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:51.251 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:51.252 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:51.253 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:51.254 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:51.255 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.2773ms
2025-11-30 02:14:51.257 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=145&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.6424ms
2025-11-30 02:14:51.259 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=145&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=PErkEvEj-hkpGaWVAbsxyw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:51.261 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:51.262 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:51.264 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:51.268 +01:00 [INF] SignalR connected: 4t4miuO1AhT_XzrcZTlZGw user:null
2025-11-30 02:14:51.275 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='145'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:51.278 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='145', @p0='2025-11-30T01:14:51.2770852Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:51.2771833Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='145' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:51.2770852Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VT:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:51.742 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/145 - null null
2025-11-30 02:14:51.745 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:51.745 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/145 - 204 null null 3.0657ms
2025-11-30 02:14:51.748 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/145 - null null
2025-11-30 02:14:51.750 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:51.751 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:51'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:51.752 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:51'.
2025-11-30 02:14:51.753 +01:00 [INF] HTTP GET /api/Conversations/history/145 started - IP: 127.0.0.1
2025-11-30 02:14:51.754 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:51.755 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:51.758 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='145'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:51.760 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='145'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:51.763 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='145'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:51.765 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:51.767 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.1579ms
2025-11-30 02:14:51.768 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:51.769 +01:00 [INF] HTTP GET /api/Conversations/history/145 completed - Status: 200 - Duration: 15.7851ms
2025-11-30 02:14:51.769 +01:00 [INF] SignalR disconnected: 4t4miuO1AhT_XzrcZTlZGw user:null ex:null
2025-11-30 02:14:51.771 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/145 - 200 null application/json; charset=utf-8 22.4925ms
2025-11-30 02:14:51.772 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:51.775 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 512.2425ms
2025-11-30 02:14:51.776 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=145&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=PErkEvEj-hkpGaWVAbsxyw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 517.0674ms
2025-11-30 02:14:52.575 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:14:52.577 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:52.578 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.2978ms
2025-11-30 02:14:52.580 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:52.583 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:52.584 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:52'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:52.586 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:52'.
2025-11-30 02:14:52.587 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:52.588 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:52.589 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:52.592 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:52.595 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:52.598 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:52.601 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:52.6000896Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:52.6000893Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:52.6002070Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482571' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482571,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:52.6000896Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:52.6000893Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:0000000E' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:52.605 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:52.606 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 16.037ms
2025-11-30 02:14:52.608 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:52.609 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.9503ms
2025-11-30 02:14:52.610 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 30.4215ms
2025-11-30 02:14:52.636 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=146&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:52.638 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:52.639 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=146&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.8367ms
2025-11-30 02:14:52.641 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=146&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:52.644 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:52.645 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:52.646 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:52.647 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:52.648 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.935ms
2025-11-30 02:14:52.649 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=146&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.7981ms
2025-11-30 02:14:52.651 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=146&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=_oI_Go_nUbcErxTysEYr-w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:52.654 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:52.655 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:52.656 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:52.659 +01:00 [INF] SignalR connected: gbjyReNZ521gBoG7e3nAVA user:null
2025-11-30 02:14:52.665 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='146'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:52.668 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='146', @p0='2025-11-30T01:14:52.6671230Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:52.6671893Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='146' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:52.667123Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VU:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:53.133 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/146 - null null
2025-11-30 02:14:53.135 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:53.136 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/146 - 204 null null 2.9024ms
2025-11-30 02:14:53.138 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/146 - null null
2025-11-30 02:14:53.140 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:53.141 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:53'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:53.142 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:53'.
2025-11-30 02:14:53.143 +01:00 [INF] HTTP GET /api/Conversations/history/146 started - IP: 127.0.0.1
2025-11-30 02:14:53.144 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:53.145 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:53.149 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='146'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:53.151 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='146'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:53.154 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='146'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:53.156 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:53.157 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.9035ms
2025-11-30 02:14:53.158 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:53.159 +01:00 [INF] HTTP GET /api/Conversations/history/146 completed - Status: 200 - Duration: 15.746ms
2025-11-30 02:14:53.160 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/146 - 200 null application/json; charset=utf-8 22.5121ms
2025-11-30 02:14:53.681 +01:00 [INF] SignalR disconnected: gbjyReNZ521gBoG7e3nAVA user:null ex:null
2025-11-30 02:14:53.683 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:53.684 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1028.3562ms
2025-11-30 02:14:53.685 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=146&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=_oI_Go_nUbcErxTysEYr-w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1033.3961ms
2025-11-30 02:14:54.760 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:54.763 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:54.763 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:54'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:54.765 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:54'.
2025-11-30 02:14:54.766 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:54.767 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:54.768 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:54.771 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:54.774 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:54.776 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:54.780 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:54.7786108Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:54.7786102Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:54.7788344Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482570' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482570,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:54.7786108Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:54.7786102Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000010' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:54.803 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:54.804 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 34.7796ms
2025-11-30 02:14:54.805 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:54.806 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 39.8936ms
2025-11-30 02:14:54.807 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 47.6899ms
2025-11-30 02:14:54.820 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=147&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:54.822 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:54.822 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=147&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.4679ms
2025-11-30 02:14:54.824 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=147&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:54.827 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:54.828 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:54.829 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:54.830 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:54.831 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6019ms
2025-11-30 02:14:54.832 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=147&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.9279ms
2025-11-30 02:14:54.834 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=147&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=b4xM7l1Gt1hoQW24VuY_4w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:54.836 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:54.837 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:54.838 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:54.840 +01:00 [INF] SignalR connected: Obx0irfGqz20qEj6BPBfiA user:null
2025-11-30 02:14:54.847 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='147'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:54.850 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='147', @p0='2025-11-30T01:14:54.8496493Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:54.8497155Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='147' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:54.8496493Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI8VV:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:55.335 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/147 - null null
2025-11-30 02:14:55.337 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:55.338 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/147 - 204 null null 2.6155ms
2025-11-30 02:14:55.341 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/147 - null null
2025-11-30 02:14:55.343 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:55.344 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:55'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:55.346 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:55'.
2025-11-30 02:14:55.347 +01:00 [INF] HTTP GET /api/Conversations/history/147 started - IP: 127.0.0.1
2025-11-30 02:14:55.348 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:55.349 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:55.352 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='147'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:55.354 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='147'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:55.357 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='147'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:55.358 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:55.360 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.531ms
2025-11-30 02:14:55.361 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:55.362 +01:00 [INF] HTTP GET /api/Conversations/history/147 completed - Status: 200 - Duration: 15.4067ms
2025-11-30 02:14:55.364 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/147 - 200 null application/json; charset=utf-8 23.1808ms
2025-11-30 02:14:55.746 +01:00 [INF] SignalR disconnected: Obx0irfGqz20qEj6BPBfiA user:null ex:null
2025-11-30 02:14:55.747 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:55.748 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 911.5422ms
2025-11-30 02:14:55.750 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=147&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=b4xM7l1Gt1hoQW24VuY_4w&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 915.4439ms
2025-11-30 02:14:56.736 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:56.738 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:56.739 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:56'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:56.741 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:56'.
2025-11-30 02:14:56.741 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:56.743 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:56.743 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:56.747 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:56.750 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:56.752 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:56.755 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:56.7544815Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:56.7544810Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:56.7546415Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482569' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482569,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:56.7544815Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:56.754481Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000012' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:56.760 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:56.761 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.6702ms
2025-11-30 02:14:56.762 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:56.763 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.5661ms
2025-11-30 02:14:56.764 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.5788ms
2025-11-30 02:14:56.770 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=148&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:56.772 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:56.773 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=148&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.1144ms
2025-11-30 02:14:56.808 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=148&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:56.810 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:56.811 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:56.812 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:56.813 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:56.814 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5364ms
2025-11-30 02:14:56.816 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=148&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.3237ms
2025-11-30 02:14:56.818 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=148&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=YAsPH4om8iqWah--Z9RffA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:56.820 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:56.821 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:56.822 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:56.825 +01:00 [INF] SignalR connected: BW-WPmNJiJLZ9rP6vN7lMg user:null
2025-11-30 02:14:56.832 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='148'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:56.835 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='148', @p0='2025-11-30T01:14:56.8343132Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:56.8343997Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='148' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:56.8343132Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI900:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:57.288 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/148 - null null
2025-11-30 02:14:57.290 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:57.291 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/148 - 204 null null 2.7616ms
2025-11-30 02:14:57.294 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/148 - null null
2025-11-30 02:14:57.296 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:57.297 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:57'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:57.298 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:57'.
2025-11-30 02:14:57.299 +01:00 [INF] HTTP GET /api/Conversations/history/148 started - IP: 127.0.0.1
2025-11-30 02:14:57.300 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:57.301 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:57.304 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='148'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:57.307 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='148'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:57.309 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='148'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:57.312 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:57.313 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.3986ms
2025-11-30 02:14:57.314 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:57.315 +01:00 [INF] HTTP GET /api/Conversations/history/148 completed - Status: 200 - Duration: 15.9892ms
2025-11-30 02:14:57.317 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/148 - 200 null application/json; charset=utf-8 22.9388ms
2025-11-30 02:14:57.785 +01:00 [INF] SignalR disconnected: BW-WPmNJiJLZ9rP6vN7lMg user:null ex:null
2025-11-30 02:14:57.786 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:14:57.787 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 966.144ms
2025-11-30 02:14:57.788 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=148&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=YAsPH4om8iqWah--Z9RffA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 970.5369ms
2025-11-30 02:14:58.719 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:14:58.722 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:58.722 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.0578ms
2025-11-30 02:14:58.724 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:14:58.727 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:58.728 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:58'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:58.729 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:58'.
2025-11-30 02:14:58.731 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:14:58.732 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:58.733 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:58.735 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mjg1LCJleHAiOjE3OTYwMDEyODUsImlhdCI6MTc2NDQ2NTI4NSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.R5P9RY-ZbY7QDMRc9M1M9_TWO55ADrIfBaoA48jKK60' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:58.738 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:14:58.740 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:14:58.743 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:14:58.7425811Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:14:58.7425806Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:14:58.7427379Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482568' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482568,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:14:58.7425811Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:14:58.7425806Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000014' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:58.749 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:14:58.750 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.688ms
2025-11-30 02:14:58.751 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:14:58.752 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.0326ms
2025-11-30 02:14:58.753 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.8869ms
2025-11-30 02:14:58.785 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:14:58.787 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:58.787 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5247ms
2025-11-30 02:14:58.789 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:14:58.792 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:58.792 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:14:58.793 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:14:58.794 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:14:58.795 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9283ms
2025-11-30 02:14:58.797 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.5828ms
2025-11-30 02:14:58.799 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=xjj3zRVAIIIulY7u3zcjLw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:14:58.801 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:58.802 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:14:58.803 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:14:58.806 +01:00 [INF] SignalR connected: al5WYJxEXKLoPjLMgIFcYA user:null
2025-11-30 02:14:58.811 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:14:58.814 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='149', @p0='2025-11-30T01:14:58.8133410Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:14:58.8134096Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='149' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:14:58.813341Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI901:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:14:59.273 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/149 - null null
2025-11-30 02:14:59.275 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:59.276 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/149 - 204 null null 2.8623ms
2025-11-30 02:14:59.279 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/149 - null null
2025-11-30 02:14:59.281 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:14:59.282 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:59'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:14:59.283 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:14:59'.
2025-11-30 02:14:59.284 +01:00 [INF] HTTP GET /api/Conversations/history/149 started - IP: 127.0.0.1
2025-11-30 02:14:59.286 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:59.287 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:14:59.289 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:14:59.291 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:14:59.294 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:14:59.296 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:14:59.297 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.4897ms
2025-11-30 02:14:59.298 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:14:59.299 +01:00 [INF] HTTP GET /api/Conversations/history/149 completed - Status: 200 - Duration: 14.7535ms
2025-11-30 02:14:59.300 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/149 - 200 null application/json; charset=utf-8 21.318ms
2025-11-30 02:15:28.779 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:15:28.782 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='149', @p0='2025-11-30T01:15:28.7810991Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:15:28.7811638Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='149' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:15:28.7810991Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:14:58.813341"}' (Size = 4000), @p10='0HNHFH06JI901:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:15:58.809 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:15:58.812 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='149', @p0='2025-11-30T01:15:58.8116565Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:15:58.8117424Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='149' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:15:58.8116565Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:15:28.781099"}' (Size = 4000), @p10='0HNHFH06JI901:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:16:13.271 +01:00 [INF] SignalR disconnected: al5WYJxEXKLoPjLMgIFcYA user:null ex:null
2025-11-30 02:16:13.272 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:16:13.273 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 74471.465ms
2025-11-30 02:16:13.274 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 74471.465ms
2025-11-30 02:16:13.276 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=xjj3zRVAIIIulY7u3zcjLw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 74477.3374ms
2025-11-30 02:16:13.333 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:16:13.333 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:16:13.335 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.337 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.338 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:16:13.338 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:16:13.339 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:16:13.340 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:16:13.343 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.344 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:13.345 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:13.346 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 7.1036ms
2025-11-30 02:16:13.346 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:16:13.347 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:16:13.350 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:16:13.354 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:16:13.355 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.358 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:16:13.360 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:16:13.360 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:16:13.362 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:13.363 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:16:13.365 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:16:13.367 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 18.6144ms
2025-11-30 02:16:13.368 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:16:13.369 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:13.370 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:16:13.371 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 10.3299ms
2025-11-30 02:16:13.372 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 19.6409ms
2025-11-30 02:16:13.373 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 35.0792ms
2025-11-30 02:16:13.376 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:13.375 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 27.0798ms
2025-11-30 02:16:13.378 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 45.0439ms
2025-11-30 02:16:13.378 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=Wq7rJPE1J43t8gICNKMzoA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:16:13.379 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 39.8338ms
2025-11-30 02:16:13.385 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.387 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 53.7872ms
2025-11-30 02:16:13.388 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:16:13.391 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:16:13.410 +01:00 [INF] SignalR connected: w3DQ_PhVuDc3_w4B4dQUsA user:null
2025-11-30 02:16:13.411 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:16:13.413 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.414 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.0318ms
2025-11-30 02:16:13.415 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:16:13.416 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:16:13.420 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='149', @p0='2025-11-30T01:16:13.4194133Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:16:13.4194866Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='149' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:16:13.4194133Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:15:58.811656"}' (Size = 4000), @p10='0HNHFH06JI903:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:16:13.421 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.423 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:16:13.424 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:16:13.426 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:16:13.428 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:16:13.429 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:13.430 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.3363ms
2025-11-30 02:16:13.431 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:16:13.432 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.441ms
2025-11-30 02:16:13.433 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 17.5094ms
2025-11-30 02:16:13.447 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:16:13.449 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:16:13.449 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.451 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:13.452 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:16:13.452 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:16:13.453 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:16:13.454 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:13.455 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:13.456 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:16:13.460 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:16:13.461 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:16:13.462 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:16:13.464 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:16:13.465 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:16:13.467 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:16:13.469 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:13.469 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:13.471 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:16:13.472 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.1535ms
2025-11-30 02:16:13.474 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:13.474 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:13.477 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:13.477 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.9333ms
2025-11-30 02:16:13.479 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:13.480 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.3145ms
2025-11-30 02:16:13.482 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:16:13.485 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:16:15.520 +01:00 [INF] Received HTTP response headers after 2034.0024ms - 422
2025-11-30 02:16:15.521 +01:00 [INF] End processing HTTP request after 2039.1852ms - 422
2025-11-30 02:16:15.522 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:15.524 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2066.3879ms
2025-11-30 02:16:15.525 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:16:15.526 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2074.4745ms
2025-11-30 02:16:15.528 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2080.9059ms
2025-11-30 02:16:16.552 +01:00 [INF] SignalR disconnected: w3DQ_PhVuDc3_w4B4dQUsA user:null ex:null
2025-11-30 02:16:16.553 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:16:16.554 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 3166.0436ms
2025-11-30 02:16:16.555 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=Wq7rJPE1J43t8gICNKMzoA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 3177.3775ms
2025-11-30 02:16:16.580 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/149/disconnect - null 0
2025-11-30 02:16:16.582 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:16:16.582 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:16.584 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:16.585 +01:00 [INF] HTTP POST /api/conversations/149/disconnect started - IP: 127.0.0.1
2025-11-30 02:16:16.585 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:16:16.586 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api)'
2025-11-30 02:16:16.588 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:16:16.588 +01:00 [INF] Route matched with {action = "UserDisconnected", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UserDisconnected(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:16:16.589 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:16:16.591 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 5.6346ms
2025-11-30 02:16:16.592 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='149'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:16:16.593 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=149&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 11.1761ms
2025-11-30 02:16:16.597 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='149', @p0='2025-11-30T01:16:16.5957700Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:16:16.5958730Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='149' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:16:16.59577Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:16:13.419413"}' (Size = 4000), @p10='0HNHFH06JI8VO:00000019' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:16:16.602 +01:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2025-11-30 02:16:16.603 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api) in 12.6646ms
2025-11-30 02:16:16.604 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.UserDisconnected (Voia.Api)'
2025-11-30 02:16:16.605 +01:00 [INF] HTTP POST /api/conversations/149/disconnect completed - Status: 200 - Duration: 19.8977ms
2025-11-30 02:16:16.606 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/149/disconnect - 200 0 null 25.9918ms
2025-11-30 02:16:18.229 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:16:18.229 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:16:18.231 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.233 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.234 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.7851ms
2025-11-30 02:16:18.234 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.2512ms
2025-11-30 02:16:18.235 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:16:18.237 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:16:18.242 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.244 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.245 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:18'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:16:18.245 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:18'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:16:18.248 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:18'.
2025-11-30 02:16:18.249 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:18'.
2025-11-30 02:16:18.250 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:16:18.250 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:16:18.251 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:16:18.253 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:16:18.254 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:16:18.255 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:18.258 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:16:18.259 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:16:18.261 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:16:18.262 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:16:18.264 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.5654ms
2025-11-30 02:16:18.264 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:16:18.2638319Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:16:18.2637623Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:16:18.2637626Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:14:45.347311","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:14:45.347312"}' (Size = 4000), @p8='0HNHFH06JI8VO:0000001A' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:16:18.2637623Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:16:18.2637626Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:16:18.265 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:16:18.268 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 17.7451ms
2025-11-30 02:16:18.269 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:18.270 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 32.6983ms
2025-11-30 02:16:18.271 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.5618ms
2025-11-30 02:16:18.274 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:16:18.275 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 25.2471ms
2025-11-30 02:16:18.277 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 41.392ms
2025-11-30 02:16:18.320 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:16:18.322 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.322 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:16:18.324 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:16:18.325 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:18.328 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:16:18.331 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:16:18.333 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:18.335 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.2633ms
2025-11-30 02:16:18.336 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:16:18.337 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.6677ms
2025-11-30 02:16:18.338 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.6378ms
2025-11-30 02:16:18.344 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:16:18.346 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.346 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:16:18.347 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:16:18.348 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:16:18.351 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:16:18.352 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:18.353 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6847ms
2025-11-30 02:16:18.354 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:16:18.355 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.6613ms
2025-11-30 02:16:18.357 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.8941ms
2025-11-30 02:16:18.380 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:16:18.381 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:16:18.382 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.384 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:18.385 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:16:18.385 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:16:18.387 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:16:18.388 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:18.388 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:18.389 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:16:18.394 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:16:18.394 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:16:18.397 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:16:18.399 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:16:18.401 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:16:18.402 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:16:18.404 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:18.404 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:18.407 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:16:18.407 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 14.9404ms
2025-11-30 02:16:18.410 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:18.410 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:18.414 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 28.1697ms
2025-11-30 02:16:18.414 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:18.415 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.13ms
2025-11-30 02:16:18.418 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:18.422 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:16:18.423 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:16:18.425 +01:00 [INF] Received HTTP response headers after 1.2099ms - 422
2025-11-30 02:16:18.426 +01:00 [INF] End processing HTTP request after 4.6661ms - 422
2025-11-30 02:16:18.427 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:18.429 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 38.3744ms
2025-11-30 02:16:18.430 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:16:18.431 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 46.4299ms
2025-11-30 02:16:18.433 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 52.8262ms
2025-11-30 02:16:24.236 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:16:24.236 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:16:24.238 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.240 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.241 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.8482ms
2025-11-30 02:16:24.241 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.3881ms
2025-11-30 02:16:24.245 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:16:24.245 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:16:24.249 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.251 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.252 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:24'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:16:24.252 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:24'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:16:24.254 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:24'.
2025-11-30 02:16:24.255 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:24'.
2025-11-30 02:16:24.256 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:16:24.257 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:16:24.258 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:16:24.259 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:16:24.260 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:16:24.261 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:24.265 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:16:24.266 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:16:24.267 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:16:24.269 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:16:24.272 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 7.1895ms
2025-11-30 02:16:24.272 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:16:24.2710337Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:16:24.2709689Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:16:24.2709693Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:16:18.263762","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:16:18.263762"}' (Size = 4000), @p8='0HNHFH06JI8VO:0000001D' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:16:24.2709689Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:16:24.2709693Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:16:24.273 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:16:24.276 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 19.4138ms
2025-11-30 02:16:24.278 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:24.278 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 32.9526ms
2025-11-30 02:16:24.279 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 16.3378ms
2025-11-30 02:16:24.283 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:16:24.284 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 27.8167ms
2025-11-30 02:16:24.285 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 40.5628ms
2025-11-30 02:16:24.349 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:16:24.351 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.351 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:16:24.353 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:16:24.354 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:24.357 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:16:24.360 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:16:24.362 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:24.364 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.7014ms
2025-11-30 02:16:24.365 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:16:24.366 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.3427ms
2025-11-30 02:16:24.367 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.6095ms
2025-11-30 02:16:24.412 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:16:24.414 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.414 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.7994ms
2025-11-30 02:16:24.416 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:16:24.419 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.420 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:16:24.421 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:16:24.422 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:16:24.424 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:16:24.425 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:24.427 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 3.0089ms
2025-11-30 02:16:24.428 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:16:24.429 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 9.5267ms
2025-11-30 02:16:24.431 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 15.5527ms
2025-11-30 02:16:24.436 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:16:24.437 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:16:24.439 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.441 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:24.442 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:16:24.443 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:16:24.445 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:16:24.446 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:24.447 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:16:24.447 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:16:24.450 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:16:24.451 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:16:24.453 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:16:24.455 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:16:24.456 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:16:24.457 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:16:24.460 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:24.460 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:24.461 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 10.9537ms
2025-11-30 02:16:24.464 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:16:24.464 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:16:24.466 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:24.467 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.1852ms
2025-11-30 02:16:24.469 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:24.470 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.3121ms
2025-11-30 02:16:24.473 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:16:24.476 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:16:24.477 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:16:26.521 +01:00 [INF] Received HTTP response headers after 2042.5058ms - 422
2025-11-30 02:16:26.522 +01:00 [INF] End processing HTTP request after 2045.789ms - 422
2025-11-30 02:16:26.523 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:26.525 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2076.817ms
2025-11-30 02:16:26.526 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:16:26.527 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2085.0314ms
2025-11-30 02:16:26.529 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2092.5264ms
2025-11-30 02:16:32.701 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:16:32.703 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:32.704 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.6508ms
2025-11-30 02:16:32.705 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:16:32.708 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:32.709 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:16:32.710 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:32'.
2025-11-30 02:16:32.711 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:16:32.713 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:16:32.714 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:16:32.716 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1Mzg0LCJleHAiOjE3OTYwMDEzODQsImlhdCI6MTc2NDQ2NTM4NCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.TIhvfRhStP53I0SteifpMIleAS50A0FqznJJ2zr3g7Q' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:16:32.719 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:16:32.721 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:16:32.725 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:16:32.7237424Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:16:32.7237420Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:16:32.7238981Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482567' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482567,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:16:32.7237424Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:16:32.723742Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000020' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:16:32.730 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:16:32.731 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.8949ms
2025-11-30 02:16:32.732 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:16:32.733 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.4058ms
2025-11-30 02:16:32.734 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.717ms
2025-11-30 02:16:32.779 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:16:32.781 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:32.782 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5896ms
2025-11-30 02:16:32.784 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:16:32.786 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:32.787 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:16:32.788 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:16:32.789 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:16:32.790 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6584ms
2025-11-30 02:16:32.791 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.7051ms
2025-11-30 02:16:32.816 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=3T6nvZiRbGrejpr15dj5qg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:16:32.818 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:32.819 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:16:32.820 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:16:32.823 +01:00 [INF] SignalR connected: zGFKOyfF71LIzqN9S8PiCw user:null
2025-11-30 02:16:32.832 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:16:32.835 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:16:32.8345891Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:16:32.8346555Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:16:32.8345891Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI904:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:16:33.274 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:16:33.277 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:33.277 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - 204 null null 3.2913ms
2025-11-30 02:16:33.280 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:16:33.282 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:16:33.283 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:33'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:16:33.285 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:16:33'.
2025-11-30 02:16:33.286 +01:00 [INF] HTTP GET /api/Conversations/history/150 started - IP: 127.0.0.1
2025-11-30 02:16:33.287 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:16:33.287 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:16:33.290 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:16:33.294 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:16:33.297 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:16:33.299 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:16:33.301 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 12.1629ms
2025-11-30 02:16:33.302 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:16:33.303 +01:00 [INF] HTTP GET /api/Conversations/history/150 completed - Status: 200 - Duration: 17.3875ms
2025-11-30 02:16:33.305 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - 200 null application/json; charset=utf-8 24.4619ms
2025-11-30 02:16:34.286 +01:00 [INF] 💾 [SaveWelcomeMessage] Guardando mensaje de bienvenida - ConvId: 150, BotId: 1
2025-11-30 02:16:34.288 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:16:34.291 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='1' (Nullable = true), @p1='150', @p2='2025-11-30T01:16:34.2901145Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='¡Hola veci! ¿Cómo estás? ¿En qué te puedo ayudar?' (Size = 4000), @p5='4' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='bot' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13='5' (Nullable = true), @p14='CREATE' (Size = 100), @p15='2025-11-30T01:16:34.2902603Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482644' (Nullable = true), @p18='Message' (Size = 100), @p19='127.0.0.1' (Size = 45), @p20='{"Id":-2147482644,"BotId":1,"ConversationId":150,"CreatedAt":"2025-11-30T01:16:34.2901145Z","FileId":null,"MessageText":"¡Hola veci! ¿Cómo estás? ¿En qué te puedo ayudar?","PublicUserId":4,"Read":false,"ReplyToMessageId":null,"Sender":"bot","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":5}' (Size = 4000), @p21='' (Size = 4000), @p22='0HNHFH06JI904:00000001' (Size = 50), @p23='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:16:34.295 +01:00 [INF] ✅ [SaveWelcomeMessage] Mensaje de bienvenida guardado - MessageId: 47
2025-11-30 02:16:34.472 +01:00 [INF] SignalR disconnected: zGFKOyfF71LIzqN9S8PiCw user:null ex:null
2025-11-30 02:16:34.474 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:16:34.475 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1655.9072ms
2025-11-30 02:16:34.476 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=3T6nvZiRbGrejpr15dj5qg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1660.054ms
2025-11-30 02:18:04.919 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:18:04.919 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:18:04.921 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:04.923 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:04.924 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:18:04.925 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:18:04.926 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:18:04.927 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:04.928 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:04.929 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:18:04.932 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:18:04.932 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:18:04.934 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:18:04.936 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:18:04.937 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:04.938 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:18:04.940 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.1923ms
2025-11-30 02:18:04.941 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:04.942 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:18:04.943 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.6057ms
2025-11-30 02:18:04.944 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 19.6457ms
2025-11-30 02:18:04.945 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:04.946 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 27.4146ms
2025-11-30 02:18:04.947 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.4923ms
2025-11-30 02:18:04.951 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.5357ms
2025-11-30 02:18:05.006 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:18:05.008 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:05.009 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.9681ms
2025-11-30 02:18:05.011 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:18:05.014 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:05.014 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:18:05.015 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:18:05.016 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:05.018 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:18:05.019 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:05.020 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6346ms
2025-11-30 02:18:05.022 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:18:05.023 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.4827ms
2025-11-30 02:18:05.024 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.574ms
2025-11-30 02:18:05.076 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:18:05.077 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:18:05.079 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:05.081 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:05.082 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:18:05.082 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:18:05.083 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:18:05.085 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:05.086 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:05.086 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:18:05.090 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:18:05.091 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:18:05.093 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:18:05.095 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:18:05.096 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:18:05.098 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:18:05.100 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:05.101 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:05.103 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:18:05.104 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.7709ms
2025-11-30 02:18:05.107 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:05.107 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:05.109 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:05.110 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.3928ms
2025-11-30 02:18:05.112 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:05.113 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.9934ms
2025-11-30 02:18:05.115 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:18:05.119 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:18:07.160 +01:00 [INF] Received HTTP response headers after 2040.5704ms - 422
2025-11-30 02:18:07.161 +01:00 [INF] End processing HTTP request after 2046.0151ms - 422
2025-11-30 02:18:07.162 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:07.164 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2075.7669ms
2025-11-30 02:18:07.165 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:18:07.166 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2083.9678ms
2025-11-30 02:18:07.167 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2090.6952ms
2025-11-30 02:18:10.057 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:18:10.057 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:10.059 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.061 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.061 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.6728ms
2025-11-30 02:18:10.062 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.9508ms
2025-11-30 02:18:10.073 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:18:10.073 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:10.075 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.077 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.078 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:10'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:10.078 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:10'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:10.079 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:10'.
2025-11-30 02:18:10.081 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:10'.
2025-11-30 02:18:10.081 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:18:10.082 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:18:10.084 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:18:10.085 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:18:10.086 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:18:10.087 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:10.090 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:18:10.091 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:18:10.092 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:18:10.094 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:18:10.096 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.0539ms
2025-11-30 02:18:10.096 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:18:10.0955118Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:18:10.0954429Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:18:10.0954432Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:16:24.270968","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:16:24.270969"}' (Size = 4000), @p8='0HNHFH06JI8VO:00000025' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:18:10.0954429Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:18:10.0954432Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:18:10.097 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:18:10.100 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 17.6976ms
2025-11-30 02:18:10.101 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:10.101 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 28.0808ms
2025-11-30 02:18:10.102 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.3498ms
2025-11-30 02:18:10.106 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:18:10.107 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 25.3993ms
2025-11-30 02:18:10.108 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 35.2839ms
2025-11-30 02:18:10.152 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:18:10.154 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.154 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:18:10.156 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:18:10.157 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:10.160 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:18:10.162 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:18:10.164 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:10.166 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.5649ms
2025-11-30 02:18:10.167 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:18:10.168 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.2993ms
2025-11-30 02:18:10.169 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 17.548ms
2025-11-30 02:18:10.195 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:18:10.197 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.198 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.787ms
2025-11-30 02:18:10.199 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:18:10.202 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.203 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:18:10.204 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:18:10.205 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:10.207 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:18:10.208 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:10.209 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.7196ms
2025-11-30 02:18:10.211 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:18:10.212 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.8764ms
2025-11-30 02:18:10.213 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.1049ms
2025-11-30 02:18:10.231 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:18:10.232 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:18:10.233 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.235 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:10.236 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:18:10.237 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:18:10.238 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:18:10.239 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:10.240 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:10.241 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:18:10.244 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:18:10.245 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:18:10.247 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:18:10.249 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:18:10.251 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:18:10.252 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:18:10.255 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:10.255 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:10.258 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:18:10.258 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.9292ms
2025-11-30 02:18:10.260 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:10.261 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:10.263 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:10.263 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.7739ms
2025-11-30 02:18:10.266 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:10.267 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.2475ms
2025-11-30 02:18:10.269 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:18:10.273 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:18:10.276 +01:00 [INF] Received HTTP response headers after 1.7913ms - 422
2025-11-30 02:18:10.277 +01:00 [INF] End processing HTTP request after 7.7024ms - 422
2025-11-30 02:18:10.277 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:10.279 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 36.1815ms
2025-11-30 02:18:10.280 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:18:10.281 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 44.6819ms
2025-11-30 02:18:10.282 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 51.2152ms
2025-11-30 02:18:11.361 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:18:11.364 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:11.365 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.2895ms
2025-11-30 02:18:11.366 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:18:11.370 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:11.371 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:18:11.372 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:18:11.373 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:18:11.374 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.3641ms
2025-11-30 02:18:11.376 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 9.8015ms
2025-11-30 02:18:11.380 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=AEiL7iMx6iLbRBKO_gm42g&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:11.382 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:11.383 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:18:11.384 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:18:11.387 +01:00 [INF] SignalR connected: yj0aJon8KZ3YXtdpSWbDTw user:null
2025-11-30 02:18:11.396 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:18:11.399 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:18:11.3987286Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:18:11.3988120Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:18:11.3987286Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:16:32.834589"}' (Size = 4000), @p10='0HNHFH06JI905:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:11.882 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:18:11.884 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:11.885 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - 204 null null 2.5312ms
2025-11-30 02:18:11.887 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:18:11.888 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:11.889 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:11'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:11.891 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:11'.
2025-11-30 02:18:11.892 +01:00 [INF] HTTP GET /api/Conversations/history/150 started - IP: 127.0.0.1
2025-11-30 02:18:11.893 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:11.893 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:11.896 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:18:11.899 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:18:11.901 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:18:11.903 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:11.904 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.9576ms
2025-11-30 02:18:11.905 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:11.906 +01:00 [INF] HTTP GET /api/Conversations/history/150 completed - Status: 200 - Duration: 14.5753ms
2025-11-30 02:18:11.908 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - 200 null application/json; charset=utf-8 20.8842ms
2025-11-30 02:18:12.407 +01:00 [INF] SignalR disconnected: yj0aJon8KZ3YXtdpSWbDTw user:null ex:null
2025-11-30 02:18:12.409 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:18:12.410 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1026.6174ms
2025-11-30 02:18:12.411 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=AEiL7iMx6iLbRBKO_gm42g&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1030.6065ms
2025-11-30 02:18:13.237 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:18:13.239 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.240 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 3.4079ms
2025-11-30 02:18:13.242 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:18:13.245 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.246 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:13'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:13.247 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:13'.
2025-11-30 02:18:13.248 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:18:13.249 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:13.250 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:13.253 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1NDkwLCJleHAiOjE3OTYwMDE0OTAsImlhdCI6MTc2NDQ2NTQ5MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.Mx0zWo1Rcd69OnyHl8vHvg5IgJF8ERu0lv8-mgbRKEk' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:13.256 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:13.259 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:18:13.262 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:18:13.2614601Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:18:13.2614596Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:18:13.2615836Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482566' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482566,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:18:13.2614601Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:18:13.2614596Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000029' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:13.267 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:13.269 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 17.0208ms
2025-11-30 02:18:13.270 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:13.271 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 22.5355ms
2025-11-30 02:18:13.273 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 31.2693ms
2025-11-30 02:18:13.301 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=151&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:18:13.304 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.304 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=151&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.1ms
2025-11-30 02:18:13.306 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=151&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:18:13.309 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.310 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:18:13.312 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:18:13.313 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:18:13.313 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.8857ms
2025-11-30 02:18:13.315 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=151&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.5549ms
2025-11-30 02:18:13.317 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=151&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=ie2p4CBhiFt0CNBGE-wuHw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:13.320 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.320 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:18:13.321 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:18:13.325 +01:00 [INF] SignalR connected: 4zuZTYmj80AURsDANctmIQ user:null
2025-11-30 02:18:13.328 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='151'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:18:13.331 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='151', @p0='2025-11-30T01:18:13.3299599Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:18:13.3300336Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='151' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:18:13.3299599Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI906:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:13.790 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/151 - null null
2025-11-30 02:18:13.792 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.792 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/151 - 204 null null 2.6235ms
2025-11-30 02:18:13.794 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/151 - null null
2025-11-30 02:18:13.796 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:13.797 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:13'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:13.798 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:13'.
2025-11-30 02:18:13.799 +01:00 [INF] HTTP GET /api/Conversations/history/151 started - IP: 127.0.0.1
2025-11-30 02:18:13.800 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:13.801 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:13.804 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='151'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:18:13.806 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='151'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:18:13.809 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='151'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:18:13.810 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:13.812 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.4213ms
2025-11-30 02:18:13.813 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:13.814 +01:00 [INF] HTTP GET /api/Conversations/history/151 completed - Status: 200 - Duration: 14.3264ms
2025-11-30 02:18:13.815 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/151 - 200 null application/json; charset=utf-8 20.567ms
2025-11-30 02:18:14.231 +01:00 [INF] SignalR disconnected: 4zuZTYmj80AURsDANctmIQ user:null ex:null
2025-11-30 02:18:14.232 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:18:14.233 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 912.7974ms
2025-11-30 02:18:14.235 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=151&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=ie2p4CBhiFt0CNBGE-wuHw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 917.955ms
2025-11-30 02:18:14.976 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:18:14.978 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:14.979 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:14'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:14.980 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:14'.
2025-11-30 02:18:14.981 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:18:14.982 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:14.983 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:14.986 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1NDkwLCJleHAiOjE3OTYwMDE0OTAsImlhdCI6MTc2NDQ2NTQ5MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.Mx0zWo1Rcd69OnyHl8vHvg5IgJF8ERu0lv8-mgbRKEk' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:14.988 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:14.991 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:18:14.994 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:18:14.9935556Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:18:14.9935548Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:18:14.9937099Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482565' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482565,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:18:14.9935556Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:18:14.9935548Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:0000002B' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:14.998 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:14.999 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9467ms
2025-11-30 02:18:15.000 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:15.001 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.9497ms
2025-11-30 02:18:15.002 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 26.3324ms
2025-11-30 02:18:15.009 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=152&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:18:15.010 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:15.011 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=152&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5811ms
2025-11-30 02:18:15.038 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=152&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:18:15.040 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:15.041 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:18:15.042 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:18:15.043 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:18:15.044 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.5359ms
2025-11-30 02:18:15.045 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=152&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 6.8392ms
2025-11-30 02:18:15.047 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=152&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=dHg3nK4YSNMSlFLUEQblBQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:15.049 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:15.050 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:18:15.051 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:18:15.054 +01:00 [INF] SignalR connected: _aLlFtU2aCO7qMncaIAVlA user:null
2025-11-30 02:18:15.060 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='152'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:18:15.063 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='152', @p0='2025-11-30T01:18:15.0622253Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:18:15.0623026Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='152' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:18:15.0622253Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI907:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:15.524 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/152 - null null
2025-11-30 02:18:15.526 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:15.526 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/152 - 204 null null 2.6657ms
2025-11-30 02:18:15.529 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/152 - null null
2025-11-30 02:18:15.530 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:15.531 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:15'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:15.532 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:15'.
2025-11-30 02:18:15.533 +01:00 [INF] HTTP GET /api/Conversations/history/152 started - IP: 127.0.0.1
2025-11-30 02:18:15.534 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:15.535 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:15.537 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='152'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:18:15.540 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='152'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:18:15.543 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='152'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:18:15.545 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:15.546 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.9021ms
2025-11-30 02:18:15.547 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:15.548 +01:00 [INF] HTTP GET /api/Conversations/history/152 completed - Status: 200 - Duration: 14.7546ms
2025-11-30 02:18:15.549 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/152 - 200 null application/json; charset=utf-8 20.3778ms
2025-11-30 02:18:15.878 +01:00 [INF] SignalR disconnected: _aLlFtU2aCO7qMncaIAVlA user:null ex:null
2025-11-30 02:18:15.880 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:18:15.881 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 831.3664ms
2025-11-30 02:18:15.882 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=152&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=dHg3nK4YSNMSlFLUEQblBQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 835.3107ms
2025-11-30 02:18:49.690 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:18:49.690 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:49.692 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.695 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.695 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 5.3765ms
2025-11-30 02:18:49.696 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 5.8867ms
2025-11-30 02:18:49.725 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:18:49.725 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:49.727 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.729 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.729 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:49'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:49.730 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:49'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:49.732 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:49'.
2025-11-30 02:18:49.733 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:49'.
2025-11-30 02:18:49.733 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:18:49.734 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:18:49.735 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:18:49.737 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:18:49.738 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:18:49.739 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:49.742 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:18:49.743 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:18:49.744 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:18:49.746 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:18:49.748 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.3897ms
2025-11-30 02:18:49.748 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:18:49.7477480Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:18:49.7476802Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:18:49.7476806Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:18:10.095442","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:18:10.095443"}' (Size = 4000), @p8='0HNHFH06JI8VO:0000002D' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:18:49.7476802Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:18:49.7476806Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:18:49.750 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:18:49.752 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 18.1869ms
2025-11-30 02:18:49.754 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 29.3869ms
2025-11-30 02:18:49.754 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:49.758 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 17.7781ms
2025-11-30 02:18:49.759 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:18:49.760 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 27.0271ms
2025-11-30 02:18:49.762 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 37.5829ms
2025-11-30 02:18:49.841 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:18:49.843 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.845 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:18:49.846 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:18:49.847 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:49.851 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:18:49.853 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:18:49.855 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:49.857 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.3972ms
2025-11-30 02:18:49.858 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:18:49.859 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 14.4323ms
2025-11-30 02:18:49.861 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 19.5632ms
2025-11-30 02:18:49.880 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:18:49.881 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.882 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.4315ms
2025-11-30 02:18:49.883 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:18:49.886 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.887 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:18:49.888 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:18:49.889 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:49.892 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:18:49.893 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:49.894 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.7024ms
2025-11-30 02:18:49.895 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:18:49.896 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.9068ms
2025-11-30 02:18:49.897 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.1563ms
2025-11-30 02:18:49.928 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:18:49.928 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:18:49.931 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.932 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:49.933 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:18:49.934 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:18:49.935 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:18:49.936 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:49.937 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:18:49.938 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:18:49.941 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:18:49.942 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:18:49.945 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:18:49.946 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:18:49.948 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:18:49.949 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:18:49.952 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:49.952 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:49.954 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:18:49.955 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 14.0436ms
2025-11-30 02:18:49.958 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:49.958 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:18:49.960 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:49.960 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.8759ms
2025-11-30 02:18:49.963 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:18:49.963 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.9523ms
2025-11-30 02:18:49.965 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:18:49.968 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:18:50.964 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:18:50.966 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:50.967 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.8752ms
2025-11-30 02:18:50.968 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:18:50.972 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:50.973 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:18:50.974 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:18:50.975 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:18:50.976 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9917ms
2025-11-30 02:18:50.977 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 9.261ms
2025-11-30 02:18:50.985 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=UKHkCXeWcOMypKeUyuJ8gA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:50.987 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:50.988 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:18:50.990 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:18:50.993 +01:00 [INF] SignalR connected: g6KWfxlcybzKiLK_ku4Mbg user:null
2025-11-30 02:18:51.001 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:18:51.004 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:18:51.0034635Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:18:51.0035467Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:18:51.0034635Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:18:11.398728"}' (Size = 4000), @p10='0HNHFH06JI908:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:51.511 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:18:51.513 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:51.514 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - 204 null null 2.9415ms
2025-11-30 02:18:51.517 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:18:51.519 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:51.520 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:51'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:51.523 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:51'.
2025-11-30 02:18:51.524 +01:00 [INF] HTTP GET /api/Conversations/history/150 started - IP: 127.0.0.1
2025-11-30 02:18:51.525 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:51.526 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:51.529 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:18:51.531 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:18:51.534 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:18:51.536 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:51.539 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 12.1919ms
2025-11-30 02:18:51.541 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:51.542 +01:00 [INF] HTTP GET /api/Conversations/history/150 completed - Status: 200 - Duration: 18.1823ms
2025-11-30 02:18:51.544 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - 200 null application/json; charset=utf-8 26.4666ms
2025-11-30 02:18:51.990 +01:00 [INF] Received HTTP response headers after 2020.9903ms - 422
2025-11-30 02:18:51.991 +01:00 [INF] End processing HTTP request after 2026.0025ms - 422
2025-11-30 02:18:51.992 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:51.993 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2053.8426ms
2025-11-30 02:18:51.994 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:18:51.995 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2061.9067ms
2025-11-30 02:18:51.996 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2068.122ms
2025-11-30 02:18:52.535 +01:00 [INF] SignalR disconnected: g6KWfxlcybzKiLK_ku4Mbg user:null ex:null
2025-11-30 02:18:52.536 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:18:52.537 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1549.0509ms
2025-11-30 02:18:52.539 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=UKHkCXeWcOMypKeUyuJ8gA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1553.9962ms
2025-11-30 02:18:53.150 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:18:53.152 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:53.153 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.8486ms
2025-11-30 02:18:53.156 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:18:53.158 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:53.159 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:53'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:53.161 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:53'.
2025-11-30 02:18:53.162 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:18:53.163 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:53.163 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:53.166 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1NTI5LCJleHAiOjE3OTYwMDE1MjksImlhdCI6MTc2NDQ2NTUyOSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.CdrscnZjggxOI1ak-IfFTWMd8Lkmt-_sJ7aIW3QGREo' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:53.168 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:53.171 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:18:53.175 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:18:53.1737491Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:18:53.1737483Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:18:53.1738961Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482564' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482564,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:18:53.1737491Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:18:53.1737483Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000031' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:53.178 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:53.179 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.7333ms
2025-11-30 02:18:53.181 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:53.181 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 19.8392ms
2025-11-30 02:18:53.183 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.3723ms
2025-11-30 02:18:53.207 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=153&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:18:53.209 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:53.210 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=153&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9619ms
2025-11-30 02:18:53.211 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=153&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:18:53.214 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:53.215 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:18:53.216 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:18:53.217 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:18:53.218 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.8971ms
2025-11-30 02:18:53.219 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=153&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.0652ms
2025-11-30 02:18:53.222 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=153&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=TaNKXdAAroEtXQcojwr2Ww&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:53.225 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:53.226 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:18:53.227 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:18:53.230 +01:00 [INF] SignalR connected: 1utPqybPefhkm_5msEQaSg user:null
2025-11-30 02:18:53.233 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='153'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:18:53.235 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='153', @p0='2025-11-30T01:18:53.2347362Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:18:53.2347943Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='153' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:18:53.2347362Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI909:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:53.521 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:03:53.5203171Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:18:53.654 +01:00 [INF] SignalR disconnected: 1utPqybPefhkm_5msEQaSg user:null ex:null
2025-11-30 02:18:53.656 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:18:53.657 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 431.2884ms
2025-11-30 02:18:53.659 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=153&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=TaNKXdAAroEtXQcojwr2Ww&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 436.7991ms
2025-11-30 02:18:54.164 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:18:54.167 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:54.167 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:54'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:54.169 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:54'.
2025-11-30 02:18:54.169 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:18:54.170 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:54.172 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:54.174 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY1NTI5LCJleHAiOjE3OTYwMDE1MjksImlhdCI6MTc2NDQ2NTUyOSwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.CdrscnZjggxOI1ak-IfFTWMd8Lkmt-_sJ7aIW3QGREo' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:54.177 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:18:54.179 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:18:54.182 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:18:54.1809247Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:18:54.1809242Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:18:54.1810378Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482563' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482563,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:18:54.1809247Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:18:54.1809242Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI8VO:00000033' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:54.185 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:18:54.186 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 13.0377ms
2025-11-30 02:18:54.187 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:18:54.188 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 18.6138ms
2025-11-30 02:18:54.189 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 24.9863ms
2025-11-30 02:18:54.224 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=154&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:18:54.226 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:54.226 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=154&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.5508ms
2025-11-30 02:18:54.228 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=154&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:18:54.230 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:54.231 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:18:54.232 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:18:54.233 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:18:54.234 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6015ms
2025-11-30 02:18:54.235 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=154&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.5057ms
2025-11-30 02:18:54.236 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=154&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=8O-w8oRocTLjD6_9sWAd4A&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:18:54.240 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:54.240 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:18:54.242 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:18:54.245 +01:00 [INF] SignalR connected: t7PNEquL_o4N_tKGpBlO6w user:null
2025-11-30 02:18:54.250 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='154'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:18:54.253 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='154', @p0='2025-11-30T01:18:54.2522518Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:18:54.2523206Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='154' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:18:54.2522518Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI90A:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:18:54.718 +01:00 [INF] SignalR disconnected: t7PNEquL_o4N_tKGpBlO6w user:null ex:null
2025-11-30 02:18:54.719 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:18:54.720 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 479.517ms
2025-11-30 02:18:54.722 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=154&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=8O-w8oRocTLjD6_9sWAd4A&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 485.0326ms
2025-11-30 02:18:54.723 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/154 - null null
2025-11-30 02:18:54.726 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:54.726 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/154 - 204 null null 3.4718ms
2025-11-30 02:18:54.728 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/154 - null null
2025-11-30 02:18:54.730 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:18:54.731 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:54'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:18:54.732 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:18:54'.
2025-11-30 02:18:54.733 +01:00 [INF] HTTP GET /api/Conversations/history/154 started - IP: 127.0.0.1
2025-11-30 02:18:54.734 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:54.734 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:18:54.737 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='154'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:18:54.741 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='154'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:18:54.743 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='154'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:18:54.744 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:18:54.745 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.8516ms
2025-11-30 02:18:54.746 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:18:54.747 +01:00 [INF] HTTP GET /api/Conversations/history/154 completed - Status: 200 - Duration: 14.5971ms
2025-11-30 02:18:54.748 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/154 - 200 null application/json; charset=utf-8 20.0693ms
2025-11-30 02:23:16.143 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:23:16.145 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:16.146 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:23:16.147 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:23:16.148 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:23:16.165 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:23:16.168 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:23:16.170 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:23:16.172 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 21.7613ms
2025-11-30 02:23:16.173 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:23:16.173 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 27.5482ms
2025-11-30 02:23:16.175 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 31.897ms
2025-11-30 02:23:16.208 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:23:16.210 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:16.211 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.3781ms
2025-11-30 02:23:16.212 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:23:16.216 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:16.216 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:23:16.217 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:23:16.218 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:23:16.220 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:23:16.221 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:23:16.222 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2914ms
2025-11-30 02:23:16.223 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:23:16.224 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.4933ms
2025-11-30 02:23:16.225 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.126ms
2025-11-30 02:23:16.229 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:23:16.230 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:23:16.231 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:16.233 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:16.234 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:23:16.235 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:23:16.236 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:23:16.237 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:23:16.238 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:23:16.239 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:23:16.242 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:23:16.245 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:23:16.247 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:23:16.248 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:23:16.251 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:23:16.252 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:16.253 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:23:16.256 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:23:16.256 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:23:16.257 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 15.224ms
2025-11-30 02:23:16.260 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:16.260 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:23:16.262 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:16.263 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.8958ms
2025-11-30 02:23:16.265 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:16.266 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.7693ms
2025-11-30 02:23:16.268 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:23:16.271 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:23:18.303 +01:00 [INF] Received HTTP response headers after 2030.1506ms - 422
2025-11-30 02:23:18.304 +01:00 [INF] End processing HTTP request after 2036.0814ms - 422
2025-11-30 02:23:18.305 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:23:18.306 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2066.1474ms
2025-11-30 02:23:18.307 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:23:18.308 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2074.1046ms
2025-11-30 02:23:18.310 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2080.9397ms
2025-11-30 02:23:25.589 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:23:25.589 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:23:25.591 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.592 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.593 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.4188ms
2025-11-30 02:23:25.593 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.4084ms
2025-11-30 02:23:25.600 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:23:25.600 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:23:25.601 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.603 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.604 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:23:25'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:23:25.604 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:23:25'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:23:25.606 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:23:25'.
2025-11-30 02:23:25.607 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:23:25'.
2025-11-30 02:23:25.607 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:23:25.608 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:23:25.609 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:23:25.610 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:23:25.611 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:23:25.612 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:23:25.615 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:23:25.616 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:23:25.617 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:23:25.619 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:23:25.621 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.3735ms
2025-11-30 02:23:25.621 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:23:25.6205076Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:23:25.6204164Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:23:25.6204171Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:18:49.74768","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:18:49.74768"}' (Size = 4000), @p8='0HNHFH06JI90C:00000003' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:23:25.6204164Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:23:25.6204171Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:23:25.622 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:23:25.625 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 16.892ms
2025-11-30 02:23:25.626 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:23:25.627 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 26.7087ms
2025-11-30 02:23:25.628 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.9937ms
2025-11-30 02:23:25.632 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:23:25.633 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 25.6017ms
2025-11-30 02:23:25.635 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 35.1257ms
2025-11-30 02:23:25.692 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:23:25.694 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.695 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:23:25.696 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:23:25.696 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:23:25.700 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:23:25.703 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:23:25.705 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:23:25.706 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.7979ms
2025-11-30 02:23:25.707 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:23:25.708 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.5512ms
2025-11-30 02:23:25.710 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 17.5934ms
2025-11-30 02:23:25.734 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:23:25.736 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.736 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.5096ms
2025-11-30 02:23:25.738 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:23:25.741 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.741 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:23:25.742 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:23:25.743 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:23:25.745 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:23:25.745 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:23:25.746 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.1738ms
2025-11-30 02:23:25.747 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:23:25.749 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.5688ms
2025-11-30 02:23:25.750 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.5547ms
2025-11-30 02:23:25.777 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:23:25.777 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:23:25.779 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.781 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:25.782 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:23:25.783 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:23:25.784 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:23:25.785 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:23:25.785 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:23:25.786 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:23:25.789 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:23:25.790 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:23:25.792 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:23:25.794 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:23:25.795 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:23:25.796 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:23:25.799 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:23:25.799 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:25.800 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.5813ms
2025-11-30 02:23:25.803 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:23:25.803 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:23:25.804 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 21.0306ms
2025-11-30 02:23:25.806 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:25.807 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 29.3876ms
2025-11-30 02:23:25.809 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:25.813 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:23:25.815 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:23:25.816 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:23:26.695 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:23:26.697 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:26.697 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.7191ms
2025-11-30 02:23:26.699 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:23:26.702 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:26.703 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:23:26.704 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:23:26.705 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:23:26.706 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.8659ms
2025-11-30 02:23:26.707 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.4479ms
2025-11-30 02:23:26.710 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=mLJZT-1OrD2RCWlyma7sxQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:23:26.712 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:26.713 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:23:26.714 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:23:26.718 +01:00 [INF] SignalR connected: 7eb9ytN34GSDqwUlxkTxJA user:null
2025-11-30 02:23:26.721 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:23:26.724 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:23:26.7230699Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:23:26.7231396Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:23:26.7230699Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:18:51.003463"}' (Size = 4000), @p10='0HNHFH06JI90E:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:23:27.211 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:23:27.213 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:27.214 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - 204 null null 2.5851ms
2025-11-30 02:23:27.217 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:23:27.218 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:23:27.219 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:23:27'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:23:27.221 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:23:27'.
2025-11-30 02:23:27.222 +01:00 [INF] HTTP GET /api/Conversations/history/150 started - IP: 127.0.0.1
2025-11-30 02:23:27.223 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:23:27.224 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:23:27.227 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:23:27.230 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:23:27.233 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:23:27.235 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:23:27.236 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.9575ms
2025-11-30 02:23:27.237 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:23:27.238 +01:00 [INF] HTTP GET /api/Conversations/history/150 completed - Status: 200 - Duration: 16.595ms
2025-11-30 02:23:27.240 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - 200 null application/json; charset=utf-8 23.5604ms
2025-11-30 02:23:27.879 +01:00 [INF] Received HTTP response headers after 2062.1575ms - 422
2025-11-30 02:23:27.881 +01:00 [INF] End processing HTTP request after 2065.7135ms - 422
2025-11-30 02:23:27.882 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:23:27.884 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2096.5251ms
2025-11-30 02:23:27.885 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:23:27.886 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2103.852ms
2025-11-30 02:23:27.887 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2110.1599ms
2025-11-30 02:23:53.528 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:08:53.5279371Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:23:56.714 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:23:56.717 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:23:56.7162016Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:23:56.7162829Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:23:56.7162016Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:23:26.723069"}' (Size = 4000), @p10='0HNHFH06JI90E:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:24:26.719 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:24:26.722 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:24:26.7218419Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:24:26.7219100Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:24:26.7218419Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:23:56.716201"}' (Size = 4000), @p10='0HNHFH06JI90E:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:24:33.528 +01:00 [INF] SignalR disconnected: 7eb9ytN34GSDqwUlxkTxJA user:null ex:null
2025-11-30 02:24:33.529 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:24:33.531 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 66818.3738ms
2025-11-30 02:24:33.533 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 66818.3738ms
2025-11-30 02:24:33.534 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=mLJZT-1OrD2RCWlyma7sxQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 66824.1696ms
2025-11-30 02:24:37.449 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:24:37.449 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:24:37.451 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.452 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.453 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.5235ms
2025-11-30 02:24:37.454 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.9274ms
2025-11-30 02:24:37.458 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:24:37.458 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:24:37.460 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.462 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.463 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:24:37'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:24:37.464 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:24:37'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:24:37.465 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:24:37'.
2025-11-30 02:24:37.467 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:24:37'.
2025-11-30 02:24:37.467 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:24:37.468 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:24:37.469 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:24:37.470 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:24:37.471 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:24:37.472 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:24:37.474 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:24:37.476 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:24:37.477 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:24:37.479 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:24:37.481 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.7094ms
2025-11-30 02:24:37.482 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:24:37.4809338Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:24:37.4808579Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:24:37.4808591Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:23:25.620416","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:23:25.620417"}' (Size = 4000), @p8='0HNHFH06JI90C:00000007' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:24:37.4808579Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:24:37.4808591Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:24:37.483 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:24:37.485 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 17.1391ms
2025-11-30 02:24:37.487 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:24:37.487 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 29.0997ms
2025-11-30 02:24:37.488 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 15.1203ms
2025-11-30 02:24:37.492 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:24:37.493 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 25.3983ms
2025-11-30 02:24:37.494 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 36.5121ms
2025-11-30 02:24:37.537 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:24:37.539 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.539 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:24:37.541 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:24:37.542 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:24:37.545 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:24:37.548 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:24:37.550 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:24:37.552 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.5663ms
2025-11-30 02:24:37.553 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:24:37.553 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.9896ms
2025-11-30 02:24:37.555 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.2145ms
2025-11-30 02:24:37.598 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:24:37.600 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.601 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.6194ms
2025-11-30 02:24:37.602 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:24:37.605 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.606 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:24:37.607 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:24:37.608 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:24:37.610 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:24:37.611 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:24:37.612 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.8963ms
2025-11-30 02:24:37.614 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:24:37.615 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.7793ms
2025-11-30 02:24:37.616 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.185ms
2025-11-30 02:24:37.681 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:24:37.682 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:24:37.683 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.685 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:24:37.686 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:24:37.687 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:24:37.688 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:24:37.689 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:24:37.690 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:24:37.690 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:24:37.694 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:24:37.694 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:24:37.697 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:24:37.699 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:24:37.700 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:24:37.701 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:24:37.703 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:24:37.703 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:24:37.705 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:24:37.706 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.5705ms
2025-11-30 02:24:37.708 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:24:37.708 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:24:37.711 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:24:37.711 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.4747ms
2025-11-30 02:24:37.714 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:24:37.715 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.0721ms
2025-11-30 02:24:37.717 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:24:37.720 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:24:39.740 +01:00 [INF] Received HTTP response headers after 2018.8273ms - 422
2025-11-30 02:24:39.741 +01:00 [INF] End processing HTTP request after 2024.2405ms - 422
2025-11-30 02:24:39.742 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:24:39.743 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2051.5082ms
2025-11-30 02:24:39.744 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:24:39.745 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2059.2859ms
2025-11-30 02:24:39.747 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2065.9469ms
2025-11-30 02:25:59.006 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:25:59.008 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:25:59.009 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9939ms
2025-11-30 02:25:59.014 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:25:59.016 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:25:59.017 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:25:59.018 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:25:59.019 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:25:59.020 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.4932ms
2025-11-30 02:25:59.022 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.6658ms
2025-11-30 02:25:59.029 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=XbsnaPod_xllpCkt7ojJlA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:25:59.031 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:25:59.032 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:25:59.034 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:25:59.037 +01:00 [INF] SignalR connected: GAEtuP-eWXVBjFcuUbMu9g user:null
2025-11-30 02:25:59.040 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:25:59.044 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='150', @p0='2025-11-30T01:25:59.0424798Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:25:59.0425700Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:25:59.0424798Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:24:26.721841"}' (Size = 4000), @p10='0HNHFH06JI90F:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:25:59.563 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:25:59.566 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:25:59.567 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - 204 null null 3.7443ms
2025-11-30 02:25:59.571 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:25:59.573 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:25:59.573 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:25:59'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:25:59.576 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:25:59'.
2025-11-30 02:25:59.578 +01:00 [INF] HTTP GET /api/Conversations/history/150 started - IP: 127.0.0.1
2025-11-30 02:25:59.580 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:25:59.581 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:25:59.584 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:25:59.587 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:25:59.590 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:25:59.593 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:25:59.595 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 12.128ms
2025-11-30 02:25:59.597 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:25:59.598 +01:00 [INF] HTTP GET /api/Conversations/history/150 completed - Status: 200 - Duration: 20.0975ms
2025-11-30 02:25:59.599 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - 200 null application/json; charset=utf-8 28.3081ms
2025-11-30 02:26:29.013 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:26:29.016 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:26:29.0154009Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:26:29.0154811Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:26:29.0154009Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:25:59.042479"}' (Size = 4000), @p10='0HNHFH06JI90F:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:26:50.171 +01:00 [INF] SignalR disconnected: GAEtuP-eWXVBjFcuUbMu9g user:null ex:null
2025-11-30 02:26:50.172 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:26:50.173 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 51140.8624ms
2025-11-30 02:26:50.175 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 51140.8624ms
2025-11-30 02:26:50.177 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=XbsnaPod_xllpCkt7ojJlA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 51147.5849ms
2025-11-30 02:28:20.237 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:28:20.238 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:28:20.240 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:20.242 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:20.242 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:28:20.243 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:28:20.244 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:28:20.245 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:28:20.246 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:28:20.246 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:28:20.249 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:28:20.252 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:28:20.254 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:28:20.256 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.4114ms
2025-11-30 02:28:20.257 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:28:20.258 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 15.9636ms
2025-11-30 02:28:20.259 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:28:20.260 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 22.984ms
2025-11-30 02:28:20.263 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:28:20.266 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:28:20.267 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:28:20.268 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 19.3068ms
2025-11-30 02:28:20.270 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:28:20.271 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 27.7667ms
2025-11-30 02:28:20.272 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.5957ms
2025-11-30 02:28:20.317 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:28:20.320 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:20.320 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.7443ms
2025-11-30 02:28:20.322 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:28:20.325 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:20.326 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:28:20.327 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:28:20.328 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:28:20.330 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:28:20.331 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:28:20.332 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.3535ms
2025-11-30 02:28:20.333 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:28:20.334 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.0787ms
2025-11-30 02:28:20.335 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.7113ms
2025-11-30 02:28:20.386 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:28:20.387 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:28:20.389 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:20.391 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:20.392 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:28:20.393 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:28:20.394 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:28:20.395 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:28:20.396 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:28:20.397 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:28:20.401 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:28:20.402 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:28:20.404 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:28:20.406 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:28:20.408 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:28:20.409 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:28:20.412 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:20.412 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:28:20.415 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:28:20.415 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 14.8443ms
2025-11-30 02:28:20.418 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:20.418 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:28:20.421 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:20.421 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 28.825ms
2025-11-30 02:28:20.425 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:20.425 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 38.6263ms
2025-11-30 02:28:20.427 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:28:20.431 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:28:22.473 +01:00 [INF] Received HTTP response headers after 2041.5683ms - 422
2025-11-30 02:28:22.475 +01:00 [INF] End processing HTTP request after 2047.2322ms - 422
2025-11-30 02:28:22.476 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:28:22.478 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2078.6496ms
2025-11-30 02:28:22.479 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:28:22.480 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2087.9115ms
2025-11-30 02:28:22.481 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2094.8674ms
2025-11-30 02:28:50.329 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:28:50.330 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:28:50.332 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.334 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.334 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.7399ms
2025-11-30 02:28:50.335 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.9145ms
2025-11-30 02:28:50.341 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:28:50.341 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:28:50.343 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.345 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.346 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:28:50'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:28:50.346 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:28:50'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:28:50.348 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:28:50'.
2025-11-30 02:28:50.349 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:28:50'.
2025-11-30 02:28:50.349 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:28:50.350 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:28:50.351 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:28:50.352 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:28:50.353 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:28:50.353 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:28:50.357 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:28:50.358 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:28:50.359 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:28:50.361 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:28:50.364 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:28:50.3631398Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:28:50.3630698Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:28:50.3630703Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:24:37.480857","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:24:37.480859"}' (Size = 4000), @p8='0HNHFH06JI90H:00000004' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:28:50.3630698Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:28:50.3630703Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:28:50.364 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 7.1298ms
2025-11-30 02:28:50.367 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:28:50.368 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 18.1726ms
2025-11-30 02:28:50.369 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:28:50.370 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 28.6465ms
2025-11-30 02:28:50.371 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 16.1686ms
2025-11-30 02:28:50.375 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:28:50.376 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 26.8935ms
2025-11-30 02:28:50.378 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 37.2104ms
2025-11-30 02:28:50.426 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:28:50.429 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.429 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:28:50.431 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:28:50.431 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:28:50.435 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:28:50.438 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:28:50.440 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:28:50.441 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.3811ms
2025-11-30 02:28:50.442 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:28:50.443 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.7321ms
2025-11-30 02:28:50.445 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 18.1013ms
2025-11-30 02:28:50.461 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:28:50.463 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.463 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.7896ms
2025-11-30 02:28:50.491 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:28:50.493 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.493 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:28:50.494 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:28:50.495 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:28:50.497 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:28:50.498 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:28:50.499 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2106ms
2025-11-30 02:28:50.500 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:28:50.501 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.0714ms
2025-11-30 02:28:50.502 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.2543ms
2025-11-30 02:28:50.509 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:28:50.510 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:28:50.511 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.513 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:50.513 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:28:50.514 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:28:50.515 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:28:50.516 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:28:50.517 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:28:50.517 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:28:50.521 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:28:50.521 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:28:50.525 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:28:50.527 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:28:50.528 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:28:50.529 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:28:50.531 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:50.531 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:28:50.533 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:28:50.534 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.9288ms
2025-11-30 02:28:50.537 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:50.537 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:28:50.540 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.1462ms
2025-11-30 02:28:50.540 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:50.542 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.7319ms
2025-11-30 02:28:50.544 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:28:50.547 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:28:50.548 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:28:51.556 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:28:51.559 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:51.559 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9008ms
2025-11-30 02:28:51.561 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:28:51.564 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:51.565 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:28:51.566 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:28:51.567 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:28:51.568 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.2697ms
2025-11-30 02:28:51.570 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.865ms
2025-11-30 02:28:51.573 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=VNSde1fobGKJktFGOnZfbg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:28:51.576 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:51.577 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:28:51.578 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:28:51.581 +01:00 [INF] SignalR connected: eiAtV9Mr_lniE50tEWPlng user:null
2025-11-30 02:28:51.585 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:28:51.588 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='150', @p0='2025-11-30T01:28:51.5872296Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:28:51.5872988Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='150' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:28:51.5872296Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:26:29.0154"}' (Size = 4000), @p10='0HNHFH06JI90J:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:28:52.084 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:28:52.086 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:52.086 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/150 - 204 null null 2.4435ms
2025-11-30 02:28:52.089 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - null null
2025-11-30 02:28:52.091 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:28:52.091 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:28:52'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:28:52.093 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:28:52'.
2025-11-30 02:28:52.094 +01:00 [INF] HTTP GET /api/Conversations/history/150 started - IP: 127.0.0.1
2025-11-30 02:28:52.095 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:28:52.095 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:28:52.098 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:28:52.101 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:28:52.103 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='150'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:28:52.105 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:28:52.106 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.7359ms
2025-11-30 02:28:52.107 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:28:52.108 +01:00 [INF] HTTP GET /api/Conversations/history/150 completed - Status: 200 - Duration: 14.5807ms
2025-11-30 02:28:52.110 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/150 - 200 null application/json; charset=utf-8 20.8277ms
2025-11-30 02:28:52.590 +01:00 [INF] Received HTTP response headers after 2040.7026ms - 422
2025-11-30 02:28:52.591 +01:00 [INF] End processing HTTP request after 2043.5821ms - 422
2025-11-30 02:28:52.592 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:28:52.593 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2074.7428ms
2025-11-30 02:28:52.594 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:28:52.595 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2081.7097ms
2025-11-30 02:28:52.596 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2087.5426ms
2025-11-30 02:28:53.530 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:13:53.5292119Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:28:53.674 +01:00 [INF] SignalR disconnected: eiAtV9Mr_lniE50tEWPlng user:null ex:null
2025-11-30 02:28:53.675 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:28:53.676 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 2099.4128ms
2025-11-30 02:28:53.678 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=150&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=VNSde1fobGKJktFGOnZfbg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 2104.7162ms
2025-11-30 02:30:05.704 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:30:05.704 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:30:05.707 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:05.709 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:05.710 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:30:05.710 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:30:05.711 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:30:05.712 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:30:05.713 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:30:05.714 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:30:05.717 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:30:05.718 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:30:05.721 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:30:05.723 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:30:05.724 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:30:05.726 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:30:05.727 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 11.6514ms
2025-11-30 02:30:05.728 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:30:05.729 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:30:05.730 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.0524ms
2025-11-30 02:30:05.731 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 21.5028ms
2025-11-30 02:30:05.732 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:30:05.734 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 29.8136ms
2025-11-30 02:30:05.735 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.4358ms
2025-11-30 02:30:05.739 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:30:05.740 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.3292ms
2025-11-30 02:30:05.742 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:05.744 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.9167ms
2025-11-30 02:30:05.746 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:30:05.749 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:05.750 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:30:05.751 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:30:05.752 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:30:05.755 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:30:05.756 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:30:05.757 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 3.3096ms
2025-11-30 02:30:05.758 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:30:05.759 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 9.0168ms
2025-11-30 02:30:05.761 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 14.9945ms
2025-11-30 02:30:05.765 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:30:05.767 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:30:05.767 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:05.769 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:05.769 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:30:05.770 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:30:05.773 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:30:05.774 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:30:05.775 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:30:05.775 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:30:05.779 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:30:05.779 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:30:05.783 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:30:05.786 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:30:05.788 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:30:05.791 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:30:05.793 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:30:05.794 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:30:05.794 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 16.4996ms
2025-11-30 02:30:05.798 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:30:05.799 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 28.8904ms
2025-11-30 02:30:05.797 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:30:05.801 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.9679ms
2025-11-30 02:30:05.812 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:30:05.818 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:30:05.821 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:30:05.824 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:30:05.825 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:30:07.854 +01:00 [INF] Received HTTP response headers after 2028.8377ms - 422
2025-11-30 02:30:07.855 +01:00 [INF] End processing HTTP request after 2031.8562ms - 422
2025-11-30 02:30:07.856 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:30:07.858 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2081.079ms
2025-11-30 02:30:07.859 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:30:07.860 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2090.4638ms
2025-11-30 02:30:07.861 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2096.566ms
2025-11-30 02:30:31.546 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:30:31.548 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:31.548 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.5174ms
2025-11-30 02:30:31.556 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:30:31.558 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:31.559 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:30:31'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:30:31.560 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:30:31'.
2025-11-30 02:30:31.561 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:30:31.562 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:30:31.563 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:30:31.567 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MTMwLCJleHAiOjE3OTYwMDIxMzAsImlhdCI6MTc2NDQ2NjEzMCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.X7t2D4UKfS4wmMFO-Up4bC1ais37BN8U2Nc2v7LOfzI' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:30:31.569 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:30:31.573 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:30:31.577 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:30:31.5754784Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:30:31.5754773Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:30:31.5756714Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482562' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482562,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:30:31.5754784Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:30:31.5754773Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI90H:0000000B' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:30:31.582 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:30:31.583 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 18.2865ms
2025-11-30 02:30:31.584 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:30:31.585 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 23.6539ms
2025-11-30 02:30:31.587 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 30.837ms
2025-11-30 02:30:31.627 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:30:31.630 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:31.630 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.8586ms
2025-11-30 02:30:31.633 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:30:31.635 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:31.635 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:30:31.638 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:30:31.639 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:30:31.640 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 5.0312ms
2025-11-30 02:30:31.642 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 9.4851ms
2025-11-30 02:30:31.646 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=lPJLZSZX67ZbM8ijB-B4WQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:30:31.648 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:31.649 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:30:31.650 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:30:31.655 +01:00 [INF] SignalR connected: u-X0fP2_Y99y_LYbQYJiyA user:null
2025-11-30 02:30:31.659 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:30:31.663 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='155', @p0='2025-11-30T01:30:31.6618170Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:30:31.6619155Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='155' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:30:31.661817Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI90L:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:30:32.102 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/155 - null null
2025-11-30 02:30:32.106 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:32.107 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/155 - 204 null null 4.8364ms
2025-11-30 02:30:32.109 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/155 - null null
2025-11-30 02:30:32.111 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:30:32.112 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:30:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:30:32.114 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:30:32'.
2025-11-30 02:30:32.114 +01:00 [INF] HTTP GET /api/Conversations/history/155 started - IP: 127.0.0.1
2025-11-30 02:30:32.115 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:30:32.116 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:30:32.119 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:30:32.122 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:30:32.125 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:30:32.127 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:30:32.128 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 11.0691ms
2025-11-30 02:30:32.129 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:30:32.130 +01:00 [INF] HTTP GET /api/Conversations/history/155 completed - Status: 200 - Duration: 15.7564ms
2025-11-30 02:30:32.132 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/155 - 200 null application/json; charset=utf-8 22.3552ms
2025-11-30 02:31:01.160 +01:00 [INF] SignalR disconnected: u-X0fP2_Y99y_LYbQYJiyA user:null ex:null
2025-11-30 02:31:01.161 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:31:01.162 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 29512.7332ms
2025-11-30 02:31:01.163 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 29512.7332ms
2025-11-30 02:31:01.164 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=lPJLZSZX67ZbM8ijB-B4WQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 29518.3065ms
2025-11-30 02:31:07.322 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-30 02:31:07.323 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:31:07.325 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.326 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.327 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 4.7791ms
2025-11-30 02:31:07.328 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 204 null null 4.9066ms
2025-11-30 02:31:07.328 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 11
2025-11-30 02:31:07.330 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:31:07.334 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.337 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.338 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:31:07'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:31:07.338 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:31:07'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:31:07.340 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:31:07'.
2025-11-30 02:31:07.341 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:31:07'.
2025-11-30 02:31:07.341 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-30 02:31:07.342 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings started - IP: 127.0.0.1
2025-11-30 02:31:07.343 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:31:07.344 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:31:07.345 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-30 02:31:07.345 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:31:07.348 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-30 02:31:07.349 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:31:07.350 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-30 02:31:07.351 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-30 02:31:07.354 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 6.267ms
2025-11-30 02:31:07.355 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-30T01:31:07.3539154Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='4' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-30T01:31:07.3538419Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-30T01:31:07.3538425Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-30T01:28:50.363069","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-30T01:28:50.36307"}' (Size = 4000), @p8='0HNHFH06JI90H:0000000D' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='4', @p11='2025-11-30T01:31:07.3538419Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-30T01:31:07.3538425Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-30 02:31:07.355 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-30 02:31:07.358 +01:00 [INF] HTTP GET /api/Bots/1/widget-settings completed - Status: 200 - Duration: 15.7715ms
2025-11-30 02:31:07.359 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 200 null application/json; charset=utf-8 28.7435ms
2025-11-30 02:31:07.359 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:31:07.362 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 15.9123ms
2025-11-30 02:31:07.363 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-30 02:31:07.364 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 22.6716ms
2025-11-30 02:31:07.365 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 36.884ms
2025-11-30 02:31:07.431 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:31:07.433 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.434 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:31:07.435 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:31:07.436 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:31:07.439 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:31:07.441 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:31:07.443 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:31:07.444 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.1654ms
2025-11-30 02:31:07.445 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:31:07.446 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 12.4509ms
2025-11-30 02:31:07.447 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 16.1356ms
2025-11-30 02:31:07.455 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:31:07.458 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.458 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.9567ms
2025-11-30 02:31:07.481 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:31:07.483 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.484 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:31:07.485 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:31:07.486 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:31:07.488 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:31:07.489 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:31:07.490 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.4888ms
2025-11-30 02:31:07.491 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:31:07.492 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.1631ms
2025-11-30 02:31:07.493 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.1007ms
2025-11-30 02:31:07.524 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:31:07.524 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:31:07.526 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.528 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:07.528 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:31:07.529 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:31:07.530 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:31:07.531 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:31:07.531 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:31:07.532 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:31:07.535 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:31:07.536 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:31:07.539 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:31:07.541 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:31:07.542 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:31:07.543 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:31:07.545 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:31:07.545 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:31:07.547 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:31:07.548 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.304ms
2025-11-30 02:31:07.550 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:31:07.550 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:31:07.553 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:31:07.553 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.5581ms
2025-11-30 02:31:07.556 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:31:07.556 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 32.101ms
2025-11-30 02:31:07.558 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:31:07.561 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:31:09.599 +01:00 [INF] Received HTTP response headers after 2037.1271ms - 422
2025-11-30 02:31:09.600 +01:00 [INF] End processing HTTP request after 2041.8069ms - 422
2025-11-30 02:31:09.601 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:31:09.603 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2069.4079ms
2025-11-30 02:31:09.604 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:31:09.605 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2076.3627ms
2025-11-30 02:31:09.606 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2081.9494ms
2025-11-30 02:31:15.737 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:31:15.739 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:15.740 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.1906ms
2025-11-30 02:31:15.741 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:31:15.744 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:15.745 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:31:15.746 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:31:15.747 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:31:15.748 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0467ms
2025-11-30 02:31:15.750 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.2391ms
2025-11-30 02:31:15.754 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=q2POQqsd9JPpdEKCDDkMeA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:31:15.756 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:15.756 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:31:15.757 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:31:15.760 +01:00 [INF] SignalR connected: DV_iIW0MaYyxBnwRT1fHoA user:null
2025-11-30 02:31:15.763 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:31:15.766 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='155', @p0='2025-11-30T01:31:15.7653954Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:31:15.7654552Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='155' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:31:15.7653954Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:30:31.661817"}' (Size = 4000), @p10='0HNHFH06JI90N:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:31:16.254 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/155 - null null
2025-11-30 02:31:16.256 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:16.257 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/155 - 204 null null 2.8111ms
2025-11-30 02:31:16.260 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/155 - null null
2025-11-30 02:31:16.262 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:31:16.263 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:31:16'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:31:16.264 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:31:16'.
2025-11-30 02:31:16.265 +01:00 [INF] HTTP GET /api/Conversations/history/155 started - IP: 127.0.0.1
2025-11-30 02:31:16.267 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:31:16.267 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:31:16.271 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:31:16.273 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:31:16.276 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:31:16.278 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:31:16.279 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.6234ms
2025-11-30 02:31:16.280 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:31:16.280 +01:00 [INF] HTTP GET /api/Conversations/history/155 completed - Status: 200 - Duration: 15.0302ms
2025-11-30 02:31:16.282 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/155 - 200 null application/json; charset=utf-8 21.7916ms
2025-11-30 02:31:45.724 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:31:45.727 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='155', @p0='2025-11-30T01:31:45.7263954Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:31:45.7264761Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='155' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:31:45.7263954Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:31:15.765395"}' (Size = 4000), @p10='0HNHFH06JI90N:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:32:15.735 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:32:15.738 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='155', @p0='2025-11-30T01:32:15.7371323Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:32:15.7372021Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='155' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:32:15.7371323Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:31:45.726395"}' (Size = 4000), @p10='0HNHFH06JI90N:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:32:45.749 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='155'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:32:45.752 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='155', @p0='2025-11-30T01:32:45.7516336Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:32:45.7516974Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='155' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:32:45.7516336Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:32:15.737132"}' (Size = 4000), @p10='0HNHFH06JI90N:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:33:06.295 +01:00 [INF] SignalR disconnected: DV_iIW0MaYyxBnwRT1fHoA user:null ex:null
2025-11-30 02:33:06.296 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:33:06.297 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 110540.4175ms
2025-11-30 02:33:06.298 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 110540.4175ms
2025-11-30 02:33:06.300 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=155&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=q2POQqsd9JPpdEKCDDkMeA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 110546.0663ms
2025-11-30 02:33:09.723 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:33:09.724 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:33:09.726 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:09.727 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:09.728 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:33:09.729 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:33:09.730 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:33:09.731 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:09.731 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:33:09.733 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:33:09.737 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:33:09.739 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:33:09.741 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:33:09.744 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:33:09.745 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:33:09.746 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:33:09.748 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 13.1433ms
2025-11-30 02:33:09.748 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:09.749 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:33:09.750 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.4182ms
2025-11-30 02:33:09.751 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 23.1483ms
2025-11-30 02:33:09.752 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:09.753 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 30.1171ms
2025-11-30 02:33:09.754 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.4278ms
2025-11-30 02:33:09.758 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.1709ms
2025-11-30 02:33:09.758 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:33:09.762 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:09.763 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.1773ms
2025-11-30 02:33:09.764 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:33:09.767 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:09.768 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:33:09.769 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:33:09.770 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:33:09.771 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:33:09.772 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:09.773 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.0249ms
2025-11-30 02:33:09.774 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:33:09.775 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.0411ms
2025-11-30 02:33:09.776 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.1185ms
2025-11-30 02:33:09.803 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:33:09.804 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:33:09.805 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:09.808 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:09.808 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:33:09.809 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:33:09.810 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:33:09.811 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:09.811 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:33:09.812 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:33:09.815 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:33:09.816 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:33:09.818 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:33:09.820 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:33:09.822 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:33:09.823 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:33:09.825 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:09.825 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:09.827 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:33:09.827 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.2605ms
2025-11-30 02:33:09.829 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:09.830 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:09.832 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:09.832 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.4959ms
2025-11-30 02:33:09.835 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:09.836 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.9275ms
2025-11-30 02:33:09.837 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:33:09.840 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:33:11.881 +01:00 [INF] Received HTTP response headers after 2039.5438ms - 422
2025-11-30 02:33:11.882 +01:00 [INF] End processing HTTP request after 2044.8251ms - 422
2025-11-30 02:33:11.883 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:33:11.885 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2071.0894ms
2025-11-30 02:33:11.886 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:33:11.887 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2078.3054ms
2025-11-30 02:33:11.888 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2084.6107ms
2025-11-30 02:33:16.641 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:33:16.643 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:16.643 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.5131ms
2025-11-30 02:33:16.645 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:33:16.648 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:16.649 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:33:16'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:33:16.651 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:33:16'.
2025-11-30 02:33:16.651 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:33:16.653 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:33:16.654 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:33:16.656 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MjY3LCJleHAiOjE3OTYwMDIyNjcsImlhdCI6MTc2NDQ2NjI2NywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.ZIX_ZLMglfTAV17A-N2d9XkTXv9iKcUrSFSyIGFeTvw' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:33:16.659 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:33:16.661 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:33:16.664 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:33:16.6633211Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:33:16.6633206Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:33:16.6634489Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482561' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482561,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:33:16.6633211Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:33:16.6633206Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI90H:00000014' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:33:16.669 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:16.670 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.9436ms
2025-11-30 02:33:16.671 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:33:16.672 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.1158ms
2025-11-30 02:33:16.673 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.1648ms
2025-11-30 02:33:16.677 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=156&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:33:16.679 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:16.680 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=156&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9257ms
2025-11-30 02:33:16.682 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=156&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:33:16.685 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:16.686 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:33:16.687 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:33:16.688 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:33:16.689 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6748ms
2025-11-30 02:33:16.690 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=156&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.3012ms
2025-11-30 02:33:16.711 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=156&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=oKs7NaLtWL-H38QBvCO8vQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:33:16.713 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:16.714 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:33:16.715 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:33:16.719 +01:00 [INF] SignalR connected: WxEWBEGN_vphKfmQ2rmxPA user:null
2025-11-30 02:33:16.722 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='156'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:33:16.725 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='156', @p0='2025-11-30T01:33:16.7242671Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:33:16.7243411Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='156' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:33:16.7242671Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI90P:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:33:17.194 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/156 - null null
2025-11-30 02:33:17.197 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:17.197 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/156 - 204 null null 2.8179ms
2025-11-30 02:33:17.200 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/156 - null null
2025-11-30 02:33:17.202 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:17.203 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:33:17'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:33:17.205 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:33:17'.
2025-11-30 02:33:17.206 +01:00 [INF] HTTP GET /api/Conversations/history/156 started - IP: 127.0.0.1
2025-11-30 02:33:17.207 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:33:17.208 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:33:17.210 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='156'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:33:17.213 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='156'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:33:17.215 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='156'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:33:17.217 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:33:17.218 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.9433ms
2025-11-30 02:33:17.219 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:33:17.220 +01:00 [INF] HTTP GET /api/Conversations/history/156 completed - Status: 200 - Duration: 14.1564ms
2025-11-30 02:33:17.221 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/156 - 200 null application/json; charset=utf-8 21.0302ms
2025-11-30 02:33:19.765 +01:00 [INF] SignalR disconnected: WxEWBEGN_vphKfmQ2rmxPA user:null ex:null
2025-11-30 02:33:19.766 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:33:19.767 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 3053.4234ms
2025-11-30 02:33:19.769 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=156&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=oKs7NaLtWL-H38QBvCO8vQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 3057.7858ms
2025-11-30 02:33:53.547 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:18:53.5461649Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:33:59.492 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:33:59.492 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:33:59.494 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:59.496 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:59.497 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:33:59.498 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:33:59.499 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:33:59.501 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:59.501 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:33:59.502 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:33:59.506 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:33:59.506 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:33:59.508 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:33:59.510 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:33:59.511 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:33:59.513 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:33:59.515 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 11.0648ms
2025-11-30 02:33:59.516 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:59.517 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:33:59.518 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.4066ms
2025-11-30 02:33:59.519 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 21.8997ms
2025-11-30 02:33:59.520 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:59.521 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 29.2789ms
2025-11-30 02:33:59.522 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.1214ms
2025-11-30 02:33:59.526 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.6035ms
2025-11-30 02:33:59.565 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:33:59.568 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:59.569 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.1356ms
2025-11-30 02:33:59.580 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:33:59.583 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:59.583 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:33:59.584 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:33:59.585 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:33:59.587 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:33:59.587 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:59.589 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.4793ms
2025-11-30 02:33:59.590 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:33:59.591 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.5578ms
2025-11-30 02:33:59.592 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.6405ms
2025-11-30 02:33:59.631 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:33:59.631 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:33:59.633 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:59.636 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:33:59.636 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:33:59.637 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:33:59.638 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:33:59.639 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:59.640 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:33:59.641 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:33:59.644 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:33:59.644 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:33:59.647 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:33:59.649 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:33:59.651 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:33:59.652 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:33:59.655 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:33:59.655 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:59.656 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.4133ms
2025-11-30 02:33:59.658 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:33:59.659 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:33:59.661 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:59.661 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.5803ms
2025-11-30 02:33:59.664 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:59.665 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.7859ms
2025-11-30 02:33:59.668 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:33:59.672 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:33:59.673 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:34:01.724 +01:00 [INF] Received HTTP response headers after 2049.5932ms - 422
2025-11-30 02:34:01.725 +01:00 [INF] End processing HTTP request after 2052.9912ms - 422
2025-11-30 02:34:01.726 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:01.728 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2085.7976ms
2025-11-30 02:34:01.729 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:34:01.730 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2093.2566ms
2025-11-30 02:34:01.731 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2100.7905ms
2025-11-30 02:34:05.487 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:34:05.487 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:34:05.489 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:05.491 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:05.492 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:34:05.492 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:34:05.494 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:34:05.495 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:05.495 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:34:05.496 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:34:05.499 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:34:05.500 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:34:05.502 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:34:05.504 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:34:05.505 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:05.506 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:34:05.508 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.1949ms
2025-11-30 02:34:05.508 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:05.509 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:34:05.511 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.5189ms
2025-11-30 02:34:05.511 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 19.4684ms
2025-11-30 02:34:05.512 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:05.514 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 27.2535ms
2025-11-30 02:34:05.515 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.4931ms
2025-11-30 02:34:05.518 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:34:05.519 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.6365ms
2025-11-30 02:34:05.521 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:05.524 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 5.607ms
2025-11-30 02:34:05.525 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:34:05.528 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:05.529 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:34:05.530 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:34:05.531 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:34:05.533 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:34:05.534 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:05.535 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.279ms
2025-11-30 02:34:05.536 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:34:05.536 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.9016ms
2025-11-30 02:34:05.538 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.3736ms
2025-11-30 02:34:05.541 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:34:05.543 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:34:05.543 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:05.545 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:05.546 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:34:05.546 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:34:05.548 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:34:05.549 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:05.550 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:34:05.550 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:34:05.554 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:34:05.554 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:34:05.556 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:34:05.558 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:34:05.560 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:34:05.561 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:34:05.563 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:05.563 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:05.565 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:34:05.566 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.8635ms
2025-11-30 02:34:05.569 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:05.569 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:05.572 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:05.572 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.0447ms
2025-11-30 02:34:05.575 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:05.576 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.4283ms
2025-11-30 02:34:05.578 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:34:05.581 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:34:05.584 +01:00 [INF] Received HTTP response headers after 1.4813ms - 422
2025-11-30 02:34:05.585 +01:00 [INF] End processing HTTP request after 7.764ms - 422
2025-11-30 02:34:05.587 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:05.588 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 36.131ms
2025-11-30 02:34:05.589 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:34:05.590 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 44.0435ms
2025-11-30 02:34:05.591 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 49.9415ms
2025-11-30 02:34:14.242 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:34:14.242 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:34:14.244 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.246 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.247 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:34:14.248 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:34:14.249 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:34:14.250 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:14.251 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:34:14.252 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:34:14.255 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:34:14.256 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:34:14.258 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:34:14.260 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:34:14.261 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:14.263 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:34:14.265 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 11.1625ms
2025-11-30 02:34:14.265 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:14.267 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:34:14.268 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.8835ms
2025-11-30 02:34:14.269 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 21.8402ms
2025-11-30 02:34:14.270 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:14.271 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 29.6337ms
2025-11-30 02:34:14.273 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 24.9168ms
2025-11-30 02:34:14.275 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:34:14.277 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.5782ms
2025-11-30 02:34:14.279 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.283 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 7.4616ms
2025-11-30 02:34:14.286 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:34:14.288 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.289 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:34:14.290 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:34:14.291 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:34:14.293 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:34:14.293 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:14.294 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.3182ms
2025-11-30 02:34:14.296 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:34:14.296 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.8876ms
2025-11-30 02:34:14.298 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.6121ms
2025-11-30 02:34:14.322 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:34:14.322 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:34:14.324 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.326 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.327 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:34:14.327 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:34:14.328 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:34:14.329 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:14.331 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:34:14.332 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:34:14.335 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:34:14.336 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:34:14.338 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:34:14.340 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:34:14.341 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:34:14.342 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:34:14.344 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:14.345 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:14.347 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:34:14.348 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 12.813ms
2025-11-30 02:34:14.350 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:14.350 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:14.352 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:14.353 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.6759ms
2025-11-30 02:34:14.355 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:14.356 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.5576ms
2025-11-30 02:34:14.358 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:34:14.361 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:34:14.625 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:34:14.627 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.628 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.6577ms
2025-11-30 02:34:14.633 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:34:14.635 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.636 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:34:14'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:34:14.638 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:34:14'.
2025-11-30 02:34:14.638 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:34:14.640 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:34:14.640 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:34:14.643 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MjY3LCJleHAiOjE3OTYwMDIyNjcsImlhdCI6MTc2NDQ2NjI2NywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.ZIX_ZLMglfTAV17A-N2d9XkTXv9iKcUrSFSyIGFeTvw' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:34:14.646 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:34:14.649 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:34:14.652 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:34:14.6513858Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:34:14.6513854Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:34:14.6515136Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482560' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482560,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:34:14.6513858Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:34:14.6513854Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI90H:0000001F' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:34:14.657 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:14.658 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 15.8504ms
2025-11-30 02:34:14.659 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:34:14.660 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.0518ms
2025-11-30 02:34:14.661 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.9809ms
2025-11-30 02:34:14.668 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=157&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:34:14.671 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.671 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=157&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.1833ms
2025-11-30 02:34:14.703 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=157&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:34:14.706 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.708 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:34:14.710 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:34:14.710 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:34:14.711 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.4112ms
2025-11-30 02:34:14.713 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=157&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 9.8134ms
2025-11-30 02:34:14.719 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=157&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=C3e-CKljG4mnSJuHiWQEYg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:34:14.721 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:14.721 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:34:14.722 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:34:14.726 +01:00 [INF] SignalR connected: OlriPqEoSxtwkTrOxtzCCQ user:null
2025-11-30 02:34:14.729 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='157'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:34:14.733 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='157', @p0='2025-11-30T01:34:14.7315579Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:34:14.7316603Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='157' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:34:14.7315579Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI90T:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:34:15.182 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/157 - null null
2025-11-30 02:34:15.184 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:15.185 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/157 - 204 null null 2.4795ms
2025-11-30 02:34:15.187 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/157 - null null
2025-11-30 02:34:15.189 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:15.190 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:34:15'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:34:15.191 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:34:15'.
2025-11-30 02:34:15.193 +01:00 [INF] HTTP GET /api/Conversations/history/157 started - IP: 127.0.0.1
2025-11-30 02:34:15.194 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:34:15.194 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:34:15.197 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='157'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:34:15.200 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='157'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:34:15.203 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='157'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:34:15.205 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:15.207 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.9855ms
2025-11-30 02:34:15.208 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:34:15.209 +01:00 [INF] HTTP GET /api/Conversations/history/157 completed - Status: 200 - Duration: 16.1072ms
2025-11-30 02:34:15.210 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/157 - 200 null application/json; charset=utf-8 22.8645ms
2025-11-30 02:34:16.396 +01:00 [INF] Received HTTP response headers after 2034.8964ms - 422
2025-11-30 02:34:16.398 +01:00 [INF] End processing HTTP request after 2040.1933ms - 422
2025-11-30 02:34:16.399 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:16.400 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2067.0086ms
2025-11-30 02:34:16.401 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:34:16.402 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2075.8669ms
2025-11-30 02:34:16.404 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2082.0208ms
2025-11-30 02:34:16.820 +01:00 [INF] SignalR disconnected: OlriPqEoSxtwkTrOxtzCCQ user:null ex:null
2025-11-30 02:34:16.821 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:34:16.822 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 2100.7598ms
2025-11-30 02:34:16.824 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=157&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=C3e-CKljG4mnSJuHiWQEYg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 2105.033ms
2025-11-30 02:34:59.741 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:34:59.742 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:34:59.744 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:59.746 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:59.747 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:34:59.747 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:34:59.748 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:34:59.750 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:59.751 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:34:59.752 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:34:59.755 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:34:59.756 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:34:59.758 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:34:59.759 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:34:59.761 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:34:59.762 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:34:59.764 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 10.5808ms
2025-11-30 02:34:59.764 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:59.765 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:34:59.767 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.8627ms
2025-11-30 02:34:59.768 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 20.7693ms
2025-11-30 02:34:59.769 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:59.770 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 28.9595ms
2025-11-30 02:34:59.771 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 23.6984ms
2025-11-30 02:34:59.775 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.6241ms
2025-11-30 02:34:59.775 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:34:59.780 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:59.781 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 5.6957ms
2025-11-30 02:34:59.785 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:34:59.787 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:59.787 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:34:59.788 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:34:59.789 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:34:59.791 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:34:59.791 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:59.792 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.3923ms
2025-11-30 02:34:59.794 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:34:59.794 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.1445ms
2025-11-30 02:34:59.796 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 11.3041ms
2025-11-30 02:34:59.834 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:34:59.835 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:34:59.837 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:59.838 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:34:59.839 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:34:59.840 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:34:59.841 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:34:59.842 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:59.842 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:34:59.843 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:34:59.846 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:34:59.847 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:34:59.849 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:34:59.851 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:34:59.853 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:34:59.854 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:34:59.857 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:59.857 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:34:59.859 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:34:59.859 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.4974ms
2025-11-30 02:34:59.862 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:59.863 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:34:59.865 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:59.866 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.0149ms
2025-11-30 02:34:59.868 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:34:59.869 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 33.7899ms
2025-11-30 02:34:59.871 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:34:59.874 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:35:00.055 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:35:00.057 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.058 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.5806ms
2025-11-30 02:35:00.065 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:35:00.067 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.068 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:35:00'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:35:00.069 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:35:00'.
2025-11-30 02:35:00.070 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:35:00.071 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:35:00.072 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:35:00.074 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MjY3LCJleHAiOjE3OTYwMDIyNjcsImlhdCI6MTc2NDQ2NjI2NywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.ZIX_ZLMglfTAV17A-N2d9XkTXv9iKcUrSFSyIGFeTvw' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:35:00.077 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:35:00.080 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:35:00.084 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:35:00.0829575Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:35:00.0829566Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:35:00.0831437Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482559' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482559,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:35:00.0829575Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:35:00.0829566Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI90H:00000024' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:35:00.089 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:35:00.090 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 16.7637ms
2025-11-30 02:35:00.091 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:35:00.091 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.548ms
2025-11-30 02:35:00.093 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 28.1778ms
2025-11-30 02:35:00.133 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:35:00.136 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.137 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.4095ms
2025-11-30 02:35:00.139 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:35:00.141 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.142 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:35:00.143 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:35:00.144 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:35:00.145 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.4962ms
2025-11-30 02:35:00.146 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.2277ms
2025-11-30 02:35:00.151 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=fBQ-FrnxpoZpMGOBfyRJ8Q&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:35:00.153 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.154 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:35:00.155 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:35:00.159 +01:00 [INF] SignalR connected: hx5kl7UtkhHMATE1D7yabQ user:null
2025-11-30 02:35:00.162 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:35:00.166 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='158', @p0='2025-11-30T01:35:00.1646445Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:35:00.1647381Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:35:00.1646445Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI90V:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:35:00.623 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/158 - null null
2025-11-30 02:35:00.625 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.625 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/158 - 204 null null 2.7597ms
2025-11-30 02:35:00.628 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/158 - null null
2025-11-30 02:35:00.630 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:00.631 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:35:00'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:35:00.632 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:35:00'.
2025-11-30 02:35:00.633 +01:00 [INF] HTTP GET /api/Conversations/history/158 started - IP: 127.0.0.1
2025-11-30 02:35:00.635 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:35:00.635 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:35:00.638 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:35:00.641 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:35:00.644 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:35:00.646 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:35:00.648 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.9656ms
2025-11-30 02:35:00.649 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:35:00.650 +01:00 [INF] HTTP GET /api/Conversations/history/158 completed - Status: 200 - Duration: 16.7171ms
2025-11-30 02:35:00.651 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/158 - 200 null application/json; charset=utf-8 23.4043ms
2025-11-30 02:35:01.897 +01:00 [INF] Received HTTP response headers after 2021.8759ms - 422
2025-11-30 02:35:01.898 +01:00 [INF] End processing HTTP request after 2027.35ms - 422
2025-11-30 02:35:01.899 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:35:01.901 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2056.5173ms
2025-11-30 02:35:01.902 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:35:01.903 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2063.8509ms
2025-11-30 02:35:01.904 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2069.8538ms
2025-11-30 02:35:08.120 +01:00 [INF] SignalR disconnected: hx5kl7UtkhHMATE1D7yabQ user:null ex:null
2025-11-30 02:35:08.121 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:35:08.122 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:35:08.123 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.124 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 7970.533ms
2025-11-30 02:35:08.125 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:35:08.126 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 7970.533ms
2025-11-30 02:35:08.127 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:35:08.128 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:35:08.129 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=fBQ-FrnxpoZpMGOBfyRJ8Q&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 7977.9093ms
2025-11-30 02:35:08.130 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:35:08.132 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.136 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:35:08.137 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:35:08.137 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:35:08.139 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:35:08.140 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:35:08.141 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:35:08.144 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:35:08.144 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.4858ms
2025-11-30 02:35:08.147 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:35:08.147 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:35:08.149 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:35:08.150 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 25.2173ms
2025-11-30 02:35:08.151 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:35:08.152 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 31.6083ms
2025-11-30 02:35:08.154 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.7126ms
2025-11-30 02:35:08.158 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:35:08.158 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 22.4685ms
2025-11-30 02:35:08.160 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 31.651ms
2025-11-30 02:35:08.174 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:35:08.176 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.177 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.692ms
2025-11-30 02:35:08.179 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:35:08.180 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:35:08.182 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.183 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.184 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:35:08.185 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 4.7499ms
2025-11-30 02:35:08.186 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:35:08.187 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:35:08.189 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:35:08.191 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.192 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 8.0166ms
2025-11-30 02:35:08.193 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:35:08.193 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=hO9sRMjFFNcwirVhwUKjLQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:35:08.194 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 15.5893ms
2025-11-30 02:35:08.196 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:35:08.198 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.201 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:35:08.202 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:35:08.203 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:35:08.204 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:35:08.204 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:35:08.206 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 3.4471ms
2025-11-30 02:35:08.207 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:35:08.208 +01:00 [INF] SignalR connected: vNQGZ20o0xbJHjhBzDHZeQ user:null
2025-11-30 02:35:08.208 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 15.23ms
2025-11-30 02:35:08.211 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 23.2936ms
2025-11-30 02:35:08.213 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:35:08.214 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:35:08.217 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='158', @p0='2025-11-30T01:35:08.2158488Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:35:08.2159319Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:35:08.2158488Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:35:00.164644"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:35:08.217 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.219 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:35:08.221 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:35:08.222 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:35:08.224 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:35:08.227 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:35:08.230 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:35:08.232 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:35:08.235 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:35:08.237 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:35:08.239 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:35:08.241 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:35:08.243 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:35:08.244 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:35:08.257 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:35:08.259 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:35:08.260 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:35:08.261 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:35:08.263 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:35:08.266 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:35:08.268 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:35:08.270 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:35:08.270 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:35:08.272 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 7.3393ms
2025-11-30 02:35:08.273 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:35:08.274 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 13.5149ms
2025-11-30 02:35:08.275 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 17.7252ms
2025-11-30 02:35:10.286 +01:00 [INF] Received HTTP response headers after 2041.5013ms - 422
2025-11-30 02:35:10.288 +01:00 [INF] End processing HTTP request after 2044.5534ms - 422
2025-11-30 02:35:10.289 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:35:10.290 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2067.4555ms
2025-11-30 02:35:10.292 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:35:10.293 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2073.0963ms
2025-11-30 02:35:10.294 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2079.9111ms
2025-11-30 02:35:38.128 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:35:38.132 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='158', @p0='2025-11-30T01:35:38.1310337Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:35:38.1311059Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:35:38.1310337Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:35:08.215848"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:36:08.153 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:36:08.157 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='158', @p0='2025-11-30T01:36:08.1556076Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:36:08.1556997Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:36:08.1556076Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:35:38.131033"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:36:38.161 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:36:38.165 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='158', @p0='2025-11-30T01:36:38.1640764Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:36:38.1641608Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:36:38.1640764Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:36:08.155607"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:37:08.161 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:37:08.165 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='158', @p0='2025-11-30T01:37:08.1640111Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:37:08.1640752Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:37:08.1640111Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:36:38.164076"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:37:38.162 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:37:38.165 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='158', @p0='2025-11-30T01:37:38.1645036Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:37:38.1645897Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:37:38.1645036Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:37:08.164011"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:38:08.169 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:38:08.172 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='158', @p0='2025-11-30T01:38:08.1712734Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:38:08.1713368Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='158' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:38:08.1712734Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-30T01:37:38.164503"}' (Size = 4000), @p10='0HNHFH06JI911:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:38:38.146 +01:00 [INF] SignalR disconnected: vNQGZ20o0xbJHjhBzDHZeQ user:null ex:null
2025-11-30 02:38:38.148 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:38:38.149 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 209947.1249ms
2025-11-30 02:38:38.150 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 209947.1249ms
2025-11-30 02:38:38.151 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=158&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=hO9sRMjFFNcwirVhwUKjLQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 209958.2225ms
2025-11-30 02:38:38.152 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/158/leave-mobile - null null
2025-11-30 02:38:38.156 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:38:38.157 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/158/leave-mobile - 204 null null 5.2072ms
2025-11-30 02:38:38.160 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/158/leave-mobile - application/json 0
2025-11-30 02:38:38.162 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:38:38.163 +01:00 [INF] HTTP POST /api/conversations/158/leave-mobile started - IP: 127.0.0.1
2025-11-30 02:38:38.164 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.LeaveMobileSession (Voia.Api)'
2025-11-30 02:38:38.165 +01:00 [INF] Route matched with {action = "LeaveMobileSession", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LeaveMobileSession(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:38:38.167 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='158'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:38:38.170 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p3='158', @p0='2025-11-30T01:38:38.1694270Z' (Nullable = true) (DbType = DateTime), @p1='2025-11-30T01:38:38.1694270Z' (Nullable = true) (DbType = DateTime), @p2='closed' (Nullable = false) (Size = 255), @p4='UPDATE' (Size = 100), @p5='2025-11-30T01:38:38.1695028Z' (DbType = DateTime), @p6='Updated Conversation' (Size = 4000), @p7='158' (Nullable = true), @p8='Conversation' (Size = 100), @p9='127.0.0.1' (Size = 45), @p10='{"ClosedAt":"2025-11-30T01:38:38.169427Z","ExpiresAt":"2025-11-30T01:38:38.169427Z","Status":"closed"}' (Size = 4000), @p11='{"ClosedAt":null,"ExpiresAt":null,"Status":"active"}' (Size = 4000), @p12='0HNHFH06JI912:00000002' (Size = 50), @p13='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p14=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `closed_at` = @p0, `expires_at` = @p1, `status` = @p2
WHERE `Id` = @p3;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:38:38.176 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType99`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:38:38.178 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.LeaveMobileSession (Voia.Api) in 12.0395ms
2025-11-30 02:38:38.179 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.LeaveMobileSession (Voia.Api)'
2025-11-30 02:38:38.180 +01:00 [INF] HTTP POST /api/conversations/158/leave-mobile completed - Status: 200 - Duration: 17.1645ms
2025-11-30 02:38:38.181 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/158/leave-mobile - 200 null application/json; charset=utf-8 21.4117ms
2025-11-30 02:38:53.555 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:23:53.5544657Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:40:05.084 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 02:40:05.086 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:40:05.087 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 02:40:05.088 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:40:05.089 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:40:05.092 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 02:40:05.095 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 02:40:05.097 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:40:05.098 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 7.6092ms
2025-11-30 02:40:05.099 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 02:40:05.100 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 13.4231ms
2025-11-30 02:40:05.101 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 17.7618ms
2025-11-30 02:40:05.130 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:40:05.133 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:40:05.133 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.0155ms
2025-11-30 02:40:05.136 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 02:40:05.139 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:40:05.139 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 02:40:05.141 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:40:05.142 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:40:05.144 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 02:40:05.145 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:40:05.146 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.7913ms
2025-11-30 02:40:05.147 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 02:40:05.148 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.6943ms
2025-11-30 02:40:05.150 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.427ms
2025-11-30 02:40:05.157 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 02:40:05.158 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 02:40:05.160 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:40:05.161 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:40:05.162 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 02:40:05.163 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 02:40:05.164 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:40:05.165 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:40:05.166 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 02:40:05.167 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 02:40:05.170 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 02:40:05.174 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 02:40:05.176 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 02:40:05.178 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 02:40:05.179 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 02:40:05.181 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 02:40:05.183 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 02:40:05.184 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 02:40:05.187 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:40:05.187 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:40:05.188 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 18.4885ms
2025-11-30 02:40:05.191 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 02:40:05.191 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 02:40:05.194 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 02:40:05.194 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 31.2898ms
2025-11-30 02:40:05.196 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:40:05.197 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 38.9634ms
2025-11-30 02:40:05.198 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 02:40:07.244 +01:00 [INF] Received HTTP response headers after 2042.4747ms - 422
2025-11-30 02:40:07.245 +01:00 [INF] End processing HTTP request after 2049.5379ms - 422
2025-11-30 02:40:07.246 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:40:07.248 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2079.5623ms
2025-11-30 02:40:07.249 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 02:40:07.250 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2087.7016ms
2025-11-30 02:40:07.251 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2093.8869ms
2025-11-30 02:43:53.574 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:28:53.5706989Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:46:30.200 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:46:30.202 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.203 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.5573ms
2025-11-30 02:46:30.205 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:46:30.207 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.208 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:30'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:46:30.209 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:30'.
2025-11-30 02:46:30.210 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:46:30.211 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:46:30.213 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:46:30.217 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MjY3LCJleHAiOjE3OTYwMDIyNjcsImlhdCI6MTc2NDQ2NjI2NywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.ZIX_ZLMglfTAV17A-N2d9XkTXv9iKcUrSFSyIGFeTvw' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:46:30.219 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:46:30.222 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:46:30.225 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:46:30.2239247Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:46:30.2239242Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:46:30.2241011Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482558' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482558,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:46:30.2239247Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:46:30.2239242Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI914:00000001' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:46:30.233 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:46:30.234 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 19.2129ms
2025-11-30 02:46:30.235 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:46:30.236 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 25.4668ms
2025-11-30 02:46:30.237 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 32.3159ms
2025-11-30 02:46:30.313 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=159&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:46:30.315 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.316 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=159&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 3.2705ms
2025-11-30 02:46:30.319 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=159&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:46:30.321 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.322 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:46:30.323 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:46:30.324 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:46:30.325 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.0376ms
2025-11-30 02:46:30.326 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=159&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.4872ms
2025-11-30 02:46:30.333 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=159&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=qVBZ4bFp_DwW2CDUAoNcWA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:46:30.335 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.336 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:46:30.337 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:46:30.340 +01:00 [INF] SignalR connected: 2OpwnYv-zis4SOYc8jjmeA user:null
2025-11-30 02:46:30.349 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='159'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:46:30.352 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='159', @p0='2025-11-30T01:46:30.3517023Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:46:30.3517745Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='159' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:46:30.3517023Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI916:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:46:30.759 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/159 - null null
2025-11-30 02:46:30.761 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.763 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/159 - 204 null null 3.8087ms
2025-11-30 02:46:30.765 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/159 - null null
2025-11-30 02:46:30.767 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:30.768 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:30'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:46:30.769 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:30'.
2025-11-30 02:46:30.770 +01:00 [INF] HTTP GET /api/Conversations/history/159 started - IP: 127.0.0.1
2025-11-30 02:46:30.771 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:46:30.771 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:46:30.774 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='159'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:46:30.776 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='159'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:46:30.779 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='159'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:46:30.782 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:46:30.783 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.6089ms
2025-11-30 02:46:30.784 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:46:30.785 +01:00 [INF] HTTP GET /api/Conversations/history/159 completed - Status: 200 - Duration: 15.5341ms
2025-11-30 02:46:30.787 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/159 - 200 null application/json; charset=utf-8 21.4962ms
2025-11-30 02:46:31.185 +01:00 [INF] SignalR disconnected: 2OpwnYv-zis4SOYc8jjmeA user:null ex:null
2025-11-30 02:46:31.186 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:46:31.187 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 851.0126ms
2025-11-30 02:46:31.188 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=159&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=qVBZ4bFp_DwW2CDUAoNcWA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 855.0535ms
2025-11-30 02:46:32.970 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:46:32.972 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:32.973 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:32'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:46:32.975 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:32'.
2025-11-30 02:46:32.976 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:46:32.977 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:46:32.978 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:46:32.981 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MjY3LCJleHAiOjE3OTYwMDIyNjcsImlhdCI6MTc2NDQ2NjI2NywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.ZIX_ZLMglfTAV17A-N2d9XkTXv9iKcUrSFSyIGFeTvw' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:46:32.983 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:46:32.986 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:46:32.989 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:46:32.9878459Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:46:32.9878455Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:46:32.9879670Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482557' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482557,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:46:32.9878459Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:46:32.9878455Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI914:00000003' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:46:32.993 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:46:32.994 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.4385ms
2025-11-30 02:46:32.995 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:46:32.996 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.4262ms
2025-11-30 02:46:32.998 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.6261ms
2025-11-30 02:46:33.003 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=160&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:46:33.005 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:33.005 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=160&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.4612ms
2025-11-30 02:46:33.007 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=160&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:46:33.009 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:33.010 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:46:33.012 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:46:33.013 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:46:33.014 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 3.5092ms
2025-11-30 02:46:33.015 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=160&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 8.3034ms
2025-11-30 02:46:33.039 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=160&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=RI-7oqF9m2Osv-x0dTEoRA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:46:33.041 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:33.042 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:46:33.043 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:46:33.047 +01:00 [INF] SignalR connected: hHGDdOFNYF3OSeK24-vv9w user:null
2025-11-30 02:46:33.053 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='160'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:46:33.056 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='160', @p0='2025-11-30T01:46:33.0551209Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:46:33.0551831Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='160' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:46:33.0551209Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI917:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:46:33.524 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/160 - null null
2025-11-30 02:46:33.526 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:33.527 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/160 - 204 null null 2.7851ms
2025-11-30 02:46:33.530 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/160 - null null
2025-11-30 02:46:33.532 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:33.533 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:33'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:46:33.534 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:33'.
2025-11-30 02:46:33.535 +01:00 [INF] HTTP GET /api/Conversations/history/160 started - IP: 127.0.0.1
2025-11-30 02:46:33.537 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:46:33.537 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:46:33.540 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='160'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:46:33.542 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='160'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:46:33.545 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='160'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:46:33.548 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:46:33.549 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 10.7247ms
2025-11-30 02:46:33.550 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:46:33.551 +01:00 [INF] HTTP GET /api/Conversations/history/160 completed - Status: 200 - Duration: 15.8967ms
2025-11-30 02:46:33.552 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/160 - 200 null application/json; charset=utf-8 22.7325ms
2025-11-30 02:46:34.333 +01:00 [INF] SignalR disconnected: hHGDdOFNYF3OSeK24-vv9w user:null ex:null
2025-11-30 02:46:34.334 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:46:34.335 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1292.8328ms
2025-11-30 02:46:34.336 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=160&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=RI-7oqF9m2Osv-x0dTEoRA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1296.9168ms
2025-11-30 02:46:35.954 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-30 02:46:35.956 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:35.957 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.8313ms
2025-11-30 02:46:35.959 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 407
2025-11-30 02:46:35.961 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:35.962 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:35'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:46:35.964 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:35'.
2025-11-30 02:46:35.965 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-30 02:46:35.966 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:46:35.967 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:46:35.969 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0NDY2MjY3LCJleHAiOjE3OTYwMDIyNjcsImlhdCI6MTc2NDQ2NjI2NywiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.ZIX_ZLMglfTAV17A-N2d9XkTXv9iKcUrSFSyIGFeTvw' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:46:35.971 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-30 02:46:35.974 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='b16b83f4a4d41d47b20bac486fe5d74882338d7592d8a7f3b0c9c19eb7d18128' (Size = 256), @__8__locals1_dto_BotId_2='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-30 02:46:35.977 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='False', @p1='False', @p2='1', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-30T01:46:35.9759706Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='4' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-30T01:46:35.9759698Z' (DbType = DateTime), @p16='5', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-30T01:46:35.9761207Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482556' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482556,"ActiveMobileSession":false,"Blocked":false,"BotId":1,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-30T01:46:35.9759706Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":4,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-30T01:46:35.9759698Z","UserId":5,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHFH06JI914:00000005' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:46:35.981 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 02:46:35.983 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 14.7881ms
2025-11-30 02:46:35.984 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-30 02:46:35.985 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 20.0105ms
2025-11-30 02:46:35.986 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 27.4831ms
2025-11-30 02:46:35.991 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=161&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null null
2025-11-30 02:46:35.993 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:35.994 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=161&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 204 null null 2.9577ms
2025-11-30 02:46:36.019 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=161&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - null 0
2025-11-30 02:46:36.021 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:36.022 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-30 02:46:36.023 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-30 02:46:36.024 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-30 02:46:36.025 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.9915ms
2025-11-30 02:46:36.026 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=161&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&negotiateVersion=1 - 200 316 application/json 7.5698ms
2025-11-30 02:46:36.028 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=161&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=wAvvi2IdSMk_RL0rOlIclQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - null null
2025-11-30 02:46:36.031 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:36.032 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-30 02:46:36.033 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-30 02:46:36.036 +01:00 [INF] SignalR connected: 0FL0uYn4W0hj9W_rRqKwHQ user:null
2025-11-30 02:46:36.041 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='161'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-30 02:46:36.043 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='161', @p0='2025-11-30T01:46:36.0429155Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-30T01:46:36.0429861Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='161' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-30T01:46:36.0429155Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHFH06JI918:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-30 02:46:36.507 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/161 - null null
2025-11-30 02:46:36.509 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:36.510 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/161 - 204 null null 2.6649ms
2025-11-30 02:46:36.513 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/161 - null null
2025-11-30 02:46:36.515 +01:00 [INF] CORS policy execution successful.
2025-11-30 02:46:36.516 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:36'.
   at Microsoft.IdentityModel.Tokens.ValidatorUtilities.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-11-30 02:46:36.517 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '29/11/2025 22:04:40', Current time (UTC): '30/11/2025 1:46:36'.
2025-11-30 02:46:36.518 +01:00 [INF] HTTP GET /api/Conversations/history/161 started - IP: 127.0.0.1
2025-11-30 02:46:36.519 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:46:36.520 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 02:46:36.523 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='161'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-30 02:46:36.525 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='161'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `AspNetUsers` AS `a` ON `m`.`user_id` = `a`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-30 02:46:36.528 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='161'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN `a`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `a`.`Id` IS NOT NULL THEN COALESCE(`a`.`AvatarUrl`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `AspNetUsers` AS `a` ON `c`.`user_id` = `a`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-30 02:46:36.530 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 02:46:36.531 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 9.7488ms
2025-11-30 02:46:36.532 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-30 02:46:36.533 +01:00 [INF] HTTP GET /api/Conversations/history/161 completed - Status: 200 - Duration: 15.1415ms
2025-11-30 02:46:36.534 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/161 - 200 null application/json; charset=utf-8 21.4951ms
2025-11-30 02:46:37.196 +01:00 [INF] SignalR disconnected: 0FL0uYn4W0hj9W_rRqKwHQ user:null ex:null
2025-11-30 02:46:37.198 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-30 02:46:37.198 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 1166.2754ms
2025-11-30 02:46:37.200 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=161&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8&id=wAvvi2IdSMk_RL0rOlIclQ&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjEiLCJhbGxvd2VkRG9tYWluIjoibG9jYWxob3N0IiwibmJmIjoxNzY0MzUyOTYwLCJleHAiOjE3OTU4ODg5NjAsImlhdCI6MTc2NDM1Mjk2MCwiaXNzIjoiVm9pYS5BcGkiLCJhdWQiOiJWb2lhLkNsaWVudCJ9.SzN2WHiwhf9IGN7szxsQDsiUvgsc3Rub0Wo1v7RLpN8 - 101 null null 1171.2625ms
2025-11-30 02:48:53.570 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:33:53.5694182Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:53:53.592 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:38:53.5867177Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 02:58:53.621 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:43:53.6164149Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-30 03:01:39.432 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 03:01:39.432 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 03:01:39.434 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.437 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.438 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 03:01:39.439 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 03:01:39.440 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.442 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.443 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.444 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 03:01:39.448 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 03:01:39.451 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 03:01:39.453 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 03:01:39.454 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:39.457 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 03:01:39.458 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 12.1833ms
2025-11-30 03:01:39.460 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 03:01:39.461 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.462 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.463 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 25.1262ms
2025-11-30 03:01:39.464 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 17.1004ms
2025-11-30 03:01:39.466 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 34.5304ms
2025-11-30 03:01:39.467 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.472 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 33.291ms
2025-11-30 03:01:39.474 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 41.7675ms
2025-11-30 03:01:39.482 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-30 03:01:39.484 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.485 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.9533ms
2025-11-30 03:01:39.520 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 03:01:39.522 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.523 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 03:01:39.525 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.525 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 03:01:39.527 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 03:01:39.528 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.530 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.6764ms
2025-11-30 03:01:39.531 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.532 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 8.5009ms
2025-11-30 03:01:39.534 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 13.9302ms
2025-11-30 03:01:39.545 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 03:01:39.547 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.548 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 03:01:39.549 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:39.550 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.553 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 03:01:39.557 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 03:01:39.557 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 03:01:39.560 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 03:01:39.561 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.564 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 03:01:39.564 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.565 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.568 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 03:01:39.568 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 03:01:39.571 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.574 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 03:01:39.575 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.577 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 03:01:39.579 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.581 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 03:01:39.582 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.583 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.584 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.586 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.2551ms
2025-11-30 03:01:39.588 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.589 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.6508ms
2025-11-30 03:01:39.591 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.0006ms
2025-11-30 03:01:39.617 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 03:01:39.617 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 03:01:39.620 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.622 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.623 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 03:01:39.624 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 03:01:39.625 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.626 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.628 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 03:01:39.629 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.632 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 03:01:39.633 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 03:01:39.635 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 03:01:39.637 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 03:01:39.639 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 03:01:39.641 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:39.641 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.643 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 11.2512ms
2025-11-30 03:01:39.644 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 13.9904ms
2025-11-30 03:01:39.645 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.647 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.648 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 23.9637ms
2025-11-30 03:01:39.649 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 25.6488ms
2025-11-30 03:01:39.650 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 32.7818ms
2025-11-30 03:01:39.652 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 34.4663ms
2025-11-30 03:01:39.658 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 03:01:39.660 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.661 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 03:01:39.662 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.663 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 03:01:39.665 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 03:01:39.666 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.667 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.2798ms
2025-11-30 03:01:39.668 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.669 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 7.8841ms
2025-11-30 03:01:39.670 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 12.0685ms
2025-11-30 03:01:39.702 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 03:01:39.702 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 03:01:39.704 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.707 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.708 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 03:01:39.709 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 03:01:39.710 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.711 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.712 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.713 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 03:01:39.717 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 03:01:39.717 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 03:01:39.717 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 03:01:39.720 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 03:01:39.721 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 03:01:39.721 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.725 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 03:01:39.726 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:39.728 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.729 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 03:01:39.731 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 03:01:39.732 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 17.4855ms
2025-11-30 03:01:39.733 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 03:01:39.734 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:39.735 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.736 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.737 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.738 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.739 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 23.1748ms
2025-11-30 03:01:39.740 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 32.2116ms
2025-11-30 03:01:39.741 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 03:01:39.744 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.744 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 03:01:39.745 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 43.6854ms
2025-11-30 03:01:39.748 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 39.1245ms
2025-11-30 03:01:39.748 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 03:01:39.750 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 03:01:39.751 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 03:01:39.754 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 52.1641ms
2025-11-30 03:01:39.758 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 03:01:39.758 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1 - null null
2025-11-30 03:01:39.759 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.762 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 03:01:39.766 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 03:01:39.767 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.768 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 03:01:39.770 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.770 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.771 +01:00 [INF] HTTP GET /api/Bots/1 started - IP: 127.0.0.1
2025-11-30 03:01:39.772 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.774 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 26.791ms
2025-11-30 03:01:39.776 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.777 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 03:01:39.777 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 03:01:39.778 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.779 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.781 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.782 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 03:01:39.783 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 49.8852ms
2025-11-30 03:01:39.785 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `a`.`Id`, `b0`.`id`
LIMIT 1
2025-11-30 03:01:39.786 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.786 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.788 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 66.4282ms
2025-11-30 03:01:39.791 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `a`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-30 03:01:39.793 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.793 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 11.6274ms
2025-11-30 03:01:39.798 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:39.800 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.801 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.802 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 18.3023ms
2025-11-30 03:01:39.803 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.804 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 36.1929ms
2025-11-30 03:01:39.806 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-30 03:01:39.808 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 58.4484ms
2025-11-30 03:01:39.809 +01:00 [INF] HTTP GET /api/Bots/1 completed - Status: 200 - Duration: 37.8241ms
2025-11-30 03:01:39.812 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 03:01:39.813 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1 - 200 null application/json; charset=utf-8 55.2168ms
2025-11-30 03:01:39.816 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.816 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-30 03:01:39.818 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 03:01:39.820 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.822 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:39.823 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-30 03:01:39.824 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.825 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.827 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-30 03:01:39.828 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 03:01:39.829 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogotá
2025-11-30 03:01:39.831 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.831 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 03:01:39.832 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 3.6789ms
2025-11-30 03:01:39.834 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 03:01:39.835 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-30 03:01:39.837 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.838 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 15.0608ms
2025-11-30 03:01:39.840 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 03:01:39.841 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 25.0042ms
2025-11-30 03:01:39.843 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.847 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-30 03:01:39.847 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - null null
2025-11-30 03:01:39.848 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.849 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.851 +01:00 [INF] CORS policy execution successful.
2025-11-30 03:01:39.853 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.853 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-30 03:01:39.854 +01:00 [INF] HTTP GET /api/Bots/1/context started - IP: 127.0.0.1
2025-11-30 03:01:39.856 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.857 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.858 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:39.859 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.860 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-30 03:01:39.861 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-30 03:01:39.865 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-30 03:01:39.866 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `a`.`Id`, `a`.`AccessFailedCount`, `a`.`Address`, `a`.`AvatarUrl`, `a`.`City`, `a`.`ConcurrencyStamp`, `a`.`Country`, `a`.`CreatedAt`, `a`.`DocumentNumber`, `a`.`document_photo_url`, `a`.`DocumentTypeId`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`IsActive`, `a`.`IsVerified`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`Name`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`Phone`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`PublicDataToken`, `a`.`role_id`, `a`.`SecurityStamp`, `a`.`Status`, `a`.`TwoFactorEnabled`, `a`.`UpdatedAt`, `a`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `AspNetUsers` AS `a` ON `b`.`user_id` = `a`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-30 03:01:39.867 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='1' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogotá' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-30 03:01:39.869 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-30 03:01:39.871 +01:00 [INF] Welcome message for Bot 1: LEVEL 1 - VISITOR EXACT (Colombia/Bogotá)
2025-11-30 03:01:39.874 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-30 03:01:39.874 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-30 03:01:39.875 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 11.732ms
2025-11-30 03:01:39.877 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.878 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-30 03:01:39.880 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-30 03:01:39.880 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 26.956ms
2025-11-30 03:01:39.882 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.883 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=1&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 36.0391ms
2025-11-30 03:01:39.885 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.890 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='1'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-30 03:01:39.891 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:39.892 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=1&query=&limit=5
2025-11-30 03:01:41.607 +01:00 [INF] Received HTTP response headers after 2020.0119ms - 422
2025-11-30 03:01:41.608 +01:00 [INF] End processing HTTP request after 2025.4143ms - 422
2025-11-30 03:01:41.609 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:41.610 +01:00 [INF] Received HTTP response headers after 1803.0761ms - 422
2025-11-30 03:01:41.610 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 2059.2103ms
2025-11-30 03:01:41.611 +01:00 [INF] End processing HTTP request after 1811.4561ms - 422
2025-11-30 03:01:41.612 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:41.613 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:41.614 +01:00 [INF] Received HTTP response headers after 1752.3843ms - 422
2025-11-30 03:01:41.614 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 2066.3873ms
2025-11-30 03:01:41.616 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 1873.1992ms
2025-11-30 03:01:41.617 +01:00 [INF] End processing HTTP request after 1760.9131ms - 422
2025-11-30 03:01:41.618 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 2073.6677ms
2025-11-30 03:01:41.619 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:41.621 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:41.621 +01:00 [INF] Received HTTP response headers after 1728.4978ms - 422
2025-11-30 03:01:41.625 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 1895.7763ms
2025-11-30 03:01:41.626 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 1800.2086ms
2025-11-30 03:01:41.627 +01:00 [INF] End processing HTTP request after 1735.9899ms - 422
2025-11-30 03:01:41.629 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 1911.3469ms
2025-11-30 03:01:41.630 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:41.631 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-30 03:01:41.633 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 1815.0765ms
2025-11-30 03:01:41.635 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 1770.2456ms
2025-11-30 03:01:41.636 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 1824.0594ms
2025-11-30 03:01:41.638 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-30 03:01:41.641 +01:00 [INF] HTTP GET /api/Bots/1/context completed - Status: 200 - Duration: 1786.8923ms
2025-11-30 03:01:41.642 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/1/context - 200 null application/json; charset=utf-8 1794.9543ms
2025-11-30 03:03:53.632 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__inactivityThreshold_0='2025-11-30T01:48:53.6316077Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
