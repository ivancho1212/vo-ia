2025-11-24 21:15:00.329 +01:00 [INF]  CORS Configuration Loaded
2025-11-24 21:15:00.372 +01:00 [INF]    Frontend Origins: http://localhost:3000, http://127.0.0.1:3000, http://127.0.0.1:5500, http://localhost:5500, https://voia-client.lat
2025-11-24 21:15:00.373 +01:00 [INF]    Widget Origins: http://localhost:3000, http://127.0.0.1:3000, http://localhost:5006, http://127.0.0.1:5006
2025-11-24 21:15:00.399 +01:00 [WRN]  REDIS_CONNECTION not configured. Using Distributed Memory Cache (single-instance only).
2025-11-24 21:15:00.680 +01:00 [INF] User profile is available. Using 'C:\Users\Puesto 8\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:15:00.732 +01:00 [INF] 游빛 Servicio de conversaciones inactivas iniciado.
2025-11-24 21:15:00.735 +01:00 [INF] MessageProcessingWorker started. Redis enabled: false
2025-11-24 21:15:00.736 +01:00 [INF] Using InMemoryMessageQueue consumer.
2025-11-24 21:15:00.777 +01:00 [INF] Now listening on: http://localhost:5006
2025-11-24 21:15:00.778 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:15:00.779 +01:00 [INF] Hosting environment: Development
2025-11-24 21:15:00.779 +01:00 [INF] Content root path: C:\Users\Puesto 8\Documents\VIA\vo-ia
2025-11-24 21:15:16.368 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-24 21:15:16.368 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/BotStyles/widget/24 - null null
2025-11-24 21:15:16.414 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:16.414 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:16.422 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 55.1581ms
2025-11-24 21:15:16.428 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 12
2025-11-24 21:15:16.438 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:16.481 +01:00 [INF] HTTP GET /api/BotStyles/widget/24 started - IP: 127.0.0.1
2025-11-24 21:15:16.481 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-24 21:15:16.516 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:15:16.520 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotStylesController.GetStyleForWidget (Voia.Api)'
2025-11-24 21:15:16.539 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-24 21:15:16.539 +01:00 [INF] Route matched with {action = "GetStyleForWidget", controller = "BotStyles"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetStyleForWidget(Int32) on controller Voia.Api.Controllers.BotStylesController (Voia.Api).
2025-11-24 21:15:17.620 +01:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-11-24 21:15:18.074 +01:00 [INF] Executed DbCommand (78ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-24 21:15:18.097 +01:00 [INF] Executed DbCommand (107ms) [Parameters=[@__botId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-24 21:15:18.154 +01:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-24 21:15:18.194 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType55`1[[<>f__AnonymousType56`12[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:15:18.206 +01:00 [INF] Executed action Voia.Api.Controllers.BotStylesController.GetStyleForWidget (Voia.Api) in 1662.2304ms
2025-11-24 21:15:18.208 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotStylesController.GetStyleForWidget (Voia.Api)'
2025-11-24 21:15:18.209 +01:00 [INF] HTTP GET /api/BotStyles/widget/24 completed - Status: 200 - Duration: 1730.8832ms
2025-11-24 21:15:18.215 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/BotStyles/widget/24 - 200 null application/json; charset=utf-8 1848.4339ms
2025-11-24 21:15:18.217 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-24 21:15:18.219 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.219 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 2.3265ms
2025-11-24 21:15:18.222 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 40
2025-11-24 21:15:18.224 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.227 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-24 21:15:18.228 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:15:18.229 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-24 21:15:18.279 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-24 21:15:18.282 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-24 21:15:18.364 +01:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-24T20:15:18.2843902Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='18' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-24T20:15:18.284225Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-24T20:15:18.2842253Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-20T21:02:33","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-20T21:02:33"}' (Size = 4000), @p8='0HNHBIONCKHTP:00000003' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='18', @p11='2025-11-24T20:15:18.2842250Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-24T20:15:18.2842253Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-24 21:15:18.372 +01:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-24T20:15:18.2472533Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='18' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-24T20:15:18.1664134Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-24T20:15:18.1664824Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-20T21:02:33","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-20T21:02:33"}' (Size = 4000), @p8='0HNHBIONCKHTO:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='18', @p11='2025-11-24T20:15:18.1664134Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-24T20:15:18.1664824Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-24 21:15:18.389 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:15:18.389 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:15:18.394 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 1853.0094ms
2025-11-24 21:15:18.394 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 163.8229ms
2025-11-24 21:15:18.395 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:15:18.396 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:15:18.397 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 1918.5629ms
2025-11-24 21:15:18.397 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 170.5326ms
2025-11-24 21:15:18.398 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 1970.9188ms
2025-11-24 21:15:18.400 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 177.459ms
2025-11-24 21:15:18.404 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24 - null null
2025-11-24 21:15:18.406 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.407 +01:00 [INF] HTTP GET /api/Bots/24 started - IP: 127.0.0.1
2025-11-24 21:15:18.409 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-24 21:15:18.413 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:15:18.484 +01:00 [INF] Executed DbCommand (9ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `u`.`Id`, `b0`.`id`
LIMIT 1
2025-11-24 21:15:18.557 +01:00 [INF] Executed DbCommand (13ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `u`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-24 21:15:18.568 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:15:18.575 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 160.0168ms
2025-11-24 21:15:18.576 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-24 21:15:18.576 +01:00 [INF] HTTP GET /api/Bots/24 completed - Status: 200 - Duration: 169.4498ms
2025-11-24 21:15:18.578 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24 - 200 null application/json; charset=utf-8 173.6143ms
2025-11-24 21:15:18.580 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-24 21:15:18.582 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.582 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.3459ms
2025-11-24 21:15:18.588 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-24 21:15:18.590 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.592 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-24 21:15:18.593 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-24 21:15:18.595 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:15:18.751 +01:00 [INF] GeoLocation Service initialized with GeoLite2 database
2025-11-24 21:15:18.766 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogot치
2025-11-24 21:15:18.768 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:15:18.770 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 173.1157ms
2025-11-24 21:15:18.771 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-24 21:15:18.772 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 180.2542ms
2025-11-24 21:15:18.773 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 185.7221ms
2025-11-24 21:15:18.775 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/context - null null
2025-11-24 21:15:18.776 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=24&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-24 21:15:18.778 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.779 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:15:18.780 +01:00 [INF] HTTP GET /api/Bots/24/context started - IP: 127.0.0.1
2025-11-24 21:15:18.781 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:15:18.784 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-24 21:15:18.785 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:15:18.785 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-24 21:15:18.789 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-24 21:15:18.807 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-24 21:15:18.808 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:15:18.827 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__botId_0='24' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogot치' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-24 21:15:18.835 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND `b`.`city` IS NULL) AND (`b`.`language` = @__language_2)
LIMIT 1
2025-11-24 21:15:18.839 +01:00 [INF] Executed DbCommand (20ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-24 21:15:18.842 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_botId_0='24' (Nullable = true), @__adminCountry_1='Colombia' (Size = 4000), @__adminCity_2='Bogot치 D.C.' (Size = 4000), @__8__locals1_language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__8__locals1_botId_0) AND (`b`.`country` = @__adminCountry_1)) AND (`b`.`city` = @__adminCity_2)) AND (`b`.`language` = @__8__locals1_language_3)
LIMIT 1
2025-11-24 21:15:18.848 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_botId_0='24' (Nullable = true), @__adminCountry_1='Colombia' (Size = 4000), @__8__locals1_language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__8__locals1_botId_0) AND (`b`.`country` = @__adminCountry_1)) AND `b`.`city` IS NULL) AND (`b`.`language` = @__8__locals1_language_2)
LIMIT 1
2025-11-24 21:15:18.855 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__country_0='Colombia' (Size = 4000), @__city_1='Bogot치' (Size = 4000), @__language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE ((`b`.`bot_id` IS NULL AND (`b`.`country` = @__country_0)) AND (`b`.`city` = @__city_1)) AND (`b`.`language` = @__language_2)
LIMIT 1
2025-11-24 21:15:18.866 +01:00 [INF] Welcome message for Bot 24: LEVEL 5 - GENERIC EXACT (Colombia/Bogot치)
2025-11-24 21:15:18.867 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:15:18.869 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 78.491ms
2025-11-24 21:15:18.871 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-24 21:15:18.872 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 88.0274ms
2025-11-24 21:15:18.873 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=24&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 96.6259ms
2025-11-24 21:15:18.882 +01:00 [INF] Executed DbCommand (9ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-24 21:15:18.912 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-24 21:15:18.930 +01:00 [INF] Executed DbCommand (9ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-24 21:15:18.959 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__bot_Id_0='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:15:18.973 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:15:18.988 +01:00 [INF] Executed DbCommand (11ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-24 21:15:18.995 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=&limit=5
2025-11-24 21:15:18.996 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=&limit=5
2025-11-24 21:15:22.000 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:15:22.018 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 3231.8132ms
2025-11-24 21:15:22.019 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:15:22.020 +01:00 [INF] HTTP GET /api/Bots/24/context completed - Status: 200 - Duration: 3240.3319ms
2025-11-24 21:15:22.022 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/context - 200 null application/json; charset=utf-8 3246.4557ms
2025-11-24 21:18:32.234 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-24 21:18:32.236 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:18:32.237 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.8736ms
2025-11-24 21:18:32.239 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 410
2025-11-24 21:18:32.241 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:18:32.243 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-24 21:18:32.244 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-24 21:18:32.247 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:18:32.276 +01:00 [INF] Executed DbCommand (11ms) [Parameters=[@__8__locals1_dto_BotId_0='24', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-24 21:18:32.306 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-24 21:18:32.322 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='2ba988196c386530340ae35fa5ad498700a82bc10d9e0e53153bb8de033207a5' (Size = 256), @__8__locals1_dto_BotId_2='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-24 21:18:32.355 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='CREATE' (Size = 100), @p1='2025-11-24T20:18:32.3489918Z' (DbType = DateTime), @p2='Created new PublicUser' (Size = 4000), @p3='-2147482647' (Nullable = true), @p4='PublicUser' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"Id":-2147482647,"BotId":24,"BrowserFingerprint":"2ba988196c386530340ae35fa5ad498700a82bc10d9e0e53153bb8de033207a5","City":"Local","Country":"Local","CreatedAt":"2025-11-24T20:18:32.324152Z","IpAddress":"127.0.0.1","UserAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0"}' (Size = 4000), @p7='' (Size = 4000), @p8='0HNHBIONCKHTR:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p11='24' (Nullable = true), @p12='2ba988196c386530340ae35fa5ad498700a82bc10d9e0e53153bb8de033207a5' (Size = 256), @p13='Local' (Size = 4000), @p14='Local' (Size = 4000), @p15='2025-11-24T20:18:32.3241520Z' (DbType = DateTime), @p16='127.0.0.1' (Size = 4000), @p17='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

INSERT INTO `public_users` (`bot_id`, `browser_fingerprint`, `city`, `country`, `created_at`, `ip_address`, `user_agent`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `public_users`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-24 21:18:32.401 +01:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='False', @p1='False', @p2='24', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-24T20:18:32.3616306Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='2' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-24T20:18:32.3615375Z' (DbType = DateTime), @p16='3', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-24T20:18:32.3884382Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482647' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482647,"ActiveMobileSession":false,"Blocked":false,"BotId":24,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-24T20:18:32.3616306Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":2,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-24T20:18:32.3615375Z","UserId":3,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHBIONCKHTR:00000001' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:18:32.408 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:18:32.410 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 161.6354ms
2025-11-24 21:18:32.411 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-24 21:18:32.412 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 168.6019ms
2025-11-24 21:18:32.413 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 174.2068ms
2025-11-24 21:18:32.417 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null null
2025-11-24 21:18:32.419 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:18:32.420 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 204 null null 3.0171ms
2025-11-24 21:18:32.422 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null 0
2025-11-24 21:18:32.424 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:18:32.439 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-24 21:18:32.441 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-24 21:18:32.445 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-24 21:18:32.446 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 6.5603ms
2025-11-24 21:18:32.447 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 200 316 application/json 25.6911ms
2025-11-24 21:18:32.450 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=jQTRfxc-pE-XhFuFiHGCDg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - null null
2025-11-24 21:18:32.452 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:18:32.453 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-24 21:18:32.454 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-24 21:18:32.478 +01:00 [INF] SignalR connected: tERDePKeDMI5Mu_LEM6rfg user:null
2025-11-24 21:18:32.502 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:18:32.508 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='133', @p0='2025-11-24T20:18:32.5049266Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:18:32.5051459Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:18:32.5049266Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHBIONCKHTT:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:18:32.926 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - null null
2025-11-24 21:18:32.927 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:18:32.928 +01:00 [INF] HTTP GET /api/Conversations/history/133 started - IP: 127.0.0.1
2025-11-24 21:18:32.929 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:18:32.932 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:18:32.942 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:18:32.972 +01:00 [INF] Executed DbCommand (12ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `users` AS `u` ON `m`.`user_id` = `u`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-24 21:18:33.005 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN `u`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN COALESCE(`u`.`avatar_url`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `users` AS `u` ON `c`.`user_id` = `u`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-24 21:18:33.007 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:18:33.011 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 77.641ms
2025-11-24 21:18:33.012 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:18:33.013 +01:00 [INF] HTTP GET /api/Conversations/history/133 completed - Status: 200 - Duration: 84.6765ms
2025-11-24 21:18:33.014 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - 200 null application/json; charset=utf-8 88.4629ms
2025-11-24 21:18:33.910 +01:00 [INF] 游 [SaveWelcomeMessage] Guardando mensaje de bienvenida - ConvId: 133, BotId: 24
2025-11-24 21:18:33.918 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:18:33.951 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='24' (Nullable = true), @p1='133', @p2='2025-11-24T20:18:33.9210290Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?' (Size = 4000), @p5='2' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='bot' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13='3' (Nullable = true), @p14='CREATE' (Size = 100), @p15='2025-11-24T20:18:33.9463524Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482647' (Nullable = true), @p18='Message' (Size = 100), @p19='127.0.0.1' (Size = 45), @p20='{"Id":-2147482647,"BotId":24,"ConversationId":133,"CreatedAt":"2025-11-24T20:18:33.921029Z","FileId":null,"MessageText":"춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?","PublicUserId":2,"Read":false,"ReplyToMessageId":null,"Sender":"bot","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":3}' (Size = 4000), @p21='' (Size = 4000), @p22='0HNHBIONCKHTT:00000001' (Size = 50), @p23='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:18:33.959 +01:00 [INF] 九 [SaveWelcomeMessage] Mensaje de bienvenida guardado - MessageId: 298
2025-11-24 21:19:02.733 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:02.736 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-24T20:19:02.7349515Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:02.7351452Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:19:02.7349515Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-24T20:18:33"}' (Size = 4000), @p10='0HNHBIONCKHTT:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:13.548 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/auth/csrf-token - null null
2025-11-24 21:19:13.548 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/133 - null null
2025-11-24 21:19:13.550 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:13.553 +01:00 [INF] HTTP GET /api/auth/csrf-token started - IP: 127.0.0.1
2025-11-24 21:19:13.553 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:13.554 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.AuthController.GetCsrfToken (Voia.Api)'
2025-11-24 21:19:13.554 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/history/133 - 204 null null 6.577ms
2025-11-24 21:19:13.556 +01:00 [INF] Route matched with {action = "GetCsrfToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetCsrfToken() on controller Voia.Api.Controllers.AuthController (Voia.Api).
2025-11-24 21:19:13.558 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - application/json null
2025-11-24 21:19:13.560 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:13.561 +01:00 [INF] HTTP GET /api/Conversations/history/133 started - IP: 127.0.0.1
2025-11-24 21:19:13.562 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:13.563 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:13.563 +01:00 [INF] CSRF token generado: yhi/kJgTBO...
2025-11-24 21:19:13.567 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:13.567 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:13.572 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `users` AS `u` ON `m`.`user_id` = `u`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-24 21:19:13.572 +01:00 [INF] Executed action Voia.Api.Controllers.AuthController.GetCsrfToken (Voia.Api) in 13.692ms
2025-11-24 21:19:13.574 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.AuthController.GetCsrfToken (Voia.Api)'
2025-11-24 21:19:13.575 +01:00 [INF] HTTP GET /api/auth/csrf-token completed - Status: 200 - Duration: 22.3223ms
2025-11-24 21:19:13.576 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/auth/csrf-token - 200 null application/json; charset=utf-8 28.6613ms
2025-11-24 21:19:13.578 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN `u`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN COALESCE(`u`.`avatar_url`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `users` AS `u` ON `c`.`user_id` = `u`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-24 21:19:13.582 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:13.584 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 19.6582ms
2025-11-24 21:19:13.585 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:13.586 +01:00 [INF] HTTP GET /api/Conversations/history/133 completed - Status: 200 - Duration: 24.8019ms
2025-11-24 21:19:13.587 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - 200 null application/json; charset=utf-8 29.8224ms
2025-11-24 21:19:13.670 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/join-mobile - null null
2025-11-24 21:19:13.671 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:13.672 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/join-mobile - 204 null null 2.5181ms
2025-11-24 21:19:13.674 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/133/join-mobile - application/json 118
2025-11-24 21:19:13.677 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:13.678 +01:00 [INF] CSRF token validado y consumido: yhi/kJgTBO...
2025-11-24 21:19:13.679 +01:00 [INF] HTTP POST /api/Conversations/133/join-mobile started - IP: 127.0.0.1
2025-11-24 21:19:13.680 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.JoinMobileSession (Voia.Api)'
2025-11-24 21:19:13.683 +01:00 [INF] Route matched with {action = "JoinMobileSession", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] JoinMobileSession(Int32, Voia.Api.Models.DTOs.JoinMobileDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:13.692 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:13.697 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p5='133', @p0='True', @p1='True', @p2='2025-11-24T20:19:13.6950020Z' (Nullable = true) (DbType = DateTime), @p3='mobile' (Size = 4000), @p4='2025-11-24T20:19:13.6889947Z' (Nullable = true) (DbType = DateTime), @p6='UPDATE' (Size = 100), @p7='2025-11-24T20:19:13.6952392Z' (DbType = DateTime), @p8='Updated Conversation' (Size = 4000), @p9='133' (Nullable = true), @p10='Conversation' (Size = 100), @p11='127.0.0.1' (Size = 45), @p12='{"ActiveMobileSession":true,"Blocked":true,"LastActiveAt":"2025-11-24T20:19:13.695002Z","MobileDeviceType":"mobile","MobileJoinedAt":"2025-11-24T20:19:13.6889947Z"}' (Size = 4000), @p13='{"ActiveMobileSession":false,"Blocked":false,"LastActiveAt":"2025-11-24T20:19:03","MobileDeviceType":null,"MobileJoinedAt":null}' (Size = 4000), @p14='0HNHBIONCKHTR:00000004' (Size = 50), @p15='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p16=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `active_mobile_session` = @p0, `blocked` = @p1, `last_active_at` = @p2, `mobile_device_type` = @p3, `mobile_joined_at` = @p4
WHERE `Id` = @p5;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:13.704 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType97`4[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:13.706 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.JoinMobileSession (Voia.Api) in 22.0518ms
2025-11-24 21:19:13.707 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.JoinMobileSession (Voia.Api)'
2025-11-24 21:19:13.708 +01:00 [INF] HTTP POST /api/Conversations/133/join-mobile completed - Status: 200 - Duration: 29.5028ms
2025-11-24 21:19:13.709 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/133/join-mobile - 200 null application/json; charset=utf-8 35.0039ms
2025-11-24 21:19:14.157 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - null null
2025-11-24 21:19:14.159 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-24 21:19:14.160 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.160 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.161 +01:00 [INF] HTTP GET /api/Bots/24/widget-settings started - IP: 127.0.0.1
2025-11-24 21:19:14.161 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 2.9015ms
2025-11-24 21:19:14.162 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 12
2025-11-24 21:19:14.163 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-24 21:19:14.166 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.167 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-24 21:19:14.168 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:19:14.169 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-24 21:19:14.170 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:14.173 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-24 21:19:14.175 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-24 21:19:14.179 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-24T20:19:14.1776471Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='18' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-24T20:19:14.1775026Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-24T20:19:14.1775029Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-24T20:15:18","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-24T20:15:18"}' (Size = 4000), @p8='0HNHBIONCKHTR:00000005' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='18', @p11='2025-11-24T20:19:14.1775026Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-24T20:19:14.1775029Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-24 21:19:14.183 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:14.184 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.1011ms
2025-11-24 21:19:14.185 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:19:14.185 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:19:14.187 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 20.1543ms
2025-11-24 21:19:14.188 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-24 21:19:14.189 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 26.3628ms
2025-11-24 21:19:14.192 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 20.6954ms
2025-11-24 21:19:14.193 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-24 21:19:14.194 +01:00 [INF] HTTP GET /api/Bots/24/widget-settings completed - Status: 200 - Duration: 32.8313ms
2025-11-24 21:19:14.195 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - 200 null application/json; charset=utf-8 37.9532ms
2025-11-24 21:19:14.280 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24 - null null
2025-11-24 21:19:14.280 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - null null
2025-11-24 21:19:14.280 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - null null
2025-11-24 21:19:14.282 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.284 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.285 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.286 +01:00 [INF] HTTP GET /api/Bots/24 started - IP: 127.0.0.1
2025-11-24 21:19:14.286 +01:00 [INF] HTTP GET /api/Conversations/history/133 started - IP: 127.0.0.1
2025-11-24 21:19:14.287 +01:00 [INF] HTTP GET /api/Conversations/history/133 started - IP: 127.0.0.1
2025-11-24 21:19:14.289 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-24 21:19:14.290 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:14.290 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:14.291 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:14.292 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:14.292 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:14.296 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `u`.`Id`, `b0`.`id`
LIMIT 1
2025-11-24 21:19:14.296 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:14.298 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `u`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-24 21:19:14.300 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `users` AS `u` ON `m`.`user_id` = `u`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-24 21:19:14.300 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:14.302 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:14.303 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN `u`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN COALESCE(`u`.`avatar_url`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `users` AS `u` ON `c`.`user_id` = `u`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-24 21:19:14.303 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 9.6894ms
2025-11-24 21:19:14.306 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `users` AS `u` ON `m`.`user_id` = `u`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-24 21:19:14.306 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:14.307 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-24 21:19:14.309 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN `u`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN COALESCE(`u`.`avatar_url`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `users` AS `u` ON `c`.`user_id` = `u`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-24 21:19:14.309 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 14.6064ms
2025-11-24 21:19:14.310 +01:00 [INF] HTTP GET /api/Bots/24 completed - Status: 200 - Duration: 24.081ms
2025-11-24 21:19:14.311 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:14.312 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:14.313 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24 - 200 null application/json; charset=utf-8 33.7172ms
2025-11-24 21:19:14.314 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 18.7882ms
2025-11-24 21:19:14.315 +01:00 [INF] HTTP GET /api/Conversations/history/133 completed - Status: 200 - Duration: 28.9032ms
2025-11-24 21:19:14.318 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:14.319 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - 200 null application/json; charset=utf-8 38.9696ms
2025-11-24 21:19:14.319 +01:00 [INF] HTTP GET /api/Conversations/history/133 completed - Status: 200 - Duration: 32.1558ms
2025-11-24 21:19:14.322 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/133 - 200 null application/json; charset=utf-8 41.8738ms
2025-11-24 21:19:14.372 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-24 21:19:14.373 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null null
2025-11-24 21:19:14.374 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.375 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.376 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 3.8182ms
2025-11-24 21:19:14.376 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 204 null null 3.3268ms
2025-11-24 21:19:14.377 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-24 21:19:14.378 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null 0
2025-11-24 21:19:14.381 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.383 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.383 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-24 21:19:14.384 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-24 21:19:14.385 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-24 21:19:14.385 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-24 21:19:14.386 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:14.387 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-24 21:19:14.388 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 4.544ms
2025-11-24 21:19:14.389 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogot치
2025-11-24 21:19:14.390 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 200 316 application/json 11.9423ms
2025-11-24 21:19:14.390 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=Os_cjVFIblIjdUOHyl786A&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - null null
2025-11-24 21:19:14.390 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:14.394 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.394 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 6.8185ms
2025-11-24 21:19:14.395 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-24 21:19:14.396 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-24 21:19:14.397 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-24 21:19:14.397 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 13.8263ms
2025-11-24 21:19:14.399 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 22.0885ms
2025-11-24 21:19:14.400 +01:00 [INF] SignalR connected: IotosMuuej7nXxzchOdJDg user:null
2025-11-24 21:19:14.402 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/context - null null
2025-11-24 21:19:14.403 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=24&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-24 21:19:14.404 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.406 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:14.406 +01:00 [INF] HTTP GET /api/Bots/24/context started - IP: 127.0.0.1
2025-11-24 21:19:14.407 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-24 21:19:14.408 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:14.409 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-24 21:19:14.409 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:14.410 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-24 21:19:14.413 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:19:14.413 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-24 21:19:14.417 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-24 21:19:14.417 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogot치' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-24 21:19:14.420 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-24 21:19:14.421 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND `b`.`city` IS NULL) AND (`b`.`language` = @__language_2)
LIMIT 1
2025-11-24 21:19:14.422 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:14.424 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_botId_0='24' (Nullable = true), @__adminCountry_1='Colombia' (Size = 4000), @__adminCity_2='Bogot치 D.C.' (Size = 4000), @__8__locals1_language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__8__locals1_botId_0) AND (`b`.`country` = @__adminCountry_1)) AND (`b`.`city` = @__adminCity_2)) AND (`b`.`language` = @__8__locals1_language_3)
LIMIT 1
2025-11-24 21:19:14.425 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-24 21:19:14.426 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_botId_0='24' (Nullable = true), @__adminCountry_1='Colombia' (Size = 4000), @__8__locals1_language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__8__locals1_botId_0) AND (`b`.`country` = @__adminCountry_1)) AND `b`.`city` IS NULL) AND (`b`.`language` = @__8__locals1_language_2)
LIMIT 1
2025-11-24 21:19:14.428 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:14.429 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__country_0='Colombia' (Size = 4000), @__city_1='Bogot치' (Size = 4000), @__language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE ((`b`.`bot_id` IS NULL AND (`b`.`country` = @__country_0)) AND (`b`.`city` = @__city_1)) AND (`b`.`language` = @__language_2)
LIMIT 1
2025-11-24 21:19:14.430 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:14.431 +01:00 [INF] Welcome message for Bot 24: LEVEL 5 - GENERIC EXACT (Colombia/Bogot치)
2025-11-24 21:19:14.433 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:14.433 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:14.434 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 21.9727ms
2025-11-24 21:19:14.436 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=&limit=5
2025-11-24 21:19:14.436 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-24 21:19:14.437 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=&limit=5
2025-11-24 21:19:14.438 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 31.0659ms
2025-11-24 21:19:14.440 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=24&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 36.7408ms
2025-11-24 21:19:14.474 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:14.478 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-24T20:19:14.4765977Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:14.4770338Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:19:14.4765977Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-24T20:19:14"}' (Size = 4000), @p10='0HNHBIONCKHU1:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:16.894 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:16.896 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:16.896 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.3694ms
2025-11-24 21:19:16.898 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:16.900 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:16.901 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:16.902 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:16.905 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:16.913 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:16.915 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:16.917 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 11.5437ms
2025-11-24 21:19:16.918 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:16.919 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 18.3408ms
2025-11-24 21:19:16.920 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 22.0057ms
2025-11-24 21:19:17.451 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:17.453 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 3042.2484ms
2025-11-24 21:19:17.454 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:17.455 +01:00 [INF] HTTP GET /api/Bots/24/context completed - Status: 200 - Duration: 3048.2313ms
2025-11-24 21:19:17.456 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/context - 200 null application/json; charset=utf-8 3053.4208ms
2025-11-24 21:19:19.939 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:19.940 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:19.941 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:19.942 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:19.943 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:19.945 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:19.947 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:19.948 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.3337ms
2025-11-24 21:19:19.949 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:19.950 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.7217ms
2025-11-24 21:19:19.951 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.4743ms
2025-11-24 21:19:22.951 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:22.953 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:22.953 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.5593ms
2025-11-24 21:19:22.956 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:22.958 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:22.959 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:22.960 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:22.961 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:22.965 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:22.967 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:22.968 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.8548ms
2025-11-24 21:19:22.969 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:22.970 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 10.8817ms
2025-11-24 21:19:22.971 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 14.8524ms
2025-11-24 21:19:25.964 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:25.966 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:25.966 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:25.967 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:25.968 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:25.971 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:25.972 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:25.973 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.2284ms
2025-11-24 21:19:25.974 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:25.975 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.739ms
2025-11-24 21:19:25.976 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.6121ms
2025-11-24 21:19:28.978 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:28.980 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:28.980 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.1756ms
2025-11-24 21:19:28.983 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:28.984 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:28.985 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:28.986 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:28.986 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:28.989 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:28.991 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:28.992 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.1968ms
2025-11-24 21:19:28.993 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:28.993 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.5964ms
2025-11-24 21:19:28.995 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 11.9466ms
2025-11-24 21:19:31.979 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:31.981 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:31.982 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:31.983 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:31.983 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:31.986 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:31.988 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:31.989 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.4466ms
2025-11-24 21:19:31.990 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:31.991 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 9.1718ms
2025-11-24 21:19:31.992 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.9758ms
2025-11-24 21:19:32.760 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:32.763 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-24T20:19:32.7620211Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:32.7621693Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:19:32.7620211Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-24T20:19:14"}' (Size = 4000), @p10='0HNHBIONCKHTT:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:34.993 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:34.995 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:34.996 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.2971ms
2025-11-24 21:19:34.998 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:34.999 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:35.000 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:35.001 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:35.002 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:35.004 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:35.006 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:35.007 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.6513ms
2025-11-24 21:19:35.008 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:35.009 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 9.1751ms
2025-11-24 21:19:35.010 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.4967ms
2025-11-24 21:19:37.724 +01:00 [INF] 游댌 [SendMessage] Iniciando - ConversationId: 133, BotId: 24, UserId: , Question: gracias
2025-11-24 21:19:37.726 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:37.727 +01:00 [INF] 九 [SendMessage] Conversaci칩n encontrada - PublicUserId: 2, UserId: 3
2025-11-24 21:19:37.728 +01:00 [INF] 游댌 [SendMessage] Usando PublicUserId para mensaje: 2
2025-11-24 21:19:37.730 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='24' (Nullable = true), @p1='133', @p2='2025-11-24T20:19:37.7289241Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='gracias' (Size = 4000), @p5='2' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='user' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13=NULL (DbType = Int32), @p14='CREATE' (Size = 100), @p15='2025-11-24T20:19:37.7292613Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482646' (Nullable = true), @p18='Message' (Size = 100), @p19='127.0.0.1' (Size = 45), @p20='{"Id":-2147482646,"BotId":24,"ConversationId":133,"CreatedAt":"2025-11-24T20:19:37.7289241Z","FileId":null,"MessageText":"gracias","PublicUserId":2,"Read":false,"ReplyToMessageId":null,"Sender":"user","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":null}' (Size = 4000), @p21='' (Size = 4000), @p22='0HNHBIONCKHU1:00000001' (Size = 50), @p23='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:37.737 +01:00 [INF] 九 [SendMessage] Mensaje de usuario guardado - PublicUserId: 2
2025-11-24 21:19:37.739 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p3='133', @p0='gracias' (Size = 4000), @p1='2025-11-24T20:19:37.7378964Z' (DbType = DateTime), @p2='gracias' (Size = 4000), @p4='UPDATE' (Size = 100), @p5='2025-11-24T20:19:37.7380675Z' (DbType = DateTime), @p6='Updated Conversation' (Size = 4000), @p7='133' (Nullable = true), @p8='Conversation' (Size = 100), @p9='127.0.0.1' (Size = 45), @p10='{"LastMessage":"gracias","UpdatedAt":"2025-11-24T20:19:37.7378964Z","UserMessage":"gracias"}' (Size = 4000), @p11='{"LastMessage":null,"UpdatedAt":"2025-11-24T21:19:32","UserMessage":null}' (Size = 4000), @p12='0HNHBIONCKHU1:00000001' (Size = 50), @p13='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p14=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_message` = @p0, `updated_at` = @p1, `user_message` = @p2
WHERE `Id` = @p3;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:37.742 +01:00 [INF] 九 [SendMessage] Conversaci칩n actualizada - user_message y last_message
2025-11-24 21:19:37.743 +01:00 [INF] 游닋 [SendMessage] Enviando ReceiveMessage al grupo 133 para mensaje 299
2025-11-24 21:19:37.745 +01:00 [INF] 九 [SendMessage] ReceiveMessage enviado al grupo 133 para mensaje 299
2025-11-24 21:19:37.757 +01:00 [WRN] The query uses the 'Distinct' operator after applying an ordering. If there are any row limiting operation used before 'Distinct' and after ordering then ordering will be used for it. Ordering(s) will be erased after 'Distinct' and results afterwards would be unordered.
2025-11-24 21:19:37.761 +01:00 [WRN] The query uses the 'Distinct' operator after applying an ordering. If there are any row limiting operation used before 'Distinct' and after ordering then ordering will be used for it. Ordering(s) will be erased after 'Distinct' and results afterwards would be unordered.
2025-11-24 21:19:37.762 +01:00 [WRN] The query uses the 'Distinct' operator after applying an ordering. If there are any row limiting operation used before 'Distinct' and after ordering then ordering will be used for it. Ordering(s) will be erased after 'Distinct' and results afterwards would be unordered.
2025-11-24 21:19:37.762 +01:00 [WRN] The query uses the 'Distinct' operator after applying an ordering. If there are any row limiting operation used before 'Distinct' and after ordering then ordering will be used for it. Ordering(s) will be erased after 'Distinct' and results afterwards would be unordered.
2025-11-24 21:19:37.768 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`field_name`, `b`.`Id`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__request_BotId_0
ORDER BY `b`.`Id`
2025-11-24 21:19:37.786 +01:00 [INF] Executed DbCommand (13ms) [Parameters=[@__request_BotId_0='24', @__ToString_1='133' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`submission_value`, `b`.`Id`
FROM `bot_data_capture_fields` AS `b`
JOIN LATERAL (
    SELECT DISTINCT `b0`.`submission_value`
    FROM `bot_data_submissions` AS `b0`
    WHERE ((`b0`.`bot_id` = @__request_BotId_0) AND (`b0`.`capture_field_id` = `b`.`Id`)) AND (`b0`.`submission_session_id` = @__ToString_1)
) AS `t` ON TRUE
WHERE `b`.`bot_id` = @__request_BotId_0
ORDER BY `b`.`Id`
2025-11-24 21:19:37.789 +01:00 [INF] 游댳 [ChatHub] Campos cargados de BD: 2 campos
2025-11-24 21:19:37.789 +01:00 [INF]   - Nombre: 
2025-11-24 21:19:37.790 +01:00 [INF]   - Direccion: 
2025-11-24 21:19:37.791 +01:00 [INF] 游댌 [ChatHub] Procesando mensaje con BotDataCaptureService: 'gracias'
2025-11-24 21:19:37.794 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversation_Id_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`sender` AS `Sender`, `m`.`message_text` AS `MessageText`, `m`.`created_at` AS `CreatedAt`
FROM `Messages` AS `m`
WHERE `m`.`conversation_id` = @__conversation_Id_0
ORDER BY `m`.`created_at`
2025-11-24 21:19:37.796 +01:00 [INF] 游닆 [ChatHub] Historial de conversaci칩n (2 mensajes): [bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gracias...
2025-11-24 21:19:37.799 +01:00 [INF] 游댌 [BotDataCaptureService] Iniciando extracci칩n - Campos pendientes: Nombre, Direccion
2025-11-24 21:19:37.800 +01:00 [INF] 游니 [BotDataCaptureService] EXTRAYENDO CON RASTREO REAL DE RECHAZOS...
2025-11-24 21:19:37.802 +01:00 [INF] 游댌 [DataExtractionService] INICIANDO EXTRACCI칍N - Mensaje: 'gracias', Campos: Nombre, Direccion
2025-11-24 21:19:37.803 +01:00 [INF] 游댍 [DataExtractionService] Analizando con regex patterns (RASTREO REAL DE RECHAZOS)...
2025-11-24 21:19:37.805 +01:00 [INF]   游댌 ExtractListValuesGenericWithRejections - Field: 'Nombre', Type: 'name'
2025-11-24 21:19:37.807 +01:00 [INF]     游댌 ExtractListFromTextWithRejections - Field: 'Nombre', Type: 'name'
2025-11-24 21:19:37.809 +01:00 [INF]       游댍 Validando: 'gracias' | Tipo: name
2025-11-24 21:19:37.810 +01:00 [INF]     九 Valor v치lido: 'gracias'
2025-11-24 21:19:37.811 +01:00 [INF]   九 Capturados 1 valores para Nombre
2025-11-24 21:19:37.811 +01:00 [INF]   九 Nombre = 'gracias' [regex gen칠rico]
2025-11-24 21:19:37.812 +01:00 [INF]   游댌 ExtractListValuesGenericWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:37.813 +01:00 [INF]     游댌 ExtractListFromTextWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:37.814 +01:00 [INF]       游댍 Validando: 'gracias' | Tipo: address
2025-11-24 21:19:37.815 +01:00 [INF]         궁 Rechazado: 'gracias' parece ser un nombre puro, no una direcci칩n
2025-11-24 21:19:37.816 +01:00 [INF]     仇 Valor rechazado: 'gracias' | Raz칩n: Parece ser un nombre puro, no contiene caracter칤sticas de direcci칩n
2025-11-24 21:19:37.817 +01:00 [INF]   仇 Direccion = NO ENCONTRADO
2025-11-24 21:19:37.818 +01:00 [INF]   游닇 Direccion - 1 valores rechazados
2025-11-24 21:19:37.819 +01:00 [INF] 九 [DataExtractionService] REGEX extrajo 1 campos exitosamente (CASOS SIMPLES)
2025-11-24 21:19:37.819 +01:00 [INF]   九 Nombre = gracias
2025-11-24 21:19:37.820 +01:00 [INF] 游댌 [DataExtractionService] Analizando 1 datos rechazados para posible recuperaci칩n...
2025-11-24 21:19:37.821 +01:00 [INF] 游댌 [DataExtractionService] AN츼LISIS DE DATOS RECHAZADOS - 1 items
2025-11-24 21:19:37.822 +01:00 [INF]   游늶 Analizando rechazado: Field='Direccion', Value='gracias', Reason='Parece ser un nombre puro, no contiene caracter칤sticas de direcci칩n'
2025-11-24 21:19:37.824 +01:00 [INF]     游뱄 Consultando IA sobre rechazo...
2025-11-24 21:19:37.825 +01:00 [INF]     游뱄 Respuesta IA: You are a data validation expert. Analyze if this data was incorrectly rejected.

CONTEXT:
- User message: "gracias"
- Field name: Direccion
- Field type: address
- Rejected value: "gracias"
- Rejection reason: Parece ser un nombre puro, no contiene caracter칤sticas de direcci칩n

TASK:
Analyze if this value should have been accepted for this field.

Return a JSON object with:
{
  "wasError": true/false (was the rejection wrong?),
  "confidence": 0.0-1.0 (how confident are you?),
  "explanation": "brief explanation"
}

Example:
{
  "wasError": true,
  "confidence": 0.95,
  "explanation": "'suba gaitana' is a valid neighborhood name (direcci칩n), not profanity"
}

Analyze now:
2025-11-24 21:19:37.827 +01:00 [ERR]     仇 Error en an치lisis IA de rechazo
System.Text.Json.JsonReaderException: 'Y' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.JsonDocument.Parse(ReadOnlySpan`1 utf8JsonSpan, JsonReaderOptions readerOptions, MetadataDb& database, StackRowStack& stack)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 utf8Json, JsonReaderOptions readerOptions, Byte[] extraRentedArrayPoolBytes, PooledByteBufferWriter extraPooledByteBufferWriter)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 json, JsonDocumentOptions options)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at Voia.Api.Services.Chat.DataExtractionService.AnalyzeRejectionWithAiAsync(Int32 botId, RejectedDataItem rejected, String userMessage) in C:\Users\Puesto 8\Documents\VIA\vo-ia\Services\Chat\DataExtractionService.cs:line 158
2025-11-24 21:19:37.866 +01:00 [INF]     九 Rechazo validado como correcto por IA
2025-11-24 21:19:37.867 +01:00 [INF] 游댌 [DataExtractionService] An치lisis completado - 0 datos recuperados
2025-11-24 21:19:37.868 +01:00 [INF] 九 [BotDataCaptureService] Extracci칩n completada - 1 campos extra칤dos
2025-11-24 21:19:37.868 +01:00 [INF]   - Nombre: gracias
2025-11-24 21:19:37.869 +01:00 [INF] 游닆 [BotDataCaptureService] PHASE 3: Iniciando revisi칩n retrospectiva de conversaci칩n...
2025-11-24 21:19:37.871 +01:00 [INF] 游댌 [DataExtractionService - PHASE 3] Iniciando revisi칩n retrospectiva de conversaci칩n...
2025-11-24 21:19:37.871 +01:00 [INF]    Campos a buscar: Nombre, Direccion
2025-11-24 21:19:37.872 +01:00 [INF]    Datos ya capturados: 
2025-11-24 21:19:37.873 +01:00 [INF]   游댌 ExtractListValuesGeneric - Field: 'Nombre', Type: 'name', Input: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gr...'
2025-11-24 21:19:37.875 +01:00 [INF]     游댌 ExtractListFromText - Field: 'Nombre', Type: 'name', Input: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gracias'
2025-11-24 21:19:37.876 +01:00 [INF]     游늵 Split en 2 partes
2025-11-24 21:19:37.876 +01:00 [INF]     仇 Valor rechazado: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme' (no cumple validaci칩n)
2025-11-24 21:19:37.877 +01:00 [INF]       游댍 Validando: '쯘n qu칠 le colaboro hoy?
[user]: gracias' | Tipo: name
2025-11-24 21:19:37.878 +01:00 [INF]     九 Valor v치lido encontrado: '쯘n qu칠 le colaboro hoy?
[user]: gracias'
2025-11-24 21:19:37.880 +01:00 [INF]   九 Capturados 1 valores para Nombre: 쯘n qu칠 le colaboro hoy?
[user]: gracias
2025-11-24 21:19:37.881 +01:00 [INF]    九 ENCONTRADO (retrospectivo): Nombre = 쯘n qu칠 le colaboro hoy?
[user]: gracias
2025-11-24 21:19:37.881 +01:00 [INF]   游댌 ExtractListValuesGeneric - Field: 'Direccion', Type: 'address', Input: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gr...'
2025-11-24 21:19:37.882 +01:00 [INF]     游댌 ExtractListFromText - Field: 'Direccion', Type: 'address', Input: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gracias'
2025-11-24 21:19:37.884 +01:00 [INF]     游늵 Split en 2 partes
2025-11-24 21:19:37.884 +01:00 [INF]     仇 Valor rechazado: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme' (no cumple validaci칩n)
2025-11-24 21:19:37.885 +01:00 [INF]       游댍 Validando: '쯘n qu칠 le colaboro hoy?
[user]: gracias' | Tipo: address
2025-11-24 21:19:37.886 +01:00 [INF]         궁 Rechazado: '쯘n qu칠 le colaboro hoy?
[user]: gracias' no tiene caracter칤sticas de direcci칩n
2025-11-24 21:19:37.887 +01:00 [INF]     仇 Valor rechazado: '쯘n qu칠 le colaboro hoy?
[user]: gracias' (no cumple validaci칩n)
2025-11-24 21:19:37.888 +01:00 [INF]    九 No encontrado: Direccion
2025-11-24 21:19:37.888 +01:00 [INF] 游댌 [DataExtractionService - PHASE 3] Revisi칩n completada. Datos nuevos encontrados: 1
2025-11-24 21:19:37.889 +01:00 [INF]    + Nombre = 쯘n qu칠 le colaboro hoy?
[user]: gracias
2025-11-24 21:19:37.889 +01:00 [INF] 九 [BotDataCaptureService] PHASE 3 encontr칩 1 nuevos datos retrospectivamente
2025-11-24 21:19:37.895 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`created_at`, `b`.`field_name`, `b`.`field_type`, `b`.`is_required`, `b`.`updated_at`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__botId_0
2025-11-24 21:19:37.930 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='CREATE' (Size = 100), @p1='2025-11-24T20:19:37.9286558Z' (DbType = DateTime), @p2='Created new BotDataSubmission' (Size = 4000), @p3='-2147482647' (Nullable = true), @p4='BotDataSubmission' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"Id":-2147482647,"BotId":24,"CaptureFieldId":13,"CaptureIntent":null,"CaptureSource":"extraction","ConversationId":null,"MetadataJson":null,"SubmissionSessionId":"133","SubmissionValue":"gracias","SubmittedAt":"2025-11-24T20:19:37.9077513Z","UserId":null}' (Size = 4000), @p7='' (Size = 4000), @p8='0HNHBIONCKHU1:00000001' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p11='24', @p12='13', @p13=NULL (Size = 4000), @p14='extraction' (Size = 4000), @p15=NULL (DbType = Int64), @p16=NULL (Size = 4000), @p17='133' (Size = 100), @p18='gracias' (Size = 4000), @p19='2025-11-24T20:19:37.9077513Z' (Nullable = true) (DbType = DateTime), @p20=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

INSERT INTO `bot_data_submissions` (`bot_id`, `capture_field_id`, `capture_intent`, `capture_source`, `conversation_id`, `metadata_json`, `submission_session_id`, `submission_value`, `submitted_at`, `user_id`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20);
SELECT `Id`
FROM `bot_data_submissions`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-11-24 21:19:37.937 +01:00 [INF] 游늵 [ChatHub] Resultado de captura: 1 nuevos, RequiresAiClarification: false
2025-11-24 21:19:37.938 +01:00 [INF] 九 [ChatHub] Se capturaron 1 nuevos datos en la captura de datos
2025-11-24 21:19:37.939 +01:00 [INF]   游닇 Submission: CaptureFieldId=13, SubmissionValue='gracias'
2025-11-24 21:19:37.940 +01:00 [INF] 九 [ChatHub] Campo actualizado: Nombre = gracias
2025-11-24 21:19:38.019 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:38.021 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:38.021 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:38.022 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:38.023 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:38.026 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:38.027 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:38.028 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.0299ms
2025-11-24 21:19:38.029 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:38.030 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.3607ms
2025-11-24 21:19:38.031 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 11.9206ms
2025-11-24 21:19:38.161 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:38.163 +01:00 [INF] 游댳 [Worker] job.CapturedFields: 2 campos
2025-11-24 21:19:38.163 +01:00 [INF]   - Nombre: gracias
2025-11-24 21:19:38.164 +01:00 [INF]   - Direccion: 
2025-11-24 21:19:38.165 +01:00 [INF] 游댌 [MessageProcessingWorker] Procesando captura de datos - Mensaje: I have just saved the following information for the user:
- Nombre: gracias
Please confirm the saved data to the user in a friendly tone and then ask for the next piece of information from this list: Direccion.
, Campos pendientes: 1
2025-11-24 21:19:38.166 +01:00 [INF] 游댌 [BotDataCaptureService] Iniciando extracci칩n - Campos pendientes: Direccion
2025-11-24 21:19:38.167 +01:00 [INF] 游니 [BotDataCaptureService] EXTRAYENDO CON RASTREO REAL DE RECHAZOS...
2025-11-24 21:19:38.167 +01:00 [INF] 游댌 [DataExtractionService] INICIANDO EXTRACCI칍N - Mensaje: 'I have just saved the following information for the user:
- Nombre: gracias
Please confirm the saved data to the user in a friendly tone and then ask for the next piece of information from this list: Direccion.
', Campos: Direccion
2025-11-24 21:19:38.168 +01:00 [INF] 游댍 [DataExtractionService] Analizando con regex patterns (RASTREO REAL DE RECHAZOS)...
2025-11-24 21:19:38.168 +01:00 [INF]   游댌 ExtractListValuesGenericWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:38.169 +01:00 [INF]     游댌 ExtractListFromTextWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:38.170 +01:00 [INF]   仇 Direccion = NO ENCONTRADO
2025-11-24 21:19:38.171 +01:00 [INF]   游닇 Direccion - 1 valores rechazados
2025-11-24 21:19:38.172 +01:00 [INF] 좶잺 [DataExtractionService] Regex no extrajo datos (POSIBLE CASO COMPLEJO). Intentando con IA...
2025-11-24 21:19:38.173 +01:00 [INF] 游뱄 [DataExtractionService] Llamando a IA para extraer datos (CASOS COMPLEJOS)...
2025-11-24 21:19:38.174 +01:00 [INF] 游뱄 [DataExtractionService] Respuesta IA: You are a world-class data extraction expert. Your task is to meticulously analyze the user's message and extract values for specific fields.

CONTEXT:
- The user is having a conversation in Spanish
- The user might provide data in various formats, with typos, or in conversational style
- Be flexible with how users provide their information

TASK:
Extract values for these fields: 'Direccion'
User's message: "I have just saved the following information for the user:
- Nombre: gracias
Please confirm the saved data to the user in a friendly tone and then ask for the next piece of information from this list: Direccion.
"

RULES:
1. Return ONLY a valid JSON object with no additional text
2. Keys must exactly match the requested field names
3. If you find a value for a field, include it in the JSON
4. If you cannot find a value, DO NOT include that key
5. Do NOT invent or assume data
6. Capture complete values (e.g., names with apellidos)

Example response:
{
  "Nombre": "Ivan Daniel Herrera Surmay",
  "Direcci칩n": "Calle 5"
}

Extract now:
2025-11-24 21:19:38.174 +01:00 [ERR] 仇 [DataExtractionService] Error: IA no devolvi칩 JSON v치lido
System.Text.Json.JsonReaderException: 'Y' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.JsonDocument.Parse(ReadOnlySpan`1 utf8JsonSpan, JsonReaderOptions readerOptions, MetadataDb& database, StackRowStack& stack)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 utf8Json, JsonReaderOptions readerOptions, Byte[] extraRentedArrayPoolBytes, PooledByteBufferWriter extraPooledByteBufferWriter)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 json, JsonDocumentOptions options)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at Voia.Api.Services.Chat.DataExtractionService.ExtractDataWithAiInternalAsync(Int32 botId, String userMessage, List`1 pendingFields) in C:\Users\Puesto 8\Documents\VIA\vo-ia\Services\Chat\DataExtractionService.cs:line 1195
2025-11-24 21:19:38.177 +01:00 [WRN] 丘멆잺 [BotDataCaptureService] Extracci칩n no encontr칩 datos
2025-11-24 21:19:38.177 +01:00 [INF] 游늵 [Worker] Resultado de captura: 0 nuevos, RequiresAiClarification: false
2025-11-24 21:19:38.178 +01:00 [INF] 좶잺 No se capturaron nuevos datos
2025-11-24 21:19:38.178 +01:00 [INF] 游늸 [MessageProcessingWorker] Processing job 299 - Location: null, null | Context: null
2025-11-24 21:19:38.179 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A&limit=5
2025-11-24 21:19:38.180 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A&limit=5
2025-11-24 21:19:41.028 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:41.030 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:41.031 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.2823ms
2025-11-24 21:19:41.033 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:41.035 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:41.035 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:41.036 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:41.037 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:41.040 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:41.041 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:41.042 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.2254ms
2025-11-24 21:19:41.043 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:41.044 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.6087ms
2025-11-24 21:19:41.045 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 11.9562ms
2025-11-24 21:19:42.270 +01:00 [INF] Start processing HTTP request GET http://localhost:5006/api/Bots/24/context?query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A
2025-11-24 21:19:42.271 +01:00 [INF] Sending HTTP request GET http://localhost:5006/api/Bots/24/context?query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A
2025-11-24 21:19:42.275 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/context?query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A - null null
2025-11-24 21:19:42.280 +01:00 [INF] HTTP GET /api/Bots/24/context started - IP: ::1
2025-11-24 21:19:42.281 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:42.281 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:42.285 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:19:42.287 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-24 21:19:42.289 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-24 21:19:42.291 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:42.293 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-24 21:19:42.295 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:42.296 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:42.298 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:42.300 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A&limit=5
2025-11-24 21:19:42.300 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A&limit=5
2025-11-24 21:19:42.395 +01:00 [INF] 游댌 [SendMessage] Iniciando - ConversationId: 133, BotId: 24, UserId: , Question: muy amable
2025-11-24 21:19:42.396 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:42.398 +01:00 [INF] 九 [SendMessage] Conversaci칩n encontrada - PublicUserId: 2, UserId: 3
2025-11-24 21:19:42.398 +01:00 [INF] 游댌 [SendMessage] Usando PublicUserId para mensaje: 2
2025-11-24 21:19:42.401 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='24' (Nullable = true), @p1='133', @p2='2025-11-24T20:19:42.3994930Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='muy amable' (Size = 4000), @p5='2' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='user' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13=NULL (DbType = Int32), @p14='CREATE' (Size = 100), @p15='2025-11-24T20:19:42.3999457Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482645' (Nullable = true), @p18='Message' (Size = 100), @p19='127.0.0.1' (Size = 45), @p20='{"Id":-2147482645,"BotId":24,"ConversationId":133,"CreatedAt":"2025-11-24T20:19:42.399493Z","FileId":null,"MessageText":"muy amable","PublicUserId":2,"Read":false,"ReplyToMessageId":null,"Sender":"user","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":null}' (Size = 4000), @p21='' (Size = 4000), @p22='0HNHBIONCKHU1:00000001' (Size = 50), @p23='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:42.406 +01:00 [INF] 九 [SendMessage] Mensaje de usuario guardado - PublicUserId: 2
2025-11-24 21:19:42.408 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p3='133', @p0='muy amable' (Size = 4000), @p1='2025-11-24T20:19:42.4069351Z' (DbType = DateTime), @p2='muy amable' (Size = 4000), @p4='UPDATE' (Size = 100), @p5='2025-11-24T20:19:42.4071105Z' (DbType = DateTime), @p6='Updated Conversation' (Size = 4000), @p7='133' (Nullable = true), @p8='Conversation' (Size = 100), @p9='127.0.0.1' (Size = 45), @p10='{"LastMessage":"muy amable","UpdatedAt":"2025-11-24T20:19:42.4069351Z","UserMessage":"muy amable"}' (Size = 4000), @p11='{"LastMessage":"gracias","UpdatedAt":"2025-11-24T20:19:38","UserMessage":"gracias"}' (Size = 4000), @p12='0HNHBIONCKHU1:00000001' (Size = 50), @p13='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p14=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_message` = @p0, `updated_at` = @p1, `user_message` = @p2
WHERE `Id` = @p3;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:42.411 +01:00 [INF] 九 [SendMessage] Conversaci칩n actualizada - user_message y last_message
2025-11-24 21:19:42.411 +01:00 [INF] 游닋 [SendMessage] Enviando ReceiveMessage al grupo 133 para mensaje 300
2025-11-24 21:19:42.412 +01:00 [INF] 九 [SendMessage] ReceiveMessage enviado al grupo 133 para mensaje 300
2025-11-24 21:19:42.414 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`field_name`, `b`.`Id`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__request_BotId_0
ORDER BY `b`.`Id`
2025-11-24 21:19:42.417 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_BotId_0='24', @__ToString_1='133' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`submission_value`, `b`.`Id`
FROM `bot_data_capture_fields` AS `b`
JOIN LATERAL (
    SELECT DISTINCT `b0`.`submission_value`
    FROM `bot_data_submissions` AS `b0`
    WHERE ((`b0`.`bot_id` = @__request_BotId_0) AND (`b0`.`capture_field_id` = `b`.`Id`)) AND (`b0`.`submission_session_id` = @__ToString_1)
) AS `t` ON TRUE
WHERE `b`.`bot_id` = @__request_BotId_0
ORDER BY `b`.`Id`
2025-11-24 21:19:42.419 +01:00 [INF] 游댳 [ChatHub] Campos cargados de BD: 2 campos
2025-11-24 21:19:42.420 +01:00 [INF]   - Nombre: gracias
2025-11-24 21:19:42.420 +01:00 [INF]   - Direccion: 
2025-11-24 21:19:42.421 +01:00 [INF] 游댌 [ChatHub] Procesando mensaje con BotDataCaptureService: 'muy amable'
2025-11-24 21:19:42.423 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversation_Id_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`sender` AS `Sender`, `m`.`message_text` AS `MessageText`, `m`.`created_at` AS `CreatedAt`
FROM `Messages` AS `m`
WHERE `m`.`conversation_id` = @__conversation_Id_0
ORDER BY `m`.`created_at`
2025-11-24 21:19:42.424 +01:00 [INF] 游닆 [ChatHub] Historial de conversaci칩n (3 mensajes): [bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gracias
[user]: muy amable...
2025-11-24 21:19:42.425 +01:00 [INF] 游댌 [BotDataCaptureService] Iniciando extracci칩n - Campos pendientes: Direccion
2025-11-24 21:19:42.426 +01:00 [INF] 游니 [BotDataCaptureService] EXTRAYENDO CON RASTREO REAL DE RECHAZOS...
2025-11-24 21:19:42.426 +01:00 [INF] 游댌 [DataExtractionService] INICIANDO EXTRACCI칍N - Mensaje: 'muy amable', Campos: Direccion
2025-11-24 21:19:42.427 +01:00 [INF] 游댍 [DataExtractionService] Analizando con regex patterns (RASTREO REAL DE RECHAZOS)...
2025-11-24 21:19:42.427 +01:00 [INF]   游댌 ExtractListValuesGenericWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:42.428 +01:00 [INF]     游댌 ExtractListFromTextWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:42.429 +01:00 [INF]       游댍 Validando: 'muy amable' | Tipo: address
2025-11-24 21:19:42.430 +01:00 [INF]         궁 Rechazado: 'muy amable' parece ser un nombre puro, no una direcci칩n
2025-11-24 21:19:42.430 +01:00 [INF]     仇 Valor rechazado: 'muy amable' | Raz칩n: Parece ser un nombre puro, no contiene caracter칤sticas de direcci칩n
2025-11-24 21:19:42.431 +01:00 [INF]   仇 Direccion = NO ENCONTRADO
2025-11-24 21:19:42.432 +01:00 [INF]   游닇 Direccion - 1 valores rechazados
2025-11-24 21:19:42.433 +01:00 [INF] 좶잺 [DataExtractionService] Regex no extrajo datos (POSIBLE CASO COMPLEJO). Intentando con IA...
2025-11-24 21:19:42.433 +01:00 [INF] 游뱄 [DataExtractionService] Llamando a IA para extraer datos (CASOS COMPLEJOS)...
2025-11-24 21:19:42.434 +01:00 [INF] 游뱄 [DataExtractionService] Respuesta IA: You are a world-class data extraction expert. Your task is to meticulously analyze the user's message and extract values for specific fields.

CONTEXT:
- The user is having a conversation in Spanish
- The user might provide data in various formats, with typos, or in conversational style
- Be flexible with how users provide their information

TASK:
Extract values for these fields: 'Direccion'
User's message: "muy amable"

RULES:
1. Return ONLY a valid JSON object with no additional text
2. Keys must exactly match the requested field names
3. If you find a value for a field, include it in the JSON
4. If you cannot find a value, DO NOT include that key
5. Do NOT invent or assume data
6. Capture complete values (e.g., names with apellidos)

Example response:
{
  "Nombre": "Ivan Daniel Herrera Surmay",
  "Direcci칩n": "Calle 5"
}

Extract now:
2025-11-24 21:19:42.435 +01:00 [ERR] 仇 [DataExtractionService] Error: IA no devolvi칩 JSON v치lido
System.Text.Json.JsonReaderException: 'Y' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.JsonDocument.Parse(ReadOnlySpan`1 utf8JsonSpan, JsonReaderOptions readerOptions, MetadataDb& database, StackRowStack& stack)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 utf8Json, JsonReaderOptions readerOptions, Byte[] extraRentedArrayPoolBytes, PooledByteBufferWriter extraPooledByteBufferWriter)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 json, JsonDocumentOptions options)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at Voia.Api.Services.Chat.DataExtractionService.ExtractDataWithAiInternalAsync(Int32 botId, String userMessage, List`1 pendingFields) in C:\Users\Puesto 8\Documents\VIA\vo-ia\Services\Chat\DataExtractionService.cs:line 1195
2025-11-24 21:19:42.437 +01:00 [WRN] 丘멆잺 [BotDataCaptureService] Extracci칩n no encontr칩 datos
2025-11-24 21:19:42.437 +01:00 [INF] 游닆 [BotDataCaptureService] PHASE 3: Iniciando revisi칩n retrospectiva de conversaci칩n...
2025-11-24 21:19:42.438 +01:00 [INF] 游댌 [DataExtractionService - PHASE 3] Iniciando revisi칩n retrospectiva de conversaci칩n...
2025-11-24 21:19:42.439 +01:00 [INF]    Campos a buscar: Direccion
2025-11-24 21:19:42.439 +01:00 [INF]    Datos ya capturados: Nombre=gracias
2025-11-24 21:19:42.440 +01:00 [INF]   游댌 ExtractListValuesGeneric - Field: 'Direccion', Type: 'address', Input: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gr...'
2025-11-24 21:19:42.441 +01:00 [INF]     游댌 ExtractListFromText - Field: 'Direccion', Type: 'address', Input: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme, 쯘n qu칠 le colaboro hoy?
[user]: gracias
[user]: muy am...'
2025-11-24 21:19:42.442 +01:00 [INF]     游늵 Split en 2 partes
2025-11-24 21:19:42.442 +01:00 [INF]     仇 Valor rechazado: '[bot]: 춰Hola veci! 쮺칩mo me le va? Cu칠nteme' (no cumple validaci칩n)
2025-11-24 21:19:42.443 +01:00 [INF]     仇 Valor rechazado: '쯘n qu칠 le colaboro hoy?
[user]: gracias
[user]: muy amable' (no cumple validaci칩n)
2025-11-24 21:19:42.444 +01:00 [INF]    九 No encontrado: Direccion
2025-11-24 21:19:42.444 +01:00 [INF] 游댌 [DataExtractionService - PHASE 3] Revisi칩n completada. Datos nuevos encontrados: 0
2025-11-24 21:19:42.445 +01:00 [INF] 좶잺 [BotDataCaptureService] PHASE 3 no encontr칩 datos nuevos
2025-11-24 21:19:42.445 +01:00 [INF] 游늵 [ChatHub] Resultado de captura: 0 nuevos, RequiresAiClarification: false
2025-11-24 21:19:42.446 +01:00 [INF] 좶잺 [ChatHub] No se capturaron nuevos datos
2025-11-24 21:19:42.448 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-24T20:19:42.4470839Z' (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:42.4472296Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"UpdatedAt":"2025-11-24T20:19:42.4470839Z"}' (Size = 4000), @p9='{"UpdatedAt":"2025-11-24T20:19:42.4069351Z"}' (Size = 4000), @p10='0HNHBIONCKHU1:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `updated_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:42.452 +01:00 [INF] 游닋 [SendMessage] Enviando ReceiveMessage (caller) para confirmaci칩n mensaje 300 conv 133
2025-11-24 21:19:42.454 +01:00 [INF] 九 [SendMessage] ReceiveMessage (caller) enviado para mensaje 300 conv 133
2025-11-24 21:19:42.459 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversation_PublicUserId_Value_0='2'], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE `p`.`Id` = @__conversation_PublicUserId_Value_0
LIMIT 1
2025-11-24 21:19:42.461 +01:00 [INF] 游늸 [ChatHub] Ubicaci칩n del usuario p칰blico: Local, Local
2025-11-24 21:19:42.462 +01:00 [INF] Message enqueued for conversation 133 message 300
2025-11-24 21:19:44.029 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:44.031 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:44.031 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:44.032 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:44.033 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:44.036 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:44.038 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:44.039 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.8762ms
2025-11-24 21:19:44.040 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:44.041 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 9.544ms
2025-11-24 21:19:44.042 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 13.2859ms
2025-11-24 21:19:44.286 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:44.289 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-24T20:19:44.2885867Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:44.2887244Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:19:44.2885867Z"}' (Size = 4000), @p9='{"LastActiveAt":"2025-11-24T20:19:33"}' (Size = 4000), @p10='0HNHBIONCKHU1:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:46.392 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:46.393 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 4110.4227ms
2025-11-24 21:19:46.394 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:46.395 +01:00 [INF] HTTP GET /api/Bots/24/context completed - Status: 200 - Duration: 4118.2518ms
2025-11-24 21:19:46.396 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/context?query=I%20have%20just%20saved%20the%20following%20information%20for%20the%20user%3A%0D%0A-%20Nombre%3A%20gracias%0D%0APlease%20confirm%20the%20saved%20data%20to%20the%20user%20in%20a%20friendly%20tone%20and%20then%20ask%20for%20the%20next%20piece%20of%20information%20from%20this%20list%3A%20Direccion.%0D%0A - 200 null application/json; charset=utf-8 4121.1558ms
2025-11-24 21:19:46.398 +01:00 [INF] Received HTTP response headers after 4124.8233ms - 200
2025-11-24 21:19:46.399 +01:00 [INF] End processing HTTP request after 4129.0581ms - 200
2025-11-24 21:19:46.406 +01:00 [INF] 游댌 [LanguageDetection] Idioma detectado: English (Score: 4)
2025-11-24 21:19:46.445 +01:00 [INF] 游댌 PROMPT VALIDATION: Valid=true, RiskScore=0, Issues=0
2025-11-24 21:19:46.451 +01:00 [INF] 游늸 [PromptBuilderService] JSON payload built for bot 24 with location: null, null
2025-11-24 21:19:46.452 +01:00 [INF] 游닋 [PromptBuilderService] FULL JSON PAYLOAD:
{
  "UserQuestion": "I have just saved the following information for the user:\r\n- Nombre: gracias\r\nPlease confirm the saved data to the user in a friendly tone and then ask for the next piece of information from this list: Direccion.\r\n",
  "UserLocation": {
    "Country": null,
    "City": null
  },
  "ContextMessage": null,
  "SystemPrompt": "System Prompt\n\nYou are an Automotive Claims and Salvage Advisor specialized in damaged vehicles (coches siniestrados).\nYour behavior is strictly defined as follows:\nPurpose and Scope\nProvide professional guidance about the process of vehicle damage assessment (tasaci\u00F3n) and the company\u2019s workflow.\nUse only the information explicitly provided through system instructions, user/assistant messages, or vectorized/company data that may be integrated later.\nIf information is missing or unavailable, clearly state that you don\u2019t have access to it. Do not invent, assume, or speculate.\n\nRestrictions\nNever provide sensitive, confidential, financial, legal, or speculative information.\nDo not generate or simulate company data unless explicitly provided.\nRemain strictly within the role of an automotive claims advisor.\n\nLanguage and Style\nAlways respond in the same language, style, or accent used by the user at the start of the conversation.\nMaintain a professional, clear, concise, and empathetic tone, suitable for customer assistance in the automotive industry.\n\nData Capture\nIf requested, assist in capturing structured information such as vehicle details, accident description, or claim references.\nClarify that data storage and processing occur in an external integrated system, not by you directly.\nFuture Integration\nIf later given access to vectorized databases or company knowledge, use that data to enhance accuracy.\nUntil then, limit responses strictly to the information currently available.\n\nAllowed Behavior\n\nExplain general processes and workflows clearly.\nAcknowledge when you lack information instead of speculating.\nStay professional and empathetic in all interactions.\n\nForbidden Behavior\n\nDo not invent policies, valuation amounts, or internal processes you don\u2019t know.\nDo not provide confidential data.\nDo not deviate into unrelated topics.\nGeneral Principles\n\nBe accurate, professional, and empathetic.\n\nFocus only on damaged vehicles, assessments, and company workflows.\n\nAntes de avanzar, captura con tacto la siguiente informaci\u00F3n del usuario: (obligatorios) Nombre, Direccion. Haz preguntas de una en una, valida repitiendo el dato y pidiendo confirmaci\u00F3n. Si ya tienes un dato, no lo vuelvas a pedir; contin\u00FAa con el siguiente. Una vez confirmados los obligatorios, puedes proceder con la solicitud del usuario.",
  "DataCaptureStatus": "--- GESTI\u00D3N DE DATOS ---\r\nDATOS CAPTURADOS: Nombre=\u0027gracias\u0027.\r\nDATOS PENDIENTES: Direccion.\r\nACCI\u00D3N: Pregunta \u00FAnicamente por \u0027Direccion\u0027. No repitas saludos ni confirmes datos anteriores.\r\n-----------------------",
  "CapturedFields": [
    {
      "FieldName": "Nombre",
      "Value": "gracias"
    },
    {
      "FieldName": "Direccion",
      "Value": ""
    }
  ],
  "Resources": {
    "Documents": [
      "Formato Autorizacion de descuento Edesk.pdf",
      "autorizacion.pdf"
    ],
    "Urls": [
      "https://radios.com.co/#olimpica",
      "https://radios.com.co/#el-sol"
    ],
    "CustomTexts": [
      "https://radios.com.co/#olimpica",
      "https://radios.com.co/#el-sol"
    ],
    "Vectors": []
  },
  "ConversationHistory": [
    {
      "Role": "user",
      "Content": "wr34gqrwef"
    },
    {
      "Role": "assistant",
      "Content": "qwrgfre3"
    },
    {
      "Role": "user",
      "Content": "I have just saved the following information for the user:\r\n- Nombre: gracias\r\nPlease confirm the saved data to the user in a friendly tone and then ask for the next piece of information from this list: Direccion.\r\n"
    }
  ]
}
2025-11-24 21:19:46.454 +01:00 [INF] 九 [MessageProcessingWorker] Prompt built successfully - Location data + Capture fields (2 campos)
2025-11-24 21:19:46.454 +01:00 [INF] No vectors found for bot 24 conv 133. Sending 'no access' reply.
2025-11-24 21:19:46.457 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='24' (Nullable = true), @p1='133', @p2='2025-11-24T20:19:46.4555917Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.' (Size = 4000), @p5='2' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='bot' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13=NULL (DbType = Int32), @p14='CREATE' (Size = 100), @p15='2025-11-24T20:19:46.4558632Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482644' (Nullable = true), @p18='Message' (Size = 100), @p19=NULL (Size = 45), @p20='{"Id":-2147482644,"BotId":24,"ConversationId":133,"CreatedAt":"2025-11-24T20:19:46.4555917Z","FileId":null,"MessageText":"Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.","PublicUserId":2,"Read":false,"ReplyToMessageId":null,"Sender":"bot","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":null}' (Size = 4000), @p21='' (Size = 4000), @p22=NULL (Size = 50), @p23=NULL (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:46.463 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p3='133', @p0='Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.' (Size = 4000), @p1='Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.' (Size = 4000), @p2='2025-11-24T20:19:46.4616995Z' (DbType = DateTime), @p4='UPDATE' (Size = 100), @p5='2025-11-24T20:19:46.4618038Z' (DbType = DateTime), @p6='Updated Conversation' (Size = 4000), @p7='133' (Nullable = true), @p8='Conversation' (Size = 100), @p9=NULL (Size = 45), @p10='{"BotResponse":"Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.","LastMessage":"Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.","UpdatedAt":"2025-11-24T20:19:46.4616995Z"}' (Size = 4000), @p11='{"BotResponse":null,"LastMessage":"gracias","UpdatedAt":"2025-11-24T20:19:38"}' (Size = 4000), @p12=NULL (Size = 50), @p13=NULL (Size = 500), @p14=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `bot_response` = @p0, `last_message` = @p1, `updated_at` = @p2
WHERE `Id` = @p3;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:46.467 +01:00 [INF] 九 [Worker] Conversaci칩n actualizada con mensaje de 'no access'
2025-11-24 21:19:46.471 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:46.472 +01:00 [INF] 游댳 [Worker] job.CapturedFields: 2 campos
2025-11-24 21:19:46.473 +01:00 [INF]   - Nombre: gracias
2025-11-24 21:19:46.474 +01:00 [INF]   - Direccion: 
2025-11-24 21:19:46.475 +01:00 [INF] 游댌 [MessageProcessingWorker] Procesando captura de datos - Mensaje: muy amable, Campos pendientes: 1
2025-11-24 21:19:46.475 +01:00 [INF] 游댌 [BotDataCaptureService] Iniciando extracci칩n - Campos pendientes: Direccion
2025-11-24 21:19:46.476 +01:00 [INF] 游니 [BotDataCaptureService] EXTRAYENDO CON RASTREO REAL DE RECHAZOS...
2025-11-24 21:19:46.477 +01:00 [INF] 游댌 [DataExtractionService] INICIANDO EXTRACCI칍N - Mensaje: 'muy amable', Campos: Direccion
2025-11-24 21:19:46.477 +01:00 [INF] 游댍 [DataExtractionService] Analizando con regex patterns (RASTREO REAL DE RECHAZOS)...
2025-11-24 21:19:46.478 +01:00 [INF]   游댌 ExtractListValuesGenericWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:46.479 +01:00 [INF]     游댌 ExtractListFromTextWithRejections - Field: 'Direccion', Type: 'address'
2025-11-24 21:19:46.479 +01:00 [INF]       游댍 Validando: 'muy amable' | Tipo: address
2025-11-24 21:19:46.480 +01:00 [INF]         궁 Rechazado: 'muy amable' parece ser un nombre puro, no una direcci칩n
2025-11-24 21:19:46.481 +01:00 [INF]     仇 Valor rechazado: 'muy amable' | Raz칩n: Parece ser un nombre puro, no contiene caracter칤sticas de direcci칩n
2025-11-24 21:19:46.482 +01:00 [INF]   仇 Direccion = NO ENCONTRADO
2025-11-24 21:19:46.483 +01:00 [INF]   游닇 Direccion - 1 valores rechazados
2025-11-24 21:19:46.484 +01:00 [INF] 좶잺 [DataExtractionService] Regex no extrajo datos (POSIBLE CASO COMPLEJO). Intentando con IA...
2025-11-24 21:19:46.484 +01:00 [INF] 游뱄 [DataExtractionService] Llamando a IA para extraer datos (CASOS COMPLEJOS)...
2025-11-24 21:19:46.485 +01:00 [INF] 游뱄 [DataExtractionService] Respuesta IA: You are a world-class data extraction expert. Your task is to meticulously analyze the user's message and extract values for specific fields.

CONTEXT:
- The user is having a conversation in Spanish
- The user might provide data in various formats, with typos, or in conversational style
- Be flexible with how users provide their information

TASK:
Extract values for these fields: 'Direccion'
User's message: "muy amable"

RULES:
1. Return ONLY a valid JSON object with no additional text
2. Keys must exactly match the requested field names
3. If you find a value for a field, include it in the JSON
4. If you cannot find a value, DO NOT include that key
5. Do NOT invent or assume data
6. Capture complete values (e.g., names with apellidos)

Example response:
{
  "Nombre": "Ivan Daniel Herrera Surmay",
  "Direcci칩n": "Calle 5"
}

Extract now:
2025-11-24 21:19:46.486 +01:00 [ERR] 仇 [DataExtractionService] Error: IA no devolvi칩 JSON v치lido
System.Text.Json.JsonReaderException: 'Y' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.JsonDocument.Parse(ReadOnlySpan`1 utf8JsonSpan, JsonReaderOptions readerOptions, MetadataDb& database, StackRowStack& stack)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 utf8Json, JsonReaderOptions readerOptions, Byte[] extraRentedArrayPoolBytes, PooledByteBufferWriter extraPooledByteBufferWriter)
   at System.Text.Json.JsonDocument.Parse(ReadOnlyMemory`1 json, JsonDocumentOptions options)
   at System.Text.Json.JsonDocument.Parse(String json, JsonDocumentOptions options)
   at Voia.Api.Services.Chat.DataExtractionService.ExtractDataWithAiInternalAsync(Int32 botId, String userMessage, List`1 pendingFields) in C:\Users\Puesto 8\Documents\VIA\vo-ia\Services\Chat\DataExtractionService.cs:line 1195
2025-11-24 21:19:46.487 +01:00 [WRN] 丘멆잺 [BotDataCaptureService] Extracci칩n no encontr칩 datos
2025-11-24 21:19:46.488 +01:00 [INF] 游늵 [Worker] Resultado de captura: 0 nuevos, RequiresAiClarification: false
2025-11-24 21:19:46.489 +01:00 [INF] 좶잺 No se capturaron nuevos datos
2025-11-24 21:19:46.489 +01:00 [INF] 游늸 [MessageProcessingWorker] Processing job 300 - Location: Local, Local | Context: null
2025-11-24 21:19:46.490 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=muy%20amable&limit=5
2025-11-24 21:19:46.491 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=muy%20amable&limit=5
2025-11-24 21:19:47.037 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:47.039 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:47.040 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.1917ms
2025-11-24 21:19:47.042 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:47.043 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:47.044 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:47.045 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:47.046 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:47.048 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:47.050 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:47.051 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.6938ms
2025-11-24 21:19:47.052 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:47.053 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 9.2795ms
2025-11-24 21:19:47.055 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.702ms
2025-11-24 21:19:50.040 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:50.041 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:50.042 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:50.043 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:50.044 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:50.046 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:50.048 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:50.049 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.2001ms
2025-11-24 21:19:50.050 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:50.051 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.6328ms
2025-11-24 21:19:50.052 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.3732ms
2025-11-24 21:19:50.541 +01:00 [INF] Start processing HTTP request GET http://localhost:5006/api/Bots/24/context?query=muy%20amable
2025-11-24 21:19:50.542 +01:00 [INF] Sending HTTP request GET http://localhost:5006/api/Bots/24/context?query=muy%20amable
2025-11-24 21:19:50.543 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/context?query=muy%20amable - null null
2025-11-24 21:19:50.545 +01:00 [INF] HTTP GET /api/Bots/24/context started - IP: ::1
2025-11-24 21:19:50.546 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:50.546 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:50.549 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:19:50.552 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-24 21:19:50.554 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-24 21:19:50.556 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:50.558 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-24 21:19:50.559 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:50.561 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:50.563 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:50.564 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=muy%20amable&limit=5
2025-11-24 21:19:50.565 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=muy%20amable&limit=5
2025-11-24 21:19:50.909 +01:00 [INF] SignalR disconnected: IotosMuuej7nXxzchOdJDg user:null ex:null
2025-11-24 21:19:50.911 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-24 21:19:50.912 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 36516.7376ms
2025-11-24 21:19:50.913 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 36516.7376ms
2025-11-24 21:19:50.914 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=Os_cjVFIblIjdUOHyl786A&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - 101 null null 36524.2652ms
2025-11-24 21:19:50.921 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/133/leave-mobile - text/plain;charset=UTF-8 24
2025-11-24 21:19:50.921 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/133/disconnect - null 0
2025-11-24 21:19:50.923 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:50.924 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:50.925 +01:00 [WRN] CSRF token faltante en POST /api/Conversations/133/leave-mobile
2025-11-24 21:19:50.925 +01:00 [WRN] CSRF token faltante en POST /api/conversations/133/disconnect
2025-11-24 21:19:50.928 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/133/disconnect - 403 null application/json; charset=utf-8 7.7005ms
2025-11-24 21:19:50.928 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/133/leave-mobile - 403 null application/json; charset=utf-8 7.7919ms
2025-11-24 21:19:53.046 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - null null
2025-11-24 21:19:53.048 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:53.049 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/133/status - 204 null null 2.2589ms
2025-11-24 21:19:53.051 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - application/json null
2025-11-24 21:19:53.053 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:53.053 +01:00 [INF] HTTP GET /api/Conversations/133/status started - IP: 127.0.0.1
2025-11-24 21:19:53.054 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:53.055 +01:00 [INF] Route matched with {action = "GetConversationStatus", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationStatus(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:53.057 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='133'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`status` AS `Status`, `c`.`active_mobile_session` AS `ActiveMobileSession`, `c`.`mobile_device_type` AS `MobileDeviceType`, `c`.`blocked` AS `Blocked`, `c`.`closed_at` AS `ClosedAt`, `c`.`last_active_at` AS `LastActiveAt`, `c`.`mobile_joined_at` AS `MobileJoinedAt`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:53.059 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType101`8[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:53.060 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api) in 4.0407ms
2025-11-24 21:19:53.061 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationStatus (Voia.Api)'
2025-11-24 21:19:53.062 +01:00 [INF] HTTP GET /api/Conversations/133/status completed - Status: 200 - Duration: 8.6506ms
2025-11-24 21:19:53.063 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/133/status - 200 null application/json; charset=utf-8 12.1763ms
2025-11-24 21:19:54.629 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:54.631 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 4083.2159ms
2025-11-24 21:19:54.631 +01:00 [INF] Received HTTP response headers after 4087.9033ms - 200
2025-11-24 21:19:54.632 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:54.632 +01:00 [INF] End processing HTTP request after 4091.2608ms - 200
2025-11-24 21:19:54.633 +01:00 [INF] HTTP GET /api/Bots/24/context completed - Status: 200 - Duration: 4088.4358ms
2025-11-24 21:19:54.635 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/context?query=muy%20amable - 200 null application/json; charset=utf-8 4091.924ms
2025-11-24 21:19:54.638 +01:00 [INF] 游깴 [PromptBuilderService] CONTEXTO DIN츼MICO A칌ADIDO - Idioma: unknown, Ubicaci칩n: Local, Local
2025-11-24 21:19:54.675 +01:00 [INF] 游댌 PROMPT VALIDATION: Valid=true, RiskScore=0, Issues=0
2025-11-24 21:19:54.677 +01:00 [INF] 游늸 [PromptBuilderService] JSON payload built for bot 24 with location: Local, Local
2025-11-24 21:19:54.678 +01:00 [INF] 游닋 [PromptBuilderService] FULL JSON PAYLOAD:
{
  "UserQuestion": "muy amable",
  "UserLocation": {
    "Country": "Local",
    "City": "Local"
  },
  "ContextMessage": null,
  "SystemPrompt": "System Prompt\n\nYou are an Automotive Claims and Salvage Advisor specialized in damaged vehicles (coches siniestrados).\nYour behavior is strictly defined as follows:\nPurpose and Scope\nProvide professional guidance about the process of vehicle damage assessment (tasaci\u00F3n) and the company\u2019s workflow.\nUse only the information explicitly provided through system instructions, user/assistant messages, or vectorized/company data that may be integrated later.\nIf information is missing or unavailable, clearly state that you don\u2019t have access to it. Do not invent, assume, or speculate.\n\nRestrictions\nNever provide sensitive, confidential, financial, legal, or speculative information.\nDo not generate or simulate company data unless explicitly provided.\nRemain strictly within the role of an automotive claims advisor.\n\nLanguage and Style\nAlways respond in the same language, style, or accent used by the user at the start of the conversation.\nMaintain a professional, clear, concise, and empathetic tone, suitable for customer assistance in the automotive industry.\n\nData Capture\nIf requested, assist in capturing structured information such as vehicle details, accident description, or claim references.\nClarify that data storage and processing occur in an external integrated system, not by you directly.\nFuture Integration\nIf later given access to vectorized databases or company knowledge, use that data to enhance accuracy.\nUntil then, limit responses strictly to the information currently available.\n\nAllowed Behavior\n\nExplain general processes and workflows clearly.\nAcknowledge when you lack information instead of speculating.\nStay professional and empathetic in all interactions.\n\nForbidden Behavior\n\nDo not invent policies, valuation amounts, or internal processes you don\u2019t know.\nDo not provide confidential data.\nDo not deviate into unrelated topics.\nGeneral Principles\n\nBe accurate, professional, and empathetic.\n\nFocus only on damaged vehicles, assessments, and company workflows.\n\nAntes de avanzar, captura con tacto la siguiente informaci\u00F3n del usuario: (obligatorios) Nombre, Direccion. Haz preguntas de una en una, valida repitiendo el dato y pidiendo confirmaci\u00F3n. Si ya tienes un dato, no lo vuelvas a pedir; contin\u00FAa con el siguiente. Una vez confirmados los obligatorios, puedes proceder con la solicitud del usuario.\r\n\r\n---CONTEXTO DE USUARIO---\r\n\uD83D\uDCCD UBICACI\u00D3N: El usuario est\u00E1 escribiendo desde Local, Local\r\n\uD83D\uDDE3\uFE0F IDIOMA: El usuario est\u00E1 comunic\u00E1ndose en the user\u0027s language\r\n\r\nINSTRUCCI\u00D3N CR\u00CDTICA:\r\n1. Responde en the user\u0027s language (el idioma que el usuario est\u00E1 usando)\r\n2. Adapta el contenido considerando la regi\u00F3n Local, Local:\r\n   - Usa acentos, expresiones y referencias culturales de esa regi\u00F3n\r\n   - Menciona monedas, medidas y costumbres locales si es relevante\r\n   - Ten en cuenta la zona horaria y contexto temporal de Local\r\n3. Si bien el usuario est\u00E1 en Local, Local, mant\u00E9n tu respuesta aut\u00E9ntica a esa regi\u00F3n\r\n4. No cambies el idioma - responde en the user\u0027s language tal como el usuario te escribe\r\n\r\nEJEMPLO DE COMPORTAMIENTO:\r\n- Usuario en Buenos Aires (Argentina) escribiendo en ESPA\u00D1OL: Responde con acento argentino, referencias locales\r\n- Usuario en Tokyo (Jap\u00F3n) escribiendo en INGL\u00C9S: Responde en ingl\u00E9s, pero con contexto de Jap\u00F3n\r\n- Usuario en Montreal (Canad\u00E1) escribiendo en FRANC\u00C9S: Responde en franc\u00E9s, con contexto de Qu\u00E9bec/Canad\u00E1\r\n---FIN CONTEXTO DE USUARIO---",
  "DataCaptureStatus": "--- GESTI\u00D3N DE DATOS ---\r\nDATOS CAPTURADOS: Nombre=\u0027gracias\u0027.\r\nDATOS PENDIENTES: Direccion.\r\nACCI\u00D3N: Pregunta \u00FAnicamente por \u0027Direccion\u0027. No repitas saludos ni confirmes datos anteriores.\r\n-----------------------",
  "CapturedFields": [
    {
      "FieldName": "Nombre",
      "Value": "gracias"
    },
    {
      "FieldName": "Direccion",
      "Value": ""
    }
  ],
  "Resources": {
    "Documents": [
      "Formato Autorizacion de descuento Edesk.pdf",
      "autorizacion.pdf"
    ],
    "Urls": [
      "https://radios.com.co/#olimpica",
      "https://radios.com.co/#el-sol"
    ],
    "CustomTexts": [
      "https://radios.com.co/#olimpica",
      "https://radios.com.co/#el-sol"
    ],
    "Vectors": []
  },
  "ConversationHistory": [
    {
      "Role": "user",
      "Content": "wr34gqrwef"
    },
    {
      "Role": "assistant",
      "Content": "qwrgfre3"
    },
    {
      "Role": "user",
      "Content": "muy amable"
    }
  ]
}
2025-11-24 21:19:54.679 +01:00 [INF] 九 [MessageProcessingWorker] Prompt built successfully - Location data + Capture fields (2 campos)
2025-11-24 21:19:54.680 +01:00 [INF] No vectors found for bot 24 conv 133. Sending 'no access' reply.
2025-11-24 21:19:54.683 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='24' (Nullable = true), @p1='133', @p2='2025-11-24T20:19:54.6809404Z' (DbType = DateTime), @p3=NULL (DbType = Int32), @p4='Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.' (Size = 4000), @p5='2' (Nullable = true), @p6='False', @p7=NULL (DbType = Int32), @p8='bot' (Nullable = false) (Size = 4000), @p9='widget' (Nullable = false) (Size = 4000), @p10='sent' (Size = 20), @p11=NULL (Size = 50), @p12='0' (Nullable = true), @p13=NULL (DbType = Int32), @p14='CREATE' (Size = 100), @p15='2025-11-24T20:19:54.6812470Z' (DbType = DateTime), @p16='Created new Message' (Size = 4000), @p17='-2147482643' (Nullable = true), @p18='Message' (Size = 100), @p19=NULL (Size = 45), @p20='{"Id":-2147482643,"BotId":24,"ConversationId":133,"CreatedAt":"2025-11-24T20:19:54.6809404Z","FileId":null,"MessageText":"Lo siento, no tengo acceso a informaci칩n relevante para responder a eso en este momento.","PublicUserId":2,"Read":false,"ReplyToMessageId":null,"Sender":"bot","Source":"widget","Status":"sent","TempId":null,"TokensUsed":0,"UserId":null}' (Size = 4000), @p21='' (Size = 4000), @p22=NULL (Size = 50), @p23=NULL (Size = 500), @p24=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Messages` (`bot_id`, `conversation_id`, `created_at`, `file_id`, `message_text`, `public_user_id`, `read`, `reply_to_message_id`, `sender`, `source`, `status`, `temp_id`, `tokens_used`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `Messages`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:54.688 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='133', @p0='2025-11-24T20:19:54.6873249Z' (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:54.6874167Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='133' (Nullable = true), @p6='Conversation' (Size = 100), @p7=NULL (Size = 45), @p8='{"UpdatedAt":"2025-11-24T20:19:54.6873249Z"}' (Size = 4000), @p9='{"UpdatedAt":"2025-11-24T20:19:46"}' (Size = 4000), @p10=NULL (Size = 50), @p11=NULL (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `updated_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:54.691 +01:00 [INF] 九 [Worker] Conversaci칩n actualizada con mensaje de 'no access'
2025-11-24 21:19:55.092 +01:00 [INF] SignalR disconnected: tERDePKeDMI5Mu_LEM6rfg user:null ex:null
2025-11-24 21:19:55.094 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-24 21:19:55.094 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 82641.1867ms
2025-11-24 21:19:55.096 +01:00 [WRN] Slow HTTP request detected: GET /chatHub - 82641.1867ms
2025-11-24 21:19:55.097 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=133&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=jQTRfxc-pE-XhFuFiHGCDg&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - 101 null null 82647.473ms
2025-11-24 21:19:55.104 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/conversations/133/disconnect - null 0
2025-11-24 21:19:55.106 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:55.107 +01:00 [WRN] CSRF token faltante en POST /api/conversations/133/disconnect
2025-11-24 21:19:55.107 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/conversations/133/disconnect - 403 null application/json; charset=utf-8 3.2205ms
2025-11-24 21:19:56.131 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - null null
2025-11-24 21:19:56.134 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.134 +01:00 [INF] HTTP GET /api/Bots/24/widget-settings started - IP: 127.0.0.1
2025-11-24 21:19:56.136 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-24 21:19:56.137 +01:00 [INF] Route matched with {action = "GetWidgetSettings", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[Voia.Api.Models.Bots.WidgetSettingsDto]] GetWidgetSettings(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:56.139 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - null null
2025-11-24 21:19:56.141 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.141 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:19:56.141 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/BotIntegrations/generate-widget-token - 204 null null 2.6336ms
2025-11-24 21:19:56.142 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - application/json 12
2025-11-24 21:19:56.143 +01:00 [INF] Executing OkObjectResult, writing value of type 'Voia.Api.Models.Bots.WidgetSettingsDto'.
2025-11-24 21:19:56.147 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.148 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api) in 9.8803ms
2025-11-24 21:19:56.148 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token started - IP: 127.0.0.1
2025-11-24 21:19:56.150 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetWidgetSettings (Voia.Api)'
2025-11-24 21:19:56.151 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:19:56.152 +01:00 [INF] HTTP GET /api/Bots/24/widget-settings completed - Status: 200 - Duration: 17.6948ms
2025-11-24 21:19:56.153 +01:00 [INF] Route matched with {action = "GenerateWidgetToken", controller = "BotIntegrations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GenerateWidgetToken(Voia.Api.Controllers.GenerateWidgetTokenRequest) on controller Voia.Api.Controllers.BotIntegrationsController (Voia.Api).
2025-11-24 21:19:56.154 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/widget-settings?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - 200 null application/json; charset=utf-8 22.7425ms
2025-11-24 21:19:56.158 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Bots` AS `b`
    WHERE `b`.`id` = @__request_BotId_0)
2025-11-24 21:19:56.160 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`completed_at`, `b`.`created_at`, `b`.`meta`, `b`.`phase`, `b`.`updated_at`
FROM `bot_phases` AS `b`
WHERE (`b`.`bot_id` = @__request_BotId_0) AND (`b`.`phase` = 'integration')
LIMIT 1
2025-11-24 21:19:56.164 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='UPDATE' (Size = 100), @p1='2025-11-24T20:19:56.1630215Z' (DbType = DateTime), @p2='Updated BotPhase' (Size = 4000), @p3='18' (Nullable = true), @p4='BotPhase' (Size = 100), @p5='127.0.0.1' (Size = 45), @p6='{"CompletedAt":"2025-11-24T20:19:56.1628775Z","Meta":"{\"source\":\"integration_script\",\"allowedDomain\":\"localhost\"}","UpdatedAt":"2025-11-24T20:19:56.162878Z"}' (Size = 4000), @p7='{"CompletedAt":"2025-11-24T20:19:14","Meta":"{\"source\": \"integration_script\", \"allowedDomain\": \"localhost\"}","UpdatedAt":"2025-11-24T20:19:14"}' (Size = 4000), @p8='0HNHBIONCKHU0:00000005' (Size = 50), @p9='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p10=NULL (DbType = Int32), @p14='18', @p11='2025-11-24T20:19:56.1628775Z' (Nullable = true) (DbType = DateTime), @p12='{"source":"integration_script","allowedDomain":"localhost"}' (Size = 4000), @p13='2025-11-24T20:19:56.1628780Z' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();

UPDATE `bot_phases` SET `completed_at` = @p11, `meta` = @p12, `updated_at` = @p13
WHERE `id` = @p14;
SELECT ROW_COUNT();
2025-11-24 21:19:56.169 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType30`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:56.170 +01:00 [INF] Executed action Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api) in 14.4428ms
2025-11-24 21:19:56.171 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotIntegrationsController.GenerateWidgetToken (Voia.Api)'
2025-11-24 21:19:56.172 +01:00 [INF] HTTP POST /api/BotIntegrations/generate-widget-token completed - Status: 200 - Duration: 23.2409ms
2025-11-24 21:19:56.173 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/BotIntegrations/generate-widget-token - 200 null application/json; charset=utf-8 30.8149ms
2025-11-24 21:19:56.256 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24 - null null
2025-11-24 21:19:56.258 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.259 +01:00 [INF] HTTP GET /api/Bots/24 started - IP: 127.0.0.1
2025-11-24 21:19:56.260 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-24 21:19:56.261 +01:00 [INF] Route matched with {action = "GetBotById", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotById(Int32) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:56.264 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
ORDER BY `b`.`id`, `u`.`Id`, `b0`.`id`
LIMIT 1
2025-11-24 21:19:56.267 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b1`.`id`, `b1`.`bot_id`, `b1`.`created_at`, `b1`.`description`, `b1`.`session_name`, `b1`.`updated_at`, `t`.`id`, `t`.`Id0`, `t`.`id1`
FROM (
    SELECT `b`.`id`, `u`.`Id` AS `Id0`, `b0`.`id` AS `id1`
    FROM `Bots` AS `b`
    INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
    LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
    WHERE `b`.`id` = @__id_0
    LIMIT 1
) AS `t`
INNER JOIN `bot_training_sessions` AS `b1` ON `t`.`id` = `b1`.`bot_id`
ORDER BY `t`.`id`, `t`.`Id0`, `t`.`id1`
2025-11-24 21:19:56.269 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType42`14[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType41`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:56.270 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotById (Voia.Api) in 8.6435ms
2025-11-24 21:19:56.271 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotById (Voia.Api)'
2025-11-24 21:19:56.272 +01:00 [INF] HTTP GET /api/Bots/24 completed - Status: 200 - Duration: 13.4549ms
2025-11-24 21:19:56.274 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24 - 200 null application/json; charset=utf-8 17.6506ms
2025-11-24 21:19:56.403 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - null null
2025-11-24 21:19:56.405 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.406 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/conversations/user-location - 204 null null 2.552ms
2025-11-24 21:19:56.407 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - null null
2025-11-24 21:19:56.409 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.410 +01:00 [INF] HTTP GET /api/conversations/user-location started - IP: 127.0.0.1
2025-11-24 21:19:56.410 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-24 21:19:56.411 +01:00 [INF] Route matched with {action = "GetUserLocation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetUserLocation() on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:56.413 +01:00 [INF] Geolocation for IP 190.147.2.0: Country=Colombia (CO), City=Bogot치
2025-11-24 21:19:56.414 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType94`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:56.415 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api) in 2.3332ms
2025-11-24 21:19:56.415 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetUserLocation (Voia.Api)'
2025-11-24 21:19:56.416 +01:00 [INF] HTTP GET /api/conversations/user-location completed - Status: 200 - Duration: 6.7621ms
2025-11-24 21:19:56.418 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/conversations/user-location - 200 null application/json; charset=utf-8 10.702ms
2025-11-24 21:19:56.484 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=24&country=Colombia&city=Bogot%C3%A1&language=es - null null
2025-11-24 21:19:56.484 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Bots/24/context - null null
2025-11-24 21:19:56.486 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.488 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:56.489 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location started - IP: 127.0.0.1
2025-11-24 21:19:56.489 +01:00 [INF] HTTP GET /api/Bots/24/context started - IP: 127.0.0.1
2025-11-24 21:19:56.490 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-24 21:19:56.491 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:56.492 +01:00 [INF] Route matched with {action = "GetByLocation", controller = "BotWelcomeMessages"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetByLocation(Int32, System.String, System.String, System.String) on controller Voia.Api.Controllers.BotWelcomeMessagesController (Voia.Api).
2025-11-24 21:19:56.492 +01:00 [INF] Route matched with {action = "GetBotContext", controller = "Bots"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Object]] GetBotContext(Int32, System.String) on controller Voia.Api.Controllers.BotsController (Voia.Api).
2025-11-24 21:19:56.495 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
WHERE `b`.`id` = @__botId_0
LIMIT 1
2025-11-24 21:19:56.496 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `b0`.`id`, `b0`.`allow_file_upload`, `b0`.`allow_image_upload`, `b0`.`avatar_url`, `b0`.`custom_css`, `b0`.`font_family`, `b0`.`header_background_color`, `b0`.`Name`, `b0`.`position`, `b0`.`primary_color`, `b0`.`secondary_color`, `b0`.`style_template_id`, `b0`.`theme`, `b0`.`Title`, `b0`.`updated_at`, `b0`.`user_id`
FROM `Bots` AS `b`
INNER JOIN `users` AS `u` ON `b`.`user_id` = `u`.`Id`
LEFT JOIN `bot_styles` AS `b0` ON `b`.`style_id` = `b0`.`id`
WHERE `b`.`id` = @__id_0
LIMIT 1
2025-11-24 21:19:56.498 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__city_2='Bogot치' (Size = 4000), @__language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND (`b`.`city` = @__city_2)) AND (`b`.`language` = @__language_3)
LIMIT 1
2025-11-24 21:19:56.499 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_AiModelConfigId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`id`, `a`.`created_at`, `a`.`frequency_penalty`, `a`.`ia_provider_id`, `a`.`model_name`, `a`.`presence_penalty`, `a`.`temperature`, `b`.`Id`, `b`.`api_endpoint`, `b`.`api_key`, `b`.`created_at`, `b`.`name`, `b`.`Status`, `b`.`updated_at`
FROM `ai_model_configs` AS `a`
INNER JOIN `bot_ia_providers` AS `b` ON `a`.`ia_provider_id` = `b`.`Id`
WHERE `a`.`id` = @__bot_AiModelConfigId_0
LIMIT 1
2025-11-24 21:19:56.501 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__botId_0='24' (Nullable = true), @__country_1='Colombia' (Size = 4000), @__language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__botId_0) AND (`b`.`country` = @__country_1)) AND `b`.`city` IS NULL) AND (`b`.`language` = @__language_2)
LIMIT 1
2025-11-24 21:19:56.502 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_BotTemplateId_0='1' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_template_id`, `b`.`Content`, `b`.`created_at`, `b`.`Role`, `b`.`updated_at`
FROM `bot_template_prompts` AS `b`
WHERE `b`.`bot_template_id` = @__bot_BotTemplateId_0
2025-11-24 21:19:56.504 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_botId_0='24' (Nullable = true), @__adminCountry_1='Colombia' (Size = 4000), @__adminCity_2='Bogot치 D.C.' (Size = 4000), @__8__locals1_language_3='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__8__locals1_botId_0) AND (`b`.`country` = @__adminCountry_1)) AND (`b`.`city` = @__adminCity_2)) AND (`b`.`language` = @__8__locals1_language_3)
LIMIT 1
2025-11-24 21:19:56.505 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`field_name` AS `FieldName`, `b`.`field_type` AS `FieldType`, COALESCE(`b`.`is_required`, FALSE) AS `IsRequired`
FROM `bot_data_capture_fields` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:56.506 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_botId_0='24' (Nullable = true), @__adminCountry_1='Colombia' (Size = 4000), @__8__locals1_language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE (((`b`.`bot_id` = @__8__locals1_botId_0) AND (`b`.`country` = @__adminCountry_1)) AND `b`.`city` IS NULL) AND (`b`.`language` = @__8__locals1_language_2)
LIMIT 1
2025-11-24 21:19:56.507 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`bot_id`, `b`.`bot_template_id`, `b`.`content`, `b`.`created_at`, `b`.`role`, `b`.`template_training_session_id`, `b`.`updated_at`
FROM `bot_custom_prompts` AS `b`
WHERE `b`.`bot_id` = @__bot_Id_0
ORDER BY `b`.`id`
2025-11-24 21:19:56.509 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__country_0='Colombia' (Size = 4000), @__city_1='Bogot치' (Size = 4000), @__language_2='es' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`Id`, `b`.`bot_id`, `b`.`city`, `b`.`country`, `b`.`created_at`, `b`.`language`, `b`.`message`
FROM `bot_welcome_messages` AS `b`
WHERE ((`b`.`bot_id` IS NULL AND (`b`.`country` = @__country_0)) AND (`b`.`city` = @__city_1)) AND (`b`.`language` = @__language_2)
LIMIT 1
2025-11-24 21:19:56.510 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`url`
FROM `training_urls` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:56.511 +01:00 [INF] Welcome message for Bot 24: LEVEL 5 - GENERIC EXACT (Colombia/Bogot치)
2025-11-24 21:19:56.512 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType59`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:56.512 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`content`
FROM `training_custom_texts` AS `t`
WHERE `t`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:56.513 +01:00 [INF] Executed action Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api) in 19.8229ms
2025-11-24 21:19:56.515 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__bot_Id_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `u`.`file_name`
FROM `uploaded_documents` AS `u`
WHERE `u`.`bot_id` = @__bot_Id_0
2025-11-24 21:19:56.515 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotWelcomeMessagesController.GetByLocation (Voia.Api)'
2025-11-24 21:19:56.517 +01:00 [INF] Start processing HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=&limit=5
2025-11-24 21:19:56.517 +01:00 [INF] HTTP GET /api/botwelcomemessages/get-by-location completed - Status: 200 - Duration: 28.4998ms
2025-11-24 21:19:56.518 +01:00 [INF] Sending HTTP request GET http://localhost:8000/search_vectors?bot_id=24&query=&limit=5
2025-11-24 21:19:56.520 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/botwelcomemessages/get-by-location?botId=24&country=Colombia&city=Bogot%C3%A1&language=es - 200 null application/json; charset=utf-8 35.0662ms
2025-11-24 21:19:57.781 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - null null
2025-11-24 21:19:57.783 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:57.783 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/Conversations/get-or-create - 204 null null 2.6585ms
2025-11-24 21:19:57.785 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 410
2025-11-24 21:19:57.787 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:57.788 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-24 21:19:57.789 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-24 21:19:57.790 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:57.793 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='24', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTU5NiwiZXhwIjoxNzk1NTUxNTk2LCJpYXQiOjE3NjQwMTU1OTYsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.iNxKZiLReZhUk-miOxOevIzCUFkHoaT4r4R28l60Nic' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-24 21:19:57.796 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-24 21:19:57.798 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='2ba988196c386530340ae35fa5ad498700a82bc10d9e0e53153bb8de033207a5' (Size = 256), @__8__locals1_dto_BotId_2='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-24 21:19:57.802 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='24', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-24T20:19:57.8003855Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='2' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-24T20:19:57.8003851Z' (DbType = DateTime), @p16='3', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-24T20:19:57.8007113Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482646' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482646,"ActiveMobileSession":false,"Blocked":false,"BotId":24,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-24T20:19:57.8003855Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":2,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-24T20:19:57.8003851Z","UserId":3,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHBIONCKHTR:00000008' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:57.807 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:19:57.808 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 16.5414ms
2025-11-24 21:19:57.808 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-24 21:19:57.809 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 21.2939ms
2025-11-24 21:19:57.810 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 25.7112ms
2025-11-24 21:19:57.814 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null null
2025-11-24 21:19:57.816 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:57.816 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 204 null null 2.4819ms
2025-11-24 21:19:57.818 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null 0
2025-11-24 21:19:57.821 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:57.821 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-24 21:19:57.822 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-24 21:19:57.823 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-24 21:19:57.824 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.6395ms
2025-11-24 21:19:57.826 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 200 316 application/json 7.7256ms
2025-11-24 21:19:57.827 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=1mUqvJn3IC6_JcsKk8QiBA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - null null
2025-11-24 21:19:57.830 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:57.831 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-24 21:19:57.832 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-24 21:19:57.834 +01:00 [INF] SignalR connected: 0e79MuGcZnJ6bS7g_sgCEw user:null
2025-11-24 21:19:57.843 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:19:57.845 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='134', @p0='2025-11-24T20:19:57.8447591Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:19:57.8448646Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='134' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:19:57.8447591Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHBIONCKHU3:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:19:58.333 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/134 - null null
2025-11-24 21:19:58.335 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:19:58.336 +01:00 [INF] HTTP GET /api/Conversations/history/134 started - IP: 127.0.0.1
2025-11-24 21:19:58.337 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:58.337 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:19:58.340 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:19:58.342 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `users` AS `u` ON `m`.`user_id` = `u`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-24 21:19:58.344 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='134'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN `u`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN COALESCE(`u`.`avatar_url`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `users` AS `u` ON `c`.`user_id` = `u`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-24 21:19:58.346 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:58.347 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.4837ms
2025-11-24 21:19:58.348 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:19:58.349 +01:00 [INF] HTTP GET /api/Conversations/history/134 completed - Status: 200 - Duration: 13.0021ms
2025-11-24 21:19:58.350 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/134 - 200 null application/json; charset=utf-8 16.7984ms
2025-11-24 21:19:59.520 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType45`9[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType46`3[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType47`6[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Decimal, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Voia.Api.Models.BotStyle, Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType48`4[[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[<>f__AnonymousType49`1[[System.Collections.Generic.IEnumerable`1[[<>f__AnonymousType50`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:59.521 +01:00 [INF] Executed action Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api) in 3026.4185ms
2025-11-24 21:19:59.522 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.BotsController.GetBotContext (Voia.Api)'
2025-11-24 21:19:59.523 +01:00 [INF] HTTP GET /api/Bots/24/context completed - Status: 200 - Duration: 3033.3919ms
2025-11-24 21:19:59.524 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Bots/24/context - 200 null application/json; charset=utf-8 3039.3745ms
2025-11-24 21:20:00.744 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__inactivityThreshold_0='2025-11-24T20:05:00.7362511Z' (Nullable = true) (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE (`c`.`status` = 'activa') AND (`c`.`last_active_at` < @__inactivityThreshold_0)
2025-11-24 21:20:01.220 +01:00 [INF] SignalR disconnected: 0e79MuGcZnJ6bS7g_sgCEw user:null ex:null
2025-11-24 21:20:01.221 +01:00 [INF] Executed endpoint '/chatHub'
2025-11-24 21:20:01.222 +01:00 [INF] HTTP GET /chatHub completed - Status: 101 - Duration: 3391.6742ms
2025-11-24 21:20:01.223 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=134&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=1mUqvJn3IC6_JcsKk8QiBA&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - 101 null null 3396.6641ms
2025-11-24 21:20:01.903 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - application/json 410
2025-11-24 21:20:01.905 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:01.906 +01:00 [INF] HTTP POST /api/Conversations/get-or-create started - IP: 127.0.0.1
2025-11-24 21:20:01.907 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-24 21:20:01.907 +01:00 [INF] Route matched with {action = "CreateOrGetConversation", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateOrGetConversation(CreateConversationDto) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:20:01.910 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='24', @__8__locals1_dto_ClientSecret_1='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTU5NiwiZXhwIjoxNzk1NTUxNTk2LCJpYXQiOjE3NjQwMTU1OTYsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.iNxKZiLReZhUk-miOxOevIzCUFkHoaT4r4R28l60Nic' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`allowed_origins`, `b`.`bot_id`, `b`.`client_secret`, `b`.`created_at`, `b`.`is_active`, `b`.`updated_at`
FROM `bot_api_settings` AS `b`
WHERE ((`b`.`bot_id` = @__8__locals1_dto_BotId_0) AND (`b`.`client_secret` = @__8__locals1_dto_ClientSecret_1)) AND `b`.`is_active`
LIMIT 1
2025-11-24 21:20:01.912 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__8__locals1_dto_BotId_0='24'], CommandType='"Text"', CommandTimeout='30']
SELECT `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Bots` AS `b`
WHERE (`b`.`id` = @__8__locals1_dto_BotId_0) AND `b`.`is_active`
LIMIT 1
2025-11-24 21:20:01.914 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__ipAddress_0='127.0.0.1' (Size = 4000), @__8__locals1_dto_BrowserFingerprint_1='2ba988196c386530340ae35fa5ad498700a82bc10d9e0e53153bb8de033207a5' (Size = 256), @__8__locals1_dto_BotId_2='24' (Nullable = true)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`
FROM `public_users` AS `p`
WHERE ((`p`.`ip_address` = @__ipAddress_0) AND (`p`.`browser_fingerprint` = @__8__locals1_dto_BrowserFingerprint_1)) AND (`p`.`bot_id` = @__8__locals1_dto_BotId_2)
LIMIT 1
2025-11-24 21:20:01.917 +01:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='False', @p1='False', @p2='24', @p3=NULL (Size = 4000), @p4=NULL (DbType = DateTime), @p5='2025-11-24T20:20:01.9154838Z' (DbType = DateTime), @p6=NULL (DbType = DateTime), @p7='True', @p8=NULL (DbType = DateTime), @p9=NULL (Size = 4000), @p10=NULL (Size = 4000), @p11=NULL (DbType = DateTime), @p12='2' (Nullable = true), @p13='active' (Nullable = false) (Size = 255), @p14='Widget Chat' (Size = 4000), @p15='2025-11-24T20:20:01.9154834Z' (DbType = DateTime), @p16='3', @p17=NULL (Size = 4000), @p18='CREATE' (Size = 100), @p19='2025-11-24T20:20:01.9159871Z' (DbType = DateTime), @p20='Created new Conversation' (Size = 4000), @p21='-2147482645' (Nullable = true), @p22='Conversation' (Size = 100), @p23='127.0.0.1' (Size = 45), @p24='{"Id":-2147482645,"ActiveMobileSession":false,"Blocked":false,"BotId":24,"BotResponse":null,"ClosedAt":null,"CreatedAt":"2025-11-24T20:20:01.9154838Z","ExpiresAt":null,"IsWithAI":true,"LastActiveAt":null,"LastMessage":null,"MobileDeviceType":null,"MobileJoinedAt":null,"PublicUserId":2,"Status":"active","Title":"Widget Chat","UpdatedAt":"2025-11-24T20:20:01.9154834Z","UserId":3,"UserMessage":null}' (Size = 4000), @p25='' (Size = 4000), @p26='0HNHBIONCKHTR:00000009' (Size = 50), @p27='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p28=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Conversations` (`active_mobile_session`, `blocked`, `bot_id`, `bot_response`, `closed_at`, `created_at`, `expires_at`, `is_with_ai`, `last_active_at`, `last_message`, `mobile_device_type`, `mobile_joined_at`, `public_user_id`, `status`, `Title`, `updated_at`, `user_id`, `user_message`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Conversations`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:20:01.921 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType69`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:20:01.922 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api) in 13.4743ms
2025-11-24 21:20:01.923 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.CreateOrGetConversation (Voia.Api)'
2025-11-24 21:20:01.923 +01:00 [INF] HTTP POST /api/Conversations/get-or-create completed - Status: 200 - Duration: 17.7439ms
2025-11-24 21:20:01.925 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/Conversations/get-or-create - 200 null application/json; charset=utf-8 21.4102ms
2025-11-24 21:20:01.928 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null null
2025-11-24 21:20:01.930 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:01.930 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 204 null null 2.102ms
2025-11-24 21:20:01.931 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - null 0
2025-11-24 21:20:01.934 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:01.935 +01:00 [INF] HTTP POST /chatHub/negotiate started - IP: 127.0.0.1
2025-11-24 21:20:01.936 +01:00 [INF] Executing endpoint '/chatHub/negotiate'
2025-11-24 21:20:01.937 +01:00 [INF] Executed endpoint '/chatHub/negotiate'
2025-11-24 21:20:01.937 +01:00 [INF] HTTP POST /chatHub/negotiate completed - Status: 200 - Duration: 2.4381ms
2025-11-24 21:20:01.939 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/chatHub/negotiate?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&negotiateVersion=1 - 200 316 application/json 7.2327ms
2025-11-24 21:20:01.941 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/chatHub?conversationId=135&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g&id=WDH0BK9g8kihLDlMPHuCPw&access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJib3RJZCI6IjI0IiwiYWxsb3dlZERvbWFpbiI6ImxvY2FsaG9zdCIsIm5iZiI6MTc2NDAxNTMxOCwiZXhwIjoxNzk1NTUxMzE4LCJpYXQiOjE3NjQwMTUzMTgsImlzcyI6IlZvaWEuQXBpIiwiYXVkIjoiVm9pYS5DbGllbnQifQ.qMHqYuPkLVyTKChopHoPtu2joXUmHOYofl7oS0Cla8g - null null
2025-11-24 21:20:01.943 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:01.944 +01:00 [INF] HTTP GET /chatHub started - IP: 127.0.0.1
2025-11-24 21:20:01.945 +01:00 [INF] Executing endpoint '/chatHub'
2025-11-24 21:20:01.947 +01:00 [INF] SignalR connected: o9DowcDdr2RXWAt3q_nG7Q user:null
2025-11-24 21:20:01.953 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__p_0
LIMIT 1
2025-11-24 21:20:01.956 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='135', @p0='2025-11-24T20:20:01.9550706Z' (Nullable = true) (DbType = DateTime), @p2='UPDATE' (Size = 100), @p3='2025-11-24T20:20:01.9551943Z' (DbType = DateTime), @p4='Updated Conversation' (Size = 4000), @p5='135' (Nullable = true), @p6='Conversation' (Size = 100), @p7='127.0.0.1' (Size = 45), @p8='{"LastActiveAt":"2025-11-24T20:20:01.9550706Z"}' (Size = 4000), @p9='{"LastActiveAt":null}' (Size = 4000), @p10='0HNHBIONCKHU4:00000001' (Size = 50), @p11='Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:145.0) Gecko/20100101 Firefox/145.0' (Size = 500), @p12=NULL (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Conversations` SET `last_active_at` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `activity_logs` (`action`, `created_at`, `description`, `entity_id`, `entity_type`, `ip_address`, `new_values`, `old_values`, `request_id`, `user_agent`, `user_id`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12);
SELECT `id`
FROM `activity_logs`
WHERE ROW_COUNT() = 1 AND `id` = LAST_INSERT_ID();
2025-11-24 21:20:02.455 +01:00 [INF] Request starting HTTP/1.1 GET http://localhost:5006/api/Conversations/history/135 - null null
2025-11-24 21:20:02.456 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:02.457 +01:00 [INF] HTTP GET /api/Conversations/history/135 started - IP: 127.0.0.1
2025-11-24 21:20:02.458 +01:00 [INF] Executing endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:20:02.458 +01:00 [INF] Route matched with {action = "GetConversationHistory", controller = "Conversations"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetConversationHistory(Int32) on controller Voia.Api.Controllers.ConversationsController (Voia.Api).
2025-11-24 21:20:02.461 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`active_mobile_session`, `c`.`blocked`, `c`.`bot_id`, `c`.`bot_response`, `c`.`closed_at`, `c`.`created_at`, `c`.`expires_at`, `c`.`is_with_ai`, `c`.`last_active_at`, `c`.`last_message`, `c`.`mobile_device_type`, `c`.`mobile_joined_at`, `c`.`public_user_id`, `c`.`status`, `c`.`Title`, `c`.`updated_at`, `c`.`user_id`, `c`.`user_message`
FROM `Conversations` AS `c`
WHERE `c`.`Id` = @__conversationId_0
LIMIT 1
2025-11-24 21:20:02.463 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `m`.`Id`, `m`.`bot_id`, `m`.`conversation_id`, `m`.`created_at`, `m`.`file_id`, `m`.`message_text`, `m`.`public_user_id`, `m`.`read`, `m`.`reply_to_message_id`, `m`.`sender`, `m`.`source`, `m`.`status`, `m`.`temp_id`, `m`.`tokens_used`, `m`.`user_id`, `u`.`Id`, `u`.`AccessFailedCount`, `u`.`address`, `u`.`avatar_url`, `u`.`City`, `u`.`ConcurrencyStamp`, `u`.`Country`, `u`.`created_at`, `u`.`document_number`, `u`.`document_photo_url`, `u`.`document_type_id`, `u`.`Email`, `u`.`EmailConfirmed`, `u`.`IsActive`, `u`.`is_verified`, `u`.`LockoutEnabled`, `u`.`LockoutEnd`, `u`.`Name`, `u`.`NormalizedEmail`, `u`.`NormalizedUserName`, `u`.`PasswordHash`, `u`.`phone`, `u`.`PhoneNumber`, `u`.`PhoneNumberConfirmed`, `u`.`PublicDataToken`, `u`.`role_id`, `u`.`SecurityStamp`, `u`.`Status`, `u`.`TwoFactorEnabled`, `u`.`updated_at`, `u`.`UserName`, `p`.`Id`, `p`.`bot_id`, `p`.`browser_fingerprint`, `p`.`city`, `p`.`country`, `p`.`created_at`, `p`.`ip_address`, `p`.`user_agent`, `b`.`id`, `b`.`ai_model_config_id`, `b`.`api_key`, `b`.`bot_template_id`, `b`.`created_at`, `b`.`description`, `b`.`ia_provider_id`, `b`.`is_active`, `b`.`is_deleted`, `b`.`is_ready`, `b`.`name`, `b`.`style_id`, `b`.`updated_at`, `b`.`user_id`
FROM `Messages` AS `m`
LEFT JOIN `users` AS `u` ON `m`.`user_id` = `u`.`Id`
LEFT JOIN `public_users` AS `p` ON `m`.`public_user_id` = `p`.`Id`
LEFT JOIN `Bots` AS `b` ON `m`.`bot_id` = `b`.`id`
WHERE `m`.`conversation_id` = @__conversationId_0
ORDER BY `m`.`created_at`
2025-11-24 21:20:02.465 +01:00 [INF] Executed DbCommand (0ms) [Parameters=[@__conversationId_0='135'], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, CASE
    WHEN `c`.`file_type` IS NOT NULL AND (`c`.`file_type` LIKE 'image%') THEN 'image'
    ELSE 'file'
END AS `Type`, COALESCE(`c`.`uploaded_at`, UTC_TIMESTAMP()) AS `Timestamp`, 'user' AS `FromRole`, `c`.`user_id` AS `FromId`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN `u`.`Name`
    ELSE 'Usuario'
END AS `FromName`, CASE
    WHEN `u`.`Id` IS NOT NULL THEN COALESCE(`u`.`avatar_url`, '')
    ELSE ''
END AS `FromAvatarUrl`, `c`.`file_path` AS `FileUrl`, `c`.`file_name` AS `FileName`, `c`.`file_type` AS `FileType`
FROM `chat_uploaded_files` AS `c`
LEFT JOIN `users` AS `u` ON `c`.`user_id` = `u`.`Id`
WHERE `c`.`conversation_id` = @__conversationId_0
2025-11-24 21:20:02.466 +01:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType75`3[[<>f__AnonymousType76`4[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.Collections.Generic.List`1[[<>f__AnonymousType74`12[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Nullable`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType77`2[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[<>f__AnonymousType73`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], Voia.Api, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:20:02.467 +01:00 [INF] Executed action Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api) in 8.0421ms
2025-11-24 21:20:02.468 +01:00 [INF] Executed endpoint 'Voia.Api.Controllers.ConversationsController.GetConversationHistory (Voia.Api)'
2025-11-24 21:20:02.469 +01:00 [INF] HTTP GET /api/Conversations/history/135 completed - Status: 200 - Duration: 12.3323ms
2025-11-24 21:20:02.471 +01:00 [INF] Request finished HTTP/1.1 GET http://localhost:5006/api/Conversations/history/135 - 200 null application/json; charset=utf-8 15.9947ms
2025-11-24 21:20:12.459 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/ChatUploadedFiles - multipart/form-data; boundary=----geckoformboundary5ddfc1cf23fcef1979d98d170d80330f 98329
2025-11-24 21:20:12.461 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:12.461 +01:00 [WRN] CSRF token faltante en POST /api/ChatUploadedFiles
2025-11-24 21:20:12.462 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/ChatUploadedFiles - 403 null application/json; charset=utf-8 3.1588ms
2025-11-24 21:20:12.472 +01:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5006/api/ChatUploadedFiles/presigned - null null
2025-11-24 21:20:12.474 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:12.474 +01:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5006/api/ChatUploadedFiles/presigned - 204 null null 2.1081ms
2025-11-24 21:20:12.476 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5006/api/ChatUploadedFiles/presigned - application/json 116
2025-11-24 21:20:12.478 +01:00 [INF] CORS policy execution successful.
2025-11-24 21:20:12.479 +01:00 [WRN] CSRF token faltante en POST /api/ChatUploadedFiles/presigned
2025-11-24 21:20:12.479 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5006/api/ChatUploadedFiles/presigned - 403 null application/json; charset=utf-8 3.1722ms
